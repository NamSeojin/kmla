window.graphica=window.graphica||{};graphica.Axis=function(d,c,b,a){this._hierarchical_data={parent_variable:null,parent_value:null,child_variable:null,segments:null,max_cats_per_axis:0,cats_padding:0};if(typeof a!=="undefined"&&a!==null){if(typeof a.parent_variable!=="undefined"){this._hierarchical_data.parent_variable=a.parent_variable}if(typeof a.parent_value!=="undefined"){this._hierarchical_data.parent_value=a.parent_value}if(typeof a.child_variable!=="undefined"){this._hierarchical_data.child_variable=a.child_variable}if(typeof a.segments!=="undefined"){this._hierarchical_data.segments=a.segments}if(typeof a.max_cats_per_axis=="number"){this._hierarchical_data.max_cats_per_axis=a.max_cats_per_axis}if(typeof a.cats_padding=="number"){this._hierarchical_data.cats_padding=a.cats_padding}}this.vp=d;this._dataset=d._ds_without_subdivision||d.getDataset(c);this._variable=c;this._variable_name=this._dataset.columnName(c);this._variable_type=this._dataset.columnType(c);this._is_variable_categorical=this._dataset.isCategorical(this._variable);this._is_variable_quantitative=this._dataset.isQuantitative(c);this._is_date_type=this._dataset.isDateType(this._variable);this._show_all_values=false;if(b&&b=="radar"){this._property=graphica.AREA;this._property_name="AREA";this.orientation="vertical"}else{this._orientation=b||"horizontal";if(this._orientation=="vertical"){this._property=graphica.POS_Y;this._property_name="AXIS_Y"}else{this._property=graphica.POS_X;this._property_name="AXIS_X"}}this._stat=this.vp.getSettings(this._variable,this._property,"aggregation");if(this._variable_type=="date"&&graphica.Utils.isDateTickSmallerThan(this._stat,this._dataset.tickUnit(this._variable))){this._stat=this._dataset.tickUnit(this._variable)}this._is_integer=(this._dataset.isInteger(this._variable)&&this._stat!="average"&&this._stat!="median");this._min=this._dataset.min(this._variable,this._stat);this._max=this._dataset.max(this._variable,this._stat);this._bin_width=this._dataset.binWidth(this._variable,this._stat);this._is_interval=false;if(this._is_variable_quantitative){this._max+=this._bin_width;this._range=this._max-this._min}this._visible=true;this._scale="lin";this._ticks=null;this._ticks_values=[];this._tick_unit;this._ticks_labels=[];this._ticks_values_index={};this._ticks_posicion=[];this._length=400;this._orientation_reversed=false;this._reversed=false;this._axis_color="rgb(220,220,220)";this._ticks_color="rgb(220,220,220)";this._ticks_shape="line";this._grid_lines_color="rgb(220,220,220)";this._division_color="rgb(220,220,220)";this._labels_color="rgb(70,70,70)";this._legend_color="rgb(70,70,70)";this._legend_label="";this._legend_align="";this._user_change_legend_align=false;this._legend_orientation="horizontal";this._show_line=true;this._show_ticks=true;this._show_labels=true;this._ticks_format="inner";this._include_zero=true;this._show_legend=true;this._range_type="uniform";this._thousands_abbreviation="k";this._millions_abbreviation="M";this._billions_abbreviation="G";this.padding_poslabel=8;this._show_only_ticks_end_labels=false;this._cut_min=false;this._label_size=14;this._label_font="";this._labels_font="";this._labels_align="center";if(this._orientation=="vertical"){this._labels_align="right"}this._user_change_labels_align=false;this._labels_vertical_align="middle";this._legend_size=14;this._low_padding=20;this._high_padding=20;this._show_grid_lines=false;this._grid_lines_type="2,2";if(this._is_variable_quantitative){this._show_grid_lines=true;this._show_ticks=false;this._show_line=false}else{this._grid_lines_type="solid"}this._grid_lines_relative_position=null;if(this._variable_type=="date"){this._grid_lines_relative_position="inner"}else{if(this._variable_type=="string"){this._grid_lines_relative_position="outer"}}this._label_date_format=null;this._forcelimits=false;this._grape=new Grape().enableEvents(false);if(this._orientation=="vertical"){this._grape.addClass("graphica-axis-y")}else{this._grape.addClass("graphica-axis-x")}this._sub_grape=new Grape().addTo(this._grape);this._min_posicion=0;this._max_posicion=this._length;this._x_origin=0;this._y_origin=0;this._is_vertical_labels_allowed=true;this._is_bar_axis=false;this._cell_padding=false;this._cell_padding_value=16;this._padding_between_areas=0;this._maxrang=this._max_posicion-this._min_posicion};graphica.Axis.fn=graphica.Axis.prototype;graphica.Axis.fn.reversed=function(a){if(a==false){this._reversed=false}else{this._reversed=true}return this};graphica.Axis.fn.scale=function(a){if(a=="lin"||a=="log2"||a=="log10"){this._scale=a;this._grape.addClass("graphica-axis-"+a)}if(this._min<0.01&&a=="log10"){this.min(0.01)}else{if(this._min<0&&a=="log2"){this.min(0)}}return this};graphica.Axis.fn.lin=function(){return this.scale("lin")};graphica.Axis.fn.log2=function(){return this.scale("log2")};graphica.Axis.fn.log10=function(){return this.scale("log10")};graphica.Axis.fn.orientation_reversed=function(a){if(a===true){this._orientation_reversed=true}else{this._orientation_reversed=false}return this};graphica.Axis.fn.ticks_format=function(a){if(a=="inner"||a=="outer"){this._ticks_format=a}return this};graphica.Axis.fn.min=function(a){if(typeof a!=="number"){return this._min}this._min=a;this._range=this._max-this._min;if(this._min<0&&this._scale!="lin"){this._scale="lin"}return this};graphica.Axis.fn.max=function(a){if(typeof a!=="number"){return this._max}this._max=a;this._range=this._max-this._min;return this};graphica.Axis.fn.ticks=function(a){if(this._is_variable_quantitative&&a>=2){this._ticks=a}};graphica.Axis.fn.applySettings=function(a){if(typeof this.vp.shared_min!=="undefined"){this.min(this.vp.shared_min);this.max(this.vp.shared_max);this._forcelimits=true}else{if(typeof a.barmin!=="undefined"){this.min(a.barmin)}if(typeof a.barmax!=="undefined"){this.max(a.barmax)}if(typeof a.min==="number"){this.min(a.min);this._forcelimits=true}if(typeof a.max==="number"){this.max(Math.max(a.max,this._min));this._forcelimits=true}}if(typeof a.ticks==="number"){this.ticks(a.ticks)}if(typeof a.scale==="string"){this.scale(a.scale)}if(typeof a.padding=="number"){this._low_padding=a.padding;this._high_padding=a.padding}if(typeof a.show_ticks=="boolean"){this._show_ticks=a.show_ticks}if(typeof a.show_title=="boolean"){this._show_legend=a.show_title}if(typeof a.show_labels=="boolean"){this._show_labels=a.show_labels}if(typeof a.show_label=="boolean"){this._show_legend=a.show_label}if(typeof a.show_line=="boolean"){this._show_line=a.show_line}if(typeof a.show_grid_lines==="boolean"){this._show_grid_lines=a.show_grid_lines}if(typeof a.grid_lines_type==="string"){this._grid_lines_type=a.grid_lines_type}if(typeof a.grid_lines_relative_position==="string"){this._grid_lines_relative_position=a.grid_lines_relative_position}if(typeof a.range==="string"){this._range_type=a.range}if(typeof a.visible=="boolean"){this._visible=a.visible}if(typeof a.thousands_abbreviation=="string"){this._thousands_abbreviation=a.thousands_abbreviation}if(typeof a.millions_abbreviation=="string"){this._millions_abbreviation=a.millions_abbreviation}if(typeof a.billions_abbreviation=="string"){this._billions_abbreviation=a.billions_abbreviation}if(raceme._getRGB(a.grid_lines_color)!==false){this._grid_lines_color=a.grid_lines_color;this._axis_color=a.grid_lines_color;this._ticks_color=a.grid_lines_color}if(typeof a.label==="string"){this._legend_label=a.label}if(typeof a.labels_size==="number"){this._label_size=a.labels_size}if(typeof a.label_size==="number"){this._legend_size=a.label_size}if(typeof a.labels_font==="string"){this._labels_font=a.labels_font}if(typeof a.label_font==="string"){this._label_font=a.label_font}if(typeof a.label_align==="string"){this._legend_align=a.label_align;this._user_change_legend_align=true}if(typeof a.labels_align==="string"){this._labels_align=a.labels_align;this._user_change_labels_align=true}if(raceme._getRGB(a.labels_color)){this._labels_color=a.labels_color}if(raceme._getRGB(a.label_color)){this._legend_color=a.label_color}if(typeof a.labels_vertical_align==="string"){this._labels_vertical_align=a.labels_vertical_align}if(typeof a.label_date_format==="string"){this._label_date_format=a.label_date_format}if(typeof a.cell_padding=="boolean"){this._cell_padding=a.cell_padding}if(typeof a.cell_padding_value=="number"){this._cell_padding_value=a.cell_padding_value}if(typeof a.reversed==="boolean"){this._reversed=a.reversed}if(typeof a.orientation==="string"){if(this._orientation=="horizontal"){if(a.orientation=="top"){this._orientation_reversed=true}else{if(a.orientation=="bottom"){this._orientation_reversed=false}}}else{if(a.orientation=="right"){this._orientation_reversed=true;if(this._user_change_labels_align==false){this._labels_align="left"}if(this._user_change_legend_align==false){this._legend_align="right"}}else{if(a.orientation=="left"){this._orientation_reversed=false}}}}};graphica.Axis.fn.legend_size=function(a){this._legend_size=a;return this};graphica.Axis.fn.length=function(a){this._length=Math.max(0,a);return this};graphica.Axis.fn.init=function(){if(this._visible==false){this._show_ticks=false;this._show_legend=false;this._show_labels=false}if(this._orientation=="vertical"&&this._legend_orientation=="horizontal"&&this._show_legend){this._y_origin=this._legend_size*2;this._length-=this._y_origin}if(this._is_variable_quantitative){this._is_vertical_labels_allowed=false;this._ticks=parseInt(this._length/70);if(this._ticks==0){this._ticks=1}if(this._scale=="lin"){this._numericNiceScale()}else{if(this._scale=="log2"){this._log2Scale()}else{if(this._scale=="log10"){this._log10Scale()}}}}else{if(this._is_date_type){if(this._stat){this._tick_unit=this._stat}else{this._tick_unit=this.vp._ds.tickUnit(this._variable)}this._ticks=this.vp._ds.getDateTicksNumber(this._variable,this._tick_unit);tmpl=48;if(this._orientation=="vertical"){tmpl=24}this.datejumps=1;this.secondarydatejumps=1;var a=false;if(this._length/this._ticks<tmpl){if(this._tick_unit=="year"){this.datejumps=5;if(this._length/this._ticks*this.datejumps<tmpl){this.datejumps=10}if(this._length/this._ticks*this.datejumps<tmpl){this.datejumps=25}if(this._length/this._ticks*this.datejumps<tmpl){this.datejumps=50}if(this._length/this._ticks*this.datejumps<tmpl){this.datejumps=100}}else{if(this._tick_unit=="quarter"){this.datejumps=4;while(this._length/this._ticks*this.datejumps<tmpl&&this.datejumps<64){this.datejumps*=2}}else{if(this._tick_unit=="month"){this.datejumps=2;if(this._length/this._ticks*this.datejumps<tmpl){this.datejumps=4}if(this._length/this._ticks*this.datejumps<tmpl){this.datejumps=6}while(this._length/this._ticks*this.datejumps<tmpl&&this.datejumps<48){this.datejumps*=2}}else{if(this._tick_unit=="day"){this.datejumps=15;if(this._length/this._ticks*this.datejumps<tmpl){this.datejumps=30}if(this.datejumps==30){if(this._min.getUTCDate()>1){this._min=new Date(this._min.getTime());this._min.setUTCDate(1);a=true}if(this._max.getUTCDate()>1){this._max=new Date(this._max.getTime());this._max.setUTCDate(1);this._max.setUTCMonth(this._max.getUTCMonth()+1);a=true}}else{if(this._min.getUTCDate()>15){this._min=new Date(this._min.getTime());this._min.setUTCDate(15);a=true}else{if(this._min.getUTCDate()>1&&this._min.getUTCDate()<15){this._min=new Date(this._min.getTime());this._min.setUTCDate(1);a=true}}}}else{if(this._tick_unit=="hour"){this.datejumps=3;while(this._length/this._ticks*this.datejumps<tmpl&&this.datejumps<525960){this.datejumps*=2}}else{if(this._tick_unit=="minute"){this.datejumps=5;if(this._length/this._ticks*this.datejumps<tmpl){this.datejumps=15}while(this._length/this._ticks*this.datejumps<tmpl&&this.datejumps<31557600){this.datejumps*=2}}else{if(this._tick_unit=="second"){this.datejumps=5;if(this._length/this._ticks*this.datejumps<tmpl){this.datejumps=15}while(this._length/this._ticks*this.datejumps<tmpl&&this.datejumps<1893456000){this.datejumps*=2}}}}}}}}}if(a){this._ticks=this.vp._ds.getDateTicksNumber(this._variable,this._tick_unit,this._min,this._max)}}else{if(this._is_variable_categorical){this._ticks_values=this.vp.getOrderedItems(this._variable,this._property,this._hierarchical_data.parent_variable,this._hierarchical_data.parent_value);this._ticks=this._ticks_values.length;for(var b=0;b<this._ticks_values.length;b++){this._ticks_values_index[this._ticks_values[b]]=b}if(this._hierarchical_data.child_variable!==null){this._sub_ticks_values={};this._sub_ticks=this.vp.getOrderedItems(this._hierarchical_data.child_variable,this._property).length;for(var b=0;b<this._ticks_values.length;b++){this._sub_ticks_values[this._ticks_values[b]]=this.vp.getOrderedItems(this._hierarchical_data.child_variable,this._property,this._variable,this._ticks_values[b])}}}}}this._format_labels();if(this._legend_label==""){this._legend_label=this._variable_name}if(this._length<((this._low_padding+this._high_padding)*1.1)){this._low_padding=0;this._high_padding=0}if(this._ticks_format=="inner"&&(this._is_variable_categorical||this._is_date_type)){this._low_padding=Math.max(this._low_padding,this._length/this._ticks/2);this._high_padding=Math.max(this._high_padding,this._length/this._ticks/2)}this._min_posicion=this._low_padding;this._max_posicion=this._length-this._high_padding;if(this._is_variable_categorical&&this._hierarchical_data.max_cats_per_axis){if(((this._hierarchical_data.max_cats_per_axis)*this._hierarchical_data.cats_padding)>(this._max_posicion-this._min_posicion)*0.5){this._hierarchical_data.cats_padding=(this._max_posicion-this._min_posicion)*0.5/this._hierarchical_data.max_cats_per_axis}this._maxrang=Math.max(0,(this._max_posicion-this._min_posicion)-((this._hierarchical_data.max_cats_per_axis)*this._hierarchical_data.cats_padding));this._padding_between_areas=((this._max_posicion-this._min_posicion)-this._maxrang)/(this._ticks)}this._generateGrape();return this};graphica.Axis.fn.clone=function(){var a=new graphica.Axis(this.vp,this._variable,this._orientation).length(this._length).orientation_reversed(this._orientation_reversed);a._show_all_values=this._show_all_values;a._min=this._min;a._max=this._max;a._range=this._range;a._scale=this._scale;a._ticks=this._ticks;a._ticks_values=this._ticks_values.concat();if(typeof this._tick_unit!=="undefined"){a._tick_unit=this._tick_unit}a._ticks_labels=this._ticks_labels.concat();a._ticks_values_index=JSON.parse(JSON.stringify(this._ticks_values_index));a._hierarchical_data=JSON.parse(JSON.stringify(this._hierarchical_data));a._ticks_posicion=this._ticks_posicion.concat();a._property=this._property;a._length=this._length;a._orientation_reversed=this._orientation_reversed;a._reversed=this._reversed;a._axis_color=this._axis_color;a._ticks_color=this._ticks_color;a._ticks_shape=this._ticks_shape;a._grid_lines_color=this._grid_lines_color;a._division_color=this._division_color;a._labels_color=this._labels_color;a._legend_color=this._legend_color;a._legend_label=this._legend_label;a._legend_align=this._legend_align;a._legend_orientation=this._legend_orientation;a._show_line=this._show_line;a._show_ticks=this._show_ticks;a._show_labels=this._show_labels;a._visible=this._visible;a._ticks_format=this._ticks_format;a._show_legend=this._show_legend;a._include_zero=this._include_zero;a._show_only_ticks_end_labels=this._show_only_ticks_end_labels;a._cut_min=this._cut_min;a._label_size=this._label_size;a._label_font=this._label_font;a._labels_align=this._labels_align;a._labels_vertical_align=this._labels_vertical_align;a._labels_font=this._labels_font;a._legend_size=this._legend_size;a._low_padding=this._low_padding;a._high_padding=this._high_padding;a._show_grid_lines=this._show_grid_lines;a._grid_lines_type=this._grid_lines_type;a._grid_lines_relative_position=this._grid_lines_relative_position;a._label_date_format=this._label_date_format;a._forcelimits=this._forcelimits;a._min_posicion=this._min_posicion;a._max_posicion=this._max_posicion;a._x_origin=this._x_origin;a._y_origin=this._y_origin;a._is_vertical_labels_allowed=this._is_vertical_labels_allowed;a._is_bar_axis=this._is_bar_axis;a._cell_padding=this._cell_padding;a._cell_padding_value=this._cell_padding_value;a.init();return a};graphica.Axis.fn._numericNiceScale=function(){var a=graphica.Utils.getNumericNiceScale(this._min,this._max,this._ticks,this._is_integer,this._forcelimits);this._min=a.min;this._max=a.max;this._ticks=a.ticks;this._ticks_values=a.ticks_values;return};graphica.Axis.fn._log2Scale=function(){var a=graphica.Utils.log2(Math.max(0,this._min));var e=graphica.Utils.log2(Math.max(0,this._max));a=Math.floor(a);e=Math.ceil(e);this._min=Math.min(this._min,Math.pow(2,a));this._max=Math.pow(2,e);var c=[];for(f=a;f<=e;f++){c.push(f)}var d=1;if(c.length-1>this._ticks){var b=Math.round(c.length/this._ticks);while(b>1){if(graphica.Utils.fmod(c.length-1,b)==0){d=b;break}else{b--}}}this._ticks_values=[];for(var f=0;f<c.length;f+=d){this._ticks_values.push(Math.pow(2,c[f]))}this._ticks=this._ticks_values.length};graphica.Axis.fn._log10Scale=function(){var a=graphica.Utils.log10(Math.max(0,this._min));var c=graphica.Utils.log10(Math.max(0,this._max));a=Math.floor(a);c=Math.ceil(c);this._min=Math.pow(10,a);this._max=Math.pow(10,c);var b=[];for(var d=a;d<=c;d++){b.push(d)}this._ticks_values=[];for(d=0;d<b.length;d++){this._ticks_values.push(Math.pow(10,b[d]))}this._ticks=this._ticks_values.length};graphica.Axis.fn._generateGrape=function(){var u;var o=this._sub_grape;if(this._hierarchical_data.segments===null&&this._show_line){this._grape.lineStyle(1,this._axis_color,1);if(this._orientation=="horizontal"){this._grape.line(this._x_origin,0,this._x_origin+this._length,0)}else{this._grape.line(0,this._y_origin,0,this._y_origin+this._length)}}var r;if(this._show_ticks||this._show_grid_lines||this._hierarchical_data.segments!==null){this._ticks_posicion=[];if(this._hierarchical_data.segments!==null){r=this._maxrang;var m=this._min_posicion;this._ticks_posicion.push(m);for(u=0;u<this._ticks;u++){if(typeof this._ticks_labels[u]==="string"&&typeof this._hierarchical_data.segments.taxonomy[this._ticks_labels[u]]!=="undefined"){m+=this._hierarchical_data.segments.taxonomy[this._ticks_labels[u]].positive*r/this._hierarchical_data.segments.summax;m+=this._padding_between_areas;this._ticks_posicion.push(m)}}}else{if(this._hierarchical_data.child_variable!==null){r=0;if(this._sub_ticks>1){r=(this._max_posicion-this._min_posicion)/this._sub_ticks}var m=this._min_posicion;this._ticks_posicion.push(m);for(u=0;u<this._ticks;u++){if(typeof this._ticks_labels[u]==="string"){m+=r*this._sub_ticks_values[this._ticks_labels[u]].length;this._ticks_posicion.push(m)}}}else{if(this._ticks_format=="inner"){if(this._max_posicion!=this._min_posicion&&this._ticks>1){r=(this._max_posicion-this._min_posicion)/(this._ticks-1)}else{r=0}for(u=0;u<this._ticks;u++){if(typeof this._ticks_labels[u]==="string"){this._ticks_posicion.push(this._min_posicion+(u*r))}}}else{if(this._max_posicion!=this._min_posicion){r=(this._max_posicion-this._min_posicion)/this._ticks}else{r=0}this._ticks_posicion.push(this._min_posicion);for(u=1;u<(this._ticks+1);u++){if(typeof this._ticks_labels[u]==="string"||u==this._ticks){this._ticks_posicion.push(this._min_posicion+(u*r))}}}}}if((this._reversed&&this._orientation=="horizontal")||(this._reversed&&this._orientation=="vertical"&&!this._is_variable_quantitative)||(this._reversed==false&&this._orientation=="vertical"&&this._is_variable_quantitative)){for(u=0;u<this._ticks_posicion.length;u++){this._ticks_posicion[u]=this._length-this._ticks_posicion[u]}}var k,w,j,t;var a,g,z,e;if(this._show_ticks||(this._show_line&&this._hierarchical_data.segments!==null)){for(u=0;u<this._ticks_posicion.length;u++){this._grape.lineStyle(1,this._ticks_color,1);if(this._orientation=="horizontal"){w=0;t=(this._orientation_reversed)?-5:5;k=this._x_origin+this._ticks_posicion[u];if(this._reversed){k-=this._padding_between_areas/2}else{k+=this._padding_between_areas/2}j=k;if(u<this._ticks_posicion.length-1){g=w;e=t;a=this._x_origin+this._ticks_posicion[u+1];if(this._reversed){a+=this._padding_between_areas/2}else{a-=this._padding_between_areas/2}z=a}}else{k=0;j=(this._orientation_reversed)?5:-5;w=this._y_origin+this._ticks_posicion[u];if(this._reversed){w-=this._padding_between_areas/2}else{w+=this._padding_between_areas/2}t=w;if(u<this._ticks_posicion.length-1){a=k;z=j;g=this._y_origin+this._ticks_posicion[u+1];if(this._reversed){g+=this._padding_between_areas/2}else{g-=this._padding_between_areas/2}e=g}}if(u<this._ticks_posicion.length-1||this._hierarchical_data.segments===null){if(this._show_ticks){this._grape.line(k,w,j,t)}if(this._hierarchical_data.segments!==null){if(this._show_ticks){this._grape.line(a,g,z,e)}this._grape.lineStyle(1,this._axis_color,1);if(this._show_line){this._grape.line(k,w,a,g)}}}}}}if(this._show_labels){var v=this.padding_poslabel;var x=this._labels_align;var l=this._labels_vertical_align;if(this._orientation=="horizontal"&&this._orientation_reversed==false){l="top";if(this._labels_align=="left"||this._labels_align=="right"){x=this._labels_align}}else{if(this._orientation=="horizontal"&&this._orientation_reversed==true){v=-v;l="bottom";if(this._labels_align=="left"||this._labels_align=="right"){x=this._labels_align}}else{if(this._orientation=="vertical"&&this._orientation_reversed==false){v=-v}else{if(this._orientation=="vertical"&&this._orientation_reversed==true){}}}}var f=new GrapeGroup();r=(this._max_posicion-this._min_posicion);if(this._max_posicion!=this._min_posicion&&this._ticks>0){if(this._hierarchical_data.segments!==null){r=this._maxrang/this._hierarchical_data.segments.summax}else{if(this._hierarchical_data.child_variable!==null){r/=this._sub_ticks}else{if(this._ticks>1){r/=(this._ticks-1)}}}}else{r=0}var h=this._min_posicion+this._padding_between_areas/2;if(this._ticks_format=="outer"&&this._hierarchical_data.child_variable===null&&this._hierarchical_data.segments===null){r=(this._max_posicion-this._min_posicion)/this._ticks;if(this._orientation=="horizontal"){h+=r/2}else{if(this._labels_vertical_align=="middle"){h+=r/2}else{if(this._labels_vertical_align=="bottom"){h+=r}}}}var s=null;var c=false;if(this._is_vertical_labels_allowed&&!this._dataset.isDateType(this._variable)){for(u=0;u<this._ticks;u++){var q=raceme.label(this.vp.getAlias(this._variable,this._property,this._ticks_labels[u])||this._ticks_labels[u],0,0,this._labels_color,this._label_size,x,l,1,this._labels_font,true);if(q.getBBox().width>r){c=true;break}}}for(u=0;u<this._ticks;u++){if(typeof this._ticks_labels[u]==="string"){if(this._include_zero==false&&this._ticks_labels[u]=="0"&&this._is_variable_quantitative){continue}var q=raceme.label(this.vp.getAlias(this._variable,this._property,this._ticks_labels[u])||this._ticks_labels[u],0,0,this._labels_color,this._label_size,x,l,1,this._labels_font,true);if(this._orientation=="horizontal"){var n=false;if(c){n=true;if(this._orientation_reversed){q=raceme.label(this.vp.getAlias(this._variable,this._property,this._ticks_labels[u])||this._ticks_labels[u],0,0,this._labels_color,this._label_size,"left","middle",1,this._labels_font,true)}else{q=raceme.label(this.vp.getAlias(this._variable,this._property,this._ticks_labels[u])||this._ticks_labels[u],0,0,this._labels_color,this._label_size,"right","middle",1,this._labels_font,true)}q.rotation(-90)}else{this._is_vertical_labels_allowed=false}if(this._hierarchical_data.segments!==null){b=this._hierarchical_data.segments.taxonomy[this._ticks_labels[u]].positive*r;if(!n&&this._labels_align=="left"){q.x(h)}else{if(!n&&this._labels_align=="right"){q.x(h+b)}else{q.x(h+b/2)}}h+=b+this._padding_between_areas}else{if(this._hierarchical_data.child_variable!==null){var b=this._sub_ticks_values[this._ticks_labels[u]].length*r;if(this._ticks_format=="outer"&&!n&&this._labels_align=="left"){q.x(h)}else{if(this._ticks_format=="outer"&&!n&&this._labels_align=="right"){q.x(h+b)}else{q.x(h+b/2)}}h+=b}else{if(this._ticks_format=="outer"&&!n&&this._labels_align=="left"){q.x(h+(u*r)-r/2)}else{if(this._ticks_format=="outer"&&!n&&this._labels_align=="right"){q.x(h+(u*r)+r/2)}else{q.x(h+(u*r))}}}}q.y(v);var p=null;if(this._is_date_type){p=q.getBBox()}if(this._ticks_format=="inner"&&p!==null){if(p.x<0){q.x(-p.x);p.x=q.x()-p.width/2}else{if(p.x+p.width>this._length){q.x(this._length-p.width/2);p.x=this._length-p.width}}}if(!this._is_date_type||s==null||p.x>s){f.push(q);if(p){s=p.x+p.width;if(!n){s+=10}}if(this._reversed){q.x(this._length-q.x())}}}else{q.x(v);var b;if(this._hierarchical_data.segments!==null){b=this._hierarchical_data.segments.taxonomy[this._ticks_labels[u]].positive*r;if(this._labels_vertical_align=="middle"){q.y(h+b/2)}else{if(this._labels_vertical_align=="bottom"){q.y(h+b)}else{q.y(h)}}h+=b+this._padding_between_areas}else{if(this._hierarchical_data.child_variable!==null){b=this._sub_ticks_values[this._ticks_labels[u]].length*r;if(this._labels_vertical_align=="middle"){q.y(h+b/2)}else{if(this._labels_vertical_align=="bottom"){q.y(h+b)}else{q.y(h)}}h+=b}else{q.y(h+(u*r))}}if(this._ticks_format=="inner"){if(q.y()+this._label_size/2>this._length){q.y(q.y()-this._label_size*0.5)}else{if(q.y()-this._label_size*0.5<0){q.y(q.y()+this._label_size/2)}}}if(!this._is_date_type||s==null||q.y()>s){f.push(q);if(this._is_date_type){s=q.y()+this._label_size+2}if((this._reversed&&!this._is_variable_quantitative)||(this._reversed==false&&this._is_variable_quantitative)){q.y(this._length-q.y())}}}if(this._is_variable_categorical){q._alias_option_original_value=this._ticks_labels[u];q._alias_option_alias_value=this.vp.getAlias(this._variable,this._property,this._ticks_labels[u]);q._alias_option_variable=this._variable_name;q._alias_option_property=this._property_name;q.enableEvents(true);this.vp.view.classify(q,"axis/legend label")}}}f.addTo(o)}if(this._orientation=="vertical"&&this._labels_align=="left"){if(!this._orientation_reversed){o.x(this._x_origin-this.getWidth())}else{o.x(this._x_origin)}}else{if(this._orientation=="vertical"&&this._labels_align=="center"){if(!this._orientation_reversed){o.x(this._x_origin-this.getWidth()/2)}else{o.x(this._x_origin+this.getWidth()/2)}}else{if(this._orientation=="vertical"&&this._labels_align=="right"){if(!this._orientation_reversed){o.x(this._x_origin)}else{o.x(this._x_origin+this.getWidth())}}else{o.x(this._x_origin)}}}o.y(this._y_origin);if(this._show_legend){var d=o.getBBox();var y;if(this._orientation=="horizontal"){if(this._legend_align=="left"){y=raceme.paragraph(this._legend_label,0,0,this._legend_color,this._legend_size,"left",this._orientation_reversed?"top":"bottom",1,this._label_font,this._length);y.x(0)}else{if(this._legend_align=="right"){y=raceme.paragraph(this._legend_label,0,0,this._legend_color,this._legend_size,"right",this._orientation_reversed?"top":"bottom",1,this._label_font,this._length);y.x(this._length)}else{y=raceme.paragraph(this._legend_label,0,0,this._legend_color,this._legend_size,"center",this._orientation_reversed?"top":"bottom",1,this._label_font,this._length);y.x(this._length/2)}}if(this._orientation_reversed){y.y(-d.height-y.getBBox().height-this._legend_size)}else{y.y(d.height+y.getBBox().height+this._legend_size)}y.attr("font-weight","bold")}else{if(this._orientation=="vertical"){if(this._legend_orientation=="horizontal"){if(this._legend_align=="left"){y=raceme.label(this._legend_label,0,0,this._legend_color,this._legend_size,"left","top",1,this._label_font,true);if(this._orientation_reversed){y.x(0)}else{if(this._is_variable_categorical){y.x(-d.width-this.padding_poslabel*2)}else{y.x(-d.width-this.padding_poslabel)}}}else{if(this._legend_align=="right"){y=raceme.label(this._legend_label,0,0,this._legend_color,this._legend_size,"right","top",1,this._label_font,true);if(this._orientation_reversed){y.x(d.width+this.padding_poslabel)}else{y.x(0)}}else{y=raceme.label(this._legend_label,0,0,this._legend_color,this._legend_size,"center","top",1,this._label_font,true);y.x(0)}}}else{if(this._orientation_reversed==true&&this._orientation=="vertical"){if(this._legend_align=="left"){y=raceme.label(this._legend_label,0,0,this._legend_color,this._legend_size,"left","bottom",1,this._label_font,true);y.x(d.x+d.width+this._legend_size*2).y(0)}else{if(this._legend_align=="right"){y=raceme.label(this._legend_label,0,0,this._legend_color,this._legend_size,"right","bottom",1,this._label_font,true);y.x(d.x+d.width+this._legend_size*2).y(this._length)}else{y=raceme.label(this._legend_label,0,0,this._legend_color,this._legend_size,"center","bottom",1,this._label_font,true);y.x(d.x+d.width+this._legend_size*2).y(this._length/2)}}y.rotation(90)}else{if(this._orientation_reversed==false&&this._orientation=="vertical"){if(this._legend_align=="left"){y=raceme.label(this._legend_label,0,0,this._legend_color,this._legend_size,"left","bottom",1,this._label_font,true);y.x(d.x2-d.width-(this._legend_size*2)).y(this._length)}else{if(this._legend_align=="right"){y=raceme.label(this._legend_label,0,0,this._legend_color,this._legend_size,"right","bottom",1,this._label_font,true);y.x(d.x2-d.width-(this._legend_size*2)).y(0)}else{y=raceme.label(this._legend_label,0,0,this._legend_color,this._legend_size,"center","bottom",1,this._label_font,true);y.x(d.x2-d.width-(this._legend_size*2)).y(this._length/2)}}y.rotation(-90)}}}y.attr("font-weight","bold")}}y.addTo(this._grape);y._legend_label=this._legend_label;y._variable_name=this._variable_name;y._legend_label_property=this._property_name;y.enableEvents(true);this.vp.view.classify(y,"axis/legend title")}};graphica.Axis.fn.getGrape=function(){return this._grape};graphica.Axis.fn.getHeight=function(){if(this._visible==false){return 0}return this.getGrape().getBBox().height+this.padding_poslabel};graphica.Axis.fn.getWidth=function(){if(this._orientation=="vertical"&&this._legend_orientation=="horizontal"){return(this._sub_grape.getBBox().width+this.padding_poslabel)}var a=this.getGrape().getBBox().width;if(a){return a+this.padding_poslabel}return 0};graphica.Axis.fn.x=function(){return this._grape.x()};graphica.Axis.fn.innerX=function(){if(this._orientation=="horizontal"){return this.x()+this._low_padding}return this.x()};graphica.Axis.fn.y=function(){return this._grape.y()};graphica.Axis.fn.innerY=function(){if(this._orientation=="vertical"){return this.y()+this._y_origin+this._high_padding}return this.y()};graphica.Axis.fn.getGridLines=function(f,a){if(typeof a!=="number"){a=0}var c=new Grape();c.x(f.x).y(f.y).enableEvents(false);if(this._grid_lines_type=="band"){c.lineStyle(0);c.beginFill(this._grid_lines_color,0.5)}else{if(this._grid_lines_type=="solid"){c.lineStyle(1,this._grid_lines_color,1,"butt","miter")}else{c.lineStyle(1,this._grid_lines_color,1,"butt","miter",4,this._grid_lines_type)}}var h;var e=0;if(this._max_posicion!=this._min_posicion){e=(this._max_posicion-this._min_posicion)/this._ticks}for(var b=0;b<this._ticks_posicion.length;b++){if(this._grid_lines_type=="band"){if((b+a)%2!=0){var d=Math.max(this._ticks_posicion[b],this._ticks_posicion[b-1]);var g=Math.min(this._ticks_posicion[b],this._ticks_posicion[b-1]);if(this._orientation=="vertical"){c.rect(0,g,f.width,d-g)}else{c.rect(g,0,d-g,f.height)}}}else{h=null;if(this._grid_lines_relative_position=="inner"&&this._variable_type=="string"){if(this._reversed){if(b>0){h=this._ticks_posicion[b]+e/2}}else{if(b+1<this._ticks_posicion.length){h=this._ticks_posicion[b]+e/2}}}else{if(this._grid_lines_relative_position=="outer"&&this._variable_type=="date"){h=this._ticks_posicion[b]-e/2}else{h=this._ticks_posicion[b]}}if(this._orientation=="vertical"){if(h!==null){c.line(0,h,f.width,h);if(b==this._ticks_posicion.length-1&&this._grid_lines_relative_position=="outer"&&this._variable_type=="date"){c.line(0,h+e,f.width,h+e)}}}else{if(h!==null){if(b==this._ticks_posicion.length-1&&this._grid_lines_relative_position=="outer"&&this._variable_type=="date"){c.line(h+e,0,h+e,f.height)}c.line(h,0,h,f.height)}}}}c._is_odd=(((this._ticks_posicion.length-1+a)%2==0)?0:1);return c};graphica.Axis.fn._format_labels=function(){var c;if(this._is_variable_quantitative){for(c=0;c<this._ticks;c++){if((this._ticks_values[c]>=1000000000||this._ticks_values[c]<=-1000000000)&&graphica.Utils.decimals(this._ticks_values[c]/1000000000)<3&&this._billions_abbreviation.trim()!=""){this._ticks_labels[c]=(this._ticks_values[c]/1000000000).toString()+this._billions_abbreviation}else{if((this._ticks_values[c]>=1000000||this._ticks_values[c]<=-1000000)&&graphica.Utils.decimals(this._ticks_values[c]/1000000)<3&&this._range>100000&&this._millions_abbreviation.trim()!=""){this._ticks_labels[c]=(this._ticks_values[c]/1000000).toString()+this._millions_abbreviation}else{if((this._ticks_values[c]>=1000||this._ticks_values[c]<=-1000)&&graphica.Utils.decimals(this._ticks_values[c]/1000)<3&&this._range>1000&&this._thousands_abbreviation.trim()!=""){this._ticks_labels[c]=(this._ticks_values[c]/1000).toString()+this._thousands_abbreviation}else{if(this._ticks_values[c]==0.000001&&this._scale=="log10"){this._ticks_labels[c]=String.fromCharCode(8776)+this._ticks_values[c].toString()}else{if(this._ticks_values[c]==0.125&&this._scale=="log2"&&this._min<0.125){this._ticks_labels[c]=String.fromCharCode(8776)+this._ticks_values[c].toString()}else{this._ticks_labels[c]=this._ticks_values[c]}}}}}if(this._orientation=="vertical"){this._ticks_labels[c]=this.vp.getFormattedNumber(this._ticks_labels[c],this._variable,graphica.POS_Y,true)}else{this._ticks_labels[c]=this.vp.getFormattedNumber(this._ticks_labels[c],this._variable,graphica.POS_X,true)}if(typeof this._ticks_labels[c]=="number"){this._ticks_labels[c]=this._ticks_labels[c].toString()}}}else{if(this._dataset.isDateType(this._variable)){var a=1;var e=null;var d="";for(c=0;c<this._ticks;c++){var b=(this.datejumps==1);var f=this._dataset.getDateTickValue(this._variable,c,this._tick_unit,this._min);this._ticks_values[c]=f;if(!b){if(this._tick_unit=="year"){if(f.getUTCFullYear()%this.datejumps==0){b=true}}else{if(this._tick_unit=="quarter"){if(c%this.datejumps==0){b=true}}else{if(this._tick_unit=="month"){if(e===null){e=f.getUTCMonth()}if((c+this.datejumps-e)%this.datejumps==0){b=true}}else{if(this._tick_unit=="day"){if((this.datejumps==15||this.datejumps==30)&&f.getUTCDate()==1){b=true}else{if(this.datejumps==15&&f.getUTCDate()==15){b=true}else{if(this.datejumps>30&&f.getUTCMonth()==0&&f.getUTCDate()==1){b=true}}}}else{if(this._tick_unit=="hour"){if(e===null){e=f.getUTCHours()}if((c+this.datejumps-e)%this.datejumps==0){b=true}}else{if(this._tick_unit=="minute"){if(e===null){e=f.getUTCMinutes()}if((c+this.datejumps+e)%this.datejumps==0){b=true}}else{if(this._tick_unit=="second"){if(e===null){e=f.getUTCSeconds()}if((c+this.datejumps+e)%this.datejumps==0){b=true}}}}}}}}}if(b){if(this._label_date_format==null&&this._dataset.includesTime(this._variable)&&this._dataset.includesDate(this._variable)==false){this._ticks_labels[c]=f.strformat(this._tick_unit,"time")}else{this._ticks_labels[c]=f.strformat(this._tick_unit,this._label_date_format)}if(d&&this._ticks_labels[c]==d){this._ticks_labels[c]=null}else{d=this._ticks_labels[c]}}}}else{for(c=0;c<this._ticks;c++){this._ticks_labels[c]=this._ticks_values[c]}}}};graphica.Axis.fn.getPoint=function(c,g,d){g=g||false;d=d||false;var b=0;var a=graphica.Utils.map;if(this._is_variable_quantitative){if(c===null||typeof c=="undefined"){return null}if(this._bin_width!=1||this._is_integer==false){c+=this._bin_width/2}if(this._scale=="log10"&&this._is_bar_axis){c=Math.max(c,this._min)}if(g==false&&(c<this._min||(c>this._max&&!this._is_bar_axis))){return null}if(d){c=Math.min(Math.max(c,this._min),this._max)}if(this._scale=="lin"){if(this._min==this._max&&this._min==c){b=this._min_posicion+(this._max_posicion-this._min_posicion)/2}else{b=a(c,this._min,this._max,this._min_posicion,this._max_posicion)}}else{if(this._scale=="log2"){b=a(graphica.Utils.log2(c),graphica.Utils.log2(this._min),graphica.Utils.log2(this._max),this._min_posicion,this._max_posicion)}else{if(this._scale=="log10"){b=a(graphica.Utils.log10(c),graphica.Utils.log10(this._min),graphica.Utils.log10(this._max),this._min_posicion,this._max_posicion)}}}}else{if(this._is_variable_categorical||this._is_date_type){var f;if(c===null||typeof c=="undefined"){return null}f=this.getCategoricalPosition(c);if(f!==null){var e=0;var i=this._min_posicion;if(this._hierarchical_data.segments!==null){if(this._reversed){return this._ticks_posicion[f+1]+this._padding_between_areas/2}return this._ticks_posicion[f]+this._padding_between_areas/2}else{if(this._hierarchical_data.child_variable!==null){if(this._max_posicion!=this._min_posicion&&this._sub_ticks>0){e=(this._max_posicion-this._min_posicion)/(this._sub_ticks)}for(var h=0;h<f;h++){i+=this._sub_ticks_values[this._ticks_labels[h]].length*e}i+=(this._sub_ticks_values[this._ticks_labels[f]].length*e)/2;b=i}else{if(this._max_posicion!=this._min_posicion&&this._ticks>1){e=(this._max_posicion-this._min_posicion)/(this._ticks-1)}if(this._ticks_format=="outer"){if(this._max_posicion!=this._min_posicion&&this._ticks>0){e=(this._max_posicion-this._min_posicion)/this._ticks;i+=e/2}}b=i+(f*e)}}}}}if((this._orientation=="vertical"&&this._reversed&&!this._is_variable_quantitative)||(this._orientation=="vertical"&&this._reversed==false&&this._is_variable_quantitative)||(this._orientation=="horizontal"&&this._reversed)){b=this._length-b}return b};graphica.Axis.fn.getCategoricalPosition=function(a){if(this._is_date_type){return this._dataset.getDateTickPosition(this._variable,a,this._tick_unit,this._min)}else{if(typeof this._ticks_values_index[a]!=="number"){return null}return this._ticks_values_index[a]}};graphica.Axis.fn.getSpacePoint=function(a){if(this._is_variable_quantitative&&this._is_interval){return graphica.Utils.map(this._min+this._bin_width,this._min,this._max,this._min_posicion,this._max_posicion)-this._min_posicion}if(this._hierarchical_data.segments!==null&&typeof a!=="undefined"){return this._hierarchical_data.segments.taxonomy[a].positive*(this._maxrang)/this._hierarchical_data.segments.summax}if(this._hierarchical_data.child_variable!==null&&typeof a!=="undefined"&&typeof this._sub_ticks_values[a]!="undefined"){return((this._max_posicion-this._min_posicion)/this._sub_ticks)*(this._sub_ticks_values[a].length)}if(this._ticks_format=="inner"){if(this._ticks>1){return(this._max_posicion-this._min_posicion)/(this._ticks-1)}return this._length}if(this._cell_padding&&this._cell_padding_value>0){return Math.max(((this._max_posicion-this._min_posicion)/this._ticks)-this._cell_padding_value,1)}return(this._max_posicion-this._min_posicion)/this._ticks};if(typeof window!=="undefined"){window.graphica=window.graphica||{};var graphica=window.graphica}else{var graphica=graphica||{}}graphica.computed_variables=["graphica.com.frequency","graphica.com.clusters","graphica.com.degree","graphica.com.indegree","graphica.com.outdegree"];graphica.Dataset=function(a){this._options=a||{};if(typeof this._options.first_row_as_column_names!=="boolean"){this._options.first_row_as_column_names=true}this.data=new Array();this.stats=new Array();this.edges=null;this.header={names:[],types:[],ids:{},length:0,no_computed_length:0,getId:function(b){if(typeof b==="string"){return this.ids[b]}return b}};this.metrics={sums:[],mins:[],maxs:[],sums_stats:[],mins_stats:[],maxs_stats:[],hasChanged:[],isInteger:[],includesTime:[],includesDate:[],bin_widths:[],tick_units:[]};this._indices=[];this._indices_length=[];this.length=0;this.nodes_index_var=-1;this.target_link_var=-1;this.source_link_var=-1;this.hierarchicalRelationships={}};graphica.Dataset.fn=graphica.Dataset.prototype;graphica.Dataset.fn.clone=function(f,d,c,b){var e=new graphica.Dataset();e.header.names=this.header.names.slice(0);e.header.types=this.header.types.slice(0);e.header.ids=JSON.parse(JSON.stringify(this.header.ids));e.header.length=this.header.length;e.nodes_index_var=this.nodes_index_var;e.target_link_var=this.target_link_var;e.source_link_var=this.source_link_var;if(typeof f!=="undefined"){var a=0;this.eachRowOrdered(function(h,g){if(typeof b=="number"&&a>=b){return false}e.add(h);a++},f,d,c)}else{this.eachRow(function(h,g){e.add(h)})}e.stats=JSON.parse(JSON.stringify(this.stats));return e};graphica.Dataset.fn.done=function(c){this._done=c;var f;var b;var e;var a;var d;var h=this;var g;g=this._options.parse_options||{};g.dynamicTyping=true;g.skipEmptyLines=true;if(this._options.structure&&this._options.structure=="graph"){if(this._options.data){e=this._options.data.indexOf("*nodes");d=this._options.data.indexOf("*edges");if(e>-1&&d>(e+6)){b=this._options.data.substring(e+7,d-1).trim();a=this._options.data.substring(d+6).trim();f=Papa.parse(b,g);h.data=f.data;h.edges=new graphica.Dataset({data:a,datatypes:h._options.datatypes});h.edges.allowedDuplicatedVariables=true;h.parse();h.edges.done(function(){var k=new graphica.GraphModel();k.init(h,this);h.nodes_index_var=k.nodes_index_var;h.source_link_var=k.source_link_var;h.target_link_var=k.target_link_var;if(h.nodes_index_var!=-1&&(h.header.types[h.nodes_index_var]!="string"&&h.header.types[h.nodes_index_var]!="geo.country"&&h.header.types[h.nodes_index_var]!="geo.state.province")){h.changeColumnType(h.nodes_index_var,"string")}if(h.source_link_var!=-1&&this.header.types[h.source_link_var]!="string"){this.changeColumnType(h.source_link_var,"string")}if(h.target_link_var!=-1&&this.header.types[h.target_link_var]!="string"){this.changeColumnType(h.target_link_var,"string")}for(var j=0;j<k.node_array.length;j++){h.setValue(j,"graphica.com.clusters",k.node_array[j]._cluster);h.setValue(j,"graphica.com.degree",k.node_array[j].inDegree+k.node_array[j].outDegree);h.setValue(j,"graphica.com.indegree",k.node_array[j].inDegree);h.setValue(j,"graphica.com.outdegree",k.node_array[j].outDegree)}c.call(h)})}else{throw"Data format error"}}else{if(this._options.url){raceme.ajax({url:this._options.url,done:function(j){h._options.url=null;h._options.data=j;h.done(c)}})}}}else{if(this._options.url){raceme.ajax({url:this._options.url,done:function(j){h._options.url=null;h._options.data=j;h.done(c)}})}else{if(this._options.data){this._options.data=this._options.data.trim();if(Array.isArray(this._options.data)){h.data=this._options.data;h.parse();c.call(h)}else{if(typeof this._options.data=="string"&&this._options.data.substring(0,6)=="*nodes"){this._options.structure="graph";this.done(c)}else{f=Papa.parse(this._options.data,g);h.data=f.data;h.parse();c.call(h)}}}}}return this};graphica.Dataset.fn.getNewColumnName=function(b){if(typeof b!=="string"){b="unnamed"}b=b.trim();for(var a=1;a<20000;a++){if(!this.hasColumn(b+" ("+a+")")){return b+" ("+a+")"}}return b};graphica.Dataset.fn.parse=function(){var b;if(typeof this.data==="undefined"){this.data=[""]}if(this.data.length==0){this.data.push("")}if(!this._options.first_row_as_column_names||!this.data.length){var a=[];for(b=0;b<this.data[0].length;b++){a.push("")}this.data.unshift(a)}for(b=0;b<this.data[0].length;b++){this.data[0][b]+="";if(this.data[0][b].trim()==""){this.data[0][b]=this.getNewColumnName()}if(this.hasColumn(this.data[0][b])&&!this.allowedDuplicatedVariables){this.data[0][b]=this.getNewColumnName(this.data[0][b]);console.log("Variable duplicated.")}if(graphica.computed_variables.indexOf(this.data[0][b])!=-1){console.log("Invalid variable name")}this.header.ids[this.data[0][b]]=b;if(this.data[0][b].toString){this.header.names.push(this.data[0][b].toString())}else{this.header.names.push(this.data[0][b])}}this.header.no_computed_length=this.header.names.length;b=this.data[0].length;this.header.ids["graphica.com.frequency"]=b;this.header.names.push("graphica.com.frequency");this.header.types.push("number");b++;this.header.ids["graphica.com.clusters"]=b;this.header.names.push("graphica.com.clusters");this.header.types.push("string");b++;if(this.edges){this.header.ids["graphica.com.degree"]=b;this.header.names.push("graphica.com.degree");this.header.types.push("number");b++;this.header.ids["graphica.com.indegree"]=b;this.header.names.push("graphica.com.indegree");this.header.types.push("number");b++;this.header.ids["graphica.com.outdegree"]=b;this.header.names.push("graphica.com.outdegree");this.header.types.push("number");b++}this.data.shift();this.header.length=this.header.names.length;this.length=this.data.length;for(b=0;b<this.header.length;b++){var d=this.header.names[b];var c;if(this.data[0]){c=this.data[0][b];var e=1;if(typeof c==="string"){while(c==""&&e<this.length){c=this.data[e][b];e++}}}else{c="string"}if(d=="graphica.com.frequency"||d=="graphica.com.degree"||d=="graphica.com.indegree"||d=="graphica.com.outdegree"){this.header.types[b]="number"}else{if(d=="graphica.com.clusters"){this.header.types[b]="string"}else{if(this._options.datatypes&&this._options.datatypes[d]){if(["string","number","geo.country","geo.state.province","date"].includes(this._options.datatypes[d])==false){this._options.datatypes[d]="string"}this.header.types[b]=this._options.datatypes[d]}else{if(typeof c==="string"){this.header.types[b]="string"}else{if(typeof c==="number"){this.header.types[b]="number"}else{if(typeof c==="boolean"){this.header.types[b]="string"}else{this.header.types[b]="string"}}}}}}}this.eachRow(function(g,f){this.formatRow(f);this.indexRow(f)})};graphica.Dataset.fn.isDateType=function(a){return(this.columnType(a)==="date")};graphica.Dataset.fn.isCategorical=function(a){return(this.columnType(a)==="string"||this.columnType(a)=="geo.country"||this.columnType(a)=="geo.state.province")};graphica.Dataset.fn.isQuantitative=function(a){return(this.columnType(a)==="number")};graphica.Dataset.fn.hasColumn=function(a){a=this.header.getId(a);if(typeof this.header.names[a]==="undefined"){return false}return true};graphica.Dataset.fn.columnNames=function(){return this.header.names};graphica.Dataset.fn.columnNamesByType=function(c){var a=[];for(var b=0;b<this.header.names.length;b++){if((!c||this.columnType(b)==c)&&graphica.computed_variables.indexOf(this.header.names[b])==-1){a.push(this.header.names[b])}}return a};graphica.Dataset.fn.columnName=function(a){a=this.header.getId(a);return this.header.names[a]};graphica.Dataset.fn.columnType=function(a){a=this.header.getId(a);return this.header.types[a]};graphica.Dataset.fn.min=function(b,a){if(this.isQuantitative(b)||this.isDateType(b)){b=this.header.getId(b);if(typeof this.metrics.hasChanged[b]==="boolean"&&this.metrics.hasChanged[b]==true){this._calc_min_max(b)}if(!this.isDateType(b)&&typeof a==="string"&&typeof this.metrics.mins_stats[b]!=="undefined"&&typeof this.metrics.mins_stats[b][a]!=="undefined"){return this.metrics.mins_stats[b][a]}return this.metrics.mins[b]}return 0};graphica.Dataset.fn.binWidth=function(a){if(this.isQuantitative(a)){a=this.header.getId(a);if(typeof this.metrics.bin_widths[a]=="number"){return this.metrics.bin_widths[a]}}return 0};graphica.Dataset.fn.max=function(b,a){if(this.isQuantitative(b)||this.isDateType(b)){b=this.header.getId(b);if(!this.isDateType(b)&&typeof this.metrics.hasChanged[b]==="boolean"&&this.metrics.hasChanged[b]==true){this._calc_min_max(b)}if(typeof a==="string"&&typeof this.metrics.maxs_stats[b]!=="undefined"&&typeof this.metrics.maxs_stats[b][a]!=="undefined"){return this.metrics.maxs_stats[b][a]}return this.metrics.maxs[b]}return 0};graphica.Dataset.fn.tickUnit=function(e){if(this.isDateType(e)){e=this.header.getId(e);if(typeof this.metrics.tick_units[e]=="undefined"){var a=this.unique(e);a.sort(function(h,g){if(h<g){return -1}else{if(h>g){return 1}}return 0});var f="year";for(var d=1;d<a.length;d++){var b=a[d].getTime();var c=a[d-1].getTime();if(b==c){continue}if(f=="year"&&a[d].getUTCFullYear()-a[d-1].getUTCFullYear()<1){f="quarter"}let difference_in_months=a[d].getUTCMonth()-a[d-1].getUTCMonth()+(12*(a[d].getUTCFullYear()-a[d-1].getUTCFullYear()));if(f=="quarter"&&difference_in_months<3){f="month"}if(f=="month"&&difference_in_months<1){f="day"}if(f=="day"&&this.includesTime(e)==false){break}let difference_in_ms=b-c;if((difference_in_ms/1000)<60){f="second";break}else{if((difference_in_ms/1000)<(60*60)){f="minute"}else{if((difference_in_ms/1000)<=(60*60*24)){f="hour"}}}}this.metrics.tick_units[e]=f}return this.metrics.tick_units[e]}return null};graphica.Dataset.fn.isHierarchicalRelationship=function(a,d){var e=this;if(this.isCategorical(a)==false||this.isCategorical(d)==false){return false}a=this.columnName(a);d=this.columnName(d);parent_var_id=this.header.getId(a);child_var_id=this.header.getId(d);this.hierarchicalRelationships[a]=this.hierarchicalRelationships[a]||{};if(typeof this.hierarchicalRelationships[a][d]!="undefined"){return this.hierarchicalRelationships[a][d]}var c={};var b=true;this.eachRow(function(f){let val_child=f[child_var_id];let val_parent=f[parent_var_id];if(typeof c[val_child]==="undefined"){c[val_child]=val_parent}else{if(c[val_child]!=val_parent){b=false;return false}}});this.hierarchicalRelationships[a][d]=b;return b};graphica.Dataset.fn._update_metrics=function(k,e){var g=k;var f=e;if(this.isDateType(e)){if(typeof this.metrics.mins[f]=="undefined"||this.metrics.mins[f]===null){this.metrics.mins[f]=graphica.Utils.dateFrom(this.data[g][f]);this.metrics.maxs[f]=graphica.Utils.dateFrom(this.data[g][f])}else{if(this.data[g][f]<this.metrics.mins[f]){this.metrics.mins[f]=graphica.Utils.dateFrom(this.data[g][f])}else{if(this.data[g][f]>this.metrics.maxs[f]){this.metrics.maxs[f]=graphica.Utils.dateFrom(this.data[g][f])}}}var d=this.includesTime(f);var c=this.includesDate(f);if(d==false||c==false){var h=graphica.Utils.dateFrom(this.data[g][f]);if(d==false&&(h.getUTCHours()!=0||h.getUTCMinutes()!=0||h.getUTCSeconds()!=0)){this.metrics.includesTime[f]=true}if(c==false&&(h.getUTCFullYear()!=1900||h.getUTCMonth()!=0||h.getUTCDate()!=1)){this.metrics.includesDate[f]=true}}}else{if(typeof this.metrics.mins[f]=="undefined"||this.metrics.mins[f]===null){this.metrics.mins[f]=this.data[g][f];this.metrics.maxs[f]=this.data[g][f];this.metrics.sums[f]=0}else{this.metrics.mins[f]=Math.min(this.data[g][f],this.metrics.mins[f]);this.metrics.maxs[f]=Math.max(this.data[g][f],this.metrics.maxs[f])}if(typeof this.stats[g][f]!=="undefined"){for(var a in this.stats[g][f]){if(Object.prototype.hasOwnProperty.call(this.stats[g][f],a)){var b=this.stats[g][f][a];if(typeof this.metrics.mins_stats[f]=="undefined"){this.metrics.mins_stats[f]={};this.metrics.sums_stats[f]={};this.metrics.maxs_stats[f]={}}if(typeof this.metrics.mins_stats[f][a]==="undefined"){this.metrics.mins_stats[f][a]=b;this.metrics.maxs_stats[f][a]=b;this.metrics.sums_stats[f][a]=0}else{this.metrics.mins_stats[f][a]=Math.min(b,this.metrics.mins_stats[f][a]);this.metrics.maxs_stats[f][a]=Math.max(b,this.metrics.maxs_stats[f][a])}this.metrics.sums_stats[f][a]+=b}}}this.metrics.sums[f]+=this.data[g][f];if(this.isInteger(f)&&graphica.Utils.decimals(this.data[g][f])>0){this.metrics.isInteger[f]=false}}};graphica.Dataset.fn._calc_min_max=function(c){var b;var a=c;this.metrics.mins[a]=null;this.metrics.maxs[a]=null;this.metrics.sums[a]=0;this.metrics.mins_stats[a]={};this.metrics.maxs_stats[a]={};if(this.isQuantitative(c)||this.isDateType(c)){for(b=0;b<this.length;b++){if(this.data[b][a]!==null){this._update_metrics(b,a)}}}this.metrics.hasChanged[c]=false};graphica.Dataset.fn.isInteger=function(a){a=this.header.getId(a);if(typeof this.metrics.isInteger[a]==="boolean"){return this.metrics.isInteger[a]}return true};graphica.Dataset.fn.includesTime=function(a){a=this.header.getId(a);if(typeof this.metrics.includesTime[a]==="boolean"){return this.metrics.includesTime[a]}return false};graphica.Dataset.fn.includesDate=function(a){a=this.header.getId(a);if(typeof this.metrics.includesDate[a]==="boolean"){return this.metrics.includesDate[a]}return false};graphica.Dataset.fn.sum=function(b,a){b=this.header.getId(b);if(this.isQuantitative(b)){if(typeof a==="string"&&typeof this.metrics.sums_stats[b]!=="undefined"&&typeof this.metrics.sums_stats[b][a]!=="undefined"){return this.metrics.sums_stats[b][a]}return this.metrics.sums[b]||0}else{return this.row(0)[b]}};graphica.Dataset.fn.sums=function(){var a=new Array();for(i=0;i<this.header.length;i++){a[i]=this.sum(i)}return a};graphica.Dataset.fn.average=function(b,a){if(this.isQuantitative(b)){b=this.header.getId(b);if(typeof a==="number"){return graphica.Utils.round(this.metrics.sums[b]/this.length,a)}return this.metrics.sums[b]/this.length}return 0};graphica.Dataset.fn.median=function(c){if(this.isQuantitative(c)){c=this.header.getId(c);var a=[];for(var b=0;b<this.length;b++){if(typeof this.data[b][c]!=="undefined"&&this.data[b][c]!==null){a.push(this.data[b][c])}}if(a.length==0){return 0}a.sort(function(f,e){return f-e});var d=Math.floor(a.length/2);if(a.length%2){return a[d]}return(a[d-1]+a[d])/2}return 0};graphica.Dataset.fn.getStats=function(e,d){if(this.isQuantitative(e)){e=this.header.getId(e);var n=0;var q=[];for(var f=0;f<this.length;f++){var a=this.getValue(f,e,d);if(a!==null){q.push(a);n+=a}}if(!q.length){return{}}q.sort(function(t,s){return t-s});var r=Math.floor(q.length/2);var c=Math.floor(q.length/4);var l=Math.floor(q.length/4*3);var p;var k;var g;if(q.length==1){p=q[0];k=p;g=p}else{if(q.length%2){p=q[r];k=q[c];g=q[l]}else{p=(q[r-1]+q[r])/2;k=q[c];g=q[l]}}var b=g-k;var h=this.min(e,d);var o=this.max(e,d);var j=n/q.length;var m=0;q.forEach(function(s){m+=Math.pow(s-j,2)});m=Math.sqrt(m/(q.length-1));return{min:h,max:o,average:j,median:p,q1:k,q3:g,minq:Math.max(k-1.5*b,h),maxq:Math.min(g+1.5*b,o),sd:m,n:q.length}}return{}};graphica.Dataset.fn.add=function(a,b){this.data.push(a);var b=b||[];this.stats.push(b);this.length++;this.formatRow(this.length-1);this.indexRow(this.length-1);return this};graphica.Dataset.fn.formatRow=function(e,f){var b=0;var a=this.header.length-1;if(typeof f!=="undefined"){b=f;a=f}this.stats[e]=this.stats[e]||[];for(var c=b;c<=a;c++){this.stats[e][c]=this.stats[e][c]||{};if(this.header.types[c]=="string"||this.header.types[c]=="geo.country"||this.header.types[c]=="geo.state.province"){if(typeof this.data[e][c]==="undefined"||this.data[e][c]===null){if(this.columnName(c)=="graphica.com.clusters"){this.data[e][c]="cluster 1"}else{this.data[e][c]=""}}else{if(typeof this.data[e][c].getMonth==="function"){if(this.includesTime(c)==false){this.data[e][c]=this.data[e][c].strformat()}else{if(this.includesDate(c)==false){this.data[e][c]=this.data[e][c].strformat("time")}else{this.data[e][c]=this.data[e][c].strformat("date-and-time")}}}else{if(typeof this.data[e][c]!=="string"){this.data[e][c]=this.data[e][c].toString()}}}this.data[e][c]=this.data[e][c].trim()}else{if(this.isQuantitative(c)){if(typeof this.data[e][c]==="string"){this.data[e][c]=parseFloat(this.data[e][c].replace(/[^\d.-]/g,""))}if(typeof this.data[e][c]==="undefined"||isNaN(this.data[e][c])){if(this.columnName(c)=="graphica.com.frequency"){this.data[e][c]=1}else{this.data[e][c]=null}}if(this.data[e][c]!==null){this._update_metrics(e,c)}}else{if(this.isDateType(c)){if(this.data[e][c]!==null){if(typeof this.data[e][c]==="number"){this.data[e][c]=this.data[e][c].toString()}var d=graphica.Utils.dateFrom(this.data[e][c]);if(d===null||graphica.Utils.isValidDate(d)==false){this.data[e][c]=null}else{this.data[e][c]=d;this._update_metrics(e,c)}}}}}}};graphica.Dataset.fn.indexRow=function(d,e){var c=0;var b=this.header.length-1;if(typeof e!=="undefined"){c=e;b=e}for(var a=c;a<=b;a++){if(this.isCategorical(a)){var f=this.data[d][a];if(typeof this._indices[a]=="undefined"){this._indices[a]={};this._indices_length[a]=0}if(typeof this._indices[a][f]==="undefined"){this._indices[a][f]=new Array();this._indices_length[a]++}this._indices[a][f].push(d)}}};graphica.Dataset.fn.renameColumn=function(b,a){b=this.header.getId(b);delete this.header.ids[this.columnName(b)];this.header.names[b]=a;this.header.ids[a]=b};graphica.Dataset.fn.changeColumnType=function(a,b){a=this.header.getId(a);this.header.types[a]=b;if(typeof this._indices[a]!="undefined"){delete this._indices[a]}if(typeof this.metrics.mins[a]!=="undefined"){delete this.metrics.mins[a]}this.eachRow(function(d,c){this.formatRow(c,a);this.indexRow(c,a)})};graphica.Dataset.fn.eachRow=function(a){for(var b=0;b<this.length;b++){var c=a.call(this,this.row(b),b,this.row_stats(b));if(c===false){return}}};graphica.Dataset.fn.eachRowOrdered=function(h,b,g,a){var k;var f=this;if(!this.length){return}if(typeof b==="undefined"||b===null||(Array.isArray(b)&&b.length==0)){return this.eachRow(h)}if(typeof g==="undefined"){g=[null]}if(typeof a==="undefined"){a=null}if(Array.isArray(b)==false){b=[b]}if(Array.isArray(a)==false){a=[a]}var e=[];k=[];for(var d=0;d<this.length;d++){vals=[];for(var c=0;c<b.length;c++){vals.push(this.getValue(d,b[c]))}k.push({id:d,value:vals})}k.sort(function(m,j){for(var o=0;o<b.length;o++){if(f.isDateType(b[o])){if(m.value[o]&&j.value[o]&&m.value[o].getTime()!=j.value[o].getTime()){if(typeof a[o]!=="string"||a[o]=="asc"){return m.value[o].getTime()-j.value[o].getTime()}else{return j.value[o].getTime()-m.value[o].getTime()}}}else{if(f.isQuantitative(b[o])){if(m.value[o]!=j.value[o]){if(typeof a[o]!=="string"||a[o]=="asc"){return m.value[o]-j.value[o]}else{return j.value[o]-m.value[o]}}}else{if(m.value[o]!=j.value[o]){g[o]=g[o]||f.unique(b[o]);if(typeof e[o]==="undefined"){e[o]={};for(var p=0;p<g[o].length;p++){var n=g[o][p];e[o][n]=p}}if(typeof a[o]!=="string"||a[o]=="asc"){return e[o][m.value[o]]-e[o][j.value[o]]}else{return e[o][j.value[o]]-e[o][m.value[o]]}}}}}return 0});for(var c=0;c<k.length;c++){var l=h.call(this,this.row(k[c].id),k[c].id,k[c].value[0]);if(l===false){return}}};graphica.Dataset.fn.getCategoricalRowObject=function(d){var a={};var c=0;for(var b=0;b<d.length;b++){if(this.isQuantitative(b)==false&&graphica.computed_variables.indexOf(this.header.names[b])==-1){c++;if(this.isDateType(b)){if(d[b]===null){a[this.header.names[b]]=""}else{a[this.header.names[b]]=d[b].toISOString()}}else{a[this.header.names[b]]=d[b]}}}if(c==0){for(var b=0;b<d.length;b++){if(graphica.computed_variables.indexOf(this.header.names[b])==-1){a[this.header.names[b]]=d[b]}}}return a};graphica.Dataset.fn.row=function(a){return this.data[a].slice(0)};graphica.Dataset.fn.row_stats=function(a){if(typeof this.stats[a]!=="undefined"){return this.stats[a].slice(0)}return[]};graphica.Dataset.fn.getValue=function(a,c,b){c=this.header.getId(c);if(typeof b==="string"&&typeof this.stats[a][c]!=="undefined"&&typeof this.stats[a][c][b]!=="undefined"){return this.stats[a][c][b]}return this.row(a)[c]};graphica.Dataset.fn.getSumofValuesByCategory=function(d,a,c,f){var b=0;if(this.isCategorical(d)==false||this.isQuantitative(c)==false){return b}if(typeof this._indices[d]!=="undefined"&&typeof this._indices[d][a]!=="undefined"){for(var e=0;e<this._indices[d][a].length;e++){b+=this.getValue(this._indices[d][a][e],c,f)}}return b};graphica.Dataset.fn.setValue=function(b,c,d){c=this.header.getId(c);if(this.isCategorical(c)){var a=-1;if(typeof this._indices[c]!=="undefined"&&typeof this._indices[c][this.row(b)[c]]!=="undefined"){a=this._indices[c][this.row(b)[c]].indexOf(b)}if(a!=-1){this._indices[c][this.row(b)[c]].splice(a,1);if(this._indices[c][this.row(b)[c]].length==0){delete this._indices[c][this.row(b)[c]]}}}else{if(this.isQuantitative(c)){this.metrics.sums[c]-=this.row(b)[c]}}this.metrics.hasChanged[c]=true;this.data[b][c]=d;this.formatRow(b,c);this.indexRow(b,c)};graphica.Dataset.fn.indexOf=function(d,a,c){a=this.header.getId(a);if(typeof this._indices[a]!=="undefined"&&typeof this._indices[a][d]!=="undefined"&&typeof this._indices[a][d][0]!=="undefined"){return this._indices[a][d][0]}if(this.isCategorical(a)){return -1}for(var b=0;b<this.length;b++){if((this.isQuantitative(a)&&this.data[b][a]==d)||(this.isDateType(a)&&d.faststrformat(c)==this.data[b][a].faststrformat(c))){return b}}return -1};graphica.Dataset.fn.rows=function(c,e,b){var d;if(this.isCategorical(c)){c=this.header.getId(c);d=new graphica.Dataset();d.header=this.header;if(typeof this._indices[c]==="undefined"||typeof this._indices[c][e]==="undefined"){return d}for(var a=0;a<this._indices[c][e].length;a++){d.add(this.row(this._indices[c][e][a]),this.stats[this._indices[c][e][a]])}if(this.edges){d.edges=this.edges.clone()}return d}else{if(this.isDateType(c)){c=this.header.getId(c);if(typeof e=="string"){e=graphica.Utils.dateFrom(e)}return this.where(function(g,f){return(g[c]!=null&&g[c].faststrformat(b)==e.faststrformat(b))})}else{return this.where(function(g,f){if(g[c]==e){return true}return false})}}};graphica.Dataset.fn.where=function(a,d){var c=this;if(typeof d!=="boolean"){d=false}var b=new graphica.Dataset();b.header=this.header;this.eachRow(function(k,g,h){if(d){var f={};for(var e=0;e<k.length;e++){f[this.header.names[e]]=k[e]}if(a.call(this,f,g)){b.add(k,h)}}else{if(a.call(this,k,g)){b.add(k,h)}}});if(this.edges&&this.nodes_index_var!=-1&&this.source_link_var!=-1&&this.target_link_var!=-1){b.edges=this.edges.where(function(e){return(b.indexOf(e[c.source_link_var],c.nodes_index_var)!=-1&&b.indexOf(e[c.target_link_var],c.nodes_index_var)!=-1)});b.nodes_index_var=this.nodes_index_var;b.target_link_var=this.target_link_var;b.source_link_var=this.source_link_var}return b};graphica.Dataset.fn.split=function(c,f,d){var a=new Array();if(typeof d==="undefined"){d=null}if(typeof f==="undefined"||f===null){f=this.unique(c,d)}for(var b=0;b<f.length;b++){var e=this.rows(c,f[b],d);a.push(e)}return a};graphica.Dataset.fn.multiple_split=function(e,b){var a=new Array();if(!e.length){return[this]}a[0]=this.split(e[0],null,(typeof b!=="undefined"&&typeof b[0]!=="undefined"?b[0]:null));for(var d=1;d<e.length;d++){a[d]=[];for(var c=0;c<a[d-1].length;c++){a[d]=a[d].concat(a[d-1][c].split(e[d],null,(typeof b!=="undefined"&&typeof b[d]!=="undefined"?b[d]:null)))}}return a[e.length-1]};graphica.Dataset.fn.maxByCategories=function(d,h,j,k){var e=function(s,m,p,o,q,n,r){if(s.length==0){return o}s=s.concat();m=m||[];m=m.concat();var l=p.getValue(n,s[0]);if(typeof m[0]!=="undefined"&&p.isDateType(s[0])){l=l.faststrformat(m[0])}if(s.length==1){o[l]=o[l]||{};o[l].positive=o[l].positive||0;o[l].negative=o[l].negative||0;q.max=q.max||0;q.min=q.min||0;if(r>0){o[l].positive+=r}else{o[l].negative+=r}q.max=Math.max(q.max,o[l].positive);q.min=Math.min(q.min,o[l].negative);return o[l]}else{o[l]=o[l]||{};q[l]=q[l]||{};s.shift();m.shift();return e(s,m,p,o[l],q[l],n,r)}};var a=this;h=h||[];for(var f=0;f<d.length;f++){h[f]=h[f]||null}var g={taxonomy:{},taxonomyMaxMin:{},max:0,min:0,summax:0};for(var f=0;f<a.length;f++){var c=a.getValue(f,j,k);var b=e(d,h,a,g.taxonomy,g.taxonomyMaxMin,f,c);g.max=Math.max(g.max,b.positive);g.summax+=c;g.min=Math.min(g.min,b.negative)}return g};graphica.Dataset.fn.getDateTicksNumber=function(e,c,d,b){if(typeof c=="undefined"){c=this.tickUnit(e)}var f=d||this.min(e);f=graphica.Utils.dateFrom(f);var a=b||this.max(e);a=graphica.Utils.dateFrom(a);if(f===null||a===null){return 0}if(c=="year"){return(a.getUTCFullYear()-f.getUTCFullYear())+1}else{if(c=="quarter"){return Math.ceil((a.getUTCMonth()-f.getUTCMonth()+(12*(a.getUTCFullYear()-f.getUTCFullYear())))/3)+1}else{if(c=="month"){return a.getUTCMonth()-f.getUTCMonth()+(12*(a.getUTCFullYear()-f.getUTCFullYear()))+1}else{if(c=="day"){f.setUTCHours(0,0,0,0);a.setUTCHours(0,0,0,0);return Math.floor((a.getTime()-f.getTime())/(1000*60*60*24))+1}else{if(c=="hour"){f.setUTCMinutes(0);f.setUTCSeconds(0);a.setUTCMinutes(0);a.setUTCSeconds(0);return Math.floor((a.getTime()-f.getTime())/(1000*60*60))+1}else{if(c=="minute"){f.setUTCSeconds(0);a.setUTCSeconds(0);return Math.floor((a.getTime()-f.getTime())/(1000*60))+1}else{if(c=="second"){return Math.floor((a.getTime()-f.getTime())/(1000))+1}}}}}}}};graphica.Dataset.fn.getDateTickValue=function(c,f,b,d){if(typeof b==="undefined"){b=this.tickUnit(c)}var e=d||this.min(c);var a=graphica.Utils.dateFrom(e);if(b=="year"){a.setUTCFullYear(e.getUTCFullYear()+f)}else{if(b=="quarter"){a.setUTCFullYear(e.getUTCFullYear()+Math.floor(f/4));a.setUTCMonth(e.getUTCMonth()+((f%4)*3))}else{if(b=="month"){a.setUTCFullYear(e.getUTCFullYear()+Math.floor(f/12));a.setUTCMonth(e.getUTCMonth()+(f%12))}else{if(b=="day"){a.setTime(e.getTime()+(f*24*60*60*1000))}else{if(b=="hour"){a.setTime(e.getTime()+(f*60*60*1000))}else{if(b=="minute"){a.setTime(e.getTime()+(f*60*1000))}else{if(b=="second"){a.setTime(e.getTime()+(f*1000))}}}}}}}return a};graphica.Dataset.fn.getDateTickPosition=function(c,d,a,b){if(typeof d==="undefined"||d===null){return null}if(typeof a==="undefined"){a=this.tickUnit(c)}var e=b||this.min(c);var e=graphica.Utils.dateFrom(e);d=graphica.Utils.dateFrom(d);if(a=="year"){return d.getUTCFullYear()-e.getUTCFullYear()}else{if(a=="quarter"){return Math.ceil((((d.getUTCMonth()-e.getUTCMonth()))+((d.getUTCFullYear()-e.getUTCFullYear())*12))/3)}else{if(a=="month"){return((d.getUTCMonth()-e.getUTCMonth()))+((d.getUTCFullYear()-e.getUTCFullYear())*12)}else{if(a=="day"){e.setUTCHours(0,0,0,0);d.setUTCHours(0,0,0,0);let utc1=e.getTime();let utc2=d.getTime();return Math.floor((utc2-utc1)/(1000*60*60*24))}else{if(a=="hour"){e.setUTCMinutes(0);e.setUTCSeconds(0);e.setUTCMilliseconds(0);d.setUTCMinutes(0);d.setUTCSeconds(0);d.setUTCMilliseconds(0);let utc1=e.getTime();let utc2=d.getTime();return Math.floor((utc2-utc1)/(1000*60*60))}else{if(a=="minute"){e.setUTCSeconds(0);e.setUTCMilliseconds(0);d.setUTCSeconds(0);d.setUTCMilliseconds(0);let utc1=e.getTime();let utc2=d.getTime();return Math.floor((utc2-utc1)/(1000*60))}else{if(a=="second"){e.setUTCMilliseconds(0);d.setUTCMilliseconds(0);let utc1=e.getTime();let utc2=d.getTime();return Math.floor((utc2-utc1)/1000)}}}}}}}};graphica.Dataset.fn.getDateTicks=function(c,d,h,l){var k=performance.now();var f=new Array();var m=new Array();var a=h||this.min(c);var j=l||this.max(c);if(this.isDateType(c)){if(typeof this._cached_getDateTicksValues!=="undefined"&&this._cached_getDateTicksValues.maxdate==j.faststrformat(d)&&this._cached_getDateTicksValues.mindate==a.faststrformat(d)&&this._cached_getDateTicksValues.column==c&&this._cached_getDateTicksValues.param_tick_unit==d){return this._cached_getDateTicksValues}if(typeof a=="undefined"){return{ticks:[],ticks_strings:[],min_tick_unit:"year"}}if(typeof d==="undefined"||d===null){d=this.tickUnit(c)}var g=this.getDateTicksNumber(c,d,h,l);for(i=0;i<g;i++){var b=this.getDateTickValue(c,i,d,h);f.push(b);var e=b.faststrformat(d);m.push(e)}this._cached_getDateTicksValues={mindate:a.faststrformat(d),maxdate:j.faststrformat(d),column:c,param_tick_unit:d,ticks:f,ticks_strings:m,min_tick_unit:d};return this._cached_getDateTicksValues}return f};graphica.Dataset.fn.column=function(b){b=this.header.getId(b);var a=new Array();this.eachRow(function(d,c){a.push(d[b])});return a};graphica.Dataset.fn.replaceColumn=function(a,c,d){var e=this;c=this.header.getId(c);if(typeof d==="undefined"){d=this.columnType(c)}this.header.types[c]=d;if(typeof this._indices[c]!="undefined"){delete this._indices[c]}if(typeof this.metrics.mins[c]!=="undefined"){delete this.metrics.mins[c]}for(var b=0;b<a.length;b++){if(b>=e.length){break}e.setValue(b,c,a[b])}return this};graphica.Dataset.fn.unique=function(c,g,b){c=this.header.getId(c);var l=[];if(typeof g==="undefined"||Array.isArray(g)==false){g=null}if(this.isCategorical(c)){if(g!==null){var f=[];l=this._keys(this._indices[c]);if(g.length==l.length&&JSON.stringify(g)==JSON.stringify(l)){return g.concat()}l.sort(function(m,j){return g.indexOf(m)-g.indexOf(j)});return l}if(this._indices.length){return this._keys(this._indices[c])}return[]}else{if(this.isDateType(c)){b=b||null;l={};this.eachRow(function(m,a){if(m[c]){var j=m[c].faststrformat(b);l[j]=graphica.Utils.dateFrom(m[c])}});if(g!==null){var k=[];for(var d=0;d<g.length;d++){if(typeof l[g[d]]!=="undefined"){k.push(l[g[d]])}}return k}return Object.values(l)}else{var h=this.column(c);for(var e=0;e<h.length;e++){if(l.includes(h[e])==false){l.push(h[e])}}return l}}};graphica.Dataset.fn.groupBy=function(b,F){var c={};var y=[];var q=new graphica.Dataset();if(typeof b=="undefined"){return q}if(Array.isArray(b)==false){b=[b]}F=F||[];for(var C=0;C<b.length;C++){if(typeof F[C]==="undefined"){F[C]=null}}q.header={names:this.header.names.slice(0),types:this.header.types.slice(0),ids:JSON.parse(JSON.stringify(this.header.ids)),length:this.header.length,no_computed_length:0,getId:function(e){if(typeof e==="string"){return this.ids[e]}return e}};var u;for(u=0;u<b.length;u++){if(this.isQuantitative(b[u])&&F[u]===null){return q}if(this.isCategorical(b[u])&&this.length==this._indices_length[this.header.getId(b[u])]){q=this.clone();if(this.edges){q.edges=this.edges.clone()}return q}if(this.isDateType(b[u])){y[this.header.getId(b[u])]=F[u]}}var o={};var g=[];var x=[];var B=[];for(var u=0;u<this.header.length;u++){g.push(false);x.push(null);B.push(null)}for(var t=0;t<b.length;t++){if(this.isQuantitative(b[t])){g[this.header.getId(b[t])]=true}}var p=0;if(b.length){for(u=0;u<this.length;u++){var m="_";var A=false;for(var t=0;t<b.length;t++){if(this.getValue(u,b[t])===null){A=true;break}else{if(this.isDateType(b[t])){var I=this.getValue(u,b[t]);if(!I){m+=" _"}else{m+=this.getValue(u,b[t]).faststrformat(F[t])+"_"}}else{if(this.isQuantitative(b[t])){var G=this.header.getId(b[t]);if(x[G]===null){x[G]=F[t].min;B[G]=F[t].binWidth}var I=this.getValue(u,b[t]);var E=I-x[G];var f=Math.floor(E/B[G]);f=x[G]+f*B[G];var z=f+B[G];m+=f+"-"+z+"_"}else{m+=this.getValue(u,b[t])+"_"}}}}if(A){continue}if(typeof o[m]==="undefined"){o[m]=new Array();p++}o[m].push(u)}if(p==this.length){q=this.clone();if(this.edges){q.edges=this.edges.clone()}return q}}else{o.all=new Array();p=1;for(u=0;u<this.length;u++){o.all.push(u)}}for(u in o){var l=new graphica.Dataset();l.header=this.header;var H;for(var s=0;s<o[u].length;s++){l.add(this.row(o[u][s]));if(this.nodes_index_var!=-1){if(s==0){H=l.getValue(0,this.nodes_index_var)}else{var D=l.getValue(s,this.nodes_index_var);if(H!=D){c[D]=H}}}}var n=new Array();var a=new Array();for(var w=0;w<this.header.length;w++){var G=this.header.getId(w);if(this.isQuantitative(w)){if(g[w]){var r=Math.floor((l.min(G)-x[w])/B[w]);q.metrics.bin_widths[G]=B[w];n.push(x[w]+r*B[w]);a.push({})}else{n.push(l.sum(G));a.push(l.getStats(G))}}else{if(this.isDateType(w)&&typeof y[w]!=="undefined"){n.push(graphica.Utils.dateFrom(l.getValue(0,G).faststrformat(y[w])));a.push({})}else{n.push(l.getValue(0,G));a.push({})}}}q.add(n,a)}if(this.nodes_index_var!=-1&&this.source_link_var!=-1&&this.target_link_var!=-1){q.edges=this.edges.clone();for(u=0;u<q.edges.length;u++){var v=q.edges.getValue(u,this.source_link_var);var d=q.edges.getValue(u,this.target_link_var);if(typeof c[v]!="undefined"){q.edges.setValue(u,this.source_link_var,c[v])}if(typeof c[d]!="undefined"){q.edges.setValue(u,this.target_link_var,c[d])}}q.edges=q.edges.groupBy([this.source_link_var,this.target_link_var])}return q};graphica.Dataset.fn._isFunction=function(a){return typeof(a)=="function"};graphica.Dataset.fn._keys=function(b){if(Object.keys){return Object.keys(b)}else{keys=new Array();for(var a in b){keys.push(a)}return keys}};graphica.Dataset.fn.getCSVObject=function(k){if(typeof k!=="boolean"){k=false}var d="";var h={};h.csv="";h.types={};if(this.edges){d=this.edges.getCSVObject(k).csv}var f;if(k){f=this.header.names.length}else{f=this.header.no_computed_length}var c=[];for(var g=0;g<f;g++){if(graphica.computed_variables.indexOf(this.header.names[g])==-1){c.push(this.header.names[g]);h.types[this.header.names[g]]=this.header.types[g]}else{var b=this.header.names[g]+" (1)";var a=2;while(this.hasColumn(b)){b=this.header.names[g]+" ("+a+")";a++}c.push(b);h.types[b]=this.header.types[g]}}h.csv+=c.join(";")+"\n";for(var g=0;g<this.length;g++){for(var e=0;e<f;e++){if(this.isDateType(e)&&this.data[g][e]!==null){h.csv+='"'+this.data[g][e].faststrformat()+'"'}else{if(this.isCategorical(e)){h.csv+='"'+this.data[g][e].split('"').join('""')+'"'}else{if(this.data[g][e]!==null){h.csv+=this.data[g][e].toString()}}}if(e<f-1){h.csv+=";"}else{h.csv+="\n"}}}if(d){h.csv="*nodes\n"+h.csv+"\n*edges\n"+d}return h};window.graphica=window.graphica||{};graphica.Elements=function(d,a,c,g){this.anchor_axis_variable=null;this.anchor_axis_variable_aggregation=null;if(typeof a!=="undefined"){this.anchor_axis_variable=a}if(typeof c=="undefined"){this._backgroundSettings={active:false}}else{this._backgroundSettings={};this._backgroundSettings.active=c.active||false;this._backgroundSettings.color=c.color||"#DCDCDC";this._backgroundSettings.opacity=0.8;if(typeof c.opacity=="number"){this._backgroundSettings.opacity=c.opacity}this._backgroundSettings.includeMap=true;if(typeof c.includeMap=="boolean"){this._backgroundSettings.includeMap=c.includeMap}}this.isBackgroundElements=this._backgroundSettings.active;this.isForScreenshot=g;this._frame=d;this._properties=this._frame._properties;this._dataset=this._properties.getDataset(a);this._properties._ds=this._dataset;if(this.anchor_axis_variable!==null){if(this._properties.getSettings(this.anchor_axis_variable,graphica.POS_X,"aggregation")!==null){this.anchor_axis_variable_aggregation=this._properties.getSettings(this.anchor_axis_variable,graphica.POS_X,"aggregation")}else{if(this._properties.getSettings(this.anchor_axis_variable,graphica.POS_Y,"aggregation")!==null){this.anchor_axis_variable_aggregation=this._properties.getSettings(this.anchor_axis_variable,graphica.POS_Y,"aggregation")}}}this.gr=new Grape();this.mark=this._properties.Mark(a);var e;if(this._backgroundSettings.includeMap){if(d._map){e=new Grape().x(d._dataspace.x).y(d._dataspace.y);e.addChild(d._map.root);this.gr.addChild(e)}else{if(d._sub_frames.length&&d._sub_frames[0]._map){for(var b=0;b<d._sub_frames.length;b++){e=new Grape().x(d._sub_frames[b]._dataspace.x).y(d._sub_frames[b]._dataspace.y);e.addChild(d._sub_frames[b]._map.root);this.gr.addChild(e)}}}}let is_a_treemap_graph=false;if(this.mark==graphica.FILLED_RECTANGLE&&this._dataset.edges&&this._frame.graphObj){is_a_treemap_graph=true}this.linksgr=new Grape();if(!is_a_treemap_graph){this.linksgr.addTo(this.gr)}this.backElements=new Grape().addTo(this.gr);this.elementsgr=new Grape().addTo(this.gr);if(is_a_treemap_graph){this.linksgr.addTo(this.gr)}this.labelsgroup=new graphica.LabelGroup(this._properties,this._frame);this._frame.labelsgroup=this.labelsgroup;this.labelsgr=new Grape();this._frame.labelsgr=this.labelsgr;this.repulsion_points=[];this.linksgroup=new GrapeGroup();this.annotationgroup=new GrapeGroup();this.grAnnotations=new Grape().addTo(this.gr);this._frame.grAnnotations=this.grAnnotations};graphica.Elements.fn=graphica.Elements.prototype;graphica.Elements.fn.init=function(){var s=this;this.grgroup=new GrapeGroup();this.grgroupByCategory={};this.grclips=new GrapeGroup();this.grDensityMap=new Grape();this.grReferenceLines=new Grape();var ag;var y=this._properties;var x;var T=[];var af=[];if(this.mark==graphica.CIRCLE){var ay;var aa=[];if(this._frame._frame_type!="Nx0"&&this._frame._frame_type!="0xN"&&this._frame._frame_type!="Nx1C"&&this._frame._frame_type!="1CxN"&&this._frame._frame_type!="Nx2C"&&this._frame._frame_type!="2CxN"&&this._frame._frame_type!="2x1C"&&this._frame._frame_type!="1Cx2"){if(this._frame._sub_frames.length){ay=this._frame._sub_frames}else{ay=[this._frame]}var n=0;for(var O=0;O<ay.length;O++){var S=ay[O];var J=S._subdataset||this._dataset;var q=[];if(y.countVariables(graphica.UNIT)>0){q.push(y.firstVariable(graphica.UNIT))}if(S.axis_x&&S.axis_x._is_variable_categorical){q.push(S.axis_x._variable)}if(S.axis_x2&&S.axis_x2._is_variable_categorical){q.push(S.axis_x2._variable)}if(S.axis_y&&S.axis_y._is_variable_categorical){q.push(S.axis_y._variable)}if(S.axis_y2&&S.axis_y2._is_variable_categorical){q.push(S.axis_y2._variable)}aa.push(J.multiple_split(q));n=Math.max(n,aa[O].length)}for(var O=0;O<ay.length;O++){var S=ay[O];var aF=aa[O];for(var N=0;N<aF.length;N++){if(aF[N].length==0){continue}var aB=aF[N].sums();var H=S.getPoints(aB);if(H.x!==null&&H.y!==null){var X=graphica.Utils.squareWidthIntoRectangle(S._dataspace.width,S._dataspace.height,n)*0.333;X*=(Math.sqrt(this._properties.default_area/Math.PI)/Math.sqrt(113/Math.PI));var G=this.drawPie(aF[N],H.x,H.y,X);this.grAnnotations.addChild(G.annotations);G.pie.addTo(this.elementsgr)}}}}}else{if(this.mark==graphica.GEO_SHAPE&&y.countVariables(graphica.SHAPE)==0&&(this._frame._map||(this._frame._sub_frames.length&&this._frame._sub_frames[0]._map))){this._dataset.eachRow(function(d,c){s.drawBackgroundElement(d,c)});if(this._frame._map){if(this._frame._map._include_area&&this._frame._map.async_map==false){this._frame._map.valuebyareaMap(this._frame._map._regions);this._frame._map._regions.each(function(){if(this._need_zoom_autofocus){this._tmpbbox=this.getBBox();s.updateZoomAutoFocusBox(this)}});this.grAnnotations.getChildren().each(function(){this._update_position()})}}else{if(this._frame._sub_frames[0]._map.async_map==false&&this._frame._sub_frames[0]._map._include_area){for(var R=0;R<this._frame._sub_frames.length;R++){this._frame._sub_frames[R]._map.valuebyareaMap(this._frame._sub_frames[R]._map._regions)}this.grAnnotations.getChildren().each(function(){this._update_position()})}}}else{if(this.mark==graphica.FILLED_RECTANGLE){if(this._frame.isACategoricalSpace()){let area_var_ok=(y.countVariables(graphica.AREA)>0);let area_var=y.firstVariable(graphica.AREA);var ay;if(this._frame._sub_frames.length){ay=this._frame._sub_frames}else{ay=[this._frame]}for(var O=0;O<ay.length;O++){var S=ay[O];var J=S._subdataset||this._dataset;var am=(y.countVariables(graphica.HUE)>0&&this._dataset.isCategorical(y.firstVariable(graphica.HUE))&&(y.countVariables(graphica.SUBDIVISION)==0||y.firstVariable(graphica.SUBDIVISION)!=y.firstVariable(graphica.HUE)));var Z={};if(am){var A=y.firstVariable(graphica.HUE);var l=J.unique(A);for(var av=0;av<l.length;av++){Z[l[av]]={};Z[l[av]].nodes=[];Z[l[av]].rows=[];Z[l[av]].rowindexes=[];Z[l[av]].cont=0;Z[l[av]].area=0;Z[l[av]].catcont=av}}else{l=["all"];Z.all={};Z.all.nodes=[];Z.all.rows=[];Z.all.rowindexes=[];Z.all.cont=0;Z.all.area=0;Z.all.x=S._dataspace.x;Z.all.y=S._dataspace.y;Z.all.width=S._dataspace.width;Z.all.height=S._dataspace.height}J.eachRow(function(f,c){var d="all";if(am){d=f[A]}Z[d].rows[Z[d].cont]=f;Z[d].rowindexes[Z[d].cont]=c;if(area_var_ok){Z[d].nodes[Z[d].cont]={data:"",weight:y.getArea(c,J),cont:Z[d].cont}}else{Z[d].nodes[Z[d].cont]={data:"",weight:1,cont:Z[d].cont}}Z[d].area+=Z[d].nodes[Z[d].cont].weight;Z[d].cont++});if(am){var b=[];for(var av=0;av<l.length;av++){b[av]={data:"",weight:Z[l[av]].area,cont:Z[l[av]].catcont}}let treedata={frame:{x:S._dataspace.x,y:S._dataspace.y,width:S._dataspace.width,height:S._dataspace.height},nodes:b};let result=[];graphica.treemap.squarify(treedata,function(d,i,f,c,g){result[g.cont]={x:d,y:i,width:f,height:c}});for(var aw=0;aw<result.length;aw++){Z[l[aw]].x=result[aw].x;Z[l[aw]].y=result[aw].y;Z[l[aw]].width=result[aw].width;Z[l[aw]].height=result[aw].height}}for(var K=0;K<l.length;K++){var ab=Z[l[K]];let treedata={frame:{x:ab.x,y:ab.y,width:ab.width,height:ab.height},nodes:ab.nodes};let result=[];graphica.treemap.squarify(treedata,function(d,i,f,c,g){result[g.cont]={x:d,y:i,width:f,height:c}});for(var M=0;M<result.length;M++){let row=ab.rows[M];let rowindex=ab.rowindexes[M];let positions=result[M];let border=y.default_border_width/2;let b_color=y.default_border_color||this.getColor(rowindex);let col=this.getColorByValue(row);var j=this._dataset.getCategoricalRowObject(row);let cus_col=this.getCustomColor(j);if(cus_col){col=cus_col}let ag=new Grape().beginFill(col,this.getIntensityByValue(row)).lineStyle(border,b_color,y.default_border_intensity);if(cus_col){ag._custom_color=cus_col}ag._row=row;ag._criteriaRow=j;ag.rect(0,0,Math.max(0,positions.width-border),Math.max(0,positions.height-border));ag.x(positions.x+border/2).y(positions.y+border/2);ag._form_data=new graphica.FormData();ag._form_data.form(graphica.FILLED_RECTANGLE).width(positions.width-border*2).height(positions.height-border*2).allow_label_overlapping(true).color(this.getColor(rowindex));ag._form_data.x(positions.x+positions.width/2).y(positions.y+positions.height/2);ag._is_filled_rectangle=true;ag._highlight_id=this.getHighlightID(rowindex,J);ag._highlight_ids=[ag._highlight_id];ag._annotation_config=y.view.getAnnotationConfig(ag._criteriaRow,this.anchor_axis_variable);y.view.classify(ag,"element");if(this.hasAnnotation(ag)){this.grAnnotations.addChild(this.getAnnotationGrape(ag))}x=this.getTooltip(rowindex,J);if(this._dataset.edges&&S.graphObj){var D=S.graphObj.getNode(row);if(D){ag.graphNode=D;D.elm=ag}}if(y.countVariables(graphica.HUE)){this.filterWrapper(ag,y.firstVariable(graphica.HUE),ag._row)}else{if(y.countVariables(graphica.SUBDIVISION)){this.filterWrapper(ag,y.firstVariable(graphica.SUBDIVISION),ag._row)}else{if(y.countVariables(graphica.UNIT)){this.filterWrapper(ag,y.firstVariable(graphica.UNIT),ag._row)}else{this.filterWrapper(ag,null,ag._row)}}}if(x!=""){ag.addChild(new Grape("title").text(x))}if(positions.width>30||positions.height>30){let label_padding=4;var aA=this.addLabel(ag,rowindex,"left","top",[],J,positions.width-label_padding*2);if(aA){aA._tmpbbox=aA._tmpbbox||aA.getBBox();var az=aA._tmpbbox.width+label_padding*2;var ax=0;var ah=0;if(az>positions.width&&az<positions.height&&this._properties.label_placement=="automatic"){ax=-az+label_padding*2;aA.rotation(-90);aA.align("right");aA.x(aA.x()+label_padding).y(aA.y()+label_padding);this.grclips.push(aA.getClip(new Grape("rect","svg").x(ax-1).y(ah-1).height(positions.width-label_padding*2+2-border).width(positions.height-label_padding*2+2-border)));if(aA.pixi){var t=new PIXI.Graphics();t.beginFill(16724736);t.drawRect(positions.x,positions.y,positions.width,positions.height);t.endFill();aA.pixi.mask=t}}else{if(this._properties.label_placement=="automatic"){aA.x(aA.x()+label_padding).y(aA.y()+label_padding)}else{aA.align(this._properties.label_align);if(this._properties.label_align=="right"){aA.x(aA.x()+positions.width-label_padding);ax=-positions.width+label_padding*2}else{if(this._properties.label_align=="left"){aA.x(aA.x()+label_padding)}else{aA.x(aA.x()+label_padding+(positions.width-label_padding*2)/2);ax=-positions.width/2+label_padding}}aA.verticalAlign(this._properties.label_vertical_align);if(this._properties.label_vertical_align=="top"){aA.y(aA.y()+label_padding)}else{if(this._properties.label_vertical_align=="bottom"){aA.y(aA.y()+positions.height-label_padding);ah=-positions.height+label_padding*2}else{aA.y(aA.y()+positions.height/2);ah=-positions.height/2}}}this.grclips.push(aA.getClip(new Grape("rect","svg").x(ax-1).y(ah-1).width(positions.width-label_padding*2+2-border).height(positions.height-label_padding*2+2-border)));if(aA.pixi){var t=new PIXI.Graphics();t.beginFill(16724736);t.drawRect(positions.x,positions.y,positions.width,positions.height);t.endFill();aA.pixi.mask=t}}}}this.grgroup.push(ag)}}}this.grgroup.addTo(this.elementsgr)}}else{if(this.mark==graphica.AREALINE&&(this._frame._frame_type=="Nx0"||this._frame._frame_type=="0xN"||(this._frame._frame_type=="multiple"&&this._frame._sub_frames.length&&(this._frame._sub_frames[0]._frame_type=="0xN"||this._frame._sub_frames[0]._frame_type=="Nx0")))){var aC;if(this._frame._sub_frames.length){aC=this._frame._sub_frames}else{aC=[this._frame]}for(var I=0;I<aC.length;I++){var S=aC[I];for(var P=0;P<S.all_n_variables.length-1;P++){var m=S._subdataset||this._dataset;var V=[];var p=[];var ao=S.all_n_variables[P];var an=S.all_n_variables[P+1];var ap=[];var aj=null;var C=S._frame_type=="Nx0"?graphica.POS_X:graphica.POS_Y;for(var aD=0;aD<S.all_n_variables.length;aD++){if(aD!=P&&aD!=P+1){ap.push(S.all_n_variables[aD])}}var ae,ad;if(S._frame_type=="Nx0"){ae=S.naxis_x[P];ad=S.naxis_x[P+1]}else{ae=S.naxis_y[P];ad=S.naxis_y[P+1]}ae._stacked_a={};ad._stacked_b={};if(m.isCategorical(ao)||m.isDateType(ao)){V.push(ao);p.push(y.getSettings(ao,C,"aggregation"))}if(m.isCategorical(an)||m.isDateType(an)){V.push(an);p.push(y.getSettings(an,C,"aggregation"))}if(y.countVariables(graphica.HUE)&&V.includes(y.firstVariable(graphica.HUE))==false){V.push(y.firstVariable(graphica.HUE));p.push(null)}if(V.length){m=m.groupBy(V)}var a=null;var L=null;var w=null;if(!m.isQuantitative(ao)&&m.isQuantitative(an)){a=ao;if(m.isDateType(ao)){aj=S._frame_type=="0xN"?((ad._reversed!=ae._reversed)?"asc":"desc"):((ad._reversed!=ae._reversed)?"desc":"asc")}else{L=y.getOrderedItems(a,C,null,null,S._frame_type=="Nx0"?(ad._reversed!=ae._reversed):(ad._reversed==ae._reversed));if(y.countVariables(graphica.HUE)){an=y.firstVariable(graphica.HUE);w=y.getOrderedItems(an,graphica.HUE,null,null,ad._reversed)}}}else{if(!m.isQuantitative(ao)&&!m.isQuantitative(an)){a=ao;if(m.isCategorical(ao)){if(y.countVariables(graphica.HUE)&&y.getSettings(y.firstVariable(graphica.HUE),graphica.HUE,"sort_type")&&y.getSettings(y.firstVariable(graphica.HUE),graphica.HUE,"sort_type")!="none"){a=y.firstVariable(graphica.HUE);L=y.getOrderedItems(a,graphica.HUE,null,null,S._frame_type=="Nx0"?ae._reversed:!ae._reversed)}else{L=y.getOrderedItems(ao,C,null,null,S._frame_type=="Nx0"?ae._reversed:!ae._reversed)}}else{L=y.getOrderedItems(ao,C,null,null,S._frame_type=="Nx0"?ae._reversed:!ae._reversed)}if(m.isCategorical(an)){w=y.getOrderedItems(an,C,null,null,S._frame_type=="Nx0"?ad._reversed:!ad._reversed)}else{if(S._frame_type=="0xN"){aj=(ad._reversed)?"asc":"desc"}else{aj=(ad._reversed)?"desc":"asc"}}}else{if(m.isQuantitative(ao)&&!m.isQuantitative(an)){a=an;if(m.isDateType(an)){aj=S._frame_type=="0xN"?((ad._reversed!=ae._reversed)?"asc":"desc"):((ad._reversed!=ae._reversed)?"desc":"asc")}else{L=y.getOrderedItems(a,C,null,null,S._frame_type=="Nx0"?(ad._reversed!=ae._reversed):(ad._reversed==ae._reversed));if(y.countVariables(graphica.HUE)){an=y.firstVariable(graphica.HUE);w=y.getOrderedItems(an,graphica.HUE,null,null,ae._reversed)}}}}}if((!m.isQuantitative(ao)&&!m.isQuantitative(an))||w!==null){for(var E=0;E<L.length;E++){var Y=m.rows(a,L[E]);if(aj!==null){Y.eachRowOrdered(function(d,c){s.drawSankey(d,c,ae,ad,Y,ap)},an,null,aj)}else{Y.eachRowOrdered(function(d,c){s.drawSankey(d,c,ae,ad,Y,ap)},an,[w])}}}else{if(aj!==null){m.eachRowOrdered(function(d,c){s.drawSankey(d,c,ae,ad,m,ap)},a,null,aj)}else{m.eachRowOrdered(function(d,c){s.drawSankey(d,c,ae,ad,m,ap)},a,[L])}}}}this.grgroup.addTo(this.elementsgr)}else{if(y.countVariables(graphica.HUE)>0&&y.isSet(y.firstVariable(graphica.HUE),graphica.POS_X)==false&&y.isSet(y.firstVariable(graphica.HUE),graphica.POS_Y)==false){T.push(y.firstVariable(graphica.HUE));af.push(y.getOrderedItems(y.firstVariable(graphica.HUE),graphica.HUE))}if(y.countVariables(graphica.SHAPE)>0&&y.isSet(y.firstVariable(graphica.SHAPE),graphica.POS_X)==false&&y.isSet(y.firstVariable(graphica.SHAPE),graphica.POS_Y)==false){T.push(y.firstVariable(graphica.SHAPE));af.push(y.getOrderedItems(y.firstVariable(graphica.SHAPE),graphica.SHAPE))}if(y.countVariables(graphica.SUBDIVISION)>0&&y.isSet(y.firstVariable(graphica.SUBDIVISION),graphica.POS_X)==false&&y.isSet(y.firstVariable(graphica.SUBDIVISION),graphica.POS_Y)==false){T.push(y.firstVariable(graphica.SUBDIVISION));af.push(y.getOrderedItems(y.firstVariable(graphica.SUBDIVISION),graphica.SUBDIVISION))}if(typeof y.unitconnectionVariable!=="undefined"){T.push(y.unitconnectionVariable)}if(y.countVariables(graphica.SMALL_MULTIPLES)>0&&y.isSet(y.firstVariable(graphica.SMALL_MULTIPLES),graphica.POS_X)==false&&y.isSet(y.firstVariable(graphica.SMALL_MULTIPLES),graphica.POS_Y)==false){T.push(y.firstVariable(graphica.SMALL_MULTIPLES));af.push(y.getOrderedItems(y.firstVariable(graphica.SMALL_MULTIPLES),graphica.SMALL_MULTIPLES))}if(y.countVariables(graphica.UNIT)>0&&y.isSet(y.firstVariable(graphica.UNIT),graphica.POS_X)==false&&y.isSet(y.firstVariable(graphica.UNIT),graphica.POS_Y)==false){T.push(y.firstVariable(graphica.UNIT));af.push(y.getOrderedItems(y.firstVariable(graphica.UNIT),graphica.UNIT))}var ar=0;this._dataset.eachRowOrdered(function(g,c,f){if(ar>100000){return false}var i=s.drawElement(c);var d=s._frame.getSubframe(g);if(i&&d){d._tmp_grgroup_to_do_bubble_layout=d._tmp_grgroup_to_do_bubble_layout||new GrapeGroup();if(i._are_multiple_elements){i.getChildren().each(function(){if(i._form_data&&i._form_data.form()<=9){d._tmp_grgroup_to_do_bubble_layout.push(this)}s.grgroup.push(this);if(s.hasAnnotation(this)){s.grAnnotations.addChild(s.getAnnotationGrape(this))}if(s._properties.convex_hull){f=f||"all";s.grgroupByCategory[f]=s.grgroupByCategory[f]||[];s.grgroupByCategory[f].push(this)}})}else{s.grgroup.push(i);if(s.hasAnnotation(i)){s.grAnnotations.addChild(s.getAnnotationGrape(i))}if(i._form_data&&i._form_data.form()<=9){d._tmp_grgroup_to_do_bubble_layout.push(i)}if(s._properties.convex_hull){f=f||"all";s.grgroupByCategory[f]=s.grgroupByCategory[f]||[];s.grgroupByCategory[f].push(i)}}}ar++},T,af);if(this.isBackgroundElements==false&&y.distribution_plot_in_front==false&&(y.density_map||y.box_plot||y.convex_hull)){this.grDensityMap.addTo(this.backElements);if(y.distribution_plot_opacity!=1){this.grDensityMap.opacity(y.distribution_plot_opacity)}}if(y.reference_lines!="none"&&this.isBackgroundElements==false){this.grReferenceLines.addTo(this.backElements)}this.grgroup.addTo(this.elementsgr);if(this.isBackgroundElements==false&&y.distribution_plot_in_front==true&&(y.density_map||y.box_plot||y.convex_hull)){this.grDensityMap.addTo(this.backElements);this.backElements.toFront();if(y.distribution_plot_opacity!=1){this.grDensityMap.opacity(y.distribution_plot_opacity)}}}}}}if(this._frame.graphObj&&this._frame._frame_type!="multiple"&&this._frame._frame_type!="1Cx0"&&this._frame._frame_type!="0x1C"&&this._frame._frame_type!="1Cx1C"){this.preDrawGraphLinks(this._frame)}else{if((this._frame._frame_type=="multiple"||this._frame._frame_type!="1Cx0"||this._frame._frame_type!="0x1C"||this._frame._frame_type!="1Cx1C")&&this._frame._sub_frames.length&&this._frame._sub_frames[0].graphObj){for(var N=0;N<this._frame._sub_frames.length;N++){this.preDrawGraphLinks(this._frame._sub_frames[N])}}}if(this.connectionReferences){var W;var e=new Grape();var k=new Grape();var al=0;for(qval in this.connectionReferences){for(grpval in this.connectionReferences[qval]){for(W in this.connectionReferences[qval][grpval]){var Q;if(this.mark==graphica.LINE){Q=this.getLineConnectionGrape(this.connectionReferences[qval][grpval][W],al);e.addChild(Q.gr);this.grgroup.push(Q.gr);this.filterWrapper(Q.gr,W,this.connectionReferences[qval][grpval][W].____last_row);this.grAnnotations.addChild(Q.annotations);if(Q.repulsion.length){this.repulsion_points=this.repulsion_points.concat(Q.repulsion)}}else{if(this.mark==graphica.AREALINE&&!this._dataset.isQuantitative(this._properties.connectionVariable)){Q=this.getAreaConnectionGrape(this.connectionReferences[qval][grpval][W]);k.addChild(Q);this.grgroup.push(Q);this.filterWrapper(Q,W,this.connectionReferences[qval][grpval][W].____last_row);if(this._properties.oneLine_oneLabel&&typeof this.connectionReferences[grpval]!=="undefined"){this.addLabel(Q,this.connectionReferences[grpval][qval][W].____last_index_row,"left")}}}}}al++}if(this.mark==graphica.LINE){e.addTo(this.elementsgr)}else{if(this.mark==graphica.AREALINE){k.addTo(this.elementsgr).toBack()}}}if(this.labelsgroup.length>0){this.labelsgr.addClass("forceredrawelementnonanimated");this.labelsgr._pre_force_redraw=function(){s.labelsgr.opacity(0)};this.labelsgr._force_redraw=function(){s.labelsgr.opacity(1);s.labelsgroup.automatic_placement(s.gr.scale());s.labelsgroup.check_overlapping()};this.labelsgroup.addTo(this.labelsgr);this.labelsgr.addTo(this.gr)}if(!this.isBackgroundElements&&(this._frame.zoomable&&(this._frame._map||this._properties._is_graph_layout))||(this._frame.zoomable==false&&this._frame._map&&this._frame.zoom_auto_focus)){this.gr.zoomable(this._frame._dataspace.x,this._frame._dataspace.y,this._frame._dataspace.width,this._frame._dataspace.height,14,this._frame.zoomable===true);this.gr.endZoom=function(){if(s._properties._layout=="map+avoid overlapping"&&(s._frame._frame_type=="map"||s._frame._frame_type=="mapXY")&&(s.mark==graphica.NONE_SHAPE||s.mark==graphica.DISK||s.mark==graphica.FILLED_DISK||s.mark==graphica.FILLED_BOX)){s.grgroup.each(function(){this.x(this.originx_longitude).y(this.originy_latitude)});s._frame.doBubbleLayout(s._frame._frame_type,(s.mark===graphica.NONE_SHAPE),(s._properties.countVariables(graphica.AREA)>0),s.gr.scale());s.paintEdges(s._frame)}s.redrawDistributionPlot()}}var aq;if(this._frame._sub_frames.length){aq=this._frame._sub_frames}else{aq=[this._frame]}if(this._properties._layout!="noLayout"&&this._properties._layout!="default"&&this._properties._layout!="map"&&(this.mark==graphica.NONE_SHAPE||this.mark==graphica.DISK||this.mark==graphica.FILLED_DISK||this.mark==graphica.FILLED_BOX)){var aG;var h=false;var at=false;var ak="TB";var aE;if((this._properties._is_graph_layout||this._properties._layout=="circular")&&this._dataset.edges){if(aq[0].graphObj&&this._properties._graph_positions){aG="onlyFitIntoView"}else{aG="forceLayout";if(this._properties._layout){if(this._properties._layout=="kamada_kawai"){aG="kamadaLayout"}else{if(this._properties._layout=="lin_log"){aG="LinLogLayout"}else{if((this._properties._layout=="dagre"||this._properties._layout=="dagreLR")){aG="dagreLayout";if(this._properties._layout=="dagreLR"){ak="LR"}}else{if(this._properties._layout=="circular"){aG="circularLayout"}}}}if(this._properties._layout=="force_distance_directed"){h=true}}}if(this._properties._layout=="dagreLR"||this._properties._layout=="dagre"){at=true}}var U=[];var r=[];for(var O=0;O<aq.length;O++){var S=aq[O];if(S._frame_type!="0x0"&&S._frame_type!="1x0"&&S._frame_type!="0x1"&&this._properties._layout!="avoid overlapping"&&this._properties._layout!="map+avoid overlapping"){s.paintEdges(S);s.redrawDistributionPlot();s.labelsgroup.automatic_placement(s.gr.scale());continue}aE=S._frame_type;if((aE=="1x0"||aE=="0x1")&&S.graphObj){S.graphObj.eachNode(function(){if(this.elm){if(S._frame_type=="1x0"){this._layoutPosX=this.elm.x()-S._dataspace.x}else{this._layoutPosY=this.elm.y()-S._dataspace.y}}})}if(this._dataset.edges&&this.isBackgroundElements==false&&this._properties.view.static_view==false&&this._properties._is_graph_layout&&typeof window.graphicawebworker!=="undefined"&&["onlyFitIntoView","avoid overlapping","map+avoid overlapping","circular"].includes(aG)==false){if(O==0){U[O]=new graphicawebworker();r[O]=new workerBlockScreen(U[O]);U[O].onmessage=function(g){var i=g.data.webworkerid;if(U[i]){U[i].terminate()}let M=0;var f={};for(M=0;M<g.data.nodes.length;M++){var c=aq[i].graphObj.getNode(g.data.nodes[M].id);if(c&&c.elm){c._layoutPosX=g.data.nodes[M].x;c._layoutPosY=g.data.nodes[M].y;f[c.id]={x:c._layoutPosX,y:c._layoutPosY};if(aE=="0x0"||aE=="0x1"){c.elm.x(aq[i]._dataspace.x+g.data.nodes[M].x)}if(aE=="0x0"||aE=="1x0"){c.elm.y(aq[i]._dataspace.y+g.data.nodes[M].y)}if(c.elm._annotation_grape){c.elm._annotation_grape._update_position()}if(c.elm._reflabel){c.elm._reflabel.x(c.elm.x());c.elm._reflabel.y(c.elm.y());c.elm._reflabel._tmpbbox=c.elm._reflabel._tmpbbox||c.elm._reflabel.getBBox()}}}if(typeof s._properties.view._viewpanel!=="undefined"){s._properties.view._viewpanel.updateGraphPositions(f)}s.paintEdges(aq[i]);s.redrawDistributionPlot();s.labelsgroup.automatic_placement(s.gr.scale());s.labelsgroup.check_overlapping();if(aE=="1x0"||aE=="0x1"){aq[i].graphObj._last_graph_layout=null}else{aq[i].graphObj._last_graph_layout=s._properties._layout}if(r[i]){r[i].end()}if(aq.length>i+1){U[i+1]=new graphicawebworker();r[i+1]=new workerBlockScreen(U[i+1]);U[i+1].onmessage=U[i].onmessage;delete U[i];var d=aq[i+1].graphObj.getJSON();U[i+1].postMessage({params:{webworkerid:i+1,layout:aG,width:aq[i+1]._dataspace.width,height:aq[i+1]._dataspace.height,calculate_distances:h,direction:ak,full_fit:at,fixed_axis:aE},nodes:d.nodes,edges:d.edges})}};var o=aq[O].graphObj.getJSON();U[O].postMessage({params:{webworkerid:O,layout:aG,width:aq[O]._dataspace.width,height:aq[O]._dataspace.height,calculate_distances:h,direction:ak,full_fit:at,fixed_axis:aE},nodes:o.nodes,edges:o.edges})}}else{if((this._properties._is_graph_layout||aG=="circularLayout")&&this._dataset.edges){S.graphObj.doLayout({layout:aG,width:S._dataspace.width,height:S._dataspace.height,calculate_distances:h,direction:ak,full_fit:at,fixed_axis:aE,orderedVariable:T.concat(),orderedVariableItems:af.concat()},function(){S.graphObj.eachNode(function(){if(this.elm){if(aE=="0x0"||aE=="0x1"){this.elm.x(S._dataspace.x+this._layoutPosX)}if(aE=="0x0"||aE=="1x0"){this.elm.y(S._dataspace.y+this._layoutPosY)}if(this.elm._annotation_grape){this.elm._annotation_grape._update_position()}if(this.elm._reflabel){this.elm._reflabel.x(this.elm.x());this.elm._reflabel.y(this.elm.y());this.elm._reflabel._tmpbbox=this.elm._reflabel._tmpbbox||this.elm._reflabel.getBBox()}}});s.paintEdges(S);s.redrawDistributionPlot();s.labelsgroup.automatic_placement(s.gr.scale())})}else{if(this._properties._layout=="avoid overlapping"||this._properties._layout=="map+avoid overlapping"){var v=S._frame_type;if(v=="1x1"){if(S.axis_x._is_date_type&&S.axis_y._is_variable_quantitative){v="1Cx1"}else{if(S.axis_x._is_variable_quantitative&&S.axis_y._is_date_type){v="1x1C"}}}else{if(v=="1x2"){if((S.axis_x._is_date_type||S.axis_x._is_variable_categorical)&&((S.axis_y2._is_date_type||S.axis_y2._is_variable_categorical))){v="1Cx2C"}else{if(S.axis_x._is_date_type||S.axis_x._is_variable_categorical){v="1Cx2"}else{if(S.axis_y2._is_date_type||S.axis_y2._is_variable_categorical){v="1x2C"}}}}else{if(v=="2x1"){if((S.axis_x2._is_date_type||S.axis_x2._is_variable_categorical)&&((S.axis_y._is_date_type||S.axis_y._is_variable_categorical))){v="2Cx1C"}else{if(S.axis_x2._is_date_type||S.axis_x2._is_variable_categorical){v="2Cx1"}else{if(S.axis_y._is_date_type||S.axis_y._is_variable_categorical){v="2x1C"}}}}else{if(v=="2x2"){if((S.axis_x2._is_date_type||S.axis_x2._is_variable_categorical)&&((S.axis_y2._is_date_type||S.axis_y2._is_variable_categorical))){v="2Cx2C"}else{if(S.axis_x2._is_date_type||S.axis_x2._is_variable_categorical){v="2Cx2"}else{if(S.axis_y2._is_date_type||S.axis_y2._is_variable_categorical){v="2x2C"}}}}}}}var ac=["0x0","1x0","0x1","1Cx1","1x1C","1Cx1C","1CxN","2CxN","Nx1C","Nx2C","1Cx2","2x1C","1x2C","2Cx1","1Cx2C","2Cx1C","2Cx2C","2x2C","2Cx2","map","mapXY"];if(ac.includes(v)&&(this.mark==graphica.NONE_SHAPE||this.mark==graphica.DISK||this.mark==graphica.FILLED_DISK||this.mark==graphica.FILLED_BOX)){S.doBubbleLayout(v,(this.mark===graphica.NONE_SHAPE),(this._properties.countVariables(graphica.AREA)>0))}this.paintEdges(S);this.redrawDistributionPlot();this.redrawReferenceLines();this.labelsgroup.automatic_placement(this.gr.scale())}}}}}else{if(this._properties._layout=="noLayout"){for(var F=0;F<aq.length;F++){var S=aq[F];if(S.graphObj){S.graphObj.eachNode(function(){if(this.elm){this.elm.x(this._layoutPosX+S._dataspace.x);this.elm.y(this._layoutPosY+S._dataspace.y)}})}}}this.paintEdges();var au=performance.now();var B=this.grAnnotations.getChildren();for(var ai=0;ai<B.length;ai++){this.repulsion_points.push({x:B.item(ai).x(),y:B.item(ai).y()})}this.labelsgroup.automatic_placement(this.gr.scale(),this.repulsion_points);if(this.isBackgroundElements==false){this.redrawDistributionPlot();this.redrawReferenceLines()}}if(this.grclips.length){this.grclips.addTo(this.elementsgr)}this.grAnnotations.getChildren().each(function(){this._update_position()});this.grAnnotations.toFront()};graphica.Elements.fn.filterWrapper=function(d,a,c,b){if(!this.isBackgroundElements){this._properties.view.filterWrapper(d,a,c,b)}};graphica.Elements.fn.getTooltip=function(b,a,c){if(this.isBackgroundElements){return""}else{return this._properties.getTooltip(b,a,c)}};graphica.Elements.fn.getColor=function(b,a){if(this.isBackgroundElements){return this._backgroundSettings.color}else{return this._properties.getColor(b,a,this.anchor_axis_variable)}};graphica.Elements.fn.getIntensity=function(b,a){if(this.isBackgroundElements){return this._backgroundSettings.opacity}else{return this._properties.getIntensity(b,a,this.anchor_axis_variable)}};graphica.Elements.fn.getCustomColor=function(a){if(this.isBackgroundElements){return""}else{return this._properties.view.getCustomColor(a,this.anchor_axis_variable)}};graphica.Elements.fn.getArea=function(b,a){return this._properties.getArea(b,a,this.anchor_axis_variable)};graphica.Elements.fn.getBarWidth=function(){if(this._frame._frame_type=="1x1"&&(this._frame.is_axis_x_interval||this._frame.is_axis_y_interval)){return 1}if(typeof this.anchor_axis_variable!=="undefined"&&this.anchor_axis_variable!==null&&typeof this._properties.use_custom_bar_width[this.anchor_axis_variable]!=="undefined"){if(typeof this._properties.custom_bar_widths[this.anchor_axis_variable]!=="undefined"){return this._properties.custom_bar_widths[this.anchor_axis_variable]}return 0.666}return this._properties.bar_width};graphica.Elements.fn.getColorByValue=function(b,a){if(this.isBackgroundElements){return this._backgroundSettings.color}else{return this._properties.getColorByValue(b,a)}};graphica.Elements.fn.getIntensityByValue=function(a){if(this.isBackgroundElements){return this._backgroundSettings.opacity}else{return this._properties.getIntensityByValue(a)}};graphica.Elements.fn.redrawReferenceLines=function(){if(this._properties.reference_lines=="none"){return}graphica.Utils.getReferenceLine(this.anchor_axis_variable,this._frame).addTo(this.grReferenceLines)};graphica.Elements.fn.redrawDistributionPlot=function(){var a=this._properties;if(this.mark==graphica.NONE_SHAPE||this.mark==graphica.DISK||this.mark==graphica.FILLED_DISK){this.grDensityMap.clear();var b=null;if(a.density_map){b=graphica.Utils.getDensityMap(this.grgroup,this._frame._dataspace,this.gr.scale())}else{if(a.box_plot){b=graphica.Utils.getBoxPlots(this._frame,this._dataset,this.anchor_axis_variable)}else{if(a.convex_hull){b=graphica.Utils.getConvexHull(this)}}}if(b){b.addTo(this.grDensityMap)}}};graphica.Elements.fn.paintEdges=function(e){var g=this;if(typeof e==="undefined"){e=this._frame}if(e._show_edges&&e.graphObj&&this.mark!=graphica.LINE&&this.mark!=graphica.AREALINE){var b;if(e._frame_type=="multiple"){b=e._sub_frames}else{b=[e]}for(var d=0;d<b.length;d++){var c=b[d];var a=0;if(this._properties.vpedges.edge_form==graphica.EDGE_BUNDLING){c.graphObj.eachEdgeOrderedByDensity(function(){if(a>g._properties.vpedges.max_edges_displayed){this._it_is_displayed=false}else{this._it_is_displayed=true}a++});c.graphObj.EdgePathBundling(this._properties.vpedges.edge_bundling_on);c.graphObj.eachEdge(function(){if(this.redrawaslink){this.redrawaslink()}})}else{c.graphObj.eachEdgeOrderedByDensity(function(){if(this.redrawaslink){if(a>g._properties.vpedges.max_edges_displayed){this._it_is_displayed=false}else{this._it_is_displayed=true;this.redrawaslink()}a++}})}}}};graphica.Elements.fn.drawElement=function(n){var c=this;var p=this._frame.getPoints(n,this.anchor_axis_variable);var u=this._dataset.row(n);if(p.x===null||p.y===null){if(this._dataset.edges&&this._frame.graphObj){z=this._frame.graphObj.getNode(u);if(z){z.elm=null}}return false}var s=this._properties;var X;var a=null;var A;var J;var U;if(p.x.length||p.y.length){if(p.x.length&&p.y.length){X=new Grape();X._row=u;X._criteriaRow=this._dataset.getCategoricalRowObject(u);X._highlight_id=this.getHighlightID(n);X._highlight_ids=[X._highlight_id];var q=this.getArea(n);q=raceme.map(q,1,9000,0,63);q=raceme._round(q,1);var m=this.getCustomColor(X._criteriaRow)||this.getColor(n);var S=this.getIntensity(n);J=this.getTooltip(n);if(this.mark==graphica.LINE){X.lineStyle(q,m,S).beginFill("none");if(s.default_border_width){a=new Grape();a.enableEvents(false);a.lineStyle(q+s.default_border_width*2,s.default_border_color,s.default_border_intensity,"butt","round");a.beginFill("none");a.beginPath();a.addTo(X)}X.beginPath();var h=new GrapeGroup();var I;var C;var e=[];var k=null;for(U=0;U<p.x.length;U++){I=((p.x[U]===null||p.y[U]===null)?true:false);C=((U==0||p.x[U-1]===null||p.y[U-1]===null)?true:false);var y,B;var F=0;var H=0;var x=0;var K=0;var y,B;var Q=graphica.NONE_SHAPE;var l=null;var T=false;var b=s.marks_included;var j;var R;var d=[];if(this._frame.naxis_x.length){j=this._frame.naxis_x[U]._variable;R=s.getSettings(j,graphica.POS_X,"aggregation");for(var W=0;W<p.x.length;W++){if(W!=U){d.push(this._frame.naxis_x[W]._variable)}}}else{if(this._frame.naxis_y.length){j=this._frame.naxis_y[U]._variable;R=s.getSettings(j,graphica.POS_Y,"aggregation");for(var W=0;W<p.y.length;W++){if(W!=U){d.push(this._frame.naxis_y[W]._variable)}}}}if(b=="all"||(U==0&&(b=="first"||b=="first and last"))||(U==p.x.length-1&&(b=="last"||b=="first and last"))||((b=="min"||b=="min and max")&&this._dataset.getValue(n,j,R)==this._dataset.min(j,R))||((b=="max"||b=="min and max")&&this._dataset.getValue(n,j,R)==this._dataset.max(j,R))){T=true}if(C&&!I){if(s.start_marks!="none"&&T){if(s.start_marks=="filled disk"||s.start_marks=="arrow filled disk"){Q=graphica.FILLED_DISK}else{if(s.start_marks=="disk"||s.start_marks=="arrow disk"){Q=graphica.DISK}}l=s.getFormGrape(Q,this.getArea(n),this.getColor(n),this.getIntensity(n),this.getCustomColor(X._criteriaRow)).x(p.x[U]).y(p.y[U])}X.moveTo(p.x[U],p.y[U]);if(a){a.moveTo(p.x[U],p.y[U])}}else{if(!C&&!I){if(k&&k._form_data.form()!=graphica.NONE_SHAPE){x+=k._form_data.radius()}if(s.end_marks!="none"&&T){if(s.end_marks=="filled disk"||s.end_marks=="arrow filled disk"){Q=graphica.FILLED_DISK}else{if(s.end_marks=="disk"||s.end_marks=="arrow disk"){Q=graphica.DISK}}l=s.getFormGrape(Q,this.getArea(n),this.getColor(n),this.getIntensity(n),this.getCustomColor(X._criteriaRow)).x(p.x[U]).y(p.y[U]);K+=l._form_data.radius()}if(s.line_type!="orthogonal"&&s.line_type!="curve"){if(s.end_marks=="arrow"||s.end_marks=="arrow disk"||s.end_marks=="arrow filled disk"){H=Math.max(q*5,7);end_arrow_angle=raceme.rect2polar(p.x[U]-p.x[U-1],p.y[U]-p.y[U-1]).angle;B=graphica.Utils.getArrowhead(H,end_arrow_angle,m,S);K+=H;h.push(B)}if(s.start_marks=="arrow"||s.start_marks=="arrow disk"||s.start_marks=="arrow filled disk"){F=Math.max(q*5,7);start_arrow_angle=raceme.rect2polar(p.x[U-1]-p.x[U],p.y[U-1]-p.y[U]).angle;y=graphica.Utils.getArrowhead(F,start_arrow_angle,m,S);x+=F;h.push(y)}}if(s.line_type!="curve"){var L=null;if(x>0||K>0){L=graphica.Utils.lineBetween2Circles(p.x[U-1],p.y[U-1],x,p.x[U],p.y[U],K)}if(L){if(L.x1!=p.x[U-1]&&L.y1!=p.y[U-1]){X.moveTo(L.x1,L.y1);if(a){a.moveTo(L.x1,L.y1)}}X.lineTo(L.x2,L.y2);if(a){a.lineTo(L.x2,L.y2)}if(y){y.x(L.x1).y(L.y1)}if(B){B.x(L.x2).y(L.y2)}X.moveTo(p.x[U],p.y[U]);if(a){a.moveTo(p.x[U],p.y[U])}}else{X.lineTo(p.x[U],p.y[U]);if(a){a.lineTo(p.x[U],p.y[U])}}}}}if(!l){l=s.getFormGrape(graphica.NONE_SHAPE,this.getArea(n),this.getColor(n),this.getIntensity(n),this.getCustomColor(X._criteriaRow)).x(p.x[U]).y(p.y[U])}l._row=u;l._criteriaRow=X._criteriaRow;l._disableAnnotationMenu=true;s.view.classify(l,"element");if(J!=""){l.addChild(new Grape("title").textContent(J))}if(s.line_type=="curve"){if(I&&!C){if(e.length){X.moveTo(e[0].x,e[0].y);X.splineCurve(e)}e=[]}else{if(U==p.x.length-1&&!I){e.push({x:p.x[U],y:p.y[U]});X.moveTo(e[0].x,e[0].y);X.splineCurve(e);if(a){a.moveTo(e[0].x,e[0].y);a.splineCurve(e)}}else{if(!I){e.push({x:p.x[U],y:p.y[U]})}}}}if(l){l._highlight_id=X._highlight_id;l._highlight_ids=[X._highlight_id];h.push(l)}var t=s.marks_to_label;if(t=="auto"||t=="all"||(U==0&&(t=="first"||t=="first and last"))||(U==p.x.length-1&&(t=="last"||t=="first and last"))||((t=="min"||t=="min and max")&&this._dataset.getValue(n,j,R)==this._dataset.min(j,R))||((t=="max"||t=="min and max")&&this._dataset.getValue(n,j,R)==this._dataset.max(j,R))){if(this._frame.naxis_y.length){if(U==0){this.addLabel(l,n,"right",null,d)}else{if(U==p.x.length-1){this.addLabel(l,n,"left",null,d)}else{this.addLabel(l,n,"center",null,d)}}}else{this.addLabel(l,n,"center",null,d)}}k=l}X.endPath();if(a){a.endPath();a=null}if(s.start_marks=="none"&&s.end_marks=="none"&&J!=""){X._mouseposition=true;X.addChild(new Grape("title").textContent(J))}h.addTo(X)}else{X._is_multiple_element=true;for(U=0;U<p.x.length;U++){I=((p.x[U]===null||p.y[U]===null)?true:false);if(!I){var d=[];if(this._frame.naxis_x.length){d=this._frame.all_n_variables.filter(function(f){return f!==c._frame.naxis_x[U]._variable})}else{d=this._frame.all_n_variables.filter(function(f){return f!==c._frame.naxis_y[U]._variable})}A=s.getFormGrape(s.getForm(u,this.anchor_axis_variable),this.getArea(n),this.getColor(n),this.getIntensity(n),this.getCustomColor(X._criteriaRow)).x(p.x[U]).y(p.y[U]);A.addTo(X);A._row=u;A._criteriaRow=this._dataset.getCategoricalRowObject(u);A._annotation_config=s.view.getAnnotationConfig(A._criteriaRow,this.anchor_axis_variable);s.view.classify(A,"element");if(this.hasAnnotation(A)){this.grAnnotations.addChild(this.getAnnotationGrape(A))}this.addLabel(A,n,"center",null,d);if(J!=""){A.addChild(new Grape("title").textContent(J))}}}}X._limits=p;if(s.countVariables(graphica.UNIT)==1){this.filterWrapper(X,s.firstVariable(graphica.UNIT),u)}else{this.filterWrapper(X,null,u)}return X}else{if(this.mark==graphica.BAR||this.mark==graphica.AREALINE){X=new Grape();X._row=u;X._criteriaRow=this._dataset.getCategoricalRowObject(u);var V=!(p.y.length);var D=this.getColor(n);var v=this.getCustomColor(X._criteriaRow);if(v){D=v;X._custom_color=v}var S=this.getIntensity(n);var N=s.default_border_width;if(this.mark==graphica.AREALINE){S=0.0001;N=0}var P=s.default_border_color||D;X.lineStyle(N,P,s.default_border_intensity).beginFill(D,S);var o=this.getBarWidth();X._form_data=new graphica.FormData();if(V){var M;var E=false;if(p.x[1]<p.x[0]){E=true;M=p.x[0]-p.x[1];X.x(p.x[0]-M/2).y(p.y);if(this.mark==graphica.BAR){X.rect(-M/2,-p.height*(o/2),M,Math.ceil(p.height*o))}else{X.rect(-M/2,-(p.height/2),M,Math.ceil(p.height));X._form_data.x(p.x[1]);X._form_data.y(p.y);X._form_data.width(p.x[0]-p.x[1]);X.attr("data-center-x",p.x[1]).attr("data-center-y",p.y)}}else{M=p.x[1]-p.x[0];X.x(p.x[0]+M/2).y(p.y);if(this.mark==graphica.BAR){X.rect(-M/2,-p.height*(o/2),M,Math.ceil(p.height*o))}else{X.rect(-M/2,-(p.height/2),M,Math.ceil(p.height));X._form_data.x(p.x[0]);X._form_data.y(p.y);X._form_data.width(p.x[1]-p.x[0]);X.attr("data-center-x",p.x[1]).attr("data-center-y",p.y)}}X._form_data.form(this.mark).orientation("horizontal").width(M).height(p.height*o).color(D).reversed(E)}else{var r;var E=false;if(p.y[0]<p.y[1]){E=true;r=p.y[1]-p.y[0];X.x(p.x).y(p.y[1]-(r/2));if(this.mark==graphica.BAR){X.rect(-p.width*(o/2),-r/2,Math.ceil(p.width*o),r)}else{X.rect(-(p.width/2),-r/2,Math.ceil(p.width),r);X._form_data.x(p.x);X._form_data.y(p.y[1]);X._form_data.height(p.y[1]-p.y[0])}}else{r=p.y[0]-p.y[1];X.x(p.x).y(p.y[1]+(r/2));if(this.mark==graphica.BAR){X.rect(-p.width*(o/2),-r/2,Math.ceil(p.width*o),r)}else{X.rect(-(p.width/2),-r/2,Math.ceil(p.width),r);X._form_data.x(p.x);X._form_data.y(p.y[0]);X._form_data.height(p.y[0]-p.y[1])}}X._form_data.form(this.mark).orientation("vertical").width(p.width*o).height(r).color(D).reversed(E)}J=this.getTooltip(n);if(J!=""){X.addChild(new Grape("title").textContent(J))}}}}else{if(this.mark!=graphica.LINE){if(this.mark==graphica.FILLED_RECTANGLE){X=new Grape().beginFill(this.getColor(n),this.getIntensity(n)).lineStyle(s.default_border_width,P,s.default_border_intensity);X._row=u;X._criteriaRow=this._dataset.getCategoricalRowObject(u);X.rect(-p.width/2+s.default_border_width/2,-p.height/2+s.default_border_width/2,Math.max(0,p.width-s.default_border_width),Math.max(0,p.height-s.default_border_width));X.x(p.x).y(p.y);X._form_data=new graphica.FormData();X._form_data.form(graphica.FILLED_RECTANGLE).width(p.width).height(p.height).color(this.getColor(n));X._is_filled_rectangle=true;J=this.getTooltip(n);if(J!=""){X.addChild(new Grape("title").textContent(J))}}else{var G=this.getArea(n);let criteriaRow=this._dataset.getCategoricalRowObject(u);X=s.getFormGrape(s.getForm(u,this.anchor_axis_variable),G,this.getColor(n),this.getIntensity(n),this.getCustomColor(criteriaRow)).x(p.x).y(p.y);X._row=u;X._criteriaRow=criteriaRow;X.area_size=G;J=this.getTooltip(n);if(J!=""){X.addChild(new Grape("title").textContent(J))}if(this._frame.zoomable||(this._frame._map&&this._frame.zoom_auto_focus)){X.addClass("nonscalable");this.updateZoomAutoFocusBox(X)}}}}if(X){X._highlight_id=this.getHighlightID(n);X._highlight_ids=[X._highlight_id];if(this.anchor_axis_variable){X._anchor_variable=this.anchor_axis_variable}}if(s.countVariables(graphica.UNIT)==1){var w=s.firstVariable(graphica.UNIT);var O=u;this.filterWrapper(X,w,O)}else{this.filterWrapper(X,null,u)}if(X){if(typeof p.latitude!=="undefined"){X.latitude=p.latitude;X.longitude=p.longitude;X.originx_longitude=p.x;X.originy_latitude=p.y}this.addLink(X,n);s.view.classify(X,"element");X._annotation_config=s.view.getAnnotationConfig(X._criteriaRow,this.anchor_axis_variable);if(this._dataset.edges&&this._frame.graphObj&&this._frame._frame_type!="multiple"&&this._frame._frame_type!="1Cx0"&&this._frame._frame_type!="0x1C"&&this._frame._frame_type!="1Cx1C"){var z=this._frame.graphObj.getNode(u);if(z){X.graphNode=z;if(typeof X.graphNode._layoutPosX=="undefined"){X.graphNode._layoutPosX=X.x()-this._frame._dataspace.x;X.graphNode._layoutPosY=X.y()-this._frame._dataspace.y}z.elm=X}if(this._properties._is_graph_layout&&this._frame._frame_type=="0x0"){this.makedraggable(X)}}else{if((this._frame._frame_type=="multiple"||this._frame._frame_type=="1Cx0"||this._frame._frame_type=="0x1C"||this._frame._frame_type=="1Cx1C")&&this._frame._sub_frames.length&&this._frame._sub_frames[0].graphObj){for(var Y=0;Y<this._frame._sub_frames.length;Y++){var z=this._frame._sub_frames[Y].graphObj.getNode(u);if(z){X.graphNode=z;z.elm=X}}if(this._frame._sub_frames[0]._is_graph_layout&&this._frame._sub_frames[0]._frame_type=="0x0"){this.makedraggable(X)}}}}if(typeof this._properties.connectionVariable!=="undefined"){this.addConnection(X,n,this.anchor_axis_variable)}if(!this._properties.oneLine_oneLabel&&this.mark!=graphica.LINE){var d=[];if(this._frame.naxis_x.length){d=this._frame.all_n_variables.filter(function(f){return f!==c.anchor_axis_variable})}else{d=this._frame.all_n_variables.filter(function(f){return f!==c.anchor_axis_variable})}this.addLabel(X,n,s.label_align,null,d)}if(X){X._limits=p}return X};graphica.Elements.fn.preDrawGraphLinks=function(a){var b=this;if(a.graphObj){if(a._show_edges){a.graphObj.eachEdge(function(){var c=new Grape();c.enableEvents(false);c.objEdge=this;this.graphEdge=c;this.redrawaslink=function(){if(this._it_is_displayed===false){return}var u=this.source_node.elm;var t=this.target_node.elm;if(!u||!t){return}var r=b._properties.vpedges;this.graphEdge.clear();var p=1/b.gr.scale();if(typeof u._form_data==="undefined"||typeof t._form_data==="undefined"){return}var E=0;var G=0;var A=null;var i=null;if(u._form_data.form()==graphica.FILLED_BOX){A=u._form_data.width()*p;i=t._form_data.width()*p}else{if(u._form_data.form()!=graphica.NONE_SHAPE){E=u._form_data.radius()*p;G=t._form_data.radius()*p}}var J,H,w,v;if(u._form_data.form()==graphica.GEO_SHAPE){J=u._form_data.x();H=u._form_data.y();w=t._form_data.x();v=t._form_data.y()}else{if(u._form_data.form()==graphica.FILLED_RECTANGLE){J=u.x()+u._form_data.width()/2;H=u.y()+u._form_data.height()/2;w=t.x()+t._form_data.width()/2;v=t.y()+t._form_data.height()/2}else{J=u.x();H=u.y();w=t.x();v=t.y()}}var e;var M,B;var d,z,h,C;var F;if(r.edges_colored_as_marks&&(!r.edges_colored_as_marks_only_between_same_color_marks||u._form_data.color()==t._form_data.color())){F=u._form_data.color()}else{if(b.isBackgroundElements){F=b._backgroundSettings.color}else{F=r.getColorByValue()}}var O=r.getIntensityByValue(this.rows[0]);var j=r.getWidth(this.weight)*p;if(r.edge_form==graphica.EDGE_BUNDLING){graphica.Utils.drawEdge(this.graphEdge,graphica.EDGE_BUNDLING,this.controlpoints,1,F,j,O)}else{if(r.edge_form==graphica.EDGE_GREAT_CIRCLE&&typeof u.latitude!=="undefined"&&typeof t.latitude!=="undefined"&&!a._map._include_area){var s=new graphica.GreatCircle({x:u.longitude,y:u.latitude},{x:t.longitude,y:t.latitude});var x=s.arc();for(var N=0;N<x.length;N++){var f=[];for(var L=0;L<x[N].length;L++){var o=a._map.getPositionXY(x[N][L][1],x[N][L][0]);f.push({x:a._dataspace.x+o.x,y:a._dataspace.y+o.y})}graphica.Utils.drawEdge(this.graphEdge,graphica.EDGE_BUNDLING,f,1,F,j,O)}}else{if(r.edge_curvature<=0||r.edge_curvature>1||r.edge_form==graphica.EDGE_CURVED||r.edge_form==graphica.EDGE_CURVED_VERTICAL){if(r.edge_form==graphica.EDGE_CURVED){if(A){E=A/2;G=i/2}if(J<w){e={x1:J+E,x2:w-G,y1:H,y2:v}}else{e={x1:w+G,x2:J-E,y1:v,y2:H}}}else{if(r.edge_form==graphica.EDGE_CURVED_VERTICAL){if(A){E=A/2;G=i/2}if(H<v){e={x1:J,x2:w,y1:H+E,y2:v-G}}else{e={x1:w,x2:J,y1:v+G,y2:H-E}}}else{if(A!==null){e=graphica.Utils.lineBetween2Boxes(J,H,A,w,v,i)}else{e=graphica.Utils.lineBetween2Circles(J,H,E,w,v,G)}}}graphica.Utils.drawEdge(this.graphEdge,r.edge_form,[{x:e.x1,y:e.y1},{x:e.x2,y:e.y2}],0,F,j,O,p)}else{var I;var y;var q;var k=r.edge_curvature;if(b._properties.circular_layout){var K=a._dataspace;var m=graphica.Utils.clockwiseAngle(J-(K.x+K.width/2),H-(K.y+K.height/2),w-(K.x+K.width/2),v-(K.y+K.height/2));if(m>Math.PI&&r.edge_form==graphica.EDGE_LINE){var n=w;var l=v;w=J;v=H;J=n;H=l}k=r.edge_curvature*((Math.abs(Math.PI-m)/Math.PI))}if(A!==null){e=graphica.Utils.lineBetween2Boxes(J,H,A,w,v,i)}else{e={x1:J,y1:H,x2:w,y2:v}}if(k>0&&k<=1){I=graphica.Utils.getControlPointsofCurve(e.x1,e.y1,e.x2,e.y2,k);if(E){var D=raceme.rect2polar(e.x1-I.p1.x,e.y1-I.p1.y);var P=raceme.polar2rect(E,D.angle);e.x1-=P.x;e.y1-=P.y}if(G){var D=raceme.rect2polar(e.x2-I.p2.x,e.y2-I.p2.y);var P=raceme.polar2rect(G,D.angle);e.x2-=P.x;e.y2-=P.y}}graphica.Utils.drawEdge(this.graphEdge,r.edge_form,[{x:e.x1,y:e.y1},{x:e.x2,y:e.y2}],k,F,j,O,p)}}}};c.addClass("forceredrawelementnonanimated");c._is_graph_link=true;if(this.source_node.elm&&this.target_node.elm){if(b._properties.view.highlight_same_color_elements_on_hover==false){this.source_node.elm._highlight_ids.push(this.target_node.elm._highlight_id);this.target_node.elm._highlight_ids.push(this.source_node.elm._highlight_id)}if(b._properties.view.highlight_same_color_elements_on_hover==false){c._highlight_ids=[this.target_node.elm._highlight_id,this.source_node.elm._highlight_id]}else{if(this.target_node.elm._highlight_id==this.source_node.elm._highlight_id){c._highlight_ids=[this.target_node.elm._highlight_id]}}b.filterWrapper(c,null,[this.source_node.elm._row,this.target_node.elm._row]);c._force_redraw=function(){this.objEdge.redrawaslink()};b.linksgroup.push(c)}})}else{if(this.mark==graphica.NONE_SHAPE||this.mark==graphica.DISK||this.mark==graphica.FILLED_DISK){a.graphObj.eachEdge(function(){if(this.source_node.elm&&this.target_node.elm){this.source_node.elm._highlight_ids.push(this.target_node.elm._highlight_id);this.target_node.elm._highlight_ids.push(this.source_node.elm._highlight_id)}})}}if(this.linksgroup.length>0){this.linksgroup.addTo(this.linksgr)}}};graphica.Elements.fn.updateZoomAutoFocusBox=function(a){if(this._frame._map&&this._frame.zoom_auto_focus){var b=a._tmpbbox||a.getBBox();a._tmpbbox=b;if(b.width==0&&b.height==0){return}if(this._frame.zoom_auto_focus_box){this._frame.zoom_auto_focus_box.x=Math.min(this._frame.zoom_auto_focus_box.x,b.x);this._frame.zoom_auto_focus_box.y=Math.min(this._frame.zoom_auto_focus_box.y,b.y);this._frame.zoom_auto_focus_box.x2=Math.max(this._frame.zoom_auto_focus_box.x2,b.x+b.width);this._frame.zoom_auto_focus_box.y2=Math.max(this._frame.zoom_auto_focus_box.y2,b.y+b.height)}else{this._frame.zoom_auto_focus_box={x:b.x,y:b.y,x2:b.x+b.width,y2:b.y+b.height}}}};graphica.Elements.fn.addLink=function(d,c){var b=this;var a=b._properties.base_url+this._properties.getHref(c);if(a!=""){a=a.trim();d.fixedclic(function(f){if(f.button==0){if(window._electron_shell){if(!a.toLowerCase().startsWith("http://")&&!a.toLowerCase().startsWith("https://")){a="https://"+a}window._electron_shell.openExternal(a)}else{if(b._properties.default_link_target=="_blank"){window.open(a)}else{window.location.href=a}}}})}};graphica.Elements.fn.addLabel=function(f,h,e,g,c,b,j){if(this.isBackgroundElements||this.isForScreenshot){return false}var g=g||"middle";b=b||this._dataset;var i=b.row(h);var a=this._properties.getLabel(h,e,g,c,b,j);if(a){var d=0;if(f._form_data&&f._form_data.form()!=graphica.FILLED_RECTANGLE){if(e=="left"){d=(f._form_data.radius()+6)}else{if(e=="right"){d=-(f._form_data.radius()+6)}}}if((f._form_data&&f._form_data.form()==graphica.GEO_SHAPE)==false){a.x(f.x()+d);a.y(f.y())}a._row=i;f._reflabel=a;f._labelsgroup=this.labelsgroup;a._refelm=f;if(!this._properties.label_allow_overlapping){a._tmpbbox=a.getBBox()}this.labelsgroup.push(a);if(this._frame.zoomable){a.addClass("nonscalable")}if(this.mark==graphica.LINE||this.mark==graphica.NONE_SHAPE){a._highlight_id=f._highlight_id;a.enableEvents(true)}if(this._properties.view._is_view_op_app){a.enableEvents(true);this._properties.view.classify(a,"label")}a._label_highlight_id=f._highlight_id;a._highlight_ids=f._highlight_ids;this.filterWrapper(a,null,i);a._is_label=true;if(typeof f._custom_color!=="undefined"){a.attr("fill",f._custom_color)}return a}return false};graphica.Elements.fn.addConnection=function(h,b,d){var g=this._dataset.row(b);var e=g[this._properties.connectionVariable];if(this._properties._ds.isDateType(this._properties.connectionVariable)){e=e.faststrformat(this._properties.connectionVariableAggregation)}var c="all";if(typeof d!=="undefined"&&d!==null){c=this._dataset.columnName(d)}if(c=="all"&&this._properties.countVariables(graphica.SMALL_MULTIPLES)>0){c=g[this._properties.firstVariable(graphica.SMALL_MULTIPLES)]}var a="all";if(this._frame._frame_type=="2x2"||this._frame._frame_type=="2x1"||this._frame._frame_type=="2CxN"){a=g[this._properties.firstVariable(graphica.POS_X)]}else{if(this._frame._frame_type=="1x2"||this._frame._frame_type=="Nx2C"||this._frame._frame_type=="Nx2C"){a=g[this._properties.firstVariable(graphica.POS_Y)]}}var f="all";if(typeof this._properties.unitconnectionVariable!=="undefined"){f=g[this._properties.unitconnectionVariable]}this.connectionReferences=this.connectionReferences||{};this.connectionReferences[c]=this.connectionReferences[c]||{};this.connectionReferences[c][a]=this.connectionReferences[c][a]||{};this.connectionReferences[c][a][f]=this.connectionReferences[c][a][f]||{};this.connectionReferences[c][a][f][e]=this.connectionReferences[c][a][f][e]||{};this.connectionReferences[c][a][f][e].gr=h;this.connectionReferences[c][a][f][e].row=g;this.connectionReferences[c][a][f][e].rowindex=b;if((typeof d==="undefined"||d===null)&&typeof this._properties.valueconnectionVariable!=="undefined"){this.connectionReferences[c][a][f][e].value=this._dataset.getValue(b,this._properties.valueconnectionVariable,this._properties.valueconnectionVariableAggregation)}else{if(typeof d!=="undefined"&&d!==null){this.connectionReferences[c][a][f][e].value=this._dataset.getValue(b,d,this.anchor_axis_variable_aggregation)}else{this.connectionReferences[c][a][f][e].value=0}}this.connectionReferences[c][a][f].____last_row=g;this.connectionReferences[c][a][f].____last_index_row=b;if(!this.connectionValues){if(this._dataset.isDateType(this._properties.connectionVariable)){this.connectionValues=this._dataset.getDateTicks(this._properties.connectionVariable,this._properties.connectionVariableAggregation).ticks_strings}else{this.connectionValues=this._properties.getOrderedItems(this._properties.connectionVariable,this._properties.connectionVariableLinkProperty)}}};graphica.Elements.fn.getAreaConnectionGrape=function(I){var J=this._frame;if(typeof this._tmp_last_connections==="undefined"){if(J._frame_type=="2x2"){this._tmp_last_connections=new graphica.StackedArray(this._dataset,[J.axis_x._variable,J.axis_y._variable,this._properties.connectionVariable],this._properties)}else{if(J._frame_type=="1x2"){this._tmp_last_connections=new graphica.StackedArray(this._dataset,[J.axis_y._variable,this._properties.connectionVariable],this._properties)}else{if(J._frame_type=="2x1"){this._tmp_last_connections=new graphica.StackedArray(this._dataset,[J.axis_x._variable,this._properties.connectionVariable],this._properties)}else{if(J._previous_categorical_bar_variables.length){this._tmp_last_connections=new graphica.StackedArray(this._dataset,[J._previous_categorical_bar_variables[0],this._properties.connectionVariable],this._properties)}else{this._tmp_last_connections=new graphica.StackedArray(this._dataset,this._properties.connectionVariable,this._properties)}}}}}var C=new Grape();C._form_data=new graphica.FormData();C._form_data.form(graphica.AREALINE);C._highlight_ids=[];var m=new Array();m[0]=new Array();var L=[];var H=this._properties;var r;var k;var K=0;for(var z=0;z<this.connectionValues.length-1;z++){var b=this.connectionValues[z];var j=this.connectionValues[z+1];var a={};if(!I[b]){if(m[K].length){for(var G=L.length-1;G>=0;G--){m[K].push(L[G])}K++;m[K]=new Array();L=[]}}if(!I[b]&&!I[j]){continue}if(!I[b]){var w=I[j].row.slice(0);w[this._properties.connectionVariable]=b;if(typeof this._tmp_last_connections.getElement(w)!=="undefined"){a[b]={gr:this._tmp_last_connections.getElement(w).gr,row:I[j].row,rowindex:I[j].rowindex,nosize:true}}else{a[b]={gr:I[j].gr,row:I[j].row,rowindex:I[j].rowindex,basepos:J.getbasePositions(b,I[j].row)}}a[j]=I[j];this._tmp_last_connections.setElement(I[j].row,I[j])}else{if(!I[j]){var w=I[b].row.slice(0);w[this._properties.connectionVariable]=j;if(typeof this._tmp_last_connections.getElement(w)!=="undefined"){a[j]={gr:this._tmp_last_connections.getElement(w).gr,row:I[b].row,rowindex:I[b].rowindex,nosize:true}}else{a[j]={gr:I[b].gr,row:I[b].row,rowindex:I[b].rowindex,basepos:J.getbasePositions(j,I[b].row)}}a[b]=I[b];this._tmp_last_connections.setElement(I[b].row,I[b])}else{a[b]=I[b];a[j]=I[j];this._tmp_last_connections.setElement(I[b].row,I[b]);this._tmp_last_connections.setElement(I[j].row,I[j])}}var p;var o;var d;var c;var h;var g;var E;var B;var D;var A;var v;var q;var F=a[b].gr._form_data;var f=a[j].gr._form_data;if(C._highlight_ids.includes(a[b].gr._highlight_id)==false){C._highlight_ids.push(a[b].gr._highlight_id)}if(C._highlight_ids.includes(a[j].gr._highlight_id)==false){C._highlight_ids.push(a[j].gr._highlight_id)}p=F.x();o=F.y();d=f.x();c=f.y();var n=a[b].row;var e=a[b].rowindex;k=this.getColor(e);r=this.getIntensity(e);C._highlight_id=this.getHighlightID(e);if(F.orientation()=="vertical"){if(typeof a[b].basepos!=="undefined"){h=a[b].basepos.x;g=a[b].basepos.y;E=a[b].basepos.x;B=a[b].basepos.y}else{h=p;g=o-F.height();if(a[b].nosize){if(F.reversed()==true){g=o}}E=h;B=Math.ceil(o);if(a[b].nosize){if(F.reversed()==false){B=Math.ceil(o-F.height())}}}if(typeof a[j].basepos!=="undefined"){D=a[j].basepos.x;A=a[j].basepos.y;v=a[j].basepos.x;q=a[j].basepos.y}else{D=d;A=c-f.height();if(a[j].nosize){if(f.reversed()==true){A=c}}v=D;q=Math.ceil(c);if(a[j].nosize){if(f.reversed()==false){q=Math.ceil(c-f.height())}}}}else{if(typeof a[b].basepos!=="undefined"){h=a[b].basepos.x;g=a[b].basepos.y;D=a[b].basepos.x;A=a[b].basepos.y}else{h=p;g=o;if(a[b].nosize){if(F.reversed()==false){h=Math.ceil(p+F.width())}}D=p+F.width();A=g;if(a[b].nosize){if(F.reversed()==true){D=p}}}if(typeof a[j].basepos!=="undefined"){E=a[j].basepos.x;B=a[j].basepos.y;v=a[j].basepos.x;q=a[j].basepos.y}else{E=d;B=c;if(a[j].nosize){if(f.reversed()==false){E=Math.ceil(d+f.width())}}v=d+f.width();q=B;if(a[j].nosize){if(f.reversed()==true){v=d}}}}C._form_data.orientation(F.orientation());if(F.orientation()=="vertical"){if(!m[K].length){m[K].push([h,g])}m[K].push([D,A]);if(!L.length){L.push([E,B])}L.push([v,q]);C._form_data.x(D).y(graphica.Utils.middleOf(A,q))}else{if(!m[K].length){m[K].push([D,A])}m[K].push([v,q]);if(!L.length){L.push([h,g])}L.push([E,B]);C._form_data.x(graphica.Utils.middleOf(v,E)).y(B)}C._form_data.color(k)}if(L.length){for(var G=L.length-1;G>=0;G--){m[K].push(L[G])}}for(var x=0;x<=K;x++){if(!m[x].length){continue}subgr=new Grape();if(H.default_border_width){subgr.lineStyle(H.default_border_width,k,H.default_border_intensity)}else{subgr.lineStyle(0,k,r)}subgr.beginFill(k,r);subgr.beginPath(true);if(H.line_type=="curve"){var u=parseInt(m[x].length/2);var l=[];var y=[];for(var G=0;G<m[x].length;G++){if(G<u){l.push({x:m[x][G][0],y:m[x][G][1]})}else{if(G>=u){y.push({x:m[x][G][0],y:m[x][G][1]})}}}subgr.moveTo(Math.round(m[x][0][0]),Math.round(m[x][0][1]));subgr.splineCurve(l);subgr.lineTo(Math.round(m[x][u][0]),Math.round(m[x][u][1]));subgr.splineCurve(y)}else{for(var G=0;G<m[x].length;G++){if(G==0){subgr.moveTo(Math.round(m[x][G][0]),Math.round(m[x][G][1]))}else{subgr.lineTo(Math.round(m[x][G][0]),Math.round(m[x][G][1]))}}}subgr.endPath();subgr.addTo(C)}C._form_data.poligon(m);return C};graphica.Elements.fn.getLineConnectionGrape=function(G,a){var l=new Grape();var Q=[];var D=new GrapeGroup();l._form_data=new graphica.FormData();l._form_data.form(graphica.LINE);var K="vertical";var E=this._frame.axis_x2||this._frame.axis_x||null;if(E&&E._variable==this._properties.connectionVariable){K="horizontal"}l._form_data.orientation(K);var v;var W=null;var r=this._properties;var z;var g;var V;var N=0;var L;var i;var H;var n;for(N=0;N<this.connectionValues.length;N++){z=this.connectionValues[N];if(!G[z]){continue}n=z;if(typeof H=="undefined"){H=z}if(typeof L=="undefined"||G[z].value<G[L].value){L=z}if(typeof i=="undefined"||G[z].value>G[i].value){i=z}}var j=false;var o=null;var Y;var F;for(N=0;N<this.connectionValues.length;N++){z=this.connectionValues[N];if(!G[z]){continue}var t=G[z].row;o=G[z].rowindex;var Y=this._dataset.getCategoricalRowObject(t);if(typeof F=="undefined"){F=this._dataset.getCategoricalRowObject(t);var u=this._dataset.columnName(this._properties.connectionVariable);delete F[u]}if(typeof l._highlight_id==="undefined"){l._highlight_id=this.getHighlightID(o);l._highlight_ids=[l._highlight_id]}var p=this._frame.getPoints(o,this.anchor_axis_variable);var O=false;var M=false;var aa="center";if(r.marks_included=="all"){O=true}else{if((r.marks_included=="last"||r.marks_included=="first and last")&&typeof n!="undefined"&&n==z){O=true}else{if((r.marks_included=="first"||r.marks_included=="first and last")&&typeof H!="undefined"&&H==z){O=true}else{if((r.marks_included=="min"||r.marks_included=="min and max")&&typeof L!="undefined"&&L==z){O=true}else{if((r.marks_included=="max"||r.marks_included=="min and max")&&typeof i!="undefined"&&i==z){O=true}}}}}if(r.marks_to_label=="all"||(r.marks_to_label=="auto"&&!r.oneLine_oneLabel)){M=true}else{if((r.marks_to_label=="last"||(r.marks_to_label=="first and last"||r.marks_to_label=="auto"&&r.oneLine_oneLabel))&&typeof n!="undefined"&&n==z){M=true;if(r.oneLine_oneLabel&&r.oneLine_oneLabel_orientation_layout=="vertical"){aa="left"}}else{if((r.marks_to_label=="first"||r.marks_to_label=="first and last")&&typeof H!="undefined"&&H==z){M=true;if(r.oneLine_oneLabel&&r.oneLine_oneLabel_orientation_layout=="vertical"){aa="right"}}else{if((r.marks_to_label=="min"||r.marks_to_label=="min and max")&&typeof L!="undefined"&&L==z){M=true}else{if((r.marks_to_label=="max"||r.marks_to_label=="min and max")&&typeof i!="undefined"&&i==z){M=true}}}}}G[z].include_this=O;if(O&&r.line_type!="orthogonal"){var R=graphica.NONE_SHAPE;if(j==false){j=true;if(r.start_marks=="filled disk"||r.start_marks=="arrow filled disk"){R=graphica.FILLED_DISK}else{if(r.start_marks=="disk"||r.start_marks=="arrow disk"){R=graphica.DISK}}}else{if(r.end_marks=="filled disk"||r.end_marks=="arrow filled disk"){R=graphica.FILLED_DISK}else{if(r.end_marks=="disk"||r.end_marks=="arrow disk"){R=graphica.DISK}}}G[z].gr=r.getFormGrape(R,this.getArea(o),this.getColor(o),this.getIntensity(o),this.getCustomColor(F));G[z].gr._row=t;G[z].gr._criteriaRow=Y;G[z].gr._criteriaRowForColor=F;G[z].gr._form_data._is_mark_of_line=true;if(R==graphica.NONE_SHAPE){G[z].gr._form_data.radius(0)}G[z].gr._tmp_is_invisible_gr=(R==graphica.NONE_SHAPE)}else{G[z].gr=r.getFormGrape(graphica.NONE_SHAPE,this.getArea(o),this.getColor(o),this.getIntensity(o),this.getCustomColor(F));G[z].gr._row=t;G[z].gr._criteriaRow=Y;G[z].gr._criteriaRowForColor=F;G[z].gr._tmp_is_invisible_gr=true}if(Array.isArray(p.x)){G[z].gr.x(p.x[a]);G[z].gr._form_data.x(p.x[a])}else{G[z].gr.x(p.x);G[z].gr._form_data.x(p.x)}if(Array.isArray(p.y)){G[z].gr.y(p.y[a]);G[z].gr._form_data.y(p.y[a])}else{G[z].gr.y(p.y);G[z].gr._form_data.y(p.y)}r.view.classify(G[z].gr,"element");G[z].gr._highlight_id=l._highlight_id;G[z].gr._highlight_ids=[l._highlight_id];G[z].gr._annotation_config=r.view.getAnnotationConfig(G[z].gr._criteriaRow,this.anchor_axis_variable);if(this.hasAnnotation(G[z].gr)){D.push(this.getAnnotationGrape(G[z].gr))}if(this.anchor_axis_variable){G[z].gr._anchor_variable=this.anchor_axis_variable}if(M){if(typeof a!=="undefined"){var b=this._frame.all_n_variables.concat();b.splice(a,1);this.addLabel(G[z].gr,o,aa,null,b)}else{this.addLabel(G[z].gr,o,aa)}}}var e=new GrapeGroup();var P=[];var q=this.getArea(o);q=raceme.map(q,1,7854,0.5,126);q=raceme._round(q,1);for(var N=0;N<this.connectionValues.length;N++){z=this.connectionValues[N];g=this.connectionValues[N+1];if(!G[z]){continue}if(!G[g]&&r.interpolate_missing_values){for(var ab=N+2;ab<this.connectionValues.length;ab++){g=this.connectionValues[ab];if(G[g]){N=ab-1;break}}}if(G[z]&&G[g]){var Z=G[z].gr;var X=Z._form_data;var U=G[g].gr;var y=U._form_data;var S;var w;var f;var c;var C;var B;if(typeof X!=="undefined"){f=X.x();c=X.y();C=y.x();B=y.y()}else{f=Z.x();c=Z.y();C=U.x();B=U.y()}var k=this.getCustomColor(F)||this.getColor(o);V=this.getIntensity(o);var x,A;var I=0;var J=0;if(r.line_type!="orthogonal"&&r.line_type!="curve"){if(G[g].include_this&&(r.end_marks=="arrow"||r.end_marks=="arrow disk"||r.end_marks=="arrow filled disk")){J=Math.max(q*5,7);end_arrow_angle=raceme.rect2polar(C-f,B-c).angle;A=graphica.Utils.getArrowhead(J,end_arrow_angle,k,V);e.push(A)}if(G[z].include_this&&(r.start_marks=="arrow"||r.start_marks=="arrow disk"||r.start_marks=="arrow filled disk")){I=Math.max(q*5,7);start_arrow_angle=raceme.rect2polar(f-C,c-B).angle;x=graphica.Utils.getArrowhead(I,start_arrow_angle,k,V);e.push(x)}}var t=G[z].row;var o=G[z].rowindex;Q.push(graphica.Utils.middlePoint({x:f,y:c},{x:C,y:B}));var m;if(r.line_type=="orthogonal"){if(K=="vertical"){m=graphica.Utils.lineBetween2Circles(f,c,I,f,B,0)}else{m=graphica.Utils.lineBetween2Circles(f,c,I,C,c,0)}}else{var T=(!G[z].include_this)?0:X.radius();var h=(!G[g].include_this)?0:y.radius();m=graphica.Utils.lineBetween2Circles(f,c,T+I,C,B,h+J)}if(!v){v=new Grape();if(r.default_border_width){W=new Grape();W.enableEvents(false)}v.lineStyle(q,k,this.getIntensity(o),"butt","round");v.beginFill("none");v.beginPath();if(W){W.lineStyle(q+r.default_border_width*2,r.default_border_color,r.default_border_intensity,"butt","round");W.beginFill("none");W.beginPath()}if(r.line_type=="curve"){v.moveTo(f,c);if(W){W.moveTo(f,c)}}else{if(m.length||r.line_type=="orthogonal"){v.moveTo(m.x1,m.y1)}else{v.moveTo(m.x2,m.y2)}if(W){W.moveTo(m.x1,m.y1)}}}else{if(G[z].include_this&&(X.radius()>0||I>0)&&r.line_type!="curve"){v.moveTo(m.x1,m.y1);if(W){W.moveTo(m.x1,m.y1)}}}if(r.line_type=="curve"){P.push({x:f,y:c})}else{if(r.line_type=="orthogonal"){v.lineTo(m.x2,m.y2);if(W){W.lineTo(m.x2,m.y2)}m=graphica.Utils.lineBetween2Circles(m.x2,m.y2,0,C,B,0)}if(m.length){v.lineTo(m.x2,m.y2);if(W){W.lineTo(m.x2,m.y2)}if(J>0){v.moveTo(C,B)}}}if(x&&G[z].include_this){if(m.length){x.x(m.x1).y(m.y1)}else{x.x(m.x2).y(m.y2)}}if(A&&G[g].include_this){if(m.length){A.x(m.x2).y(m.y2)}else{A.x(m.x1).y(m.y1)}}tooltip=this.getTooltip(o);if(tooltip!=""){Z.addChild(new Grape("title").text(tooltip))}if(this.isBackgroundElements==false||Z._tmp_is_invisible_gr==false){e.push(Z)}this.addLink(Z,o);l._form_data.y(B).x(C)}else{if(G[z]){if(!v){v=new Grape()}var Z=G[z].gr;Z._highlight_id=l._highlight_id;Z._highlight_ids=[l._highlight_id];tooltip=this.getTooltip(G[z].rowindex);if(tooltip!=""){Z.addChild(new Grape("title").text(tooltip))}if(r.line_type=="curve"){var X=Z._form_data;if(typeof X!=="undefined"){P.push({x:X.x(),y:X.y()})}else{P.push({x:Z.x(),y:Z.y()})}v.splineCurve(P);if(W){W.splineCurve(P)}}if(this.isBackgroundElements==false||Z._tmp_is_invisible_gr==false){e.push(Z)}this.addLink(Z,o);if(W){W.endPath();W.addTo(l);W=null}v.endPath();v.addTo(l);v=null}}}e.addTo(l);return{gr:l,annotations:D,repulsion:Q}};graphica.Elements.fn.drawSankey=function(l,g,n,m,r,f){var y=this._properties;var A,e,z,d,x,c,v,b;var j,s,q;var p=n._variable;var o=m._variable;var u=n._stacked_a;var t=m._stacked_b;var B=this._frame._quantitative_bar_variable;var k=new Grape();var a=n.getPoint(l[p]);var D=m.getPoint(l[o]);if(a===null||D===null){return false}if(r.isCategorical(p)){u[l[p]]=u[l[p]]||0;j=n.getSpacePoint(l[p]);Math.max(j,1);s=j*l[B]/n._hierarchical_data.segments.taxonomy[l[p]].positive;if(n._orientation=="vertical"){A=n.x();e=n.y()+n._y_origin+a+j-u[l[p]]-s*0.5}else{e=n.y();A=this._frame._dataspace.x+a+u[l[p]]+s*0.5}u[l[p]]+=s}else{if(r.isQuantitative(p)){u.value=u.value||0;if(n._orientation=="vertical"){s=n._reversed?a:n._length-a;A=n.x();e=n.y()+n._y_origin+n.getPoint(u.value+l[p]*0.5)}else{s=n._reversed?this._frame._dataspace.width-a:a;e=n.y();A=this._frame._dataspace.x+n.getPoint(u.value+l[p]*0.5)}u.value+=l[p]}else{if(r.isDateType(p)){s=0;if(n._orientation=="vertical"){A=n.x();e=n.y()+n._y_origin+a}else{e=n.y();A=this._frame._dataspace.x+a}}}}if(r.isCategorical(o)){t[l[o]]=t[l[o]]||0;j=m.getSpacePoint(l[o]);Math.max(j,1);q=j*l[B]/m._hierarchical_data.segments.taxonomy[l[o]].positive;if(m._orientation=="vertical"){z=m.x();d=m.y()+m._y_origin+D+j-t[l[o]]-q*0.5}else{d=m.y();z=this._frame._dataspace.x+D+t[l[o]]+q*0.5}t[l[o]]+=q}else{if(r.isQuantitative(o)){t.value=t.value||0;if(m._orientation=="vertical"){q=m._reversed?D:m._length-D;z=m.x();d=m.y()+m._y_origin+m.getPoint(t.value+l[o]*0.5)}else{q=m._reversed?this._frame._dataspace.width-D:D;d=m.y();z=this._frame._dataspace.x+m.getPoint(t.value+l[o]*0.5)}t.value+=l[o]}else{if(r.isDateType(o)){q=0;if(m._orientation=="vertical"){z=m.x();d=m.y()+m._y_origin+D}else{d=m.y();z=this._frame._dataspace.x+D}}}}if(y.line_type=="curve"){var C=n._orientation=="vertical"?graphica.Utils.middleOf(A,z):graphica.Utils.middleOf(e,d);k.beginFill(this.getColor(g,r),this.getIntensity(g,r));if(y.default_border_width){k.lineStyle(y.default_border_width/2,y.default_border_color,y.default_border_intensity)}if(n._orientation=="vertical"){k.beginPath(true).moveTo(A,e-s*0.5).curveTo(z,d-q*0.5,C,e-s*0.5,C,d-q*0.5).lineTo(z,d+q*0.5).curveTo(A,e+s*0.5,C,d+q*0.5,C,e+s*0.5).endPath()}else{k.beginPath(true).moveTo(A+s*0.5,e).curveTo(z+q*0.5,d,A+s*0.5,C,z+q*0.5,C).lineTo(z-q*0.5,d).curveTo(A-s*0.5,e,z-q*0.5,C,A-s*0.5,C).endPath()}}else{k.beginFill(this.getColor(g,r),this.getIntensity(g,r));if(y.default_border_width){k.lineStyle(y.default_border_width/2,y.default_border_color,y.default_border_intensity)}if(n._orientation=="vertical"){k.beginPath(true).moveTo(A,e-s*0.5).lineTo(z,d-q*0.5).lineTo(z,d+q*0.5).lineTo(A,e+s*0.5).endPath()}else{k.beginPath(true).moveTo(A+s*0.5,e).lineTo(z+q*0.5,d).lineTo(z-q*0.5,d).lineTo(A-s*0.5,e).endPath()}}k.endFill();k.attr("data-center-x",A+(z-A)*0.5);k.attr("data-center-y",e+(d-e)*0.5);this.grgroup.push(k);k._highlight_id=this.getHighlightID(g,r);k._highlight_ids=[k._highlight_id];this.filterWrapper(k,null,l);k._row=l;k._criteriaRow=this._dataset.getCategoricalRowObject(l);k._useFullRowAsCriteria=true;k._criteriaRow={};for(var w=0;w<l.length;w++){if(this._dataset.isQuantitative(w)==false&&graphica.computed_variables.includes(this._dataset.header.names[w])==false){if((this._frame._frame_type=="Nx0"&&!y.isSet(w,graphica.POS_X))||(this._frame._frame_type=="0xN"&&!y.isSet(w,graphica.POS_Y))||p==w||o==w){k._criteriaRow[this._dataset.header.names[w]]=l[w]}}}this.addLink(k,l);k._annotation_config=y.view.getAnnotationConfig(k._criteriaRow,this.anchor_axis_variable);if(this.hasAnnotation(k)){this.grAnnotations.addChild(this.getAnnotationGrape(k))}y.view.classify(k,"element");var h=this.getTooltip(g,r,f);if(h!=""){k.addChild(new Grape("title").textContent(h))}};graphica.Elements.fn.drawBackgroundElement=function(o,m){var b=this._properties;var i=b.firstVariable(graphica.UNIT);var l=o[i];var h=this._frame.getSubframe(m);if(h===false){return false}var g=h._map.getRegionGrape(l);if(g){g._row=o;g._criteriaRow=this._dataset.getCategoricalRowObject(o);var k=this.getColor(m);var a=this.getCustomColor(g._criteriaRow);if(a){k=a;g._custom_color=a}g.enableEvents(true);g.style("fill",k);g.opacity(1).attr("fill-opacity",this.getIntensity(m));if(b.default_border_width>0){g.attr("stroke-width",b.default_border_width/2)}else{if(h._map_border_only_in_regions_with_data){g.attr("stroke-width",h._default_map_border/2)}}if(h._map_border_only_in_regions_with_data){g.toFront()}g.attr("stroke",b.default_border_color);if(b.countVariables(graphica.AREA)>0){g.valuebyarea=this.getArea(m)}var d=h._map.getCentroid(l,o);var e=h._map.getCentroidScaled(l,o);g.attr("data-center-x",d.x-g.x()).attr("data-center-y",d.y);if(typeof e.latitude!=="undefined"){g.latitude=e.latitude;g.longitude=e.longitude}if(!g._tmpbbox){g._tmpbbox=g.getBBox()}this.updateZoomAutoFocusBox(g);var n=this.getTooltip(m);if(n!=""){g.addChild(new Grape("title").text(n))}g._form_data=new graphica.FormData();g._form_data.form(graphica.GEO_SHAPE).radius(0).x(e.x).y(e.y).color(k);if(b.label_config){this.addLabel(g,m,"center","middle")}if(h.zoom_auto_focus){g._need_zoom_autofocus=true}this.grgroup.push(g);g._highlight_id=this.getHighlightID(m);g._highlight_ids=[g._highlight_id];this.filterWrapper(g,i,o);this.addLink(g,m);g._annotation_config=b.view.getAnnotationConfig(g._criteriaRow,this.anchor_axis_variable);if(this.hasAnnotation(g)){this.grAnnotations.addChild(this.getAnnotationGrape(g))}b.view.classify(g,"element");if(this._dataset.edges&&this._frame.graphObj&&this._frame._frame_type!="multiple"&&this._frame._frame_type!="1Cx0"&&this._frame._frame_type!="0x1C"&&this._frame._frame_type!="1Cx1C"){var j=this._frame.graphObj.getNode(o);if(j){g.graphNode=j;j.elm=g}}else{if((this._frame._frame_type=="multiple"||this._frame._frame_type=="1Cx0"||this._frame._frame_type=="0x1C"||this._frame._frame_type=="1Cx1C")&&this._frame._sub_frames.length&&this._frame._sub_frames[0].graphObj){for(var c=0;c<this._frame._sub_frames.length;c++){var j=this._frame._sub_frames[c].graphObj.getNode(o);if(j){g.graphNode=j;j.elm=g}}}}}};graphica.Elements.fn.drawPie=function(o,s,q,g){var t=this._properties;var k=new Grape();k.x(s).y(q);var t=this._properties;var j=g*t.donut_inner_radius;var v=t.categorical_division.length||1;if(t.circle_chart_type=="rose"||t.circle_chart_type=="radar"){v=1}var f=((g-j)/v);if(t.circle_chart_type=="radar"){f=g}var x;if(t.circle_chart_type=="pie"){if(t.countVariables(graphica.AREA)>0){x=o.sum(t.firstVariable(graphica.AREA),t.getSettings(t.firstVariable(graphica.AREA),graphica.AREA,"aggregation"))}else{x=o.sum(o.header.getId("graphica.com.frequency"))}}else{if(t.size_range=="independent"){if(t.countVariables(graphica.AREA)>0){x=o.max(t.firstVariable(graphica.AREA),t.getSettings(t.firstVariable(graphica.AREA),graphica.AREA,"aggregation"))}else{x=o.max(o.header.getId("graphica.com.frequency"))}}else{if(typeof this._frame._bar_max_value!=="undefined"){x=this._frame._bar_max_value}else{x=o.sum(o.header.getId("graphica.com.frequency"))}}}k.area_size=g;var n=true;if(this._properties.countVariables(graphica.UNIT)>0&&this._properties.getLabelCategoricalVariables().length&&this._properties.firstVariable(graphica.UNIT)==this._properties.label_variables[0]){k._form_data=new graphica.FormData();k._form_data.form(graphica.CIRCLE).radius(g);n=false}var b;if(t.circle_chart_type=="radar"){var p;var c=t.getOrderedItems(t.categorical_division[0]);if(c){var i=c.length;for(var u=i-1;u>=0;u--){var w;if(t.countVariables(graphica.AREA)>0){w=t.firstVariable(graphica.AREA)}else{w=o.header.getId("graphica.com.frequency")}p=new graphica.Axis(t,w,"radar");p.length(f);p._show_legend=false;p._show_ticks=true;p._show_line=true;p._ticks_shape="circle";p._low_padding=0;p._high_padding=0;p._include_zero=false;if(u>0||t.isSet(w,graphica.LABEL)==true||(this._first_radar_has_been_drawn&&t.size_range=="uniform")){p._show_labels=false}p.min(0);p.max(x);p.init();var m=p.getGrape().y(-f);m.by("line").attr("shape-rendering","");m=new Grape().addChild(m);m.x(s).y(q);if(u>0){m.rotation(-(360/i*u))}this._frame.gr.addChild(m)}this._first_radar_has_been_drawn=true;if(typeof p!="undefined"){x=p.max()}}}var a=new GrapeGroup();if(t.circle_chart_type=="radar"&&t.countVariables(graphica.HUE)>0&&this._dataset.isCategorical(t.firstVariable(graphica.HUE))){var e=t.getOrderedItems(t.firstVariable(graphica.HUE),graphica.HUE);for(var l=0;l<e.length;l++){var h=o.rows(t.firstVariable(graphica.HUE),e[l]);if(h.length){b=this.drawSlice(h,x,-90,0,j,f,k,n,t.circle_chart_type,s,q);k.addChild(b.grape).addChild(new Grape("defs").addChild(b.pielabelsdef)).addChild(b.pielabels);a.push(b.annotations)}}}else{b=this.drawSlice(o,x,-90,0,j,f,k,n,t.circle_chart_type,s,q);a.push(b.annotations);k.addChild(b.grape).addChild(new Grape("defs").addChild(b.pielabelsdef)).addChild(b.pielabels)}if(this._frame.zoomable){k.addClass("nonscalable");this.updateZoomAutoFocusBox(k)}return{pie:k,annotations:a}};graphica.Elements.fn.drawSlice=function(k,O,H,h,M,V,u,w,Q,D,z){if(typeof w!=="boolean"){w=true}var n=new Grape();var J=new GrapeGroup();var I=new GrapeGroup();var m=new Grape("defs");var y=this._properties;var al=y.categorical_division.length;var ae=null;var R=null;if(typeof y.categorical_division[h]!=="undefined"){ae=y.categorical_division[h];R=graphica.SUBDIVISION}else{if(y.countVariables(graphica.HUE)>0&&k.isQuantitative(y.firstVariable(graphica.HUE))==false){ae=y.firstVariable(graphica.HUE);R=graphica.HUE}}var a=[];for(var ah=0;ah<y.categorical_division.length;ah++){if(y.categorical_division[ah]!=ae){a.push(y.categorical_division[ah])}}var am;var Z;if(ae!==null){am=y.getOrderedItems(ae,R);Z=k.groupBy(ae)}else{am=[""];Z=k}var N=[null];if(Q=="rose"&&y.countVariables(graphica.HUE)>0&&k.isQuantitative(y.firstVariable(graphica.HUE))==false&&y.firstVariable(graphica.HUE)!=ae){N=y.getOrderedItems(y.firstVariable(graphica.HUE),graphica.HUE)}var aa;if(y.countVariables(graphica.AREA)>0){aa=y.firstVariable(graphica.AREA)}else{aa=k.header.getId("graphica.com.frequency")}var F=y.getSettings(aa,graphica.AREA,"aggregation");var P=false;if(y.label_config!=""&&y.label_placement=="automatic"&&y.categorical_division.length>1&&Q=="pie"){P=true}var g=360/am.length;var Y=V;var v;var x=new GrapeGroup();var L=new Grape();if(Q=="radar"){var l;if(k.isQuantitative(y.firstVariable(graphica.HUE))){l=this.getColorByValue(k.average(y.firstVariable(graphica.HUE)))}else{l=this.getColor(0,k)}L.beginFill(l,this.getIntensityByValue(k.average(y.firstVariable(graphica.INTENSITY))));if(y.default_border_width){L.lineStyle(y.default_border_width,l,y.default_border_intensity,0)}if(!y.view.highlight_on_hover){L.enableEvents(false)}L.beginPath(true)}for(var ad=0;ad<am.length;ad++){var ai=am[ad];var X;if(am.length>1){X=k.rows(ae,am[ad])}else{X=k}if(Q=="pie"){g=graphica.Utils.map(X.sum(aa,F),0,O,0,360)}else{if(Q=="radar"){V=graphica.Utils.map(X.sum(aa,F),0,O,0,Y)}}v=Z.indexOf(am[ad],ae);if(v==-1){v=0}if(ai=="null"||g==0){}else{if(Q=="radar"&&X.length>0){var T=raceme.polar2rect(V,H).x;var S=raceme.polar2rect(V,H).y;if(ad==0){n._highlight_id=this.getHighlightID(v,Z);n._highlight_ids=[n._highlight_id];L.moveTo(T,S)}else{L.lineTo(T,S)}var ac=y.getFormGrape(graphica.NONE_SHAPE);ac._highlight_id=n._highlight_id;ac._highlight_ids=[n._highlight_id];ac.x(T).y(S);ac._form_data=new graphica.FormData();ac._form_data.form(graphica.RADAR_SLICE).radius(V).parent(u).xin(raceme.polar2rect(V,H).x).yin(raceme.polar2rect(V,H).y).xout(raceme.polar2rect(M+Y,H).x).yout(raceme.polar2rect(M+Y,H).y).init_angle(H).end_angle(H+g).angle(H).color(this.getColor(0,X));x.push(ac);ac._row=X.row(0);ac._criteriaRow=this._dataset.getCategoricalRowObject(ac._row);y.view.classify(ac,"element");ac._annotation_config=y.view.getAnnotationConfig(ac._criteriaRow,this.anchor_axis_variable);if(this.hasAnnotation(ac)){J.push(this.getAnnotationGrape(ac))}var W=this.getTooltip(v,Z,a);if(W!=""){ac.addChild(new Grape("title").text(W))}if(ad==am.length-1){L.endPath();n.addChild(L);n.addChild(x);n._viz_filter_classes=[];n._viz_filter_interactions=null;n._row=X.row(0);n._criteriaRow=this._dataset.getCategoricalRowObject(n._row);this.grgroup.push(n);this.filterWrapper(n,ae,n._row)}this.addLabel(ac,0,y.label_align,"middle",null,X)}else{if(Q=="rose"){if(y.default_border_color&&g>2&&g<=360){n.lineStyle(y.default_border_width,y.default_border_color,y.default_border_intensity,0)}else{n.lineStyle(y.default_border_width,y.default_border_color,0,0)}if(N.length==0){N=[null]}var ak=M;for(var ab=0;ab<N.length;ab++){var W="";var e;if(N[ab]!==null){e=X.rows(y.firstVariable(graphica.HUE),N[ab]);if(e.length){W=this.getTooltip(0,e,a)}}else{e=X;if(e.length){W=this.getTooltip(v,Z,a)}}if(e.length==0){continue}var q=this.getColor(0,e);n._criteriaRow=this._dataset.getCategoricalRowObject(e.row(0));var C=this.getCustomColor(n._criteriaRow);if(C){n._custom_color=C;q=C}n.beginFill(q,this.getIntensity(0,e));V=graphica.Utils.map(e.sum(aa,F),0,O,0,Y);n.pieSlice(ak,ak+V-1,H,H+g);var ac=n.lastChild();ac._form_data=new graphica.FormData();ac._form_data.form(graphica.POLAR_SLICE).radius(ak+V).parent(u).xin(raceme.polar2rect(ak+V,H+g/2).x).yin(raceme.polar2rect(ak+V,H+g/2).y).xout(raceme.polar2rect(M+Y,H+g/2).x).yout(raceme.polar2rect(M+Y,H+g/2).y).init_angle(H).end_angle(H+g).angle(H+g/2).color(q);if(C){ac._custom_color=C}ac._viz_filter_classes=[];ac._viz_filter_interactions=null;ac._row=e.row(0);ac._criteriaRow=this._dataset.getCategoricalRowObject(ac._row);ac._highlight_id=this.getHighlightID(0,e);ac._highlight_ids=[ac._highlight_id];this.grgroup.push(ac);this.filterWrapper(ac,ae,ac._row);y.view.classify(ac,"element");var t=raceme.polar2rect(ak+V/2,H+g/2).x;var p=raceme.polar2rect(ak+V/2,H+g/2).y;ac.attr("data-center-x",t);ac.attr("data-center-y",p);ac._annotation_config=y.view.getAnnotationConfig(ac._criteriaRow,this.anchor_axis_variable);if(this.hasAnnotation(ac)){J.push(this.getAnnotationGrape(ac))}if(W!=""){ac.addChild(new Grape("title").text(W))}ak+=V;this.addLabel(ac,0,y.label_align,"middle",null,e)}}else{if(X.length>0){var B=Z.row(v);var G=this._dataset.getCategoricalRowObject(B);if(y.categorical_division.length){for(var U=0;U<y.categorical_division.length;U++){if(U!=h){var c=this._dataset.columnName(y.categorical_division[U]);delete B[c]}}}var q=this.getColor(v,Z);var C=this.getCustomColor(B);if(C){q=C}n.beginFill(q,this.getIntensity(v,Z));if(y.default_border_color&&g>2&&g<=360){n.lineStyle(y.default_border_width,y.default_border_color,y.default_border_intensity,0)}else{n.lineStyle(y.default_border_width,y.default_border_color,0,0)}n.pieSlice(M,M+V-1,H,H+g);var ac=n.lastChild();ac._form_data=new graphica.FormData();ac._form_data.form(graphica.SLICE).radius(M+V).parent(u).xin(raceme.polar2rect(M+V/2,H+g/2).x).yin(raceme.polar2rect(M+V/2,H+g/2).y).xout(raceme.polar2rect(M+V,H+g/2).x).yout(raceme.polar2rect(M+V,H+g/2).y).init_angle(H).end_angle(H+g).angle(H+g/2).color(q);if(C){ac._custom_color=C}ac._viz_filter_classes=[];ac._viz_filter_interactions=null;ac._row=B;ac._criteriaRow=B;ac._highlight_id=this.getHighlightID(v,Z);ac._highlight_ids=[ac._highlight_id];this.grgroup.push(ac);this.filterWrapper(ac,ae,ac._row);y.view.classify(ac,"element");var t=raceme.polar2rect(M+V/2,H+g/2).x;var p=raceme.polar2rect(M+V/2,H+g/2).y;ac.attr("data-center-x",t);ac.attr("data-center-y",p);ac._annotation_config=y.view.getAnnotationConfig(ac._criteriaRow,this.anchor_axis_variable);if(this.hasAnnotation(ac)){J.push(this.getAnnotationGrape(ac))}var W=this.getTooltip(v,Z,a);if(W!=""){ac.addChild(new Grape("title").text(W))}if(ac){if(ai!="null"&&P){var b=y.getLabelText(v,a,Z);var o=new Grape();var E;var A=H+g*0.5;if(h==0){if(A<90||A>270){E=raceme.label(b,0,0,y.getLabelColor(v,Z),y.default_label_size,"right","middle",y.getLabelIntensity(y.getLabelColor(v,Z)),y.label_font)}else{E=raceme.label(b,0,0,y.getLabelColor(v,Z),y.default_label_size,"left","middle",y.getLabelIntensity(y.getLabelColor(v,Z)),y.label_font)}}else{if(A<90||A>270){E=raceme.label(b,0,0,y.getLabelColor(v,Z),y.default_label_size,"left","middle",y.getLabelIntensity(y.getLabelColor(v,Z)),y.label_font)}else{E=raceme.label(b,0,0,y.getLabelColor(v,Z),y.default_label_size,"right","middle",y.getLabelIntensity(y.getLabelColor(v,Z)),y.label_font)}}if(typeof ac._custom_color!=="undefined"){E.attr("fill",ac._custom_color)}if(y.stroke_on_labels){E.style("stroke-width","2px");E.style("stroke",y.stroke_color_on_labels);E.style("paint-order","stroke");E.style("stroke-linejoin","round")}var j=E.getBBox();var d=M;if(y.label_auto_contrast!==false&&y.stroke_on_labels==false){this.labelsgroup.changeContrastColor(E,ac._form_data)}var ag=d-j.width/2;var aj=raceme.polar2rect(ag,H);var af=raceme.polar2rect(ag,H+g);if(h==0){E.x(raceme.polar2rect(d+V-4,A).x);E.y(raceme.polar2rect(d+V-4,A).y)}else{E.x(raceme.polar2rect(d+4,A).x);E.y(raceme.polar2rect(d+4,A).y)}if(A<90||A>270){E.rotation(A);if(j.width>V+4&&h==0){E.x(raceme.polar2rect(d+V+(j.width-V)+4,A).x);E.y(raceme.polar2rect(d+V+(j.width-V)+4,A).y)}}else{if(j.width>V+4&&h>0){E.x(raceme.polar2rect(d-(j.width-V)-4,A).x);E.y(raceme.polar2rect(d-(j.width-V)-4,A).y)}else{}E.rotation(A+180)}I.push(o.addChild(E.enableEvents(false)));this.grclips.push(o.getClip(new Grape("path").attr("d",ac.attr("d"))));if(E.pixi){var K=ac.pixi.clone();K.transform=ac.pixi.transform;E.pixi.mask=K}}else{this.addLabel(ac,0,y.label_align,"middle",null,X)}}}}}}if((y.categorical_division.length-1)>h&&Q=="pie"){var s=this.drawSlice(X,O,H,h+1,M+V,V,u,w,Q,D,z);n.addChild(s.grape);I.push(s.pielabels);J.push(s.annotations);s.pielabelsdef.addTo(m)}H+=g}return{grape:n,pielabels:I,pielabelsdef:m.getChildren(),annotations:J}};graphica.Elements.fn.getGrape=function(){return this.gr};graphica.Elements.fn.hasAnnotation=function(a){return(this.isBackgroundElements==false&&typeof a!="undefined"&&typeof a._annotation_config!=="undefined"&&a._annotation_config&&a._annotation_config.text!="")};graphica.Elements.fn.getAnnotationGrape=function(a){var q=this;var o=new Grape();var e=20;var m=5;o.__elm=a;var d;var c=0;var t=null;o._update_position=function(){var p=0;var v=0;if(this.__elm.tagName()=="path"){if(this.__elm.hasAttr("data-center-x")){var r=this.__elm.point(this.__elm.attr("data-center-x"),this.__elm.attr("data-center-y"));p=r.x;v=r.y}else{var u=this.__elm.getPolygon().centroid();p=u.x;v=u.y}}else{if(this.__elm.hasAttr("data-center-x")){p=this.__elm.attr("data-center-x");v=this.__elm.attr("data-center-y")}else{d=this.__elm.getBBox();p=this.__elm.point().x+(d.width/2);if(this.__elm._is_invisible||this.__elm._is_filled_rectangle||(typeof this._annotation_config.type=="string"&&this._annotation_config.type=="visible")){v=this.__elm.point().y+(d.height/2)}else{v=this.__elm.point().y+(d.height/2)}}}if(this.__elm._form_data){if(this.__elm._form_data._radius){c=this.__elm._form_data._radius}if(this.__elm._form_data._form){t=this.__elm._form_data._form}}this.x(p*this.scale()-q.gr.x()/q.gr.scale()).y(v*this.scale()-q.gr.y()/q.gr.scale())};o._calc_vector=function(F,z,v){if(typeof d=="undefined"){d={x:0,y:0,width:0,height:0}}var A=o._text_block._tmpbbox;var G=0;if(typeof o._annotation_config!=="undefined"&&typeof o._annotation_config.align!=="undefined"){if(o._annotation_config.align=="center"){G=-A.width/2}else{if(o._annotation_config.align=="right"){G=-A.width}}}if(typeof F==="undefined"||F===null||typeof z=="undefined"||z===null){F=o._text_block.x()+G;z=o._text_block.y()}var y=[{x:F,y:z},{x:F+A.width/2,y:z},{x:F+A.width,y:z},{x:F+A.width,y:z+A.height/2},{x:F+A.width,y:z+A.height},{x:F+A.width/2,y:z+A.height},{x:F,y:z+A.height},{x:F,y:z+A.height/2}];var C=[{x:0,y:-d.height/2},{x:d.width/2,y:0,pos:"right"},{x:0,y:d.height/2},{x:-d.width/2,y:0,pos:"left"}];if(c&&t!==graphica.NONE_SHAPE){var r=raceme.polar2rect(c,45);C.push({x:Math.abs(r.x),y:Math.abs(r.y),pos:"right"});C.push({x:-Math.abs(r.x),y:Math.abs(r.y),pos:"left"});C.push({x:-Math.abs(r.x),y:-Math.abs(r.y),pos:"left"});C.push({x:Math.abs(r.x),y:-Math.abs(r.y),pos:"right"})}if(t==graphica.NONE_SHAPE||t==graphica.AREALINE||t==graphica.SLICE||t==graphica.POLAR_SLICE||t==graphica.RADAR_SLICE||graphica.Utils.intersectRect({x:o._text_block.x()+G,y:o._text_block.y(),width:A.width,height:A.height},{x:-d.width/2,y:-d.height/2,width:d.width,height:d.height})){C=[{x:0,y:0}]}var E=y[0];var D=C[0];for(var x=0;x<y.length;x++){for(var w=0;w<C.length;w++){if(graphica.Utils.distance(y[x],C[w])<graphica.Utils.distance(E,D)){if(typeof C[w]["pos"]!="undefined"&&((C[w]["pos"]=="right"&&y[x].x<C[w].x)||(C[w]["pos"]=="left"&&y[x].x>C[w].x))){continue}E=y[x];D=C[w]}}}if(typeof v=="number"&&v>0){var p=raceme.rect2polar(D.x-E.x,D.y-E.y);var B=Math.max(p.r-v,0);var u=raceme.polar2rect(B,p.angle);D.x=E.x+u.x;D.y=E.y+u.y}return[E,D]};o._redraw_arrow=function(){if(typeof this._annotation_config.type=="string"&&this._annotation_config.type=="visible"&&(typeof this._annotation_config.line_type=="undefined"||this._annotation_config.line_type!="none")){o._arrow_grape.clear();var r=this._calc_vector(null,null,1);var p=graphica.EDGE_LINE;if(typeof o._annotation_config!=="undefined"&&typeof o._annotation_config.line_type!=="undefined"){if(o._annotation_config.line_type=="arrow"){p=graphica.EDGE_ARROW}else{if(o._annotation_config.line_type=="fine arrow"){p=graphica.EDGE_FINE_ARROW}}}var u=false;if(typeof o._annotation_config!=="undefined"&&typeof o._annotation_config.line_curvature!=="undefined"&&(o._annotation_config.line_curvature=="curve"||o._annotation_config.line_curvature=="reverse curve")){u=0.25}graphica.Utils.drawEdge(o._arrow_grape,p,r,u,typeof o._annotation_config.line_color!=="undefined"?o._annotation_config.line_color:"black",typeof o._annotation_config.line_width!=="undefined"?o._annotation_config.line_width:1,1,1,(u!==false&&o._annotation_config.line_curvature=="reverse curve"))}};o._annotation_config=a._annotation_config;if(typeof o._annotation_config.type=="string"&&o._annotation_config.type=="visible"){o._arrow_grape=new Grape().addTo(o)}o._update_position();o.addClass("nonscalable");var l=q._properties.replaceVariablesWithValues(o._annotation_config.text,o.__elm._row);if(typeof o._annotation_config.type=="string"&&o._annotation_config.type=="visible"){var g=o._annotation_config.width||200;var j,f;if(typeof o._annotation_config.x!="undefined"){j=o._annotation_config.x}else{j=0}if(typeof o._annotation_config.y!="undefined"){y_pos=o._annotation_config.y}else{y_pos=40}o._text_block=raceme.paragraph(l,0,0,typeof o._annotation_config.text_color!=="undefined"?o._annotation_config.text_color:"rgb(0,0,0)",o._annotation_config.font_size||14,typeof o._annotation_config.align!=="undefined"?o._annotation_config.align:"left","top",1,"",g);if(typeof o._annotation_config.text_stroke=="undefined"||o._annotation_config.text_stroke==true){o._text_block.style("stroke-width","2px").style("stroke",(typeof this._properties.view._background_color!=="undefined"&&this._properties.view._transparent_background==false)?this._properties.view._background_color:"white").style("paint-order","stroke").style("stroke-linejoin","round")}o._text_block.x(j).y(y_pos);o._text_block.addTo(o);o._text_block._tmpbbox=o.getBBox();o._text_block.style("cursor","grab");o._redraw_arrow();var k;o._text_block.drag(function(p){p.stopPropagation();if(typeof p.clientX!=="undefined"){k={x:p.clientX,y:p.clientY}}this.style("cursor","grabbing")},function(G){if(typeof k==="undefined"){k={x:G.clientX,y:G.clientY}}this.style("cursor","grabbing");var z={x:G.clientX,y:G.clientY};var y=k.x-z.x;var x=k.y-z.y;var H=typeof G.rotationAngle!=="undefined";var p=this.scale();var C=this.x()-y*p;var B=this.y()-x*p;var A=0;if(typeof o._annotation_config!=="undefined"&&typeof o._annotation_config.align!=="undefined"){if(o._annotation_config.align=="center"){A=+this._tmpbbox.width/2}else{if(o._annotation_config.align=="right"){A=+this._tmpbbox.width}}}var E=o._calc_vector(C,B);E={x:E[0].x-E[1].x,y:E[0].y-E[1].y};var D=raceme.rect2polar(E.x,E.y);var v=raceme.polar2rect(D.r,45);var I=raceme.polar2rect(D.r,135);var r=raceme.polar2rect(D.r,225);var w=raceme.polar2rect(D.r,315);var F=raceme.rect2polar(y,x);var J=F.r;var u=F.angle;if(H==false){if(D.r>6&&raceme.distance(E,v)<=J*1.5&&(J<2||Math.abs(u-45)<25||Math.abs(u-225)<25)){C+=(v.x-E.x);B+=(v.y-E.y);k.y=G.clientY;k.x=G.clientX}else{if(D.r>6&&raceme.distance(E,I)<J*1.5&&(J<2||Math.abs(u-135)<25||Math.abs(u-315)<25)){C+=(I.x-E.x);B+=(I.y-E.y);k.y=G.clientY;k.x=G.clientX}else{if(D.r>6&&raceme.distance(E,r)<=J*1.5&&(J<2||Math.abs(u-45)<25||Math.abs(u-225)<25)){C+=(r.x-E.x);B+=(r.y-E.y);k.y=G.clientY;k.x=G.clientX}else{if(D.r>6&&raceme.distance(E,w)<J*1.5&&(J<2||Math.abs(u-135)<25||Math.abs(u-315)<25)){let new_vec_data=raceme.polar2rect(D.r,315);C+=(w.x-E.x);B+=(w.y-E.y);k.y=G.clientY;k.x=G.clientX}else{if(B<4&&B>-4){B=0}else{if(B<-this._tmpbbox.height/2+4&&B>-this._tmpbbox.height/2-4){B=-this._tmpbbox.height/2}else{if(B<-this._tmpbbox.height+4&&B>-this._tmpbbox.height-4){B=-this._tmpbbox.height}else{k.y=G.clientY}}}if(C<A+4&&C>A-4){C=0+A}else{if(C<-this._tmpbbox.width/2+A+4&&C>-this._tmpbbox.width/2+A-4){C=-this._tmpbbox.width/2+A}else{if(C<-this._tmpbbox.width+A+4&&C>-this._tmpbbox.width+A-4){C=-this._tmpbbox.width+A}else{k.x=G.clientX}}}}}}}}else{k.y=G.clientY;k.x=G.clientX}this.x(C);this.y(B);o._redraw_arrow()},function(p){this.style("cursor","grab");o._annotation_config.x=this.x();o._annotation_config.y=this.y();if(typeof o.update_settings_after_drag!="undefined"){o.update_settings_after_drag(o._annotation_config)}})}else{o.beginFill("#ffffff");o.lineStyle(0);var s=-e/2;var i=-e-m;if(typeof d!=="undefined"){i-=d.height/2}var b=o.rect(0,0,e+2,e+2,e/2).x(s-1).y(i-1);o.beginPath(true).moveTo(0,i+e+m).lineTo(-m-2,i-4+e).lineTo(m+2,i-4+e).lineTo(0,i+e+m).endPath();o.beginFill("#2969a3");o.lineStyle(0);var h=o.rect(0,0,e,e,e/2).x(s).y(i);o.beginPath(true).moveTo(0,i-2+e+m).lineTo(-m,i-2+e).lineTo(m,i-2+e).lineTo(0,i-2+e+m).endPath();var n=null;o.mouseenter(function(){if(typeof n!=="undefined"&&n!==null){n.remove();n=null}var v=q._frame._framespace.width;n=raceme.paragraph(l,0,2,"rgb(250,250,250)",14,"left","top",1,"",v-32);var x=n.getBBox();var r=x.width+16;var p=Math.max(x.height+8,e);var w=-r/2;var u=-p-m;if(typeof d!=="undefined"){u-=d.height/2}if(o.point().x+w<q._frame._framespace.x){w-=o.point().x+w-q._frame._framespace.x}if(o.point().x+r/2+16>q._frame._framespace.x+q._frame._framespace.width){w-=((o.point().x+r/2)-(q._frame._framespace.x+q._frame._framespace.width))+16}b.stop(0).animate(250).ease("out").x(w-1).y(u-1).attr("width",r+2).attr("height",p+2).attr("rx",2);h.stop(0).animate(250).ease("out").x(w).y(u).attr("width",r).attr("height",p).attr("rx",2).done(function(){n.x(w+8).y(u+4);n.addTo(o)})});o.mouseleave(function(){b.stop(0).animate(250,250).ease("in").x(s-1).y(i-1).attr("width",e+2).attr("height",e+2).attr("rx",e/2);h.stop().animate(250,250).ease("in").x(s).y(i).attr("width",e).attr("height",e).attr("rx",e/2).meanwhile(function(){if(typeof n!=="undefined"&&n!==null){n.remove();n=null}})},"removeannoationtext",false)}a._annotation_grape=o;o._reference_annotation_element=a;this._properties.view.classify(o,"annotation");this.annotationgroup.push(o);o._label_highlight_id=a._highlight_id;o._highlight_ids=a._highlight_ids;this.filterWrapper(o,null,a._row);return o};graphica.Elements.fn.makedraggable=function(c){if(this.mark==graphica.NONE_SHAPE){return false}var b=this;var a;c.drag(function(d){d.stopPropagation();if(typeof d.clientX!=="undefined"){a={x:d.clientX,y:d.clientY}}this.toFront();return false},function(k){if(typeof a=="undefined"){a={x:k.clientX,y:k.clientY}}if(window._highlightOFF_timeout){clearTimeout(window._highlightOFF_timeout);window._highlightOFF_timeout=null}var d={x:k.clientX,y:k.clientY};var j=a.x-d.x;var i=a.y-d.y;var f=c.scale();var h=c.x()-j*f;var g=c.y()-i*f;h=Math.min(Math.max(b._frame._dataspace.x,h),b._frame._dataspace.x+b._frame._dataspace.width);g=Math.min(Math.max(b._frame._dataspace.y,g),b._frame._dataspace.y+b._frame._dataspace.height);c.x(h);c.y(g);a={x:k.clientX,y:k.clientY};if(b._properties.view.tlp){b._properties.view.tlp.tooltip.stop();b._properties.view.tlp.tooltip.hide();b._properties.view.tlp.tooltip.opacity(0)}if(c._labelsgroup){c._labelsgroup.automatic_placement(b.gr.scale());c._labelsgroup.check_overlapping()}if(c.graphNode&&b._frame._show_edges){c.graphNode.eachEdge(function(){this.redrawaslink()})}if(c._annotation_grape){c._annotation_grape._update_position()}if(b._properties.convex_hull){b.redrawDistributionPlot()}},function(d){if(c.graphNode&&b._frame._show_edges&&b._properties.vpedges.edge_form==graphica.EDGE_BUNDLING){b._frame.graphObj.EdgePathBundling(b._properties.vpedges.edge_bundling_on);c.graphNode.eachEdge(function(){this.redrawaslink()})}if(this.graphNode){if(typeof b._properties.view._update_after_nodedrag!=="undefined"){b._properties.view._update_after_nodedrag()}}b.redrawDistributionPlot()})};graphica.Elements.fn.getHighlightID=function(b,a){a=a||this._dataset;if(this._properties.view.highlight_same_color_elements_on_hover==false||this._properties.countVariables(graphica.HUE)==0||a.isCategorical(this._properties.firstVariable(graphica.HUE))==false){return raceme._generateId()}return a.getValue(b,this._properties.firstVariable(graphica.HUE))};window.graphica=window.graphica||{};graphica.Frame=function(b,a,c,d,e){this._dataset=d||b._ds;this._properties=b;this._width=raceme.dV(a,1280);this._height=raceme.dV(c,800);this._title="";this._legend_width=0;this.zoomable=true;this.zoom_auto_focus=true;this._isforscreenshot=e;this.gr=new Grape();this._frame_type="0x0";this._subframe_type="";this._multiple_variable_frames=["1Cx2","2x1C","Nx1C","1CxN","2CxN","Nx2C"];this.axis_x=null;this.axis_x2=null;this.axis_y=null;this.axis_y2=null;this.hide_axis_x=false;this.hide_axis_y=false;this.hide_axis_x2=false;this.hide_axis_y2=false;this.naxis_y=[];this.naxis_x=[];this.all_n_variables=[];this.is_axis_x_interval=false;this.is_axis_y_interval=false;this.multiple_var=null;this.second_multiple_var=null;this._show_edges=true;this._show_map=true;this._geo_variable=null;this._title_size=24;this._title_color="black";this._background_image="";this._left_padding=32;this._top_padding=32;this._right_padding=32;this._bottom_padding=32;this._category_padding=16;this._framespace={x:0,y:0,width:this._width,height:this._height};this._dataspace={x:0,y:0,width:this._width,height:this._height};this._categorical_matrix={};this._map=null;this._map_projection="mercator";this._map_division="country";this._default_map_color="rgb(200,200,200)";this._default_map_border=1;this._default_map_border_color="white";this._map_border_only_in_regions_with_data=false;this._map_border_only_in_selected_country="";this._default_map_opacity=1;this._floating_legend=false;this._legend_position="right";this._sub_frames=[];this._sub_frames_keys={};this._is_subframe=false;this._parent_frame=null;this._quantitative_bar_variables=[];this.reference_vars={multiple_elements_per_frame:true};this._include_interaction=true;this._is_vertical_labels_allowed=true};graphica.Frame.fn=graphica.Frame.prototype;graphica.Frame.fn.init=function(){var q=this;var x=this._properties;this._framespace.height-=(this._top_padding+this._bottom_padding);this._framespace.width-=(this._left_padding+this._right_padding);this._framespace.x+=this._left_padding;this._framespace.y+=this._top_padding;var ah=new Grape().enableEvents(false);if(this._background_image!=""){ah.addTo(this.gr)}if(this._title!=""){var u=new Grape().x(this._framespace.x).y(this._framespace.y);var aQ;if(this._is_subframe){aQ=raceme.label(this._title,0,1,this._title_color,this._title_size,"left","top",1,"")}else{aQ=raceme.paragraph(this._title,0,1,this._title_color,this._title_size,"left","top",1,"",this._framespace.width)}aQ.addTo(u);if(typeof this._title_font=="string"){aQ.style("font-family",this._title_font)}var aR=aQ.getBBox();u.addChild(aQ.getClip(new Grape("rect","svg").width(this._framespace.width).height(aR.height+this._title_size/2)));if(u.pixi){var s=new PIXI.Graphics();s.beginFill(16724736);s.drawRect(this._framespace.x,this._framespace.y,this._framespace.width,aR.height+this._title_size/2);s.endFill();u.pixi.mask=s}if(this._is_subframe==false){u._chart_label=this._title;x.view.classify(u,"chart title")}else{if(this._parent_frame=="multiple"&&typeof this._alias_option_original_value!=="undefined"){u._alias_option_original_value=this._alias_option_original_value;u._alias_option_alias_value=this._alias_option_alias_value;u._alias_option_variable=this._alias_option_variable;u._alias_option_property="MULTIPLES";x.view.classify(u,"axis/legend label")}}this.gr.addChild(u);u.enableEvents(true);this._framespace.height-=(aR.height+this._title_size/2);this._framespace.y+=(aR.height+this._title_size/2)}var B=x.countVariables(graphica.POS_X);var l=x.countVariables(graphica.POS_Y);if(B>0){this._var_x=x.firstVariable(graphica.POS_X);this._var_x_settings=x.getSettings(this._var_x,graphica.POS_X);if(B>1){this._var_x2=x.secondVariable(graphica.POS_X);this._var_x2_settings=x.getSettings(this._var_x2,graphica.POS_X)}}if(l>0){this._var_y=x.firstVariable(graphica.POS_Y);this._var_y_settings=x.getSettings(this._var_y,graphica.POS_Y);if(l>1){this._var_y2=x.secondVariable(graphica.POS_Y);this._var_y2_settings=x.getSettings(this._var_y2,graphica.POS_Y)}}if(x.legends_to_include.length>0&&!this._is_subframe&&!this._isforscreenshot){this.legends_grape=new Grape();var e=new Grape();var I=0;var E=0;for(var Q=0;Q<x.legends_to_include.length;Q++){var aL,af;if(this._legend_position=="auto"){aL=new graphica.Legend(this._properties,x.legends_to_include[Q]);af=new graphica.Legend(this._properties,x.legends_to_include[Q],this._framespace.width);aL=aL.getGrape().y(I);aL.addTo(this.legends_grape);I+=aL.getBBox().height+20;af=af.getGrape().y(E);af.addTo(e);E+=af.getBBox().height+20}else{if(this._legend_position=="bottom"){aL=new graphica.Legend(this._properties,x.legends_to_include[Q],this._framespace.width)}else{aL=new graphica.Legend(this._properties,x.legends_to_include[Q])}aL=aL.getGrape().y(I);aL.addTo(this.legends_grape);I+=aL.getBBox().height+20}}this.legends_grape.y(this._framespace.y);var aU;if(this._legend_width==0){aU=this.legends_grape.getBBox()}else{aU={width:this._legend_width,height:this._legend_width}}if(this._legend_position=="auto"){var ax=this._framespace.width*this._framespace.height;var ab=aU.width*this._framespace.height;var a=e.getBBox().height*this._framespace.width;if(ax-ab<ax-a||aU.height>this._framespace.height){this._legend_position="bottom";this.legends_grape=e;aU=this.legends_grape.getBBox()}else{this._legend_position="right"}}if(this._legend_position=="right"){this.legends_grape.x(this._framespace.x+this._framespace.width-aU.width);if(this._floating_legend==false){this._framespace.width-=(aU.width+10)}}else{if(this._legend_position=="bottom"){this.legends_grape.y(this._framespace.y+this._framespace.height-aU.height);this.legends_grape.x(this._left_padding);if(this._floating_legend==false){this._framespace.height-=(aU.height+20)}}}this.legends_grape.addTo(this.gr)}else{x.legends_to_include.length=0}if((l==1||l==2)&&this._dataset.isCategorical(this._var_y)&&!(this._var_y_settings.show_labels===false)&&this._is_subframe==false&&this._parent_frame!="multiple"&&x.countVariables(graphica.SMALL_MULTIPLES)==0){var X=this._var_y_settings.labels_size||14;var O=this._dataset.unique(this._var_y).length;var aV=X*1.8*O;if(l==2&&this._dataset.isCategorical(this._var_y2)&&B>0&&!(this._var_y2_settings.show_labels===false)){var R=this._dataset.unique(this._var_y2).length;X=this._var_y2_settings.labels_size||14;if(this._dataset.isHierarchicalRelationship(this._var_y,this._var_y2)){aV=X*1.8*(R)}else{aV=X*1.8*(O*R)}}if(this._var_x_settings&&this._var_x_settings.padding){aV+=this._var_x_settings.padding}if(x.legends_to_include.length&&this._legend_position=="bottom"){aV+=aU.height}if(aV>this._framespace.height){var r=this._height-this._framespace.height;this._framespace.height=aV;this._height=this._framespace.height+r;if(x.legends_to_include.length&&this._legend_position=="bottom"){this.legends_grape.y(this._framespace.y+this._framespace.height)}}}if((B==1||B==2)&&this._dataset.isCategorical(this._var_x)&&!(this._var_x_settings.show_labels===false)&&this._is_subframe==false&&this._parent_frame!="multiple"&&x.countVariables(graphica.SMALL_MULTIPLES)==0){var X=this._var_x_settings.labels_size||14;var P=this._dataset.unique(this._var_x).length;var W=X*1.8*P;if(B==2&&this._dataset.isCategorical(this._var_x2)&&l>0&&!(this._var_x2_settings.show_labels===false)){var ak=this._dataset.unique(this._var_x2).length;X=this._var_x2_settings.labels_size||14;if(this._dataset.isHierarchicalRelationship(this._var_x,this._var_x2)){W=X*1.8*(ak)}else{W=X*1.8*(P*ak)}}if(this._var_y_settings&&this._var_y_settings.padding){W+=this._var_y_settings.padding}if(x.legends_to_include.length&&this._legend_position=="right"){W+=aU.width}if(W>this._framespace.width){var r=this._width-this._framespace.width;this._framespace.width=W;this._width=this._framespace.width+r;if(x.legends_to_include.length&&this._legend_position=="right"){this.legends_grape.x(this._framespace.x+this._framespace.width)}}}this._frame_type=x._frame_type;this._subframe_type=x._subframe_type;if(this._frame_type=="multiple"){var at;if(l==1&&x.getSettings(x.firstVariable(graphica.POS_Y),graphica.POS_Y,"show_title")==true){at=new graphica.Axis(x,x.firstVariable(graphica.POS_Y),"vertical").length(this._framespace.height);this.applyDefaultsToAxis(at,"y",x.getSettings(x.firstVariable(graphica.POS_Y),graphica.POS_Y),true);at._show_line=false;at._show_ticks=false;at._show_labels=false;at._legend_orientation="vertical";at.init();var aA=at.getWidth();var ar;if(at._orientation_reversed){ar=this._framespace.x+this._framespace.width-aA}else{ar=this._framespace.x+aA;this._framespace.x+=aA}at.getGrape().x(ar).y(this._framespace.y).addTo(this.gr);this._framespace.width-=aA}if(B==1&&x.getSettings(x.firstVariable(graphica.POS_X),graphica.POS_X,"show_title")==true){at=new graphica.Axis(x,x.firstVariable(graphica.POS_X),"horizontal").length(this._framespace.width);this.applyDefaultsToAxis(at,"x",x.getSettings(x.firstVariable(graphica.POS_X),graphica.POS_X),true);at._show_line=false;at._show_ticks=false;at._show_labels=false;at.init();var J=at.getHeight();var aq=this._framespace.y+this._framespace.height-J;if(at._orientation_reversed){aq=this._framespace.y+J;this._framespace.y+=J}at.getGrape().x(this._framespace.x).y(aq).addTo(this.gr);this._framespace.height-=J}}this._dataspace.x=this._framespace.x;this._dataspace.y=this._framespace.y;this._dataspace.width=this._framespace.width;this._dataspace.height=this._framespace.height;if(this._parent_frame!="multiple"){var au;var aT=x.allVariables(graphica.POS_X);var aS=x.allVariables(graphica.POS_Y);if(x.Mark()==graphica.AREALINE&&((aT.length>1&&aS.length==0)||(aT.length==0&&aS.length>1))){this._tmp_grouped_max={};if(x.countVariables(graphica.AREA)>0){this._quantitative_bar_variable=x.firstVariable(graphica.AREA)}else{this._quantitative_bar_variable=this._dataset.header.getId("graphica.com.frequency")}this.all_n_variables=(aT.length>1)?x.allVariables(graphica.POS_X):x.allVariables(graphica.POS_Y);for(var Q=0;Q<this.all_n_variables.length;Q++){var g=this.all_n_variables[Q];if(this._dataset.isQuantitative(g)){var d=this._properties.getSettings(g,(aT.length>1)?graphica.POS_X:graphica.POS_Y,"aggregation");this._tmp_grouped_max[this._dataset.columnName(g)]={_tmp_max_by_categories:{},_tmp_localmax_by_categories:{},_bar_max_value:Math.max(this._dataset.sum(g,d),0),_bar_min_value:Math.min(0,this._dataset.min(g,d))}}}}else{var U=(x.Mark()==graphica.CIRCLE&&this._multiple_variable_frames.includes(this._frame_type)==false&&this._multiple_variable_frames.includes(this._subframe_type)==false);this._quantitative_bar_variables=[];var ay=[];this._previous_categorical_bar_variables=[];this._previous_categorical_bar_variables_aggregation=[];if(x.countVariables(graphica.SMALL_MULTIPLES)>0){this._previous_categorical_bar_variables.push(x.firstVariable(graphica.SMALL_MULTIPLES));this._previous_categorical_bar_variables_aggregation.push(x.getSettings(x.firstVariable(graphica.SMALL_MULTIPLES),graphica.SMALL_MULTIPLES,"aggregation"))}if(x.countVariables(graphica.UNIT)>0&&U){this._previous_categorical_bar_variables.push(x.firstVariable(graphica.UNIT));this._previous_categorical_bar_variables_aggregation.push(x.getSettings(x.firstVariable(graphica.UNIT),graphica.UNIT,"aggregation"))}for(var G=0;G<aT.length;G++){au=aT[G];if(this._dataset.isCategorical(au)||this._dataset.isDateType(au)||(this._dataset.isQuantitative(au)&&aT.length==1&&aS.length==1&&this._dataset.header.names[aS[0]]=="graphica.com.frequency"&&this._dataset.header.names[au]!="graphica.com.frequency")){if(G==aT.length-1&&typeof this._categorical_bar_variable==="undefined"){this._categorical_bar_variable=au;this._categorical_bar_variable_aggregation=x.getSettings(this._categorical_bar_variable,graphica.POS_X,"aggregation")}else{if(au!==this._categorical_bar_variable){this._previous_categorical_bar_variables.push(au);this._previous_categorical_bar_variables_aggregation.push(x.getSettings(au,graphica.POS_X,"aggregation"))}}}else{if(x.Mark(au)==graphica.BAR||x.Mark(au)==graphica.AREALINE||U){this._quantitative_bar_variables.push(au);ay.push(graphica.POS_X);if(G==aT.length-1&&typeof this._quantitative_bar_variable==="undefined"&&(x.Mark(au)==graphica.BAR||x.Mark(au)==graphica.AREALINE)){this._quantitative_bar_variable=au}}}}for(G=0;G<aS.length;G++){au=aS[G];if(this._dataset.isCategorical(au)||this._dataset.isDateType(au)||(this._dataset.isQuantitative(au)&&aT.length==1&&aS.length==1&&this._dataset.header.names[aT[0]]=="graphica.com.frequency"&&this._dataset.header.names[au]!="graphica.com.frequency")){if(G==aS.length-1&&typeof this._categorical_bar_variable==="undefined"){this._categorical_bar_variable=au;this._categorical_bar_variable_aggregation=x.getSettings(this._categorical_bar_variable,graphica.POS_Y,"aggregation")}else{if(au!==this._categorical_bar_variable){this._previous_categorical_bar_variables.push(au);this._previous_categorical_bar_variables_aggregation.push(x.getSettings(au,graphica.POS_Y,"aggregation"))}}}else{if(x.Mark(au)==graphica.BAR||x.Mark(au)==graphica.AREALINE||U){this._quantitative_bar_variables.push(au);ay.push(graphica.POS_Y);if(G==aS.length-1&&typeof this._quantitative_bar_variable==="undefined"&&(x.Mark(au)==graphica.BAR||x.Mark(au)==graphica.AREALINE)){this._quantitative_bar_variable=au}}}}if(U&&x.countVariables(graphica.SUBDIVISION)>0){if(typeof this._categorical_bar_variable=="undefined"){this._categorical_bar_variable=x.firstVariable(graphica.SUBDIVISION);this._categorical_bar_variable_aggregation=x.getSettings(this._categorical_bar_variable,graphica.SUBDIVISION,"aggregation")}else{this._previous_categorical_bar_variables.push(this._categorical_bar_variable);this._previous_categorical_bar_variables_aggregation.push(this._categorical_bar_variable_aggregation);this._categorical_bar_variable=x.firstVariable(graphica.SUBDIVISION);this._categorical_bar_variable_aggregation=x.getSettings(x.firstVariable(graphica.SUBDIVISION),"aggregation")}}else{if(U&&x.countVariables(graphica.HUE)>0){if(typeof this._categorical_bar_variable=="undefined"){this._categorical_bar_variable=x.firstVariable(graphica.HUE);this._categorical_bar_variable_aggregation=x.getSettings(this._categorical_bar_variable,graphica.HUE,"aggregation")}else{this._previous_categorical_bar_variables.push(this._categorical_bar_variable);this._previous_categorical_bar_variables_aggregation.push(this._categorical_bar_variable_aggregation);this._categorical_bar_variable=x.firstVariable(graphica.HUE);this._categorical_bar_variable_aggregation=x.getSettings(x.firstVariable(graphica.HUE),"aggregation")}}}if(this._previous_categorical_bar_variables.length>0&&typeof this._categorical_bar_variable=="undefined"){this._categorical_bar_variable=this._previous_categorical_bar_variables.pop();this._categorical_bar_variable_aggregation=this._previous_categorical_bar_variables_aggregation.pop()}if(this._previous_categorical_bar_variables.length==0&&(U&&x.circle_chart_type=="radar")&&x.countVariables(graphica.HUE)>0){this._previous_categorical_bar_variables.push(x.firstVariable(graphica.HUE));this._previous_categorical_bar_variables_aggregation.push(x.getSettings(x.firstVariable(graphica.HUE),graphica.HUE,"aggregation"))}if(typeof this._quantitative_bar_variable==="undefined"){if(x.all_quantitative_axis_variables.length&&this._quantitative_bar_variables.length){this._quantitative_bar_variable=this._quantitative_bar_variables[0]}else{if(x.countVariables(graphica.AREA)>0&&(x.Mark(x.firstVariable(graphica.AREA))==graphica.BAR||x.Mark(x.firstVariable(graphica.AREA))==graphica.AREALINE||U)){this._quantitative_bar_variable=x.firstVariable(graphica.AREA);this._quantitative_bar_variables[0]=this._quantitative_bar_variable;ay[0]=graphica.AREA}else{if(x.Mark(this._dataset.header.getId("graphica.com.frequency"))==graphica.BAR||x.Mark(this._dataset.header.getId("graphica.com.frequency"))==graphica.AREALINE||U){this._quantitative_bar_variable=this._dataset.header.getId("graphica.com.frequency");this._quantitative_bar_variables[0]=this._quantitative_bar_variable}}}}if(typeof this._quantitative_bar_variable!="undefined"){var d=this._properties.getSettings(this._quantitative_bar_variables[0],ay[0],"aggregation");if(this._quantitative_bar_variables.length>1){this._tmp_grouped_max={};for(var Q=0;Q<this._quantitative_bar_variables.length;Q++){var d=this._properties.getSettings(this._quantitative_bar_variables[Q],ay[Q],"aggregation");var aF=this._properties.getDataset(this._quantitative_bar_variables[Q]).maxByCategories(this._previous_categorical_bar_variables.concat([this._categorical_bar_variable]),this._previous_categorical_bar_variables_aggregation.concat([this._categorical_bar_variable_aggregation]),this._quantitative_bar_variables[Q],d);this._tmp_grouped_max[this._dataset.columnName(this._quantitative_bar_variables[Q])]={_tmp_max_by_categories:aF.taxonomy,_tmp_localmax_by_categories:aF.taxonomyMaxMin,_bar_max_value:aF.max,_bar_min_value:aF.min}}}else{if(this._previous_categorical_bar_variables.length>0){var aF=this._dataset.maxByCategories(this._previous_categorical_bar_variables.concat([this._categorical_bar_variable]),this._previous_categorical_bar_variables_aggregation.concat([this._categorical_bar_variable_aggregation]),this._quantitative_bar_variable,d);this._tmp_max_by_categories=aF.taxonomy;this._tmp_localmax_by_categories=aF.taxonomyMaxMin;this._bar_max_value=aF.max;this._bar_min_value=aF.min}else{if(typeof this._categorical_bar_variable!=="undefined"){var aF=this._dataset.maxByCategories([this._categorical_bar_variable],[this._categorical_bar_variable_aggregation],this._quantitative_bar_variable,d);this._tmp_max_by_categories=aF.taxonomy;this._tmp_localmax_by_categories=aF.taxonomyMaxMin;this._bar_max_value=aF.max;this._bar_min_value=aF.min}else{this._bar_max_value=Math.max(this._dataset.sum(q._quantitative_bar_variable,d),0);this._bar_min_value=Math.min(0,this._dataset.min(q._quantitative_bar_variable,d))}}}}}}this._tmp_categorical_bars_areas={};if(x._synchronize_axis){if(this._frame_type=="Nx1C"||this._frame_type=="2x1C"||this._frame_type=="Nx2C"){var D=x.allVariables(graphica.POS_X);for(var M=0;M<D.length;M++){var n;var L;if(x.getSettings(D[M],graphica.POS_X,"min")!==null){n=x.getSettings(D[M],graphica.POS_X,"min")}else{n=this._dataset.min(D[M],x.getSettings(D[M],graphica.POS_X,"aggregation"));if(this.isQuantitativeBarVariable(D[M])){n=Math.min(n,0)}}if(typeof x.shared_min==="undefined"){x.shared_min=n}else{x.shared_min=Math.min(x.shared_min,n)}if(x.getSettings(D[M],graphica.POS_X,"max")!==null){L=x.getSettings(D[M],graphica.POS_X,"max")}else{L=this._dataset.max(D[M],x.getSettings(D[M],graphica.POS_X,"aggregation"))}if(typeof x.shared_max==="undefined"){x.shared_max=L}else{x.shared_max=Math.max(x.shared_max,L)}}}else{if(this._frame_type=="1CxN"||this._frame_type=="1Cx2"||this._frame_type=="2CxN"){var m=x.allVariables(graphica.POS_Y);for(var M=0;M<m.length;M++){if(x.getSettings(m[M],graphica.POS_Y,"min")!==null){n=x.getSettings(m[M],graphica.POS_Y,"min")}else{n=this._dataset.min(m[M],x.getSettings(m[M],graphica.POS_Y,"aggregation"));if(this.isQuantitativeBarVariable(m[M])){n=Math.min(n,0)}}if(typeof x.shared_min==="undefined"){x.shared_min=n}else{x.shared_min=Math.min(x.shared_min,n)}if(x.getSettings(m[M],graphica.POS_Y,"max")!==null){L=x.getSettings(m[M],graphica.POS_Y,"max")}else{L=this._dataset.max(m[M],x.getSettings(m[M],graphica.POS_Y,"aggregation"))}if(typeof x.shared_max==="undefined"){x.shared_max=L}else{x.shared_max=Math.max(x.shared_max,L)}}}}}if(this._dataset.edges){var V=(typeof this._properties.view._settings.general.pruning=="boolean"&&this._properties.view._settings.general.pruning==true);if(!this._properties.circular_layout&&this._properties.view._settings.graphObj&&this._properties.view._settings.graphObj.node_number==this._dataset.length&&this._properties.view._settings.graphObj._last_grouped_columns==this._dataset._last_grouped_columns&&typeof this._properties.view._settings.graphObj._last_pruning==="boolean"&&this._properties.view._settings.graphObj._last_pruning==V&&this._parent_frame!="multiple"){this.graphObj=this._properties.view._settings.graphObj}else{if(!this._is_subframe||this._parent_frame=="multiple"||this._parent_frame=="0x1C"||this._parent_frame=="1Cx0"||this._parent_frame=="1Cx1C"){this.graphObj=new graphica.GraphModel();if(typeof this._subdataset!=="undefined"&&this._subdataset!==null){this.graphObj.init(this._subdataset,this._subdataset.edges)}else{this.graphObj.init(this._dataset,this._dataset.edges)}if(typeof this._properties.view._settings.general.pruning=="boolean"&&V){this.graphObj.pfnet(true);this.graphObj._last_pruning=true}else{this.graphObj._last_pruning=false}this.graphObj._last_grouped_columns=this._dataset._last_grouped_columns;if(this._properties.view._settings.graph_positions){this.graphObj.eachNode(function(){if(typeof q._properties.view._settings.graph_positions[this.id]!=="undefined"){this._layoutPosX=q._properties.view._settings.graph_positions[this.id].x;this._layoutPosY=q._properties.view._settings.graph_positions[this.id].y}})}this._properties.view._settings.graphObj=this.graphObj}}}if(this._frame_type=="multiple"){this.divideFrame(x.firstVariable(graphica.SMALL_MULTIPLES));if(this._subframe_type=="1CxN"||this._subframe_type=="1Cx2"||this._subframe_type=="2CxN"){this.all_n_variables=x.allVariables(graphica.POS_Y)}else{if(this._subframe_type=="Nx1C"||this._subframe_type=="2x1C"||this._subframe_type=="Nx2C"){this.all_n_variables=x.allVariables(graphica.POS_X)}}}else{if(this._frame_type=="map"){this._geo_variable=x.firstVariable(graphica.UNIT);var t=false;if(x.countVariables(graphica.AREA)>0&&x.countVariables(graphica.SHAPE)==0&&x.default_form==graphica.GEO_SHAPE){t=true}this._map=new graphica.Geo.Map(this._dataspace,this,t,this._show_map,(this._dataset.columnType(this._properties.firstVariable(graphica.UNIT))=="geo.country")?"country":"state");this._map._default_color=this._default_map_color;this._map._default_border=this._default_map_border;this._map._default_border_color=this._default_map_border_color;this._map._map_border_only_in_regions_with_data=this._map_border_only_in_regions_with_data;this._map._default_opacity=this._default_map_opacity;this._map.init(function(){if(q.labelsgr&&q.labelsgr._force_redraw){for(var j=0;j<q.labelsgroup.length;j++){var h=q._dataspace.x+this.root.x()+q.labelsgroup.item(j)._refelm._form_data.x()*this.ratio;var c=q._dataspace.y+this.root.y()+q.labelsgroup.item(j)._refelm._form_data.y()*this.ratio;q.labelsgroup.item(j)._refelm._form_data.x(h).y(c)}q.labelsgr._force_redraw()}if(q.grAnnotations&&q.grAnnotations.length){q.grAnnotations.getChildren().each(function(){this._update_position()})}})}else{if(this._frame_type=="0x0"){this._categorical_matrix._x_cell_width=this._dataspace.width;this._categorical_matrix._y_cell_width=this._dataspace.height;this.getCategoricalMatrix()}else{if(this._frame_type=="mapXY"){this._map=new graphica.Geo.Map(this._dataspace,this,t,this._show_map,(this._map_division=="state")?"state":"country");this._map._default_color=this._default_map_color;this._map._default_border=this._default_map_border;this._map._default_border_color=this._default_map_border_color;this._map._default_opacity=this._default_map_opacity;this._map._map_border_only_in_selected_country=this._map_border_only_in_selected_country;this._map.init()}else{if(this._frame_type=="1x0"||this._frame_type=="1Cx0"){this.axis_x=new graphica.Axis(x,this._var_x,"horizontal").length(this._framespace.width);this.axis_x._is_vertical_labels_allowed=this._is_vertical_labels_allowed;this.applyDefaultsToAxis(this.axis_x,"x",x.getSettings(this._var_x,graphica.POS_X));var J=Math.min(this.axis_x.getHeight(),this._framespace.height*0.75);var aq=this._framespace.y+this._framespace.height-J;if(this.axis_x._orientation_reversed){aq=this._framespace.y+J}this.axis_x.getGrape().x(this._framespace.x).y(aq).addTo(this.gr);this._dataspace.height=this._framespace.height-J;if(this.axis_x._orientation_reversed){this._dataspace.y+=J}if(this.axis_x._show_grid_lines){this.gr.addChild(this.axis_x.getGridLines(this._dataspace))}if(this._frame_type=="1Cx0"){this.divideFrame(this.axis_x._variable)}}else{if(this._frame_type=="0x1"||this._frame_type=="0x1C"){this.axis_y=new graphica.Axis(x,this._var_y,"vertical").length(this._framespace.height);this.applyDefaultsToAxis(this.axis_y,"y",x.getSettings(this._var_y,graphica.POS_Y));var aA;if(this._frame_type=="0x1C"){aA=Math.min(this.axis_y.getWidth()+this.axis_y.padding_poslabel,this._framespace.width*0.75)}else{aA=Math.min(this.axis_y.getWidth(),this._framespace.width*0.75)}var ar=this._framespace.x+aA;if(this.axis_y._orientation_reversed){ar=this._framespace.x+this._framespace.width-aA}this.axis_y.getGrape().y(this._framespace.y).x(ar).addTo(this.gr);this._dataspace.width=this._framespace.width-aA;this._dataspace.x=this._framespace.x+aA;if(this.axis_y._orientation_reversed){this._dataspace.x=this._framespace.x}this._dataspace.y=this._framespace.y+this.axis_y._y_origin;this._dataspace.height=this._framespace.height-this.axis_y._y_origin;if(this.axis_y._show_grid_lines){this.gr.addChild(this.axis_y.getGridLines(this._dataspace))}if(this._frame_type=="0x1C"){this.divideFrame(this.axis_y._variable)}}else{if(this._frame_type=="1x1"||this._frame_type=="1Cx1C"||this._frame_type=="1Cx1"||this._frame_type=="1x1C"){if(this._frame_type=="1x1"&&q._properties.default_form==graphica.BAR){if(this._var_x==this._dataset.header.getId("graphica.com.frequency")&&this._var_y!=this._dataset.header.getId("graphica.com.frequency")){this.is_axis_y_interval=true}else{if(this._var_x!=this._dataset.header.getId("graphica.com.frequency")&&this._var_y==this._dataset.header.getId("graphica.com.frequency")){this.is_axis_x_interval=true}}}this.axis_x=new graphica.Axis(x,this._var_x,"horizontal").length(this._framespace.width);this.axis_x._is_vertical_labels_allowed=this._is_vertical_labels_allowed;this.applyDefaultsToAxis(this.axis_x,"x",this._var_x_settings);let is_vertical_labels_allowed=(this.axis_x._is_vertical_labels_allowed&&this._is_vertical_labels_allowed);var J=Math.min(this.axis_x.getHeight(),this._framespace.height*0.75);this.axis_y=new graphica.Axis(x,this._var_y,"vertical").length(this._framespace.height-J);this.applyDefaultsToAxis(this.axis_y,"y",this._var_y_settings,true);this.axis_y._is_interval=this.is_axis_y_interval;this.axis_y.init();var aA;if(this._frame_type=="1Cx1C"||this._frame_type=="1x1C"){aA=Math.min(this.axis_y.getWidth()+this.axis_y.padding_poslabel,this._framespace.width*0.75)}else{aA=Math.min(this.axis_y.getWidth(),this._framespace.width*0.75)}this.axis_x=new graphica.Axis(x,this._var_x,"horizontal").length(this._framespace.width-aA);this.axis_x._is_vertical_labels_allowed=is_vertical_labels_allowed;this.applyDefaultsToAxis(this.axis_x,"x",this._var_x_settings);this.axis_x._is_interval=this.is_axis_x_interval;var ar=this._framespace.x;var aq=this._framespace.y;if(this.axis_x._orientation_reversed==true){aq+=J}if(this.axis_y._orientation_reversed==false){ar+=aA}this._dataspace.x=ar;this._dataspace.y=aq+this.axis_y._y_origin;this._dataspace.width=this._framespace.width-aA;this._dataspace.height=this._framespace.height-J-this.axis_y._y_origin;if(this.axis_x._orientation_reversed==true){this.axis_x.getGrape().x(ar).y(aq).addTo(this.gr)}else{this.axis_x.getGrape().x(ar).y(aq+this._dataspace.height+this.axis_y._y_origin).addTo(this.gr)}if(this.axis_y._orientation_reversed==true){this.axis_y.getGrape().x(ar+this._dataspace.width).y(aq).addTo(this.gr)}else{this.axis_y.getGrape().x(ar).y(aq).addTo(this.gr)}if(this.axis_x._show_grid_lines){this.gr.addChild(this.axis_x.getGridLines(this._dataspace))}if(this.axis_y._show_grid_lines){this.gr.addChild(this.axis_y.getGridLines(this._dataspace))}if(this._frame_type=="1Cx1C"){this.divideFrame(this.axis_x._variable,this.axis_y._variable)}}else{if(this._frame_type=="2x2"){this.axis_x=new graphica.Axis(x,this._var_x,"horizontal").length(this._framespace.width).orientation_reversed(true);this.axis_x._is_vertical_labels_allowed=this._is_vertical_labels_allowed;let is_vertical_labels_allowed=this.axis_x._is_vertical_labels_allowed;this.applyDefaultsToAxis(this.axis_x,"x",this._var_x_settings);var aP=this.axis_x.getHeight();var aE=this.axis_x.getSpacePoint();this.axis_x2=new graphica.Axis(x,this._var_x2,"horizontal").length(aE);this.axis_x2._is_vertical_labels_allowed=this._is_vertical_labels_allowed;let Z=this.axis_x2._is_vertical_labels_allowed;this.applyDefaultsToAxis(this.axis_x2,"x2",this._var_x2_settings);var aO=this.axis_x2.getHeight();var J=aP+aO;this.axis_y=new graphica.Axis(x,this._var_y,"vertical").length(this._framespace.height-J);this.applyDefaultsToAxis(this.axis_y,"y",this._var_y_settings);var aA=this.axis_y.getWidth();var am=this.axis_y.getSpacePoint();this.axis_y2=new graphica.Axis(x,this._var_y2,"vertical").length(am).orientation_reversed(true);this.applyDefaultsToAxis(this.axis_y2,"y2",this._var_y2_settings);var p=this.axis_y2.getWidth();this.axis_x=new graphica.Axis(x,this._var_x,"horizontal").length(this._framespace.width-aA-p).orientation_reversed(true);this.axis_x._is_vertical_labels_allowed=is_vertical_labels_allowed;this.applyDefaultsToAxis(this.axis_x,"x",this._var_x_settings);aE=this.axis_x.getSpacePoint();this.axis_x2=new graphica.Axis(x,this._var_x2,"horizontal").length(aE);this.axis_x2._is_vertical_labels_allowed=Z;this.applyDefaultsToAxis(this.axis_x2,"x2",this._var_x2_settings);var ar=this._framespace.x;var aq=this._framespace.y;if(this.axis_x._orientation_reversed==true){aq+=aP}if(this.axis_x2._orientation_reversed==true){aq+=aO}if(this.axis_y._orientation_reversed==false){ar+=aA}if(this.axis_y2._orientation_reversed==false){ar+=p}this._dataspace.x=ar;this._dataspace.width=this._framespace.width-aA-p;this._dataspace.y=aq+this.axis_y2._y_origin;this._dataspace.height=this._framespace.height-aP-aO-this.axis_y2._y_origin;if(this.axis_x._orientation_reversed){if(this.axis_x2._orientation_reversed){this.axis_x.getGrape().x(this._dataspace.x).y(aq-aO).addTo(this.gr)}else{this.axis_x.getGrape().x(this._dataspace.x).y(aq).addTo(this.gr)}}else{if(this.axis_x2._orientation_reversed){this.axis_x.getGrape().x(this._dataspace.x).y(aq+this._dataspace.height+this.axis_y._y_origin).addTo(this.gr)}else{this.axis_x.getGrape().x(this._dataspace.x).y(aq+this._dataspace.height+this.axis_y._y_origin+aO).addTo(this.gr)}}if(this.axis_y._orientation_reversed==true){if(this.axis_y2._orientation_reversed){this.axis_y.getGrape().x(ar+this._dataspace.width+p).y(aq).addTo(this.gr)}else{this.axis_y.getGrape().x(ar+this._dataspace.width).y(aq).addTo(this.gr)}}else{this.axis_y.getGrape().x(this._framespace.x+aA).y(aq).addTo(this.gr)}am=(this._framespace.height-J)/this.axis_y._ticks;for(var K=0;K<this.axis_y._ticks;K++){var v=this.axis_y2.clone().getGrape();if(this.axis_y2._orientation_reversed){v.x(ar+this._dataspace.width)}else{v.x(ar)}var S=this._dataspace.y+this.axis_y._min_posicion+(K*am)+((am-this.axis_y.getSpacePoint())/2);v.y(S).addTo(this.gr);if(this.axis_y2._show_grid_lines){this.gr.addChild(this.axis_y2.getGridLines(this._dataspace).y(S).x(ar))}}aE=(this._framespace.width-aA-p)/this.axis_x._ticks;for(var K=0;K<this.axis_x._ticks;K++){var v;var T=ar+this.axis_x._min_posicion+(K*aE)+((aE-this.axis_x.getSpacePoint())/2);if(this.axis_x2._orientation_reversed==true){v=this.axis_x2.clone().getGrape().x(T).y(aq).addTo(this.gr)}else{v=this.axis_x2.clone().getGrape().x(T).y(aq+this._dataspace.height).addTo(this.gr)}if(this.axis_x2._show_grid_lines){this.gr.addChild(this.axis_x2.getGridLines(this._dataspace).y(aq).x(T))}}if(this.axis_x._show_grid_lines){this.gr.addChild(this.axis_x.getGridLines(this._dataspace))}if(this.axis_y._show_grid_lines){this.gr.addChild(this.axis_y.getGridLines(this._dataspace))}}else{if(this._frame_type=="1x2"||this._frame_type=="Nx2C"||this._frame_type=="Nx1C"){var aA=0;var p=0;var aj=0;var C=0;var az=(this._frame_type!="Nx1C"&&this._dataset.isHierarchicalRelationship(this._var_y,this._var_y2));var o=[this._var_x];if(this._frame_type=="Nx2C"||this._frame_type=="Nx1C"){this.all_n_variables=x.allVariables(graphica.POS_X);o=this.all_n_variables}var F=false;for(var Q=0;Q<o.length;Q++){if(x.getSettings(o[Q],graphica.POS_X,"orientation")=="top"){F=true;break}}if(az){this.axis_y=new graphica.Axis(x,this._var_y,"vertical",{child_variable:this._var_y2})}else{this.axis_y=new graphica.Axis(x,this._var_y,"vertical")}this.axis_y.length(this._framespace.height);this.applyDefaultsToAxis(this.axis_y,"y",this._var_y_settings);aA=this.axis_y.getWidth()+this.axis_y.padding_poslabel;var am=this.axis_y.getSpacePoint();if(this._frame_type!="Nx1C"){if(az){am=this.axis_y._length}this.axis_y2=new graphica.Axis(x,this._var_y2,"vertical").length(am);this.applyDefaultsToAxis(this.axis_y2,"y2",this._var_y2_settings,true);this.axis_y2._show_legend=false;this.axis_y2.init();p=this.axis_y2.getWidth()+this.axis_y2.padding_poslabel}var A=(this._framespace.width-aA-p)/o.length;var ar=this._framespace.x;if(!this.axis_y._orientation_reversed){ar=this._framespace.x+aA}if(this._frame_type!="Nx1C"&&!this.axis_y2._orientation_reversed){ar=this._framespace.x+p}for(var Q=0;Q<o.length;Q++){let axisx=new graphica.Axis(x,o[Q],"horizontal").length(A);axisx._is_vertical_labels_allowed=false;this.applyDefaultsToAxis(axisx,"x",x.getSettings(o[Q],graphica.POS_X));this.naxis_x.push(axisx);if(axisx._orientation_reversed==false){aj=Math.max(aj,axisx.getHeight())}else{C=Math.max(C,axisx.getHeight())}}if(o.length==1){this.axis_x=this.naxis_x[0]}if(az){this.axis_y=new graphica.Axis(x,this._var_y,"vertical",{child_variable:this._var_y2})}else{this.axis_y=new graphica.Axis(x,this._var_y,"vertical")}this.axis_y.length(this._framespace.height-C-aj);this.applyDefaultsToAxis(this.axis_y,"y",this._var_y_settings);aA=this.axis_y.getWidth()+this.axis_y.padding_poslabel;if(this._frame_type!="Nx1C"){var am=this.axis_y.getSpacePoint();if(az){am=this.axis_y._length}this.axis_y2=new graphica.Axis(x,this._var_y2,"vertical").length(am);this.applyDefaultsToAxis(this.axis_y2,"y2",this._var_y2_settings,true);this.axis_y2._show_legend=false;this.axis_y2.init()}var ar=this._framespace.x;var aq=this._framespace.y+C;if(this.axis_y._orientation_reversed==false){ar+=aA}if(this._frame_type!="Nx1C"&&this.axis_y2._orientation_reversed==false){ar+=p}this._dataspace.x=ar;this._dataspace.width=Math.max(this._framespace.width-aA-p,10);this._dataspace.y=aq+this.axis_y._y_origin;this._dataspace.height=this._framespace.height-C-aj-this.axis_y._y_origin;for(var Q=0;Q<o.length;Q++){var al=this.naxis_x[Q].getGrape();if(this.naxis_x[Q]._orientation_reversed==false){al.y(this._framespace.y+this._framespace.height-aj)}else{al.y(this._framespace.y+C)}al.x(ar+Q*A).addTo(this.gr);if(this.naxis_x[Q]._show_grid_lines){this.gr.addChild(this.naxis_x[Q].getGridLines({x:ar+Q*A,y:this._framespace.y+this.axis_y._y_origin+C,width:A,height:this._framespace.height-aj-C-this.axis_y._y_origin}))}if(this._frame_type!="Nx1C"&&this.axis_y2._show_line&&Q>0){this.gr.lineStyle(1,this.axis_y2._axis_color).line(ar+Q*A,this._framespace.y+this._framespace.height-aj,ar+Q*A,this._framespace.y+this.axis_y._y_origin+C)}else{if(this._frame_type=="Nx1C"&&this.axis_y._show_line&&Q>0){this.gr.lineStyle(1,this.axis_y._axis_color).line(ar+Q*A,this._framespace.y+this._framespace.height-aj,ar+Q*A,this._framespace.y+this.axis_y._y_origin+C)}}}if(this.axis_y._orientation_reversed==true){this.axis_y.getGrape().x(this._framespace.x+this._framespace.width-aA).y(aq).addTo(this.gr)}else{this.axis_y.getGrape().x(this._framespace.x+aA).y(aq).addTo(this.gr)}if(this._frame_type!="Nx1C"){var aa=this._properties.getSettings(this.axis_y2._variable,"AXIS_Y","reversed");var y=this._properties.getSettings(this.axis_y2._variable,"AXIS_Y","reversed_on");var ad=this.axis_y2.clone();var aN=0;for(var K=0;K<this.axis_y._ticks;K++){let v;if(aa&&(!y||y=="all"||(y=="first"&&K==0)||(y=="last"&&K==this.axis_y._ticks-1)||(y=="odd"&&K%2==1)||(y=="even"&&K%2==0))){ad.reversed(true)}else{ad.reversed(false)}if(az){ad._hierarchical_data={parent_variable:this._var_y,parent_value:this.axis_y._ticks_values[K],child_variable:null,segments:null};ad.length(this.axis_y.getSpacePoint(this.axis_y._ticks_values[K]))}v=ad.clone();if(ad._orientation_reversed){v.getGrape().x(ar+this._dataspace.width)}else{v.getGrape().x(ar)}var aB=this._dataspace.y+this.axis_y.getPoint(this.axis_y._ticks_values[K])-this.axis_y.getSpacePoint(this.axis_y._ticks_values[K])/2;v.getGrape().y(aB).addTo(this.gr);if(ad._show_grid_lines){var ao=v.getGridLines(this._dataspace,aN);aN=ao._is_odd;ao.y(aB).x(ar);this.gr.addChild(ao)}this.naxis_y.push(v)}}if(this.axis_y._show_grid_lines){if(this._frame_type=="Nx2C"){this.axis_y.getGridLines({x:this._framespace.x,y:this._dataspace.y,height:this._dataspace.height,width:this._framespace.width}).addTo(this.gr).toBack()}else{this.gr.addChild(this.axis_y.getGridLines({x:this._dataspace.x,y:this._dataspace.y,height:this._dataspace.height,width:this._dataspace.width}))}}}else{if(this._frame_type=="2x1"||this._frame_type=="2CxN"||this._frame_type=="1CxN"){var J=0;var aG=0;var N=0;var H=0;var az=(this._frame_type!="1CxN"&&this._dataset.isHierarchicalRelationship(this._var_x,this._var_x2));var b=[this._var_y];if(this._frame_type=="2CxN"||this._frame_type=="1CxN"){this.all_n_variables=x.allVariables(graphica.POS_Y);b=this.all_n_variables}var ac=false;for(var Q=0;Q<b.length;Q++){if(x.getSettings(b[Q],graphica.POS_Y,"orientation")=="right"){ac=true;break}}if(az){this.axis_x=new graphica.Axis(x,this._var_x,"horizontal",{child_variable:this._var_x2})}else{this.axis_x=new graphica.Axis(x,this._var_x,"horizontal")}this.axis_x.length(this._framespace.width);this.axis_x._is_vertical_labels_allowed=this._is_vertical_labels_allowed;this.applyDefaultsToAxis(this.axis_x,"x",this._var_x_settings);var z=this.axis_x._is_vertical_labels_allowed;J=this.axis_x.getHeight();var aE=this.axis_x.getSpacePoint();if(this._frame_type!="1CxN"){if(az){aE=this.axis_x._length}this.axis_x2=new graphica.Axis(x,this._var_x2,"horizontal").length(aE);this.axis_x2._is_vertical_labels_allowed=this._is_vertical_labels_allowed;this.applyDefaultsToAxis(this.axis_x2,"x2",this._var_x2_settings,true);this.axis_x2._show_legend=false;this.axis_x2.init();var Z=this.axis_x2._is_vertical_labels_allowed;aG=this.axis_x2.getHeight()}var av=(this._framespace.height-J-aG)/b.length;var aq=this._framespace.y;if(!this.axis_x._orientation_reversed){aq=this._framespace.y+J}if(this._frame_type!="1CxN"&&!this.axis_x2._orientation_reversed){aq+=aG}for(var Q=0;Q<b.length;Q++){let axisy=new graphica.Axis(x,b[Q],"vertical").length(av);this.applyDefaultsToAxis(axisy,"y",x.getSettings(b[Q],graphica.POS_Y));this.naxis_y.push(axisy);if(axisy._orientation_reversed==false){N=Math.max(N,axisy.getWidth())}else{H=Math.max(H,axisy.getWidth())}}if(b.length==1){this.axis_y=this.naxis_y[0]}if(az){this.axis_x=new graphica.Axis(x,this._var_x,"horizontal",{child_variable:this._var_x2})}else{this.axis_x=new graphica.Axis(x,this._var_x,"horizontal")}this.axis_x.length(this._framespace.width-N-H);this.axis_x._is_vertical_labels_allowed=z;this.applyDefaultsToAxis(this.axis_x,"x",this._var_x_settings);var J=this.axis_x.getHeight();if(this._frame_type!="1CxN"){var aE=this.axis_x.getSpacePoint();if(az){aE=this.axis_x._length}this.axis_x2=new graphica.Axis(x,this._var_x2,"horizontal").length(aE);this.axis_x2._is_vertical_labels_allowed=Z;this.applyDefaultsToAxis(this.axis_x2,"x2",this._var_x2_settings,true);this.axis_x2._show_legend=false;this.axis_x2.init();var aG=this.axis_x2.getHeight()}var aq=this._framespace.y;var ar=this._framespace.x+N;if(this.axis_x._orientation_reversed){aq+=J}if(this._frame_type!="1CxN"&&this.axis_x2._orientation_reversed){aq+=aG}this._dataspace.y=aq;this._dataspace.height=Math.max(this._framespace.height-J-aG,10);this._dataspace.x=ar+this.axis_x._x_origin;this._dataspace.width=this._framespace.width-N-H-this.axis_x._x_origin;for(var Q=0;Q<b.length;Q++){var al=this.naxis_y[Q].getGrape();if(this.naxis_y[Q]._orientation_reversed){al.x(this._framespace.x+this._framespace.width-H)}else{al.x(this._framespace.x+N)}al.y(aq+Q*av).addTo(this.gr);if(this.naxis_y[Q]._show_grid_lines){this.gr.addChild(this.naxis_y[Q].getGridLines({y:aq+Q*av,x:this._framespace.x+this.axis_x._x_origin+N,height:av,width:this._framespace.width-H-N-this.axis_x._x_origin}))}if(this._frame_type!="1CxN"&&this.axis_x2._show_line&&Q>0){this.gr.lineStyle(1,this.axis_x2._axis_color).line(this._framespace.x+this._framespace.width-H,aq+Q*av,this._framespace.x+this.axis_x2._x_origin+N,aq+Q*av)}else{if(this._frame_type=="1CxN"&&this.axis_x._show_line&&Q>0){this.gr.lineStyle(1,this.axis_x._axis_color).line(this._framespace.x+this._framespace.width-H,aq+Q*av,this._framespace.x+this.axis_x._x_origin+N,aq+Q*av)}}}if(this.axis_x._orientation_reversed==false){this.axis_x.getGrape().y(this._framespace.y+this._framespace.height-J).x(ar).addTo(this.gr)}else{this.axis_x.getGrape().y(this._framespace.y+J).x(ar).addTo(this.gr)}if(this._frame_type!="1CxN"){var aa=this._properties.getSettings(this.axis_x2._variable,"AXIS_X","reversed");var y=this._properties.getSettings(this.axis_x2._variable,"AXIS_X","reversed_on");var ad=this.axis_x2.clone();var aN=0;for(var K=0;K<this.axis_x._ticks;K++){let v;if(aa&&(!y||y=="all"||(y=="first"&&K==0)||(y=="last"&&K==this.axis_x._ticks-1)||(y=="odd"&&K%2==1)||(y=="even"&&K%2==0))){ad.reversed(true)}else{ad.reversed(false)}if(az){ad._hierarchical_data={parent_variable:this._var_x,parent_value:this.axis_x._ticks_values[K],child_variable:null,segments:null};ad.length(this.axis_x.getSpacePoint(this.axis_x._ticks_values[K]))}v=ad.clone();if(ad._orientation_reversed==false){v.getGrape().y(aq+this._dataspace.height)}else{v.getGrape().y(aq)}var aC=this._dataspace.x+this.axis_x.getPoint(this.axis_x._ticks_values[K])-this.axis_x.getSpacePoint(this.axis_x._ticks_values[K])/2;v.getGrape().x(aC).addTo(this.gr);if(ad._show_grid_lines){var ao=v.getGridLines(this._dataspace,aN);aN=ao._is_odd;ao.x(aC).y(aq);this.gr.addChild(ao)}this.naxis_x.push(v)}}if(this.axis_x._show_grid_lines){if(this._frame_type=="2CxN"){this.axis_x.getGridLines({y:this._framespace.y,x:this._dataspace.x,height:this._framespace.height,width:this._dataspace.width}).addTo(this.gr).toBack()}else{this.gr.addChild(this.axis_x.getGridLines({y:this._dataspace.y,x:this._dataspace.x,height:this._dataspace.height,width:this._dataspace.width}))}}}else{if(this._frame_type=="2x1C"){this.axis_y=new graphica.Axis(x,this._var_y,"vertical").length(this._framespace.height);this.applyDefaultsToAxis(this.axis_y,"y",x.getSettings(this._var_y,graphica.POS_Y),true);this.axis_y._legend_orientation="vertical";this.axis_y.init();var aA=this.axis_y.getWidth();var ar=this._framespace.x;if(!this.axis_y._orientation_reversed){ar=this._framespace.x+aA}this.all_n_variables=x.allVariables(graphica.POS_X);var J=0;var A=(this._framespace.width-aA);let axisx=new graphica.Axis(x,this.all_n_variables[0],"horizontal").length(A);axisx._is_vertical_labels_allowed=false;if(x.getSettings(this.all_n_variables[0],graphica.POS_X,"use_custom_color")){var Y="rgb(31,78,121)";if(typeof x.custom_colors[this.all_n_variables[0]]!=="undefined"){Y=x.custom_colors[this.all_n_variables[0]]}axisx._labels_color=Y;axisx._legend_color=Y}this.applyDefaultsToAxis(axisx,"x",x.getSettings(this.all_n_variables[0],graphica.POS_X),true);axisx._orientation_reversed=false;axisx.init();this.naxis_x.push(axisx);var ae=axisx.getHeight();J+=ae;let topaxisx=new graphica.Axis(x,this.all_n_variables[1],"horizontal").length(A);topaxisx._is_vertical_labels_allowed=false;if(x.getSettings(this.all_n_variables[1],graphica.POS_X,"use_custom_color")){var Y="rgb(31,78,121)";if(typeof x.custom_colors[this.all_n_variables[1]]!=="undefined"){Y=x.custom_colors[this.all_n_variables[1]]}topaxisx._labels_color=Y;topaxisx._legend_color=Y}this.applyDefaultsToAxis(topaxisx,"x");topaxisx._show_ticks=true;topaxisx.applySettings(x.getSettings(this.all_n_variables[1],graphica.POS_X));topaxisx._orientation_reversed=true;topaxisx.init();this.naxis_x.push(topaxisx);var ai=topaxisx.getHeight();J+=ai;this.naxis_x[0].getGrape().y(this._framespace.y+this._framespace.height-ae).x(ar).addTo(this.gr);this.naxis_x[1].getGrape().y(this._framespace.y+ai).x(ar).addTo(this.gr);this.axis_y=new graphica.Axis(x,this._var_y,"vertical").length(this._framespace.height-J);this.applyDefaultsToAxis(this.axis_y,"y",x.getSettings(this._var_y,graphica.POS_Y),true);this.axis_y._legend_orientation="vertical";this.axis_y.init();var aA=this.axis_y.getWidth();var ar=this._framespace.x+aA;if(this.axis_y._orientation_reversed){ar=this._framespace.x+this._framespace.width-aA}this._dataspace.width=this._framespace.width-aA;this._dataspace.x=this._framespace.x+aA;if(this.axis_y._orientation_reversed){this._dataspace.x=this._framespace.x}this._dataspace.y=this._framespace.y+ai+this.axis_y._y_origin;this._dataspace.height=this._framespace.height-J-this.axis_y._y_origin;this.axis_y.getGrape().y(this._framespace.y+ai).x(ar).addTo(this.gr);if(this.naxis_x[0]._show_grid_lines){this.gr.addChild(this.naxis_x[0].getGridLines(this._dataspace))}if(this.axis_y._show_grid_lines){this.gr.addChild(this.axis_y.getGridLines(this._dataspace))}}else{if(this._frame_type=="1Cx2"){this.axis_x=new graphica.Axis(x,this._var_x,"horizontal").length(this._framespace.width);this.axis_x._is_vertical_labels_allowed=false;this.applyDefaultsToAxis(this.axis_x,"x",x.getSettings(this._var_x,graphica.POS_X));var J=this.axis_x.getHeight();var aq=this._framespace.y;if(this.axis_x._orientation_reversed){aq=this._framespace.y+J}this.all_n_variables=x.allVariables(graphica.POS_Y);var aA=0;var av=(this._framespace.height-J);let axisy=new graphica.Axis(x,this.all_n_variables[0],"vertical").length(av);this.applyDefaultsToAxis(axisy,"y");if(x.getSettings(this.all_n_variables[0],graphica.POS_Y,"use_custom_color")){var Y="rgb(31,78,121)";if(typeof x.custom_colors[this.all_n_variables[0]]!=="undefined"){Y=x.custom_colors[this.all_n_variables[0]]}axisy._labels_color=Y;axisy._legend_color=Y}axisy.applySettings(x.getSettings(this.all_n_variables[0],graphica.POS_Y));axisy._orientation_reversed=false;axisy.init();this.naxis_y.push(axisy);var k=axisy.getWidth();aA+=k;let rightaxisy=new graphica.Axis(x,this.all_n_variables[1],"vertical").length(av);if(x.getSettings(this.all_n_variables[1],graphica.POS_Y,"use_custom_color")){var Y="rgb(31,78,121)";if(typeof x.custom_colors[this.all_n_variables[1]]!=="undefined"){Y=x.custom_colors[this.all_n_variables[1]]}rightaxisy._labels_color=Y;rightaxisy._legend_color=Y}this.applyDefaultsToAxis(rightaxisy,"y");rightaxisy.applySettings(x.getSettings(this.all_n_variables[1],graphica.POS_Y));rightaxisy._orientation_reversed=true;rightaxisy.init();this.naxis_y.push(rightaxisy);var ap=rightaxisy.getWidth();aA+=ap;this.naxis_y[0].getGrape().y(aq).x(this._framespace.x+k).addTo(this.gr);this.naxis_y[1].getGrape().y(aq).x(this._framespace.x+this._framespace.width-ap).addTo(this.gr);this.axis_x=new graphica.Axis(x,this._var_x,"horizontal").length(this._framespace.width-aA);this.applyDefaultsToAxis(this.axis_x,"x",x.getSettings(this._var_x,graphica.POS_X),true);this.axis_x._is_vertical_labels_allowed=false;this.axis_x.init();var J=this.axis_x.getHeight();var aq=this._framespace.y+J;if(!this.axis_x._orientation_reversed){aq=this._framespace.y+this._framespace.height-J}this._dataspace.height=this._framespace.height-J;this._dataspace.y=this._framespace.y;if(this.axis_x._orientation_reversed){this._dataspace.y=this._framespace.y+J}this._dataspace.x=this._framespace.x+k+this.axis_x._x_origin;this._dataspace.width=this._framespace.width-aA-this.axis_x._x_origin;this.axis_x.getGrape().y(aq).x(this._framespace.x+k).addTo(this.gr);if(this.naxis_y[0]._show_grid_lines){this.gr.addChild(this.naxis_y[0].getGridLines(this._dataspace))}if(this.axis_x._show_grid_lines){this.gr.addChild(this.axis_x.getGridLines(this._dataspace))}}else{if(this._frame_type=="0xN"){this.all_n_variables=x.allVariables(graphica.POS_Y);var A=this._framespace.width/l;var an=(x.getSettings(this.all_n_variables[0],graphica.POS_Y,"orientation")=="right");var aw=(this.all_n_variables.length>1&&x.getSettings(this.all_n_variables[this.all_n_variables.length-1],graphica.POS_Y,"orientation")=="left");if(an&&aw){A=this._framespace.width/(l-1)}else{if(an||aw){A=this._framespace.width/(l-0.5)}}var aD=0;if(x.Mark()==graphica.AREALINE){for(var Q=0;Q<l;Q++){if(this._dataset.isCategorical(this.all_n_variables[Q])){aD=Math.max(aD,this._dataset.unique(this.all_n_variables[Q]).length)}}}for(var Q=0;Q<l;Q++){var ag=null;if(x.Mark()==graphica.AREALINE&&this._dataset.isCategorical(this.all_n_variables[Q])){var aI=this._properties.getSettings(this._quantitative_bar_variable,graphica.AREA,"aggregation");ag={segments:this._dataset.maxByCategories([this.all_n_variables[Q]],[],this._quantitative_bar_variable,aI),max_cats_per_axis:aD,cats_padding:this._category_padding}}let axisy=new graphica.Axis(x,this.all_n_variables[Q],"vertical",ag).length(this._framespace.height);if(Q==0&&this._properties.default_form==graphica.LINE&&this._properties.label_config!=""){axisy._orientation_reversed=true}else{if(Q==l-1&&(this._properties.default_form!=graphica.LINE||this._properties.label_config=="")){axisy._orientation_reversed=true}}if(Q>0&&Q<l-1){axisy._legend_align="center"}this.applyDefaultsToAxis(axisy,"y",x.getSettings(this.all_n_variables[Q],graphica.POS_Y));this.naxis_y.push(axisy);var aM=axisy.getGrape().y(this._framespace.y);if(an){aM.x(this._framespace.x+(Q*A))}else{aM.x(this._framespace.x+(Q*A)+A*0.5)}aM.addTo(this.gr);this._dataspace.y=this._framespace.y+axisy._y_origin;this._dataspace.height=this._framespace.height-axisy._y_origin}}else{if(this._frame_type=="Nx0"){this.all_n_variables=x.allVariables(graphica.POS_X);var av=this._framespace.height/B;var f=(x.getSettings(this.all_n_variables[0],graphica.POS_X,"orientation")=="bottom");var aH=(this.all_n_variables.length>1&&x.getSettings(this.all_n_variables[this.all_n_variables.length-1],graphica.POS_X,"orientation")=="top");if(f&&aH){av=this._framespace.height/(B-1)}else{if(f||aH){av=this._framespace.height/(B-0.5)}}var aD=0;if(x.Mark()==graphica.AREALINE){for(var Q=0;Q<B;Q++){if(this._dataset.isCategorical(this.all_n_variables[Q])){aD=Math.max(aD,this._dataset.unique(this.all_n_variables[Q]).length)}}}for(var Q=0;Q<B;Q++){var ag=null;if(x.Mark()==graphica.AREALINE&&this._dataset.isCategorical(this.all_n_variables[Q])){var aI=this._properties.getSettings(this._quantitative_bar_variable,graphica.AREA,"aggregation");ag={segments:this._dataset.maxByCategories([this.all_n_variables[Q]],[],this._quantitative_bar_variable,aI),max_cats_per_axis:aD,cats_padding:this._category_padding}}let axisx=new graphica.Axis(x,this.all_n_variables[Q],"horizontal",ag).length(this._framespace.width);axisx._is_vertical_labels_allowed=false;if(Q==0){axisx._orientation_reversed=true}this.applyDefaultsToAxis(axisx,"x",x.getSettings(this.all_n_variables[Q],graphica.POS_X));this.naxis_x.push(axisx);var aM=axisx.getGrape();if(f){aM.y(this._framespace.y+(Q*av))}else{aM.y(this._framespace.y+(Q*av)+av*0.5)}aM.x(this._framespace.x).addTo(this.gr)}}}}}}}}}}}}}}}if(this._background_image!=""){var aJ=raceme.image(this._background_image,this._dataspace.x,this._dataspace.y,this._dataspace.width,this._dataspace.height).attr("preserveAspectRatio","none").addTo(ah)}if(this._include_interaction){if(B==1&&this.axis_x){this._properties.view.filterWrapperAxis(this.axis_x)}if(l==1&&this.axis_y){this._properties.view.filterWrapperAxis(this.axis_y)}if(this._frame_type=="0xN"||this._frame_type=="1CxN"||this._frame_type=="1Cx2"||this._frame_type=="2CxN"||this._frame_type=="1x2"){for(var aK=0;aK<this.naxis_y.length;aK++){this._properties.view.filterWrapperAxis(this.naxis_y[aK]);if(this._frame_type=="1x2"&&aK>=0){break}}}else{if(this._frame_type=="Nx0"||this._frame_type=="Nx1C"||this._frame_type=="2x1C"||this._frame_type=="Nx2C"||this._frame_type=="2x1"){for(var aK=0;aK<this.naxis_x.length;aK++){this._properties.view.filterWrapperAxis(this.naxis_x[aK]);if(this._frame_type=="2x1"&&aK>=0){break}}}}}if(this.zoomable&&this._frame_type!="map"&&this._frame_type!="0x0"&&this._frame_type!="mapXY"){this.zoomable=false}};graphica.Frame.fn.getGrape=function(){return this.gr};graphica.Frame.fn.getPoints=function(d,b){var e={x:0,y:0,width:0,height:0,x1:0,y1:0};var q;var k=this.axis_x;var g=this.axis_y;var r=this.axis_y2;var j=this.axis_x2;var p=this._properties;var m;var l;var o=this._dataspace;e.x1=o.x;e.y1=o.y;e.width=o.width;e.height=o.height;if(g&&g._is_date_type){e.height=g.getSpacePoint()}if(k&&k._is_date_type){e.width=k.getSpacePoint()}if(this._frame_type=="multiple"||this._frame_type=="1Cx0"||this._frame_type=="0x1C"||this._frame_type=="1Cx1C"){if(this.getSubframe(d,b)!==false){return this.getSubframe(d,b).getPoints(d,b)}}else{if(this._frame_type=="0x0"){if((p.default_form==graphica.CIRCLE&&this._properties.countVariables(graphica.UNIT)==0)||p.default_form==graphica.NONE_SHAPE||this.reference_vars.multiple_elements_per_frame==false){e.x=o.x+o.width/2;e.y=o.y+o.height/2}else{if(this._is_subframe&&this._parent_frame=="0x1C"){e=this.getCategoricalMatrixPosition("lefttoright")}else{e=this.getCategoricalMatrixPosition()}}}else{if(this._frame_type=="1x0"){if(this.isQuantitativeBarVariable(k._variable)){e.x=this.getSegmentPositions(d,k,o.x)}else{if(typeof this._quantitative_bar_variable!=="undefined"){e.y=this.getSegmentPositionsWithoutAxis(d,o.height,o.y);m=k.getPoint(p.getDataValue(d,k._variable,graphica.POS_X));e.x=((m===null)?null:o.x+m);e.width=k.getSpacePoint();return e}else{m=k.getPoint(p.getDataValue(d,k._variable,graphica.POS_X));e.x=((m===null)?null:o.x+m)}}e.y=o.y+o.height/2;return e}else{if(this._frame_type=="0x1"){if(this.isQuantitativeBarVariable(g._variable)){e.y=this.getSegmentPositions(d,g,o.y);e.width=o.width}else{if(typeof this._quantitative_bar_variable!=="undefined"){e.x=this.getSegmentPositionsWithoutAxis(d,o.width,o.x);l=g.getPoint(p.getDataValue(d,g._variable,graphica.POS_Y));e.y=((l===null)?null:o.y+l);e.height=g.getSpacePoint();return e}else{l=g.getPoint(p.getDataValue(d,g._variable,graphica.POS_Y));e.y=((l===null)?null:o.y+l)}}e.x=o.x+o.width/2;return e}else{if(this._frame_type=="map"){if(Array.isArray(d)){e=this._map.getCentroidScaled(d[this._geo_variable],d);if(this._map_border_only_in_regions_with_data&&this._map.getRegionGrape(d[this._geo_variable])){this._map.getRegionGrape(d[this._geo_variable]).attr("stroke",this._default_map_border_color).attr("stroke-width",this._default_map_border/2).toFront()}}else{e=this._map.getCentroidScaled(this._dataset.getValue(d,this._geo_variable),this._dataset.row(d));if(this._map_border_only_in_regions_with_data&&this._map.getRegionGrape(this._dataset.getValue(d,this._geo_variable))){this._map.getRegionGrape(this._dataset.getValue(d,this._geo_variable)).attr("stroke",this._default_map_border_color).attr("stroke-width",this._default_map_border/2).toFront()}}return e}else{if(this._frame_type=="mapXY"){if(Array.isArray(d)){var h=d[this._properties.firstVariable(graphica.POS_Y)];var f=d[this._properties.firstVariable(graphica.POS_X)]}else{var h=this._dataset.getValue(d,this._properties.firstVariable(graphica.POS_Y));var f=this._dataset.getValue(d,this._properties.firstVariable(graphica.POS_X))}e=this._map.getPositionXY(h,f);e.x+=o.x;e.y+=o.y;e.latitude=h;e.longitude=f;return e}else{if(this._frame_type=="1x1"||this._frame_type=="1Cx1"||this._frame_type=="1x1C"){if(this.isQuantitativeBarVariable(k._variable)){e.x=this.getSegmentPositions(d,k,o.x)}else{if(typeof this._quantitative_bar_variable!=="undefined"&&!this.isQuantitativeBarVariable(g._variable)&&p.connectionVariable==g._variable){e.x=this.getSegmentPositionsWithoutAxis(d,k.getSpacePoint(),o.x+k.getPoint(p.getDataValue(d,k._variable,graphica.POS_X))-k.getSpacePoint()/2)}else{m=k.getPoint(p.getDataValue(d,k._variable,graphica.POS_X));e.x=((m===null)?null:o.x+m);if(k._is_variable_categorical||k._is_date_type||this.is_axis_x_interval){e.x1=e.x-k.getSpacePoint()/2;e.width=k.getSpacePoint()}}}if(this.isQuantitativeBarVariable(g._variable)){e.y=this.getSegmentPositions(d,g,o.y)}else{if(typeof this._quantitative_bar_variable!=="undefined"&&!this.isQuantitativeBarVariable(k._variable)&&p.connectionVariable==k._variable){e.y=this.getSegmentPositionsWithoutAxis(d,g.getSpacePoint(),o.y+g.getPoint(p.getDataValue(d,g._variable,graphica.POS_Y))-g.getSpacePoint()/2)}else{l=g.getPoint(p.getDataValue(d,g._variable,graphica.POS_Y));e.y=((l===null)?null:o.y+l);if(g._is_variable_categorical||g._is_date_type||this.is_axis_y_interval){e.y1=e.y-g.getSpacePoint()/2;e.height=g.getSpacePoint()}}}return e}else{if(this._frame_type=="1x2"){if(this.isQuantitativeBarVariable(k._variable)){e.x=this.getSegmentPositions(d,k,o.x,g)}else{m=k.getPoint(p.getDataValue(d,k._variable,graphica.POS_X));e.x=((m===null)?null:o.x+m)}e.height=r.getSpacePoint();var c=g.getCategoricalPosition(p.getDataValue(d,g._variable,graphica.POS_Y));if(c!==null){if(this.isQuantitativeBarVariable(r._variable)){e.y=this.getSegmentPositions(d,this.naxis_y[c],o.y,g)}else{e.y=this.naxis_y[c].getPoint(p.getDataValue(d,r._variable,graphica.POS_Y))+this.naxis_y[c].y()}e.width=k.getSpacePoint()}else{e.y=null}e.y1=e.y-e.height/2;e.x1=e.x-e.width/2;return e}else{if(this._frame_type=="2x1"){if(this.isQuantitativeBarVariable(g._variable)){e.y=this.getSegmentPositions(d,g,o.y,k)}else{l=g.getPoint(p.getDataValue(d,g._variable,graphica.POS_Y));e.y=((l===null)?null:o.y+l)}e.width=j.getSpacePoint();var c=k.getCategoricalPosition(p.getDataValue(d,k._variable,graphica.POS_X));if(c!==null){if(this.isQuantitativeBarVariable(j._variable)){e.x=this.getSegmentPositions(d,this.naxis_x[c],o.x,k)}else{e.x=this.naxis_x[c].getPoint(p.getDataValue(d,j._variable,graphica.POS_X))+this.naxis_x[c].x()}e.height=g.getSpacePoint()}else{e.x=null}e.y1=e.y-e.height/2;e.x1=e.x-e.width/2;return e}else{if(this._frame_type=="2x2"){if(this.isQuantitativeBarVariable(r._variable)){e.y=this.getSegmentPositions(d,r,o.y,[k,g])}else{l=r.getPoint(p.getDataValue(d,r._variable,graphica.POS_Y));e.y=((l===null)?null:o.y+g.getPoint(p.getDataValue(d,g._variable,graphica.POS_Y))-r._length/2+l)}e.width=j.getSpacePoint();if(this.isQuantitativeBarVariable(j._variable)){e.x=this.getSegmentPositions(d,j,o.x,[k,g])}else{m=j.getPoint(p.getDataValue(d,j._variable,graphica.POS_X));e.x=((m===null)?null:o.x+k.getPoint(p.getDataValue(d,k._variable,graphica.POS_X))-j._length/2+m)}e.height=r.getSpacePoint();e.y1=e.y-e.height/2;e.x1=e.x-e.width/2;return e}else{if(this._frame_type=="Nx1C"||this._frame_type=="2x1C"||this._frame_type=="Nx2C"){var s=this._dataspace.width/this.naxis_x.length;for(q=0;q<this.naxis_x.length;q++){if(this.naxis_x[q]._variable!==b){continue}var m;if(this.isQuantitativeBarVariable(this.naxis_x[q]._variable)){if(this._frame_type=="2x1C"){m=this.getSegmentPositions(d,this.naxis_x[q],o.x,null,this.naxis_x[q]._variable,this.naxis_x[q]._variable_name)}else{if(this._frame_type=="Nx2C"){m=this.getSegmentPositions(d,this.naxis_x[q],o.x+s*q,g,this.naxis_x[q]._variable,this.naxis_x[q]._variable_name)}else{m=this.getSegmentPositions(d,this.naxis_x[q],o.x+s*q,null,this.naxis_x[q]._variable,this.naxis_x[q]._variable_name)}}e.x=m}else{m=this.naxis_x[q].getPoint(p.getDataValue(d,this.naxis_x[q]._variable,graphica.POS_X,this.naxis_x[q]._variable));if(m===null){e.x=null}else{if(this._frame_type=="2x1C"){e.x=o.x+m}else{e.x=o.x+m+s*q}}}if(this._frame_type=="Nx2C"){e.height=r.getSpacePoint()}else{e.height=g.getSpacePoint()}if(this._frame_type=="Nx2C"){var c=g.getCategoricalPosition(p.getDataValue(d,g._variable,graphica.POS_Y));if(c!==null){e.y=this.naxis_y[c].getPoint(p.getDataValue(d,r._variable,graphica.POS_Y))+this.naxis_y[c].y()}else{e.y=null}}else{var a=p.getDataValue(d,g._variable,graphica.POS_Y,this.naxis_x[q]._variable);e.y=(a===null)?null:this._dataspace.y+g.getPoint(a)}break}e.y1=e.y-e.height/2}else{if(this._frame_type=="1CxN"||this._frame_type=="1Cx2"||this._frame_type=="2CxN"){var n=this._dataspace.height/this.naxis_y.length;for(q=0;q<this.naxis_y.length;q++){if(this.naxis_y[q]._variable!==b){continue}var l;if(this.isQuantitativeBarVariable(this.naxis_y[q]._variable)){if(this._frame_type=="1Cx2"){l=this.getSegmentPositions(d,this.naxis_y[q],o.y,null,this.naxis_y[q]._variable_name,this.naxis_y[q]._variable)}else{if(this._frame_type=="2CxN"){l=this.getSegmentPositions(d,this.naxis_y[q],o.y+n*q,k,this.naxis_y[q]._variable,this.naxis_y[q]._variable_name)}else{l=this.getSegmentPositions(d,this.naxis_y[q],o.y+n*q,null,this.naxis_y[q]._variable_name,this.naxis_y[q]._variable)}}e.y=l}else{l=this.naxis_y[q].getPoint(p.getDataValue(d,this.naxis_y[q]._variable,graphica.POS_Y,this.naxis_y[q]._variable));if(l===null){e.y=null}else{if(this._frame_type=="1Cx2"){e.y=o.y+l}else{e.y=o.y+l+n*q}}}if(this._frame_type=="2CxN"){e.width=j.getSpacePoint()}else{e.width=k.getSpacePoint()}if(this._frame_type=="2CxN"){var c=k.getCategoricalPosition(p.getDataValue(d,k._variable,graphica.POS_Y));if(c!==null){e.x=this.naxis_x[c].getPoint(p.getDataValue(d,j._variable,graphica.POS_X))+this.naxis_x[c].x()}else{e.x=null}}else{var a=p.getDataValue(d,k._variable,graphica.POS_X,this.naxis_y[q]._variable);e.x=(a===null)?null:this._dataspace.x+k.getPoint(a)}break}e.x1=e.x-e.width/2}else{if(this._frame_type=="0xN"){e.x=[];e.y=[];var s=this._dataspace.width/this.naxis_y.length;for(q=0;q<this.naxis_y.length;q++){var l=this.naxis_y[q].getPoint(p.getDataValue(d,this.naxis_y[q]._variable,graphica.POS_Y));if(l===null){e.y.push(null)}else{e.y.push(this.naxis_y[q].y()+this.naxis_y[q]._y_origin+l)}e.x.push(o.x+(q*s)+s*0.5)}}else{if(this._frame_type=="Nx0"){e.x=[];e.y=[];var n=this._dataspace.height/this.naxis_x.length;for(q=0;q<this.naxis_x.length;q++){var m=this.naxis_x[q].getPoint(p.getDataValue(d,this.naxis_x[q]._variable,graphica.POS_X));if(m===null){e.x.push(null)}else{e.x.push(o.x+m)}e.y.push(o.y+(q*n)+n*0.5)}}}}}}}}}}}}}}}if(typeof e.width==="undefined"){if(k){e.width=k.getSpacePoint()}else{e.width=o.width}}if(typeof e.height==="undefined"){if(g){e.height=g.getSpacePoint()}else{e.height=o.height}}return e};graphica.Frame.fn.applyDefaultsToAxis=function(e,b,d,f){if(typeof b=="undefined"){b=""}var c=this._properties;if(this._is_subframe){e._legend_orientation="vertical"}if(this._parent_frame=="multiple"){e._show_legend=false}if(this._frame_type!="Nx0"&&this._frame_type!="0xN"){if(b=="x"&&this.hide_axis_x&&(e._variable===c.firstVariable(graphica.POS_X)||this._frame_type=="Nx1C"||this._frame_type=="Nx2C")){e._visible=false}else{if(b=="x"&&this.hide_axis_x2&&e._variable===c.secondVariable(graphica.POS_X)){e._visible=false}else{if(b=="y"&&this.hide_axis_y&&(e._variable===c.firstVariable(graphica.POS_Y)||this._frame_type=="1CxN"||this._frame_type=="2CxN")){e._visible=false}else{if(b=="y"&&this.hide_axis_y2&&e._variable==c.secondVariable(graphica.POS_Y)){e._visible=false}}}}}if(this.isQuantitativeBarVariable(e._variable)){if(typeof this._tmp_grouped_max!=="undefined"){e.max(this._tmp_grouped_max[e._variable_name]._bar_max_value);e.min(this._tmp_grouped_max[e._variable_name]._bar_min_value)}else{e.max(this._bar_max_value);e.min(this._bar_min_value)}}if(this._dataset.isCategorical(e._variable)){if(this._frame_type!="1x1"&&this._frame_type!="1x0"&&this._frame_type!="0x1"){e._ticks_format="outer";e._show_ticks=false}e._show_line=false;e._show_grid_lines=true;e._low_padding=0;e._high_padding=0;if(b=="x"&&["2x1","2x2","2CxN"].includes(this._frame_type)){e._cell_padding=true}else{if(b=="y"&&["1x2","2x2","Nx2C"].includes(this._frame_type)){e._cell_padding=true}}}else{if(this._dataset.isQuantitative(e._variable)){e._low_padding=0;e._high_padding=0;var a=c.Mark(e._variable);if(a==graphica.BAR||a==graphica.LINE||a==graphica.AREALINE){e._is_bar_axis=true}if(((this._frame_type=="1CxN"||this._frame_type=="2CxN")&&b=="y")||((this._frame_type=="Nx1C"||this._frame_type=="Nx2C")&&b=="x")){e._high_padding=24}}}if(this._frame_type=="0xN"||this._frame_type=="Nx0"){e._show_ticks=true;e._show_line=true}if((this._frame_type=="1Cx1"||this._frame_type=="1x1C")&&!this._dataset.isQuantitative(e._variable)){e._show_grid_lines=false}if((this._frame_type=="1CxN"||this._frame_type=="2CxN"||this._frame_type=="1Cx1"||(this._frame_type=="1x1"&&this._dataset.isDateType(e._variable))||(this._frame_type=="1x0"&&!this._dataset.isQuantitative(e._variable)))&&b=="x"){if(c.marks_to_label=="first"){e._low_padding+=c.label_space_width}else{if(c.marks_to_label=="first and last"){e._low_padding+=c.label_space_width;e._high_padding+=c.label_space_width}else{e._high_padding+=c.label_space_width}}}if((this._frame_type=="2x1"||this._frame_type=="2x2")&&b=="x"){e._show_grid_lines=true;if(!this._dataset.isQuantitative(e._variable)){e._low_padding=0;e._high_padding=0;if(this._dataset.isDateType(e._variable)){e._ticks_format="outer"}}}else{if((this._frame_type=="2x1"||this._frame_type=="2x2")&&b=="x2"){e._show_legend=false;if(!this._dataset.isQuantitative(e._variable)){e._show_grid_lines=false;e._high_padding+=c.label_space_width}}else{if(this._frame_type=="2x1"&&b=="y"){e._legend_orientation="vertical"}else{if((this._frame_type=="1CxN"||this._frame_type=="2CxN"||this._frame_type=="1Cx2")&&b=="y"){e._legend_orientation="vertical"}else{if(this._frame_type=="1x2"&&b=="y"){e._show_grid_lines=true;if(!this._dataset.isQuantitative(e._variable)){e._low_padding=0;e._high_padding=0;if(this._dataset.isDateType(e._variable)){e._ticks_format="outer"}}}else{if(this._frame_type=="2x2"&&b=="y"){e._legend_orientation="vertical";if(!this._dataset.isQuantitative(e._variable)){e._low_padding=0;e._high_padding=0;if(this._dataset.isDateType(e._variable)){e._ticks_format="outer"}}}else{if((this._frame_type=="1x2"||this._frame_type=="2x2")&&b=="y2"){e._legend_orientation="vertical";e._show_legend=false;if(!this._dataset.isQuantitative(e._variable)){e._show_grid_lines=false}}}}}}}}if(b=="y"&&(this._frame_type!="0xN"&&this._frame_type!="1CxN"&&this._frame_type!="2CxN"&&this._frame_type!="2x1C"&&this._frame_type!="1Cx2"&&this._frame_type!="multiple")){if(e._orientation_reversed){e._legend_align="right"}else{e._legend_align="left"}}if(b=="y"&&e._orientation_reversed){e._labels_align="left"}if(typeof d!=="undefined"&&d!==null){e.applySettings(d);if((typeof f=="boolean"&&f)==false){e.init()}}if(e._cell_padding){if(b=="x"){if(["2x1","2x2","2x1C","2CxN"].includes(this._frame_type)==false){e._cell_padding=false}}else{if(b=="y"){if(["1x2","2x2","1Cx2","Nx2C"].includes(this._frame_type)==false){e._cell_padding=false}}else{e._cell_padding=false}}}};graphica.Frame.fn.isQuantitativeBarVariable=function(a){if(this._properties.Mark(a)==graphica.CIRCLE){return false}if((this._frame_type=="Nx0"||this._frame_type=="0xN")&&this._properties.Mark(a)==graphica.AREALINE&&this._dataset.isQuantitative(a)){return true}if((this._frame_type=="Nx0"||this._frame_type=="0xN"||this._frame_type=="Nx1C"||this._frame_type=="Nx2C"||this._frame_type=="1CxN"||this._frame_type=="2CxN"||this._frame_type=="2x1C"||this._frame_type=="1Cx2")&&this._quantitative_bar_variables.includes(a)){return true}return(typeof this._quantitative_bar_variable!=="undefined"&&a==this._quantitative_bar_variable&&(typeof this._categorical_bar_variable!=="undefined"||(this._frame_type=="1x0"||this._frame_type=="0x1")))};graphica.Frame.fn.getSegmentPositions=function(p,j,d,e,o,f){var k;var g;var a,h;if(typeof f=="undefined"){f="OnlyVariable"}var n;if(Array.isArray(p)){n=p[this._categorical_bar_variable]}else{if(typeof o!=="undefined"){n=this._properties.getCategoricalDataValue(p,this._categorical_bar_variable,o)}else{n=this._dataset.getValue(p,this._categorical_bar_variable)}}if(typeof n==="number"){n=n.toString()}if(this._dataset.isDateType(this._categorical_bar_variable)){n=n.faststrformat(this._categorical_bar_variable_aggregation)}var m;if(j._orientation=="vertical"){m=this._properties.getDataValue(p,j._variable,graphica.POS_Y,o)}else{m=this._properties.getDataValue(p,j._variable,graphica.POS_X,o)}if(typeof e!=="undefined"&&e!==null){if(Array.isArray(e)){var c,b;c=e[0];b=e[1];if(Array.isArray(p)){a=p[c._variable];h=p[b._variable]}else{a=this._dataset.getValue(p,c._variable);h=this._dataset.getValue(p,b._variable)}if(this._dataset.isDateType(c._variable)){a=a.faststrformat(c._stat)}if(this._dataset.isDateType(b._variable)){h=a.faststrformat(b._stat)}this._tmp_categorical_bars_areas[f]=this._tmp_categorical_bars_areas[f]||{};if(typeof this._tmp_categorical_bars_areas[f][a]=="undefined"){this._tmp_categorical_bars_areas[f][a]={}}if(typeof this._tmp_categorical_bars_areas[f][a][h]=="undefined"){this._tmp_categorical_bars_areas[f][a][h]={}}if(typeof this._tmp_categorical_bars_areas[f][a][h][n]=="undefined"){this._tmp_categorical_bars_areas[f][a][h][n]={}}this._tmp_categorical_bars_areas[f][a][h][n].positive=this._tmp_categorical_bars_areas[f][a][h][n].positive||0;this._tmp_categorical_bars_areas[f][a][h][n].negative=this._tmp_categorical_bars_areas[f][a][h][n].negative||0;k=(m>=0)?this._tmp_categorical_bars_areas[f][a][h][n].positive:this._tmp_categorical_bars_areas[f][a][h][n].negative}else{if(Array.isArray(p)){a=p[e._variable]}else{a=this._dataset.getValue(p,e._variable)}if(this._dataset.isDateType(e._variable)){a=a.faststrformat(e._stat)}this._tmp_categorical_bars_areas[f]=this._tmp_categorical_bars_areas[f]||{};if(typeof this._tmp_categorical_bars_areas[f][a]=="undefined"){this._tmp_categorical_bars_areas[f][a]={}}if(typeof this._tmp_categorical_bars_areas[f][a][n]=="undefined"){this._tmp_categorical_bars_areas[f][a][n]={}}this._tmp_categorical_bars_areas[f][a][n].positive=this._tmp_categorical_bars_areas[f][a][n].positive||0;this._tmp_categorical_bars_areas[f][a][n].negative=this._tmp_categorical_bars_areas[f][a][n].negative||0;k=(m>=0)?this._tmp_categorical_bars_areas[f][a][n].positive:this._tmp_categorical_bars_areas[f][a][n].negative}}else{this._tmp_categorical_bars_areas[f]=this._tmp_categorical_bars_areas[f]||{};if(typeof this._tmp_categorical_bars_areas[f][n]=="undefined"){this._tmp_categorical_bars_areas[f][n]={}}this._tmp_categorical_bars_areas[f][n].positive=this._tmp_categorical_bars_areas[f][n].positive||0;this._tmp_categorical_bars_areas[f][n].negative=this._tmp_categorical_bars_areas[f][n].negative||0;k=(m>=0)?this._tmp_categorical_bars_areas[f][n].positive:this._tmp_categorical_bars_areas[f][n].negative}var l=k+m;g=[d+j.getPoint(k),d+j.getPoint(l)];if(typeof e!=="undefined"&&e!==null){if(Array.isArray(e)){if(j._orientation==c._orientation){g[0]+=c.getPoint(a)-c.getSpacePoint()/2;g[1]+=c.getPoint(a)-c.getSpacePoint()/2}if(j._orientation==b._orientation){g[0]+=b.getPoint(h)-b.getSpacePoint()/2;g[1]+=b.getPoint(h)-b.getSpacePoint()/2}if(m>=0){this._tmp_categorical_bars_areas[f][a][h][n].positive=l}else{this._tmp_categorical_bars_areas[f][a][h][n].negative=l}}else{if(j._orientation==e._orientation){g[0]+=e.getPoint(a)-e.getSpacePoint()/2;g[1]+=e.getPoint(a)-e.getSpacePoint()/2}if(m>=0){this._tmp_categorical_bars_areas[f][a][n].positive=l}else{this._tmp_categorical_bars_areas[f][a][n].negative=l}}}else{if(m>=0){this._tmp_categorical_bars_areas[f][n].positive=l}else{this._tmp_categorical_bars_areas[f][n].negative=l}}return g};graphica.Frame.fn.getSegmentPositionsForSankey=function(e,f,d,b){e=e||this._dataset;var a;var c=this.all_n_variables[i];_tmp_categorical_bars_areas[c]=_tmp_categorical_bars_areas[c]||{};if(this._dataset.isCategorical(c)){}else{if(this._dataset.isQuantitative(svg)){}else{if(this._dataset.isDateType(svg)){}}}};graphica.Frame.fn.getSegmentPositionsWithoutAxis=function(o,m,c){var j;var e;var a;var n;if(Array.isArray(o)){n=o[this._categorical_bar_variable]}else{n=this._dataset.getValue(o,this._categorical_bar_variable)}if(this._dataset.isDateType(this._categorical_bar_variable)){n=n.faststrformat(this._categorical_bar_variable_aggregation)}var l;var h=this._bar_max_value;var g=this._bar_max_value;if(this._previous_categorical_bar_variables.length){var d=this._previous_categorical_bar_variables[0];var f=this._previous_categorical_bar_variables_aggregation[0];if(Array.isArray(o)){a=o[d]}else{a=this._dataset.getValue(o,d)}if(this._dataset.isDateType(d)){a=a.faststrformat(f)}if(typeof this._tmp_categorical_bars_areas[a]=="undefined"){this._tmp_categorical_bars_areas[a]={}}if(typeof this._tmp_categorical_bars_areas[a][n]=="undefined"){this._tmp_categorical_bars_areas[a][n]=0}if(typeof this._tmp_max_by_categories!="undefined"&&typeof this._tmp_max_by_categories[a]!=="undefined"&&typeof this._tmp_max_by_categories[a][n]!=="undefined"){h=this._tmp_max_by_categories[a][n].positive-this._tmp_max_by_categories[a][n].negative}if(this._properties.size_range=="independent"&&typeof this._tmp_localmax_by_categories[a]!=="undefined"){g=this._tmp_localmax_by_categories[a].max}j=this._tmp_categorical_bars_areas[a][n]}else{if(typeof this._tmp_categorical_bars_areas[n]=="undefined"){this._tmp_categorical_bars_areas[n]=0}if(typeof this._tmp_max_by_categories!="undefined"&&typeof this._tmp_max_by_categories[n]!=="undefined"){h=this._tmp_max_by_categories[n].positive-this._tmp_max_by_categories[n].negative}j=this._tmp_categorical_bars_areas[n]}l=Math.abs(this._properties.getDataValue(o,this._quantitative_bar_variable,graphica.AREA));var k=j+l;var b=raceme.map((g-h)/2,0,g,0,m);e=[c+b+raceme.map(j,0,g,0,m),c+b+raceme.map(k,0,g,0,m)];if(typeof d!=="undefined"){this._tmp_categorical_bars_areas[a][n]=k}else{this._tmp_categorical_bars_areas[n]=k}return e};graphica.Frame.fn.getbasePositions=function(j,k){if(this._frame_type=="multiple"){return this.getSubframe(k).getbasePositions(j,k)}var b=this._dataspace;var e={x:0,y:0};var c;var h;var a;var d=b.height;var g=b.width;if(this._previous_categorical_bar_variables.length){if(this._frame_type=="1Cx1"){c=this.axis_x._variable;h=null}else{if(this._frame_type=="1x1C"){c=this.axis_y._variable;h=null}else{c=this._previous_categorical_bar_variables[0];h=this._previous_categorical_bar_variables_aggregation[0]}}a=k[c];if(this._dataset.isDateType(c)){a=a.faststrformat(h)}}if(this._frame_type=="2x2"){if(this.isQuantitativeBarVariable(this.axis_y2._variable)){e.y=this.axis_y2.getPoint(0)+this.axis_y.getPoint(k[this.axis_y._variable])-this.axis_y.getSpacePoint()/2;e.x=this.axis_x2.getPoint(j)+this.axis_x.getPoint(k[this.axis_x._variable])-this.axis_x.getSpacePoint()/2}else{e.x=this.axis_x2.getPoint(0)+this.axis_x.getPoint(k[this.axis_x._variable])-this.axis_x.getSpacePoint()/2;e.y=this.axis_y2.getPoint(j)+this.axis_y.getPoint(k[this.axis_y._variable])-this.axis_y.getSpacePoint()/2}}else{if(this._frame_type=="1x2"){if(this.isQuantitativeBarVariable(this.axis_y2._variable)){var f=this.axis_y.getCategoricalPosition(k[this.axis_y._variable]);e.y=this.naxis_y[f].getPoint(0)+this.axis_y.getPoint(k[this.axis_y._variable])-this.axis_y.getSpacePoint()/2;e.x=this.axis_x.getPoint(j)}else{e.x=this.axis_x.getPoint(0);e.y=this.axis_y2.getPoint(j)+this.axis_y.getPoint(k[this.axis_y._variable])-this.axis_y.getSpacePoint()/2}}else{if(this._frame_type=="2x1"){if(this.isQuantitativeBarVariable(this.axis_y._variable)){e.y=this.axis_y.getPoint(0);e.x=this.axis_x2.getPoint(j)+this.axis_x.getPoint(k[this.axis_x._variable])-this.axis_x.getSpacePoint()/2}else{var f=this.axis_x.getCategoricalPosition(k[this.axis_x._variable]);e.x=this.naxis_x[f].getPoint(0)+this.axis_x.getPoint(k[this.axis_x._variable])-this.axis_x.getSpacePoint()/2;e.y=this.axis_y.getPoint(j)}}else{if(this._frame_type=="1x1"){if(this.isQuantitativeBarVariable(this.axis_y._variable)){e.y=this.axis_y.getPoint(0);e.x=this.axis_x.getPoint(j)}else{e.x=this.axis_x.getPoint(0);e.y=this.axis_y.getPoint(j)}}else{if(this._frame_type=="0x1"||this._frame_type=="1x1C"){if(this._frame_type=="1x1C"){d=this.axis_y.getSpacePoint()}if(this._frame_type=="1x1C"&&this._previous_categorical_bar_variables.length){if(typeof this._tmp_max_by_categories[a]!=="undefined"){this._tmp_max_by_categories[a][j]=this._tmp_max_by_categories[a][j]||{positive:0,negative:0};e.y=raceme.map((this._bar_max_value-(this._tmp_max_by_categories[a][j].positive-this._tmp_max_by_categories[a][j].negative))/2,0,this._bar_max_value,0,d)}else{e.y=d/2}if(this._frame_type=="1x1C"){e.y+=this.axis_y.getPoint(a)-d/2}e.x=this.axis_x.getPoint(0)}else{if(this._frame_type=="0x1"){this._tmp_max_by_categories[j]=this._tmp_max_by_categories[j]||{positive:0,negative:0};if(typeof this._tmp_max_by_categories[j][j]!=="undefined"){this._tmp_max_by_categories[j]=this._tmp_max_by_categories[j][j]}e.x=raceme.map((this._bar_max_value-(this._tmp_max_by_categories[j].positive-this._tmp_max_by_categories[j].negative))/2,0,this._bar_max_value,0,g)}else{e.x=this.axis_x.getPoint(0)}e.y=this.axis_y.getPoint(j)}}else{if(this._frame_type=="1x0"||this._frame_type=="1Cx1"){if(this._frame_type=="1Cx1"){g=this.axis_x.getSpacePoint()}if(this._frame_type=="1Cx1"&&this._previous_categorical_bar_variables.length){if(typeof this._tmp_max_by_categories[a]!=="undefined"){this._tmp_max_by_categories[a][j]=this._tmp_max_by_categories[a][j]||{positive:0,negative:0};e.x=raceme.map((this._bar_max_value-(this._tmp_max_by_categories[a][j].positive-this._tmp_max_by_categories[a][j].negative))/2,0,this._bar_max_value,0,g)}else{e.x=g/2}if(this._frame_type=="1Cx1"){e.x+=this.axis_x.getPoint(a)-g/2}e.y=this.axis_y.getPoint(0)}else{if(this._frame_type=="1x0"){this._tmp_max_by_categories[j]=this._tmp_max_by_categories[j]||{positive:0,negative:0};if(typeof this._tmp_max_by_categories[j][j]!=="undefined"){this._tmp_max_by_categories[j]=this._tmp_max_by_categories[j][j]}e.y=raceme.map((this._bar_max_value-(this._tmp_max_by_categories[j].positive-this._tmp_max_by_categories[j].negative))/2,0,this._bar_max_value,0,d)}else{e.y=this.axis_y.getPoint(0)}e.x=this.axis_x.getPoint(j)}}}}}}}e.x+=b.x;e.y+=b.y;return e};graphica.Frame.fn.divideFrame=function(k,s){var m=this._properties.clone();this.multiple_var=k;var A;I;if(this._frame_type=="multiple"){A=this._properties.getOrderedItems(k,graphica.SMALL_MULTIPLES)}else{if(this._frame_type=="1Cx0"||this._frame_type=="1Cx1C"){A=this._properties.getOrderedItems(k,graphica.POS_X)}else{A=this._properties.getOrderedItems(k,graphica.POS_Y)}}var I=this._dataset.split(k,A);var N;var e;var f=0;var O=0;var b=0;var w=0;var v=null;var x=null;var a=null;var l=null;var o;var t;this.reference_vars.multiple_elements_per_frame=false;for(var P=0;P<I.length;P++){if(I[P].length>1){this.reference_vars.multiple_elements_per_frame=true;break}}var G;var F;if(this._frame_type=="multiple"){var u=this._categorical_matrix;u.max_per_cell=I.length;u.latest_x=0;u.latest_y=0;u._cell_width=graphica.Utils.squareWidthIntoRectangle(this._dataspace.width,this._dataspace.height,u.max_per_cell);t=parseInt(this._dataspace.width/u._cell_width);if(u._cell_width>3){u._cell_width=parseInt(u._cell_width)}N=u._cell_width;e=u._cell_width;m.remove_link(this.multiple_var,"MULTIPLES");m.calcFrameType();G=this._dataspace.x;F=this._dataspace.y;if(m.countVariables(graphica.POS_Y)>=1||m.countVariables(graphica.POS_X)>=1){o=new graphica.Frame(m,N,e,this._dataset);o._is_vertical_labels_allowed=false;o._include_interaction=false;o._bar_max_value=this._bar_max_value;o._bar_min_value=this._bar_min_value;o._quantitative_bar_variables=this._quantitative_bar_variables;o._quantitative_bar_variable=this._quantitative_bar_variable;if(this._properties.include_title_on_small_multiples){o._title="LOREMipsum";o._title_size=this._properties.small_title_font_size;if(this._properties.small_title_font){o._title_font=this._properties.small_title_font}}o.hide_axis_x=true;o.hide_axis_y=true;o.hide_axis_x2=true;o.hide_axis_y2=true;o._is_subframe=true;o._parent_frame=this._frame_type;o._left_padding=this._properties.small_left_padding;o._right_padding=this._properties.small_right_padding;o._top_padding=this._properties.small_top_padding;o._bottom_padding=this._properties.small_bottom_padding;o.init();o.hide_axis_x=false;o.hide_axis_y=false;o.hide_axis_x2=false;o.hide_axis_y2=false;N=o._dataspace.width;e=o._dataspace.height}if(typeof o!=="undefined"&&o._frame_type!="1CxN"){if(o.axis_y){m.setSettings(o.axis_y._variable,graphica.POS_Y,"show_title",false)}if(o.axis_y2){m.setSettings(o.axis_y2._variable,graphica.POS_Y,"show_title",false)}}if(typeof o!=="undefined"&&o._frame_type!="Nx1C"){if(o.axis_x){m.setSettings(o.axis_x._variable,graphica.POS_X,"show_title",false)}if(o.axis_x2){m.setSettings(o.axis_x2._variable,graphica.POS_X,"show_title",false)}}var p=function(q,j,d){var Q=new graphica.Axis(m,q,j).length(d);o.applyDefaultsToAxis(Q,j=="vertical"?"y":"x",m.getSettings(q,j=="vertical"?graphica.POS_Y:graphica.POS_X),true);if(j=="vertical"){Q._orientation_reversed=false}else{Q._is_vertical_labels_allowed=false}Q.init();return Q};if(m.countVariables(graphica.POS_X)>=1){x=p(m.firstVariable(graphica.POS_X),"horizontal",N);if(m.countVariables(graphica.POS_X)==2&&this._subframe_type=="2x1C"){l=p(m.secondVariable(graphica.POS_X),"horizontal",N)}}if(m.countVariables(graphica.POS_Y)>=1){v=p(m.firstVariable(graphica.POS_Y),"vertical",e);if(m.countVariables(graphica.POS_Y)==2&&this._subframe_type=="1Cx2"){a=p(m.secondVariable(graphica.POS_Y),"vertical",e)}}if(x||v){if(v){f=v.getWidth()}if(a){b=a.getWidth()}if(x){O=x.getHeight()}if(l){w=l.getHeight()}u._cell_width=graphica.Utils.squareWidthIntoRectangle(this._dataspace.width-f-b,this._dataspace.height-O-w,u.max_per_cell);t=parseInt((this._dataspace.width-f-b)/u._cell_width);e=u._cell_width;N=u._cell_width}o=this.generateSubFrame(m,N,e+O+w,this._dataset,null,"ipsum",k,true);o.init();if(x||v){if(o.axis_y){f=o.axis_y.getWidth()}if(o.axis_y2){b=o.axis_y2.getWidth()}if(o.axis_x){O=o.axis_x.getHeight()}if(o.axis_x2){w=o.axis_x2.getHeight()}if(o._frame_type=="Nx1C"||o._frame_type=="Nx2C"){for(var E=0;E<o.naxis_x.length;E++){O=Math.max(O,o.naxis_x[E].getHeight())}}else{if(o._frame_type=="1CxN"||o._frame_type=="2CxN"){for(var E=0;E<o.naxis_y.length;E++){f=Math.max(f,o.naxis_y[E].getWidth())}}}}}else{if(this._frame_type=="1Cx0"){m.remove_link(k,"AXIS_X");m.calcFrameType();N=this.axis_x.getSpacePoint();e=this._dataspace.height}else{if(this._frame_type=="0x1C"){m.remove_link(k,"AXIS_Y");m.calcFrameType();N=this._dataspace.width;e=this.axis_y.getSpacePoint()}else{if(this._frame_type=="1Cx1C"){this.second_multiple_var=s;m.remove_link(k,"AXIS_X");m.remove_link(s,"AXIS_Y");m.calcFrameType();N=this.axis_x.getSpacePoint();e=this.axis_y.getSpacePoint()}}}}var g=true;var n=true;var H=false;var D=false;var c=1;var K=N;var y=e;if(this._frame_type!="1Cx1C"){var r=false;for(var M=0;M<I.length;M++){if(this._frame_type=="1Cx0"){G=this._dataspace.x+this.axis_x.getPoint(A[M])-N/2;F=this._dataspace.y}else{if(this._frame_type=="0x1C"){G=this._dataspace.x;F=this._dataspace.y+this.axis_y.getPoint(A[M])-e/2}else{if(this._frame_type=="multiple"&&this._subframe_type!="0xN"&&this._subframe_type!="Nx0"){K=N;y=e;g=(c==1);D=(c==t);H=(((I.length-1-M)+c)<=t);if(g&&v&&v._orientation_reversed==false){K+=f}else{if(D&&v&&v._orientation_reversed==true){K+=f}}if(D&&a){K+=b}if(H&&x&&x._orientation_reversed==false){y+=O}else{if(n&&x&&(x._orientation_reversed==true||this._subframe_type=="2x1C")){y+=O}}if(n&&l){y+=w}}}}K=Math.round(K);y=Math.round(y);var J=A[M];this._sub_frames.push(this.generateSubFrame(m,K,y,this._dataset,I[M],J,k));this._sub_frames_keys[J]=this._sub_frames[M];this._sub_frames[M]._framespace.x=G;this._sub_frames[M]._framespace.y=F;if(this._frame_type=="multiple"){if(v&&((!g&&v._orientation_reversed==false)||(!D&&v._orientation_reversed==true))){this._sub_frames[M].hide_axis_y=true}if(a&&!D){this._sub_frames[M].hide_axis_y2=true}if(x&&((!H&&x._orientation_reversed==false)||(!n&&x._orientation_reversed==true))){this._sub_frames[M].hide_axis_x=true}if(l&&!n){this._sub_frames[M].hide_axis_x2=true}if(!r&&this._sub_frames[M].hide_axis_y==false&&this._sub_frames[M].hide_axis_x==false){r=true}else{this._sub_frames[M]._include_interaction=false}}this._sub_frames[M].init();this.gr.addChild(this._sub_frames[M].getGrape());if(this._frame_type=="multiple"){if(c==t){c=1;F+=y;G=this._dataspace.x;n=false}else{c++;G+=K}}}}else{this.reference_vars.multiple_elements_per_frame=false;for(var M=0;M<I.length;M++){var B=I[M].unique(s);var h=I[M].split(s,B);if(this.reference_vars.multiple_elements_per_frame==false){for(var P=0;P<h.length;P++){if(h[P].length>1){this.reference_vars.multiple_elements_per_frame=true;break}}}for(var L=0;L<h.length;L++){G=this._dataspace.x+this.axis_x.getPoint(A[M])-N/2;F=this._dataspace.y+this.axis_y.getPoint(B[L])-e/2;this._sub_frames.push(new graphica.Frame(m,N,e,this._dataset));var J=A[M];var z=B[L];this._sub_frames_keys[J]=this._sub_frames_keys[J]||{};var C=this._sub_frames.length-1;this._sub_frames_keys[J][z]=this._sub_frames[C];this._sub_frames[C]._framespace.x=G;this._sub_frames[C]._framespace.y=F;this._sub_frames[C]._subdataset=h[L];this._sub_frames[C]._show_edges=this._show_edges;this._sub_frames[C]._left_padding=0;this._sub_frames[C]._right_padding=0;this._sub_frames[C]._top_padding=0;this._sub_frames[C]._bottom_padding=0;this._sub_frames[C]._is_subframe=true;this._sub_frames[C]._parent_frame=this._frame_type;this._sub_frames[C].reference_vars=this.reference_vars;this._properties.view._settings.graphObj=null;this._sub_frames[C].init();this.gr.addChild(this._sub_frames[C].getGrape())}}}};graphica.Frame.fn.generateSubFrame=function(a,b,g,d,h,f,e,j){var c=new graphica.Frame(a,b,g,d);c._is_vertical_labels_allowed=false;if(typeof j!=="undefined"&&j){c._include_interaction=false}c._subdataset=h;c._show_edges=this._show_edges;c._show_map=this._show_map;c.reference_vars=this.reference_vars;if(typeof this._tmp_max_by_categories!=="undefined"){c._tmp_max_by_categories=this._tmp_max_by_categories;c._tmp_localmax_by_categories=this._tmp_localmax_by_categories}if(typeof this._tmp_grouped_max!=="undefined"){c._tmp_grouped_max=this._tmp_grouped_max}c._map_projection=this._map_projection;c._map_division=this._map_division;c._default_map_color=this._default_map_color;c._default_map_border=this._default_map_border;c._default_map_border_color=this._default_map_border_color;c._map_border_only_in_regions_with_data=this._map_border_only_in_regions_with_data;c._map_border_only_in_selected_country=this._map_border_only_in_selected_country;c._default_map_opacity=this._default_map_opacity;if(this._frame_type=="multiple"){c._category_padding=this._category_padding;c._categorical_bar_variable=this._categorical_bar_variable;c._previous_categorical_bar_variables=this._previous_categorical_bar_variables;c._previous_categorical_bar_variables_aggregation=this._previous_categorical_bar_variables_aggregation;c._bar_max_value=this._bar_max_value;c._bar_min_value=this._bar_min_value;c._quantitative_bar_variables=this._quantitative_bar_variables;c._quantitative_bar_variable=this._quantitative_bar_variable;if(this._properties.include_title_on_small_multiples){if(this._dataset.isDateType(e)){c._title=new Date(f).strformat(this._properties.getSettings(e,graphica.SMALL_MULTIPLES,"aggregation"),this._properties.getSettings(e,graphica.SMALL_MULTIPLES,"label_date_format"))}else{c._title=f;c._alias_option_original_value=f;c._alias_option_alias_value=this._properties.getAlias(this.multiple_var,graphica.SMALL_MULTIPLES,f);c._alias_option_variable=this._dataset.columnName(this.multiple_var);c._title=c._alias_option_alias_value||f}c._title_size=this._properties.small_title_font_size;c._title_color=this._properties.small_title_color;if(this._properties.small_title_font){c._title_font=this._properties.small_title_font}}c._left_padding=this._properties.small_left_padding;c._right_padding=this._properties.small_right_padding;c._top_padding=this._properties.small_top_padding;c._bottom_padding=this._properties.small_bottom_padding}else{c._left_padding=4;c._right_padding=4;c._top_padding=4;c._bottom_padding=4}c._is_subframe=true;c._parent_frame=this._frame_type;this._properties.view._settings.graphObj=null;return c};graphica.Frame.fn.getSubframe=function(b,c){if(this._sub_frames.length==0){return this}var a;if(Array.isArray(b)){a=b[this.multiple_var]}else{a=this._properties.getDataset(c).getValue(b,this.multiple_var)}if(this.second_multiple_var===null){if(typeof this._sub_frames_keys[a]!=="undefined"){return this._sub_frames_keys[a]}}else{var d;if(Array.isArray(b)){d=b[this.second_multiple_var]}else{d=this._dataset.getValue(b,this.second_multiple_var)}if(typeof this._sub_frames_keys[a]!=="undefined"&&typeof this._sub_frames_keys[a][d]!=="undefined"){return this._sub_frames_keys[a][d]}}return false};graphica.Frame.fn.getCategoricalMatrix=function(){if(this._multiple_elements_per_frame==false){return}var b=this._categorical_matrix;var a=this._subdataset||this._dataset;if(this._properties.countVariables(graphica.UNIT)>0){b.max_per_cell=a.unique(this._properties.firstVariable(graphica.UNIT)).length}else{b.max_per_cell=a.length}b.latest_x=0;b.latest_y=0;b._cell_width=graphica.Utils.squareWidthIntoRectangle(this._dataspace.width,this._dataspace.height,b.max_per_cell);if(this._properties.default_form!=graphica.CIRCLE){b._cell_width=Math.min(b._cell_width,(Math.sqrt(this._properties.default_area/Math.PI)*2)+this._properties.default_border_width+1)}if(b._cell_width>3){b._cell_width=parseInt(b._cell_width)}};graphica.Frame.fn.getCategoricalMatrixPosition=function(f){var b;let dev={x:0,y:0};var d=this._dataspace;b=this._categorical_matrix;b.origin_x=0;b.origin_y=0;this._categorical_matrix._x_cell_width=d.width;var c=this._categorical_matrix._cell_width;var e=this._categorical_matrix._x_cell_width;var a=this._categorical_matrix._y_cell_width;dev.x=d.x+b.origin_x+b.latest_x+c*0.5;dev.y=d.y+b.origin_y+b.latest_y+c*0.5;dev.x1=d.x;dev.y1=d.y;if(typeof f!=="undefined"&&f=="lefttoright"){b.latest_y+=c;if((b.latest_y+c)-1>a){b.latest_y=0;b.latest_x+=c}}else{b.latest_x+=c;if((b.latest_x+c)-1>e){b.latest_x=0;b.latest_y+=c}}return dev};graphica.Frame.fn.isACategoricalSpace=function(){return(this._frame_type=="multiple"||this._frame_type=="0x0"||this._frame_type=="1Cx1C"||this._frame_type=="1Cx0"||this._frame_type=="0x1C"||(this._frame_type=="2x2"&&!this._dataset.isQuantitative(this._properties.secondVariable(graphica.POS_X))&&!this._dataset.isQuantitative(this._properties.secondVariable(graphica.POS_Y)))||(this._frame_type=="1x2"&&!this._dataset.isQuantitative(this._properties.firstVariable(graphica.POS_X))&&!this._dataset.isQuantitative(this._properties.secondVariable(graphica.POS_Y)))||(this._frame_type=="2x1"&&!this._dataset.isQuantitative(this._properties.secondVariable(graphica.POS_X))&&!this._dataset.isQuantitative(this._properties.firstVariable(graphica.POS_Y))))};graphica.Frame.fn.getCellWidthSpace=function(){if(this._categorical_matrix){return this._categorical_matrix._cell_width}if(this.axis_x2){return this.axis_x2.getSpacePoint()}if(this.axis_x){return this.axis_x.getSpacePoint()}return this._dataspace.width};graphica.Frame.fn.getCellHeightSpace=function(){if(this._categorical_matrix){return this._categorical_matrix._cell_width}if(this.axis_y2){return this.axis_y2.getSpacePoint()}if(this.axis_y){return this.axis_y.getSpacePoint()}return this._dataspace.height};graphica.Frame.fn.doBubbleLayout=function(d,k,c,j){if(typeof j!=="number"){j=1}if(typeof k!=="boolean"){k=false}if(typeof c!=="boolean"){c=false}if(k){c=true}var h=this;if(typeof d=="undefined"){d="0x0"}if(this._sub_frames.length){for(var f=0;f<this._sub_frames.length;f++){this._sub_frames[f].doBubbleLayout(d)}}else{if(!this._tmp_grgroup_to_do_bubble_layout){return}var a=this._tmp_grgroup_to_do_bubble_layout;var b=[];var g=0;a.each(function(){if(!this._form_data){this._form_data=new graphica.FormData();this._form_data.radius(5)}if(k&&this._reflabel){this._reflabel._tmpbox=this._reflabel._tmpbox||this._reflabel.getBBox();b.push({id:g,form:graphica.BOX,width:this._reflabel._tmpbox.width,height:this._reflabel._tmpbox.height,x:this.x(),y:this.y(),limits:this._limits})}else{if(this._form_data.form()==graphica.FILLED_BOX){b.push({id:g,width:this._form_data.width()/j,height:this._form_data.height()/j,form:graphica.FILLED_BOX,x:this.x()-this._form_data.width()/j/2,y:this.y()-this._form_data.height()/j/2,limits:this._limits})}else{b.push({id:g,r:this._form_data.radius()/j,form:graphica.DISK,x:this.x(),y:this.y(),limits:this._limits})}}g++});b=graphica.Utils.bubbleLayout(b,this._dataspace.width,this._dataspace.height,d,c,this._properties._layout_distance/j,this._properties._layout_spatial_boundaries,j);if(k&&d=="0x0"||(b.length&&b[0].form==graphica.FILLED_BOX)){for(var e=0;e<b.length;e++){b[e].width=b[e].width||0;b[e].height=b[e].height||0;b[e].x+=b[e].width/2;b[e].y+=b[e].height/2}}for(var f=0;f<b.length;f++){let no=a.item(b[f].id);no.x(b[f].x).y(b[f].y);if(typeof no.graphNode!="undefined"){no.graphNode._layoutPosX=b[f].x-this._dataspace.x;no.graphNode._layoutPosY=b[f].y-this._dataspace.y}if(no._annotation_grape){no._annotation_grape._update_position()}if(no._reflabel){no._reflabel.x(b[f].x).y(b[f].y)}}}};window.graphica=window.graphica||{};graphica.Geo={};var all_scripts=document.getElementsByTagName("SCRIPT");graphica.Geo.path="";if(document.currentScript&&document.currentScript.src){var hr=new URL(document.currentScript.src).href;graphica.Geo.path=hr.substr(0,hr.lastIndexOf("/"))}graphica.Geo.name_2_iso3={AFGHANISTAN:"AFG","ALAND ISLANDS":"ALA",ALBANIA:"ALB",ALGERIA:"DZA","AMERICAN SAMOA":"ASM",ANDORRA:"AND",ANGOLA:"AGO",ANGUILLA:"AIA",ANTARCTICA:"ATA","ANTIGUA AND BARBUDA":"ATG",ARGENTINA:"ARG",ARMENIA:"ARM",ARUBA:"ABW",AUSTRALIA:"AUS",AUSTRIA:"AUT",AZERBAIJAN:"AZE",BAHAMAS:"BHS",BAHRAIN:"BHR",BANGLADESH:"BGD",BARBADOS:"BRB",BELARUS:"BLR",BELGIUM:"BEL",BELIZE:"BLZ",BENIN:"BEN",BERMUDA:"BMU",BHUTAN:"BTN",BOLIVIA:"BOL","BOSNIA AND HERZEGOVINA":"BIH",BOTSWANA:"BWA","BOUVET ISLAND":"BVT",BRAZIL:"BRA","BRITISH VIRGIN ISLANDS":"VGB","BRITISH INDIAN OCEAN TERRITORY":"IOT","BRUNEI DARUSSALAM":"BRN",BRUNEI:"BRN",BULGARIA:"BGR","BURKINA FASO":"BFA",BURUNDI:"BDI",CAMBODIA:"KHM",CAMEROON:"CMR",CANADA:"CAN","CAPE VERDE":"CPV","CAYMAN ISLANDS":"CYM","CENTRAL AFRICAN REPUBLIC":"CAF",CHAD:"TCD",CHILE:"CHL",CHINA:"CHN","HONG KONG":"HKG",MACAO:"MAC","CHRISTMAS ISLAND":"CXR","COCOS (KEELING) ISLANDS":"CCK",COLOMBIA:"COL",COMOROS:"COM","CONGO(BRAZZAVILLE)":"COG","REPUBLIC OF THE CONGO":"COG","CONGO REPUBLIC":"COG","DEMOCRATIC REPUBLIC OF THE CONGO":"COD",CONGO:"COD","COOK ISLANDS":"COK","COSTA RICA":"CRI","CTE D'IVOIRE":"CIV","COTE D'IVOIRE":"CIV","IVORY COAST":"CIV",CROATIA:"HRV",CUBA:"CUB",CYPRUS:"CYP","CZECH REPUBLIC":"CZE",DENMARK:"DNK",DJIBOUTI:"DJI",DOMINICA:"DMA","DOMINICAN REPUBLIC":"DOM",ECUADOR:"ECU",EGYPT:"EGY","EL SALVADOR":"SLV","EQUATORIAL GUINEA":"GNQ",ERITREA:"ERI",ESTONIA:"EST",ETHIOPIA:"ETH","FALKLAND ISLANDS (MALVINAS)":"FLK","FAROE ISLANDS":"FRO",FIJI:"FJI",FINLAND:"FIN",FRANCE:"FRA","FRENCH GUIANA":"GUF","FRENCH POLYNESIA":"PYF","FRENCH SOUTHERN TERRITORIES":"ATF",GABON:"GAB",GAMBIA:"GMB",GEORGIA:"GEO",GERMANY:"DEU",GHANA:"GHA",GIBRALTAR:"GIB",GREECE:"GRC",GREENLAND:"GRL",GRENADA:"GRD",GUADELOUPE:"GLP",GUAM:"GUM",GUATEMALA:"GTM",GUERNSEY:"GGY",GUINEA:"GIN","GUINEA-BISSAU":"GNB",GUYANA:"GUY",HAITI:"HTI","HEARD ISLAND AND MCDONALD ISLANDS":"HMD","HOLY SEE(VATICAN CITY STATE)":"VAT",HONDURAS:"HND",HUNGARY:"HUN",ICELAND:"ISL",INDIA:"IND",INDONESIA:"IDN",IRAN:"IRN",IRAQ:"IRQ",IRELAND:"IRL","ISLE OF MAN":"IMN",ISRAEL:"ISR",ITALY:"ITA",JAMAICA:"JAM",JAPAN:"JPN",JERSEY:"JEY",JORDAN:"JOR",KAZAKHSTAN:"KAZ",KENYA:"KEN",KIRIBATI:"KIR","NORTH KOREA":"PRK","SOUTH KOREA":"KOR",KUWAIT:"KWT",KYRGYZSTAN:"KGZ","LAO PDR":"LAO",LAOS:"LAO",LATVIA:"LVA",LEBANON:"LBN",LESOTHO:"LSO",LIBERIA:"LBR",LIBYA:"LBY",LIECHTENSTEIN:"LIE",LITHUANIA:"LTU",LUXEMBOURG:"LUX",MACEDONIA:"MKD",MADAGASCAR:"MDG",MALAWI:"MWI",MALAYSIA:"MYS",MALDIVES:"MDV",MALI:"MLI",MALTA:"MLT","MARSHALL ISLANDS":"MHL",MARTINIQUE:"MTQ",MAURITANIA:"MRT",MAURITIUS:"MUS",MAYOTTE:"MYT",MEXICO:"MEX",MICRONESIA:"FSM",MOLDOVA:"MDA",MONACO:"MCO",MONGOLIA:"MNG",MONTENEGRO:"MNE",MONTSERRAT:"MSR",MOROCCO:"MAR",MOZAMBIQUE:"MOZ",MYANMAR:"MMR",NAMIBIA:"NAM",NAURU:"NRU",NEPAL:"NPL",NETHERLANDS:"NLD","NETHERLANDS ANTILLES":"ANT","NEW CALEDONIA":"NCL","NEW ZEALAND":"NZL",NICARAGUA:"NIC",NIGER:"NER",NIGERIA:"NGA",NIUE:"NIU","NORFOLK ISLAND":"NFK","NORTHERN MARIANA ISLANDS":"MNP",NORWAY:"NOR",OMAN:"OMN",PAKISTAN:"PAK",PALAU:"PLW","PALESTINIAN TERRITORY":"PSE",PALESTINE:"PSE","WEST BANK AND GAZA":"PSE",PANAMA:"PAN","PAPUA NEW GUINEA":"PNG",PARAGUAY:"PRY",PERU:"PER",PHILIPPINES:"PHL",PITCAIRN:"PCN",POLAND:"POL",PORTUGAL:"PRT","PUERTO RICO":"PRI",QATAR:"QAT","RUNION":"REU",REUNION:"REU",ROMANIA:"ROU","RUSSIAN FEDERATION":"RUS",RUSSIA:"RUS",RWANDA:"RWA","SAINT-BARTHLEMY":"BLM","SAINT HELENA":"SHN","SAINT KITTS AND NEVIS":"KNA","SAINT LUCIA":"LCA","SAINT-MARTIN (FRENCH PART)":"MAF","SAINT PIERRE AND MIQUELON":"SPM","SAINT VINCENT AND GRENADINES":"VCT",SAMOA:"WSM","SAN MARINO":"SMR","SAO TOME AND PRINCIPE":"STP","SAUDI ARABIA":"SAU",SENEGAL:"SEN",SERBIA:"SRB",SEYCHELLES:"SYC","SIERRA LEONE":"SLE",SINGAPORE:"SGP",SLOVAKIA:"SVK","SLOVAK REPUBLIC":"SVK",SLOVENIA:"SVN","SOLOMON ISLANDS":"SLB",SOMALIA:"SOM","SOUTH AFRICA":"ZAF","SOUTH GEORGIA AND THE SOUTH SANDWICH ISLANDS":"SGS","SOUTH SUDAN":"SSD",SPAIN:"ESP","SRI LANKA":"LKA",SUDAN:"SDN",SURINAME:"SUR","SVALBARD AND JAN MAYEN ISLANDS":"SJM",SWAZILAND:"SWZ",SWEDEN:"SWE",SWITZERLAND:"CHE","SYRIAN ARAB REPUBLIC":"SYR",SYRIA:"SYR",TAIWAN:"TWN",TAJIKISTAN:"TJK",TANZANIA:"TZA","UNITED REPUBLIC OF TANZANIA":"TZA",THAILAND:"THA","TIMOR-LESTE":"TLS",TOGO:"TGO",TOKELAU:"TKL",TONGA:"TON","TRINIDAD AND TOBAGO":"TTO",TUNISIA:"TUN",TURKEY:"TUR",TURKMENISTAN:"TKM","TURKS AND CAICOS ISLANDS":"TCA",TUVALU:"TUV",UGANDA:"UGA",UKRAINE:"UKR","UNITED ARAB EMIRATES":"ARE","UNITED KINGDOM":"GBR","UNITED STATES OF AMERICA":"USA","UNITED STATES":"USA","UNITED STATES MINOR OUTLYING ISLANDS":"UMI",URUGUAY:"URY",UZBEKISTAN:"UZB",VANUATU:"VUT","VENEZUELA(BOLIVARIAN REPUBLIC OF)":"VEN",VENEZUELA:"VEN","VIET NAM":"VNM",VIETNAM:"VNM","VIRGIN ISLANDS":"VIR","WALLIS AND FUTUNA ISLANDS":"WLF","WESTERN SAHARA":"ESH",YEMEN:"YEM",ZAMBIA:"ZMB",ZIMBABWE:"ZWE",KOSOVO:"XKX"};graphica.Geo.iso2_2_iso3={AF:"AFG",AX:"ALA",AL:"ALB",DZ:"DZA",AS:"ASM",AD:"AND",AO:"AGO",AI:"AIA",AQ:"ATA",AG:"ATG",AR:"ARG",AM:"ARM",AW:"ABW",AU:"AUS",AT:"AUT",AZ:"AZE",BS:"BHS",BH:"BHR",BD:"BGD",BB:"BRB",BY:"BLR",BE:"BEL",BZ:"BLZ",BJ:"BEN",BM:"BMU",BT:"BTN",BO:"BOL",BA:"BIH",BW:"BWA",BV:"BVT",BR:"BRA",VG:"VGB",IO:"IOT",BN:"BRN",BG:"BGR",BF:"BFA",BI:"BDI",KH:"KHM",CM:"CMR",CA:"CAN",CV:"CPV",KY:"CYM",CF:"CAF",TD:"TCD",CL:"CHL",CN:"CHN",HK:"HKG",MO:"MAC",CX:"CXR",CC:"CCK",CO:"COL",KM:"COM",CG:"COG",CD:"COD",CK:"COK",CR:"CRI",CI:"CIV",HR:"HRV",CU:"CUB",CY:"CYP",CZ:"CZE",DK:"DNK",DJ:"DJI",DM:"DMA",DO:"DOM",EC:"ECU",EG:"EGY",SV:"SLV",GQ:"GNQ",ER:"ERI",EE:"EST",ET:"ETH",FK:"FLK",FO:"FRO",FJ:"FJI",FI:"FIN",FR:"FRA",GF:"GUF",PF:"PYF",TF:"ATF",GA:"GAB",GM:"GMB",GE:"GEO",DE:"DEU",GH:"GHA",GI:"GIB",GR:"GRC",GL:"GRL",GD:"GRD",GP:"GLP",GU:"GUM",GT:"GTM",GG:"GGY",GN:"GIN",GW:"GNB",GY:"GUY",HT:"HTI",HM:"HMD",VA:"VAT",HN:"HND",HU:"HUN",IS:"ISL",IN:"IND",ID:"IDN",IR:"IRN",IQ:"IRQ",IE:"IRL",IM:"IMN",IL:"ISR",IT:"ITA",JM:"JAM",JP:"JPN",JE:"JEY",JO:"JOR",KZ:"KAZ",KE:"KEN",KI:"KIR",KP:"PRK",KR:"KOR",KW:"KWT",KG:"KGZ",LA:"LAO",LV:"LVA",LB:"LBN",LS:"LSO",LR:"LBR",LY:"LBY",LI:"LIE",LT:"LTU",LU:"LUX",MK:"MKD",MG:"MDG",MW:"MWI",MY:"MYS",MV:"MDV",ML:"MLI",MT:"MLT",MH:"MHL",MQ:"MTQ",MR:"MRT",MU:"MUS",YT:"MYT",MX:"MEX",FM:"FSM",MD:"MDA",MC:"MCO",MN:"MNG",ME:"MNE",MS:"MSR",MA:"MAR",MZ:"MOZ",MM:"MMR",NA:"NAM",NR:"NRU",NP:"NPL",NL:"NLD",AN:"ANT",NC:"NCL",NZ:"NZL",NI:"NIC",NE:"NER",NG:"NGA",NU:"NIU",NF:"NFK",MP:"MNP",NO:"NOR",OM:"OMN",PK:"PAK",PW:"PLW",PS:"PSE",PA:"PAN",PG:"PNG",PY:"PRY",PE:"PER",PH:"PHL",PN:"PCN",PL:"POL",PT:"PRT",PR:"PRI",QA:"QAT",RE:"REU",RO:"ROU",RU:"RUS",RW:"RWA",BL:"BLM",SH:"SHN",KN:"KNA",LC:"LCA",MF:"MAF",PM:"SPM",VC:"VCT",WS:"WSM",SM:"SMR",ST:"STP",SA:"SAU",SN:"SEN",RS:"SRB",SC:"SYC",SL:"SLE",SG:"SGP",SK:"SVK",SI:"SVN",SB:"SLB",SO:"SOM",ZA:"ZAF",GS:"SGS",SS:"SSD",ES:"ESP",LK:"LKA",SD:"SDN",SR:"SUR",SJ:"SJM",SZ:"SWZ",SE:"SWE",CH:"CHE",SY:"SYR",TW:"TWN",TJ:"TJK",TZ:"TZA",TH:"THA",TL:"TLS",TG:"TGO",TK:"TKL",TO:"TON",TT:"TTO",TN:"TUN",TR:"TUR",TM:"TKM",TC:"TCA",TV:"TUV",UG:"UGA",UA:"UKR",AE:"ARE",GB:"GBR",US:"USA",UM:"UMI",UY:"URY",UZ:"UZB",VU:"VUT",VE:"VEN",VN:"VNM",VI:"VIR",WF:"WLF",EH:"ESH",YE:"YEM",ZM:"ZMB",ZW:"ZWE",XK:"XKX"};graphica.Geo.centroids={AFG:[33,66],ALB:[41,20],ANT:[12.11,-68.92],DZA:[28,3],ASM:[-14.3333333,-170],AND:[42.5,1.5],AGO:[-12.5,18.5],AIA:[18.216667,-63.05],ATG:[17.05,-61.8],ARG:[-34,-64],ARM:[40,45],ABW:[12.5,-69.966667],SHN:[-15.95,-5.7],AUS:[-25,135],AUT:[47.333333,13.333333],AZE:[40.5,47.5],BHS:[24,-76],BHR:[26,50.5],BGD:[24,90],BRB:[13.166667,-59.533333],BLR:[53,28],BEL:[50.833333,4],BLZ:[17.25,-88.75],BEN:[9.5,2.25],BMU:[32.333333,-64.75],BTN:[27.5,90.5],BOL:[-17,-65],BIH:[44.25,17.833333],BWA:[-22,24],BVT:[-54.433333,3.4],BRA:[-10,-55],IOT:[-6,72],VGB:[18.5,-64.5],BRN:[4.5,114.666667],BGR:[43,25],BFA:[13,-2],MMR:[22,98],BDI:[-3.5,30],KHM:[13,105],CMR:[6,12],CAN:[59,-110],CPV:[16,-24],CYM:[19.5,-80.666667],CAF:[7,21],TCD:[15,19],CHL:[-30,-71],CHN:[35,105],CXR:[-10.5,105.666667],CCK:[-12,96.833333],COL:[4,-72],COM:[-12.166667,44.25],COK:[-16.083333,-161.583333],CRI:[10,-84],CIV:[8,-5],HRV:[45.166667,15.5],CUB:[22,-79.5],CYP:[35,33],CZE:[49.75,15],COD:[0,25],DNK:[56,10],DJI:[11.5,42.5],DMA:[15.5,-61.333333],DOM:[19,-70.666667],ECU:[-2,-77.5],EGY:[27,30],SLV:[13.833333,-88.916667],GNQ:[2,10],ERI:[15,39],EST:[59,26],ETH:[8,38],FLK:[-51.75,-59.166667],FRO:[62,-7],FSM:[5,152],FJI:[-18,178],FIN:[64,26],FRA:[46,2],GUF:[4,-53],PYF:[-15,-140],ATF:[-43,67],GAB:[-1,11.75],GMB:[13.5,-15.5],PSE:[31.425074,34.373398],GEO:[41.999981,43.499905],DEU:[51.5,10.5],GHA:[8,-2],GIB:[36.133333,-5.35],GRC:[39,22],GRL:[72,-40],GRD:[12.116667,-61.666667],GLP:[16.25,-61.583333],GUM:[13.4444444,144.7366667],GTM:[15.5,-90.25],GGY:[49.583333,-2.333333],GIN:[11,-10],GNB:[12,-15],GUY:[5,-59],HTI:[19,-72.416667],HMD:[-53,73],HND:[15,-86.5],HKG:[22.25,114.166667],HUN:[47,20],ISL:[65,-18],IND:[20,77],IDN:[-5,120],IRN:[32,53],IRQ:[33,44],IRL:[53,-8],IMN:[54.25,-4.5],ISR:[31.5,34.75],ITA:[42.833333,12.833333],JAM:[18.25,-77.5],JPN:[36,138],JEY:[49.216667,-2.116667],JOR:[31,36],KAZ:[48,68],KEN:[1,38],KIR:[-5,-170],KWT:[29.5,47.75],KGZ:[41,75],LAO:[18,105],LVA:[57,25],LBN:[33.833333,35.833333],LSO:[-29.5,28.25],LBR:[6.5,-9.5],LBY:[25,17],LIE:[47.166667,9.533333],LTU:[56,24],LUX:[49.75,6.166667],MAC:[22.157778,113.559722],MKD:[41.833333,22],MDG:[-20,47],MWI:[-13.5,34],MYS:[2.5,112.5],MDV:[3.2,73],MLI:[17,-4],MLT:[35.916667,14.433333],MHL:[10,167],MTQ:[14.666667,-61],MRT:[20,-12],MUS:[-20.3,57.583333],MYT:[-12.833333,45.166667],MEX:[23,-102],MDA:[47,29],MCO:[43.733333,7.4],MNG:[46,105],MNE:[42.5,19.3],MSR:[16.75,-62.2],MAR:[32,-5],MOZ:[-18.25,35],NAM:[-22,17],NRU:[-0.533333,166.916667],NPL:[28,84],NLD:[52.5,5.75],NCL:[-21.5,165.5],NZL:[-42,174],NIC:[13,-85],NER:[16,8],NGA:[10,8],NIU:[-19.033333,-169.866667],NFK:[-29.033333,167.95],PRK:[40,127],MNP:[16,146],NOR:[62,10],OMN:[21,57],PAK:[30,70],PLW:[6,134],PAN:[9,-80],PNG:[-6,147],PRY:[-22.993333,-57.996389],PER:[-10,-76],PHL:[13,122],PCN:[-25.066667,-130.1],POL:[52,20],PRT:[39.5,-8],PRI:[18.2482882,-66.4998941],QAT:[25.5,51.25],COG:[-1,15],REU:[-21.1,55.6],ROU:[46,25],RUS:[60,100],RWA:[-2,30],BLM:[17.9,-62.833333],KNA:[17.333333,-62.75],LCA:[13.883333,-60.966667],MAF:[18.075,-63.05833],SPM:[46.833333,-56.333333],VCT:[13.083333,-61.2],WSM:[-13.803096,-172.178309],SMR:[43.933333,12.416667],STP:[1,7],SAU:[25,45],SEN:[14,-14],SRB:[44,21],SYC:[-4.583333,55.666667],SLE:[8.5,-11.5],SGP:[1.366667,103.8],SVK:[48.666667,19.5],SVN:[46.25,15.166667],SLB:[-8,159],SOM:[6,48],ZAF:[-30,26],SGS:[-56,-33],KOR:[37,127.5],SSD:[8,30],ESP:[40,-4],LKA:[7,81],SDN:[16,30],SUR:[4,-56],SJM:[78,20],SWZ:[-26.5,31.5],SWE:[62,15],CHE:[47,8],SYR:[35,38],TWN:[24,121],TJK:[39,71],TZA:[-6,35],THA:[15,100],TLS:[-8.833333,125.75],TGO:[8,1.166667],TKL:[-9,-171.75],TON:[-20,-175],TTO:[11,-61],TUN:[34,9],TUR:[39.059012,34.911546],TKM:[40,60],TCA:[21.733333,-71.583333],TUV:[-8,178],UGA:[2,33],UKR:[49,32],ARE:[24,54],GBR:[54,-4],USA:[39.828175,-98.5795],URY:[-33,-56],UMI:[5.8811111,-162.0725],VIR:[18.3482891,-64.9834807],UZB:[41.707542,63.84911],VUT:[-16,167],VAT:[41.9,12.45],VEN:[8,-66],VNM:[16.166667,107.833333],WLF:[-13.3,-176.2],PSE:[31.666667,35.25],ESH:[25,-13.5],YEM:[15.5,47.5],ZMB:[-15,30],ZWE:[-19,29],XKX:[42.66,21.16]};graphica.Geo.existsCountry=function(a){a=a.toUpperCase();return(typeof graphica.Geo.name_2_iso3[a]!=="undefined"||typeof graphica.Geo.centroids[a]!=="undefined"||typeof graphica.Geo.iso2_2_iso3[a]!=="undefined")};graphica.Geo.existsState=function(c){if(typeof graphica.Geo.states=="undefined"){graphica.Geo.states=[];if(typeof dbstatesprovinces!=="undefined"){var b=dbstatesprovinces.header.getId("adm1_code");var a=dbstatesprovinces.header.getId("name");dbstatesprovinces.eachRow(function(f){if(f.length>=2){var e=f[b];var d=f[a].toUpperCase();if(typeof graphica.Geo.states[d]=="undefined"){graphica.Geo.states[d]=[e]}else{graphica.Geo.states[d].push(e)}}})}}return(typeof graphica.Geo.states[c.toUpperCase()]!=="undefined")};graphica.Geo.Map=function(e,f,d,c,b){if(typeof b!=="string"||b!="state"){b="country"}this._admin_level=b;this._is_visible=true;if(typeof c==="boolean"){this._is_visible=c}this._include_area=d;this._default_color="rgb(220,220,220)";this._default_border=1;this._default_border_color="white";this._default_opacity=1;this._width=e.width;this._height=e.height;this._dsx=e.x;this._dsy=e.y;this.hasBeenInit=false;this._frame=f;this._properties=f._properties;var a=f._map_projection;if(typeof a==="undefined"){a="mercator"}if(a!="mercator"&&a!="natural"&&a!="equirectangular"){a="mercator"}this._projection=a;if(this._projection=="mercator"){this._projection_width=1000;this._projection_height=646;if(this._admin_level=="state"){this._projection_width=1000;this._projection_height=662;this._map_url=graphica.Geo.path+"/world_admin1_mercator.svg";if(typeof world_admin1_mercator!="undefined"){this._map_content=world_admin1_mercator}}else{this._map_url=graphica.Geo.path+"/world_country_mercator.svg";if(typeof world_country_mercator!="undefined"){this._map_content=world_country_mercator}}}else{if(this._projection=="natural"){this._projection_width=1000;this._projection_height=436;if(this._admin_level=="state"){this._projection_width=998;this._projection_height=445;this._map_url=graphica.Geo.path+"/world_admin1_natural.svg";if(typeof world_admin1_natural!="undefined"){this._map_content=world_admin1_natural}}else{this._map_url=graphica.Geo.path+"/world_country_natural.svg";if(typeof world_country_natural!="undefined"){this._map_content=world_country_natural}}}else{if(this._projection=="equirectangular"){this._projection_width=1000;this._projection_height=388;if(this._admin_level=="state"){this._projection_width=999.7;this._projection_height=397.5;this._map_url=graphica.Geo.path+"/world_admin1_equirectangular.svg";if(typeof world_admin1_equirectangular!="undefined"){this._map_content=world_admin1_equirectangular}}else{this._map_url=graphica.Geo.path+"/world_country_equirectangular.svg";if(typeof world_country_equirectangular!="undefined"){this._map_content=world_country_equirectangular}}}}}};graphica.Geo.Map.fn=graphica.Geo.Map.prototype;graphica.Geo.Map.fn.init=function(c){var g=this;this.async_map=true;if(typeof this._map_content==="string"){this.async_map=false}this.root=new Grape();this._iso32grapes={};this.grregions=new Grape();this._regions=new GrapeGroup();var d=this._width/this._projection_width;var h=this._height/this._projection_height;var b=0;if(this._admin_level=="state"){dbstatesprovinces.eachRow(function(l,j){var k=l[0];g._iso32grapes[k]=j;g._regions.push(new Grape("path").enableEvents(false).attr("data-id",k))})}else{for(var i in graphica.Geo.centroids){if(graphica.Geo.centroids.hasOwnProperty(i)){this._iso32grapes[i]=b;this._regions.push(new Grape("path").enableEvents(false).attr("data-id",i));b++}}}this.grregions.opacity(0).addTo(this.root);this._regions.addTo(this.grregions);if(d<h){this.ratio=d;this.root.scale(d);this.root.y((this._height-this._projection_height*d)/2)}else{this.ratio=h;this.root.scale(h);this.root.x((this._width-this._projection_width*h)/2)}var f=new GrapeGroup();this._regions.each(function(){if(g._map_border_only_in_selected_country&&g._admin_level=="state"&&this.attr("data-id")&&this.attr("data-id").startsWith(g.getISO3(g._map_border_only_in_selected_country))==false){this.attr("stroke",g._default_color).attr("stroke-width",0)}else{if(g._map_border_only_in_regions_with_data){this.attr("stroke",g._default_color).attr("stroke-width",0)}else{this.attr("stroke",g._default_border_color).attr("stroke-width",g._default_border/2/g.ratio);if(g._map_border_only_in_selected_country&&g._admin_level=="state"){f.push(this)}}}this.opacity(g._default_opacity).style("fill",g._default_color).style("fill-rule","evenodd").style("stroke-linejoin","round").addClass("nonscalable_border")});if(f.length>0){f.toFront()}var g=this;var e=function(j){var m=new DOMParser();var k=m.parseFromString(j,"image/svg+xml");var l=k.getElementsByTagName("svg").item(0).getElementsByTagName("g").item(0);l=new Grape(l).getChildren();l.each(function(){var q=(g._admin_level=="country")?this.attr("data-iso_a3"):this.id();var p=g._iso32grapes[q];if(typeof p!=="undefined"){var o=this.attr("d");if(o){g._regions.item(p).attr("d",o)}if(g._regions.item(p)._need_zoom_autofocus){var n=g._regions.item(p).getBBox();if(g.zoom_auto_focus_box){g.zoom_auto_focus_box.x=Math.min(g.zoom_auto_focus_box.x,n.x);g.zoom_auto_focus_box.y=Math.min(g.zoom_auto_focus_box.y,n.y);g.zoom_auto_focus_box.x2=Math.max(g.zoom_auto_focus_box.x2,n.x+n.width*g.ratio);g.zoom_auto_focus_box.y2=Math.max(g.zoom_auto_focus_box.y2,n.y+n.height*g.ratio)}else{g.zoom_auto_focus_box={x:n.x,y:n.y,x2:n.x+n.width*g.ratio,y2:n.y+n.height*g.ratio}}}}if(g._regions.item(p)._annotation_grape){g._regions.item(p)._annotation_grape._update_position()}});if(g._include_area&&g.async_map==true){g.valuebyareaMap(g._regions)}g.grregions.opacity(1);if(g._elms_to_make_zoom&&g.zoom_auto_focus_box&&(g.zoom_auto_focus_box.x!=g.zoom_auto_focus_box.x2||g.zoom_auto_focus_box.y!=g.zoom_auto_focus_box.y2)){g._elms_to_make_zoom.focusZoom(g.zoom_auto_focus_box,false)}if(c){c.call(g)}g.hasBeenInit=true};if(this._is_visible){if(this.async_map==false){e(g._map_content)}else{var a=raceme.ajax({url:this._map_url,done:function(j){e(j)}})}}};graphica.Geo.Map.fn.latitude2y=function(i,a){if(i===null||a===null){return null}var d=i*Math.PI/180;var g;var h;var e;-59;var j=83.7;var b=(this._admin_level=="country")?-55.7:-59;if(this._projection=="mercator"){var f=this._projection_height;var c=Math.log(Math.abs(Math.tan((Math.PI/4)+(d/2))));e=(f/2)-(f*c/(2*Math.PI));e+=f/180*6.1;e=f/(2*Math.PI)*Math.log(Math.tan(Math.PI/4+(i/2)*Math.PI/180));e=f/2-e;g=f/(2*Math.PI)*Math.log(Math.tan(Math.PI/4+(j/2)*Math.PI/180));g=f/2-g;h=f/(2*Math.PI)*Math.log(Math.tan(Math.PI/4+(b/2)*Math.PI/180));h=f/2-h;return raceme.map(e,g,h,0,f)}else{if(this._projection=="natural"){e=this._naturalLatitude(i);g=this._naturalLatitude(j);h=this._naturalLatitude(b);return raceme.map(e,g,h,0,this._projection_height)}else{if(this._projection=="equirectangular"){return raceme.map(i,j,b,0,this._projection_height)}}}};graphica.Geo.Map.fn._naturalLatitude=function(g){var c=g*Math.PI/180;var f=Math.pow(c,3);var b=Math.pow(c,7);var a=Math.pow(c,9);var e=Math.pow(c,11);var d=180;return this._projection_height/2-(d*((1.007226*c)+(0.015085*f)+(-0.044475*b)+(0.028874*a)+(-0.005916*e)))};graphica.Geo.Map.fn._naturalLongitude=function(a,i){var b=i*Math.PI/180;var h=a*Math.PI/180;var e=Math.pow(b,2);var c=Math.pow(b,4);var f=Math.pow(b,10);var d=Math.pow(b,12);var g=180;return this._projection_width/2+(g*h*(0.8707+(-0.131979*e)+(-0.013791*c)+(0.003971*f)+(-0.001529*d)))};graphica.Geo.Map.fn.longitude2x=function(a,b){if(b===null||a===null){return null}if(this._projection=="mercator"){return raceme.map(a,-180,180,0,this._projection_width)}else{if(this._projection=="natural"){return raceme.map(this._naturalLongitude(a,b),this._naturalLongitude(-178.5,0),this._naturalLongitude(179,0),0,this._projection_width)}else{if(this._projection=="equirectangular"){return((a+180)*(this._projection_width/360))}}}};graphica.Geo.Map.fn.getCentroid=function(f,h){var a={x:null,y:null};if(this._admin_level=="state"){f=f.toUpperCase();if(graphica.Geo.existsState(f)){var i;var b="";if(this._properties.country_specification=="value"&&typeof this._properties.country_specification_label=="string"){b=this.getISO3(this._properties.country_specification_label)}else{if(this._properties.country_specification=="variable"&&typeof this._properties.country_specification_variable!=="undefined"&&typeof h!="undefined"){b=this.getISO3(h[this._properties.country_specification_variable])}}if(dbstatesprovinces){if(!b||graphica.Geo.states[f].length==1){i=graphica.Geo.states[f][0]}else{for(var g=0;g<graphica.Geo.states[f].length;g++){if(graphica.Geo.states[f][g].startsWith(b)){i=graphica.Geo.states[f][g];break}else{if(g==graphica.Geo.states[f].length-1){i=graphica.Geo.states[f][0]}}}}var c=dbstatesprovinces.header.getId("adm1_code");var e=dbstatesprovinces.indexOf(i,c);a.latitude=dbstatesprovinces.getValue(e,"lat");a.longitude=dbstatesprovinces.getValue(e,"lon");a.x=this.longitude2x(a.longitude,a.latitude);a.y=this.latitude2y(a.latitude,a.longitude)}}}else{f=this.getISO3(f);if(graphica.Geo.existsCountry(f)){a.y=this.latitude2y(graphica.Geo.centroids[f][0],graphica.Geo.centroids[f][1]);a.x=this.longitude2x(graphica.Geo.centroids[f][1],graphica.Geo.centroids[f][0]);a.latitude=graphica.Geo.centroids[f][0];a.longitude=graphica.Geo.centroids[f][1]}}return a};graphica.Geo.Map.fn.getCentroidScaled=function(c,b){var a=this.getCentroid(c,b);if(a.x===null||a.y===null){return{x:null,y:null}}a.x*=this.ratio;a.x+=this.root.x()+this._dsx;a.y*=this.ratio;a.y+=this.root.y()+this._dsy;return a};graphica.Geo.Map.fn.getPositionXY=function(c,b){var a={};if(c===null||b===null){a.y=null;a.x=null}else{a.y=this.latitude2y(c,b);a.x=this.longitude2x(b,c);a.x*=this.ratio;a.x+=this.root.x();a.y*=this.ratio;a.y+=this.root.y()}return a};graphica.Geo.Map.fn.getISO3=function(c){if(typeof c!=="string"){return"notfound"}var a=c.toUpperCase();if(typeof graphica.Geo.centroids[a]==="undefined"){var b=a.indexOf(",");if(b!=-1){a=a.substr(0,b)}a=graphica.Geo.iso2_2_iso3[a]||graphica.Geo.name_2_iso3[a]||"notfound"}return a};graphica.Geo.Map.fn.getIndex=function(a){country_code=this.getISO3(a);if(country_code!="notfound"){return this._iso32grapes[country_code]}return -1};graphica.Geo.Map.fn.getRegionGrape=function(g){if(typeof g!=="string"){return false}if(this._admin_level=="state"){g=g.toUpperCase();if(graphica.Geo.existsState(g)){var i;var b="";if(this._properties.country_specification=="value"&&typeof this._properties.country_specification_label=="string"){b=this.getISO3(this._properties.country_specification_label)}else{if(this._properties.country_specification=="variable"&&typeof this._properties.country_specification_variable!=="undefined"&&typeof row!="undefined"){b=this.getISO3(row[this._properties.country_specification_variable])}}if(dbstatesprovinces){if(!b||graphica.Geo.states[g].length==1){i=graphica.Geo.states[g][0]}else{for(var h=0;h<graphica.Geo.states[g].length;h++){if(graphica.Geo.states[g][h].startsWith(b)){i=graphica.Geo.states[g][h];break}else{if(h==graphica.Geo.states[g].length-1){i=graphica.Geo.states[g][0]}}}}var e=dbstatesprovinces.header.getId("adm1_code");var f=dbstatesprovinces.indexOf(i,e);return this._regions.item(f)}}else{return false}}else{var a=this.getISO3(g);var c=this.getIndex(a);if(c==-1){return false}return this._regions.item(c)}};graphica.Geo.Map.fn.valuebyareaMap=function(e){var c=new Array();var b=new Array();var v=0;var y=0;if(e.length>300){return}for(var A=0;A<e.length;A++){e.item(A).valuebyarea=e.item(A).valuebyarea||0.001;var G=e.item(A).getSubPaths();var l=0;for(var w=0;w<G.length;w++){l+=G[w].area()}y+=l;v+=e.item(A).valuebyarea;for(w=0;w<G.length;w++){G[w].valuebyarea=raceme.map(G[w].area(),0,l,0,e.item(A).valuebyarea);G[w].valuebyarea=Math.max(G[w].valuebyarea,0.0001);c.push(G[w]);b.push(A)}}var t;var h=10;for(var B=0;B<h;B++){for(A=0;A<c.length;A++){t=c[A];t._work_area=t.area();t._work_centroid=t.centroid()}if(B==h-1){break}var f=0;for(A=0;A<c.length;A++){t=c[A];t._work_desired=y*(t.valuebyarea/v);t._work_radius=Math.sqrt(t._work_area/Math.PI);t._work_mass=Math.sqrt(t._work_desired/Math.PI)-t._work_radius;t._work_size_error=Math.max(t._work_area,t._work_desired)/Math.min(t._work_area,t._work_desired);f+=t._work_size_error}var q=0.5;for(A=0;A<c.length;A++){t=c[A];for(var z=0;z<t.length;z++){var s=t.item(z);var F={x:0,y:0};for(var m=0;m<c.length;m++){var a=c[m]._work_centroid;var j=c[m]._work_radius;var D=c[m]._work_mass;var r=s.x-a.x;var p=s.y-a.y;var o=r*r+p*p;var E=j*j;var u=Math.sqrt(o);var d;if(u>j){d=D*(j/u)}else{d=D*(o/E)*(4-3*u/j)}F.x+=(d*graphica.Utils.cosArctan(p,r));F.y+=(d*graphica.Utils.sinArctan(p,r))}s.x+=(F.x*q);s.y+=(F.y*q)}}}for(var C=0;C<c.length;C++){var G=new Array();G.push(c[C]);e.item(b[C]).attr("data-center-x",c[C]._work_centroid.x);e.item(b[C]).attr("data-center-y",c[C]._work_centroid.y);if(!e.item(b[C])._form_data){e.item(b[C])._form_data=new graphica.FormData();e.item(b[C])._form_data.form(graphica.GEO_SHAPE)}e.item(b[C])._form_data.x(c[C]._work_centroid.x*this.ratio+this.root.x()+this._dsx+e.item(b[C]).x()).y(c[C]._work_centroid.y*this.ratio+this.root.y()+this._dsy);var x=c[C]._work_area;while(C+1<c.length&&b[C+1]==b[C]){G.push(c[C+1]);if(c[C+1]._work_area>x){e.item(b[C+1]).attr("data-center-x",c[C+1]._work_centroid.x);e.item(b[C+1]).attr("data-center-y",c[C+1]._work_centroid.y);if(!e.item(b[C+1])._form_data){e.item(b[C+1])._form_data=new graphica.FormData();e.item(b[C+1])._form_data.form(graphica.GEO_SHAPE)}e.item(b[C+1])._form_data.x(c[C+1]._work_centroid.x*this.ratio+this.root.x()+this._dsx+this._dsx+e.item(b[C]).x()).y(c[C+1]._work_centroid.y*this.ratio+this.root.y()+this._dsy);x=c[C+1]._work_area}C++}e.item(b[C]).attr("d",raceme.subpaths2path(G))}};if(typeof window!=="undefined"){window.graphica=window.graphica||{};var graphica=window.graphica}else{self.graphica=self.graphica||{};var graphica=self.graphica}graphica.GraphModel=function(){this.node_list={};this.edges={};this.node_number=0;this.edge_number=0;this.id2innerid={};this.node_array=[];this.nodes_dataset=null;this.edges_dataset=null;this.source_link_var=-1;this.target_link_var=-1;this.nodes_index_var=-1;this.calculatedWDegrees=false;this.edge_weight_variable=-1;this.max_edge_weight=0;this.isCoarsened=false};graphica.GraphNode=function(b,a){this.grmodel=b;this.innerid=a;this.id=null;this.inEdges=[];this.outEdges=[];this.inDegree=0;this.outDegree=0;this.degree=0};graphica.GraphNode.prototype.eachEdge=function(a){var b;for(b=0;b<this.inEdges.length;b++){if(this.grmodel.areConnected(this.inEdges[b].source_node.innerid,this.inEdges[b].target_node.innerid)){a.call(this.inEdges[b])}}for(b=0;b<this.outEdges.length;b++){if(this.grmodel.areConnected(this.outEdges[b].source_node.innerid,this.outEdges[b].target_node.innerid)){a.call(this.outEdges[b])}}};graphica.GraphNode.prototype.getNeighbours=function(a){var b=[];if(typeof a!=="boolean"){a=false}for(i=0;i<this.inEdges.length;i++){if(a&&this.inEdges[i]._it_is_displayed===false){continue}if(this.grmodel.areConnected(this.inEdges[i].source_node.innerid,this.inEdges[i].target_node.innerid)&&b.indexOf(this.inEdges[i].source_node.innerid)==-1){b.push(this.inEdges[i].source_node.innerid)}}for(i=0;i<this.outEdges.length;i++){if(a&&this.outEdges[i]._it_is_displayed===false){continue}if(this.grmodel.areConnected(this.outEdges[i].source_node.innerid,this.outEdges[i].target_node.innerid)&&b.indexOf(this.outEdges[i].target_node.innerid)==-1){b.push(this.outEdges[i].target_node.innerid)}}return b};graphica.GraphNode.prototype.getId=function(){if(this.id!==null){return this.id}return this.innerid};graphica.GraphModel.fn=graphica.GraphModel.prototype;graphica.GraphModel.fn.init=function(k,a){this.nodes_dataset=k;this.edges_dataset=a;var e;var b;for(e=0;e<a.header.names.length-1;e++){for(b=e+1;b<a.header.names.length;b++){if(a.header.names[e]==a.header.names[b]&&k.header.names.indexOf(a.header.names[e])!=-1){this.source_link_var=e;this.target_link_var=b;break}}}if(this.source_link_var!=-1){for(e=0;e<a.header.names.length;e++){if(e!=this.source_link_var&&e!=this.target_link_var&&a.isQuantitative(e)&&graphica.computed_variables.indexOf(a.header.names[e])==-1){this.edge_weight_variable=e;break}}this.nodes_index_var=k.header.names.indexOf(a.header.names[this.source_link_var]);for(e=0;e<this.nodes_dataset.length;e++){this.addNode(this.nodes_dataset.data[e])}for(b=0;b<this.edges_dataset.length;b++){var h=this.edges_dataset.data[b];var f=h[this.source_link_var]+"";var g=h[this.target_link_var]+"";var c=1;if(this.edge_weight_variable>-1&&typeof h[this.edge_weight_variable]=="number"){c=h[this.edge_weight_variable]}this.addEdge(f,g,c,h)}}else{console.log("No link between nodes and edges found")}};graphica.GraphModel.fn.initFromJSON=function(c){var b=0;for(b=0;b<c.nodes.length;b++){var a=this.addNode(c.nodes[b].id);if(a){if(typeof c.nodes[b].x!=="undefined"){a._layoutPosX=c.nodes[b].x}if(typeof c.nodes[b].y!=="undefined"){a._layoutPosY=c.nodes[b].y}}}for(b=0;b<c.edges.length;b++){this.addEdge(c.edges[b].s,c.edges[b].t,c.edges[b].w)}};graphica.GraphModel.fn.getJSON=function(){var a={nodes:[],edges:[]};this.eachNode(function(){a.nodes.push({id:this.getId(),x:this._layoutPosX||0,y:this._layoutPosY||0})});this.eachEdge(function(){a.edges.push({s:this.source_node.getId(),t:this.target_node.getId(),w:this.weight})});return a};graphica.GraphModel.fn.addNode=function(b){var c=this;var a;if(typeof b==="undefined"){a=this.node_number}else{if(Array.isArray(b)){a=b[this.nodes_index_var]+""}else{a=b}}if(!this.node_list[a]){this.id2innerid[a]=this.node_number;this.edges[this.node_number]=[];this.node_list[a]=new graphica.GraphNode(this,this.node_number);this.node_list[a].id=a;if(Array.isArray(b)){this.node_list[a]["row"]=b}this.node_array[this.node_number]=this.node_list[a];this.node_number++;return this.node_list[a]}return null};graphica.GraphModel.fn.getNode=function(a){if(Array.isArray(a)&&this.nodes_index_var!=-1){a=a[this.nodes_index_var]}a+="";if(typeof this.node_list[a]!==undefined){return this.node_list[a]}return false};graphica.GraphModel.fn.eachNode=function(a){for(var b=0;b<this.node_number;b++){a.call(this.node_array[b])}};graphica.GraphModel.fn.eachNodeOrdered=function(a,f,e){if(typeof f=="undefined"||typeof e=="undefined"||!Array.isArray(e)||e.length==0||!Array.isArray(e[0])||!Array.isArray(f)){return this.eachNode(a)}for(var b=0;b<e[0].length;b++){for(var c=0;c<this.node_number;c++){if(typeof this.node_array[c]["row"][f[0]]!=="undefined"&&this.node_array[c]["row"][f[0]]==e[0][b]){a.call(this.node_array[c])}}}};graphica.GraphModel.fn.addEdge=function(e,g,a,j){if(e==g){return}if(!this.getNode(e)||!this.getNode(g)){return}var b=this.id2innerid[e];var h=this.id2innerid[g];var c=this.getNode(e);var f=this.getNode(g);if(!this.areConnected(b,h)){this.edges[b][h]={};this.edge_number++;c.outEdges.push(this.edges[b][h]);c.outDegree++;f.inEdges.push(this.edges[b][h]);f.inDegree++;this.edges[b][h].weight=0;if(!this.areConnected(h,b)){c.degree++;f.degree++}}if(typeof a=="string"){a=Number(a)}this.edges[b][h].weight+=a;this.max_edge_weight=Math.max(this.max_edge_weight,this.edges[b][h].weight);this.edges[b][h].rows=this.edges[b][h].rows||[];if(typeof j!=="undefined"){this.edges[b][h].rows.push(j)}this.edges[b][h].source_node=c;this.edges[b][h].target_node=f};graphica.GraphModel.fn.removeEdge=function(f,c,b){if(typeof b!="boolean"){b=false}var a;var e;a=this.getEdge(f,c);if(a){delete this.edges[f][c];if(!this.calculatedWDegrees){this.calculateWDegree()}e=a.weight;a.source_node.wDegree-=a.weight;a.source_node.outDegree--;a.target_node.wDegree-=a.weight;a.target_node.inDegree--;this.edge_number--;if(!this.areConnected(c,f)){a.source_node.degree--;a.target_node.degree--}}if(b){a=this.getEdge(c,f);if(a){delete this.edges[c][f];e=a.weight;a.source_node.wDegree-=a.weight;a.source_node.outDegree--;a.target_node.wDegree-=a.weight;a.target_node.inDegree--;this.edge_number--;a.source_node.degree--;a.target_node.degree--}}};graphica.GraphModel.fn.eachEdge=function(a){for(var c=0;c<this.node_number;c++){for(var b=0;b<this.node_number;b++){if(this.areConnected(c,b)){if(a.call(this.edges[c][b])==false){return}}}}};graphica.GraphModel.fn.eachEdgeOrderedByDensity=function(a){var e=this;var b=[];this.eachEdge(function(){e.getDensity(this.source_node.innerid,this.target_node.innerid);b.push(this)});b.sort(function(g,f){if(g._density>f._density){return -1}else{if(g._density<f._density){return 1}}return 0});for(var c=0;c<b.length;c++){a.call(b[c])}};graphica.GraphModel.fn.getOrderedEdges=function(){var a=[];this.eachEdge(function(){a.push(this)});a.sort(function(e,c){if(e.weight>c.weight){return -1}else{if(e.weight<c.weight){return 1}}return 0});return a};graphica.GraphModel.fn.updateEdgeWeights=function(){var a=this;if(this.edge_weight_variable>-1){this.max_edge_weight=0;this.eachEdge(function(){var b=0;for(var e=0;e<this.rows.length;e++){if(this.rows[e][a.edge_weight_variable]){b+=this.rows[e][a.edge_weight_variable]}}this.weight=b;a.max_edge_weight=Math.max(a.max_edge_weight,this.weight)})}else{this.max_edge_weight=1;this.eachEdge(function(){this.weight=1})}this.calculatedWDegrees=false};graphica.GraphModel.fn.calculateWDegree=function(){this.eachNode(function(){var a=0;this.eachEdge(function(){a+=this.weight});this.wDegree=a});this.calculatedWDegrees=true};graphica.GraphModel.fn.getWDegree=function(a){if(!this.calculatedWDegrees){this.calculateWDegree()}return this.node_array[a].wDegree};graphica.GraphModel.fn.getEdgeWeights=function(c,f){if(typeof c!="boolean"){c=false}if(typeof f!="boolean"){f=false}var b=[];for(var e=0;e<this.node_number;e++){b[e]=[];for(var a=0;a<this.node_number;a++){if(this.areConnected(e,a)){if(f){b[e][a]=1}else{b[e][a]=this.edges[e][a].weight}}if(c&&this.areConnected(a,e)){if(f){b[e][a]=1}else{b[e][a]=this.edges[a][e].weight}}}}return b};graphica.GraphModel.fn.getNeighbours=function(g,f,e,b){if(typeof f=="undefined"||f===null){f=g}var c=[];var a;if(typeof e=="undefined"||e===null){e=this.edges;var h=this.node_array[g].getNeighbours(b);for(a=0;a<h.length;a++){var k=h[a];if(k!=f&&k!=g&&(typeof e[f][k]!="undefined"||typeof e[k][f]!="undefined")){c.push(k)}}}else{for(a=0;a<this.node_number;a++){if(a!=g&&a!=f){if(typeof e[g][a]!="undefined"||typeof e[f][a]!="undefined"||typeof e[a][g]!="undefined"||typeof e[a][f]!="undefined"){c.push(a)}}}}return c};graphica.GraphModel.fn.getEdge=function(c,b,a){if(typeof a!="boolean"){a=false}if(this.areConnected(c,b)){return this.edges[c][b]}else{if(a&&this.areConnected(b,c)){return this.edges[b][c]}}return null};graphica.GraphModel.fn.getAndNeighbours=function(g,e){var k=[];var b=this.edges;var f=this.node_array[g].getNeighbours();var c=this.node_array[e].getNeighbours();var a;var h;for(a=0;a<f.length;a++){h=f[a];if((typeof b[e][h]!="undefined"||typeof b[h][e]!="undefined")){k.push(h)}}for(a=0;a<c.length;a++){h=c[a];if((typeof b[g][h]!="undefined"||typeof b[h][g]!="undefined")&&k.indexOf(h)==-1){k.push(h)}}return k};graphica.GraphModel.fn.getMergeNeighbours=function(b,a,h){if(b!=a){var c=[];var k=0;var g=0;var m=this.getNeighbours(b,null,h);var l=this.getNeighbours(a,null,h);var e=m.length;var f=l.length;while(k<e&&g<f){if(m[k]<l[g]){c.push(m[k]);k++}else{if(m[k]>l[g]){c.push(l[g]);g++}else{c.push(m[k]);k++;g++}}}if(k<e){while(k<e){c.push(m[k]);k++}}else{if(g<f){while(g<f){c.push(l[g]);g++}}}return c}else{return this.getNeighbours(b)}};graphica.GraphModel.fn.areConnected=function(c,b,a){if(typeof c!=="number"||typeof b!=="number"||c==b||c<0||c>=this.node_number||b<0||b>=this.node_number){return false}if(!a){return(typeof this.edges[c][b]!=="undefined")}return(typeof this.edges[c][b]!=="undefined"||typeof this.edges[b][c]!=="undefined")};graphica.GraphModel.fn.getDensity=function(b,e,a){var c=this.getEdge(b,e,a);if(typeof c._density!=="number"){c._density=Math.pow(c.weight,2)/(this.getWDegree(b)*this.getWDegree(e))}return c._density};graphica.GraphModel.fn.sumOfWeights=function(){var a=0;this.eachEdge(function(){a+=this.weight});return a};graphica.GraphModel.fn.EdgePathBundling=function(h){h=h||"distance";var p=this;var n=10;var u=2;var a=2;var c=1;var b=function(j,A){var y,w;(y=[]).length=p.node_number;y.fill(+Infinity);y[j]=0;(w=[]).length=p.node_number;w.fill(-1);var v={};var F=new graphica.FibonacciHeap();var z=F.insert(0,j);v[j]=z;while(!F.isEmpty()){var B=F.extractMinimum();B=B.value;if(B==A){break}var C=p.getNeighbours(B,null,null,true);for(var D=0;D<C.length;D++){var E=C[D];if((B==j&&E==A)||(E==j&&B==A)){continue}var H=y[B]+p.getEdge(B,E,true)._bundling_weight;if(y[E]>H){if(w[E]<0){var z=F.insert(H,E);v[E]=z}else{var z=v[E];F.decreaseKey(z,H)}w[E]=B;y[E]=H}}}var G=[A];var x=A;while(true){x=w[x];G.push(x);if(x===j){return G}if(x<=0){return[]}}};var m=[];this.eachEdge(function(){if(this._it_is_displayed!==false){var j=this.source_node.innerid;var v=this.target_node.innerid;if(!p.node_array[j].elm||!p.node_array[v].elm){return}if(p.node_array[j].elm._form_data.form()!=graphica.GEO_SHAPE&&p.node_array[j].elm._form_data.form()!=graphica.FILLED_RECTANGLE){p.node_array[j].elm._form_data.x(p.node_array[j].elm.x());p.node_array[j].elm._form_data.y(p.node_array[j].elm.y());p.node_array[v].elm._form_data.x(p.node_array[v].elm.x());p.node_array[v].elm._form_data.y(p.node_array[v].elm.y())}this._bundling_distance=raceme.distance({x:p.node_array[j].elm._form_data.x(),y:p.node_array[j].elm._form_data.y()},{x:p.node_array[v].elm._form_data.x(),y:p.node_array[v].elm._form_data.y()});if(h=="weight"){this._bundling_weight=Math.log(1+(1/this.weight))}else{this._bundling_weight=Math.pow(this._bundling_distance,u)}this._is_bundled=false;this._is_locked=false;m.push(this)}});m=m.sort(function(v,j){if(v._bundling_weight<j._bundling_weight){return 1}return -1});for(var q=0;q<m.length;q++){var o=m[q];if(q==0){o._is_locked=true}var f=o.source_node.innerid;var t=o.target_node.innerid;if(o._is_locked){o.controlpoints=[{x:this.node_array[f].elm._form_data.x(),y:this.node_array[f].elm._form_data.y()},{x:this.node_array[t].elm._form_data.x(),y:this.node_array[t].elm._form_data.y()}];continue}var k=b(f,t);if(k.length>2){var s=0;var g=this.node_array[k[0]];for(var r=1;r<k.length;r++){var l=this.node_array[k[r]];s+=raceme.distance({x:g.elm._form_data.x(),y:g.elm._form_data.y()},{x:l.elm._form_data.x(),y:l.elm._form_data.y()});g=l}if(s>=a*o._bundling_distance){o.controlpoints=[{x:this.node_array[f].elm._form_data.x(),y:this.node_array[f].elm._form_data.y()},{x:this.node_array[t].elm._form_data.x(),y:this.node_array[t].elm._form_data.y()}]}else{var g=this.node_array[k.pop()];var e=[{x:g.elm._form_data.x(),y:g.elm._form_data.y()}];while(k.length>0){var l=this.node_array[k.pop()];this.getEdge(g.innerid,l.innerid,true)._is_locked=true;e.push({x:l.elm._form_data.x(),y:l.elm._form_data.y()});g=l}o._is_bundled=true;o._cp=e;o.controlpoints=graphica.Utils.approximateBezier(e,n)}}else{o.controlpoints=[{x:this.node_array[f].elm._form_data.x(),y:this.node_array[f].elm._form_data.y()},{x:this.node_array[t].elm._form_data.x(),y:this.node_array[t].elm._form_data.y()}]}}};graphica.GraphModel.fn.Dijkstra=function(a){if(typeof a!=="boolean"){a=true}this.paths=[];var m=this.getEdgeWeights(true,!a);for(var g=0;g<this.node_number;g++){var f=new Array(this.node_number).fill(9999);delete f[g];var c=f.slice(0);f[g]=0;var e=new Array();e[g]=0;var k=false;var h=1;while(h>0){var l;if(k){let sk=Object.keys(e).sort(function(o,n){return e[n]-e[o]});l=sk.pop()}else{let sk=Object.keys(e);l=sk.pop()}delete e[l];h--;k=false;if(f[l]==9999){break}for(var j=0;j<this.node_number;j++){if(typeof m[l][j]=="undefined"){continue}if(typeof c[j]!="undefined"||typeof e[j]!="undefined"){var b=f[l]+(1/m[l][j]);if(b<f[j]){f[j]=b;delete c[j];if(typeof e[j]=="undefined"){h++}e[j]=b;if(l!=g&&typeof m[g][j]!="undefined"&&((1/m[g][j])>b)){delete m[g][j]}k=true}}}}this.paths[g]=f}};graphica.GraphModel.fn.pfnet=function(e){var g=0.5;if(e){g=1}var b=this.edge_number;for(var r=0;r<this.node_number;r++){var p=this.node_array[r];if(p.degree>1){var h=this.getNeighbours(r);for(var k=0;k<h.length;k++){var q=h[k];if(this.areConnected(r,q,true)){var m=this.getAndNeighbours(r,q);var o;if(e){o=1/this.getDensity(r,q,true)}else{o=0;if(this.areConnected(r,q)){o+=this.getEdge(r,q).weight}if(this.areConnected(q,r)){o+=this.getEdge(q,r).weight}o=1/o}for(var n=0;n<m.length;n++){var l=m[n];var f;var a;if(e){f=1/this.getDensity(r,l,true);a=1/this.getDensity(q,l,true)}else{f=0;if(this.areConnected(r,l)){f+=this.getEdge(r,l).weight}if(this.areConnected(l,r)){f+=this.getEdge(l,r).weight}f=1/f;a=0;if(this.areConnected(q,l)){a+=this.getEdge(q,l).weight}if(this.areConnected(l,q)){a+=this.getEdge(l,q).weight}a=1/a}if(f+a<o*g){this.removeEdge(r,q,true);break}else{if(f+o<a*g){this.removeEdge(q,l,true)}else{if(o+a<f*g){this.removeEdge(r,l,true)}}}}}}}}};graphica.GraphModel.fn.fastPruning=function(){var e=this;var c=this.edge_number;var b=c;var a=this.sumOfWeights();densidad_media=a/(b*b);this.eachEdge(function(){var f=e.getDensity(this.source_node.innerid,this.target_node.innerid);if(f<densidad_media){a-=this.weight;e.removeEdge(this.source_node.innerid,this.target_node.innerid);b--;densidad_media=a/(b*b)}})};graphica.GraphModel.fn.newmanClustering=function(n){var a=this;if(!n){n=6}var l=performance.now();var e=0;var I=0;var m=0;var v=0;var K=0;var b=0;var B=0;var U=this.getEdgeWeights(true);var g=this.node_number;var f=0;var h=this.edge_number;var D=[];var ag=[];for(var X=0;X<this.node_number;X++){D[X]=[];ag[X]=0}var q=[];var j=[];var ac=[];var aa=[];var L=[];var F=null;var C=null;var t=null;for(var R=0;R<this.node_number;R++){var z=this.node_array[R];q[R]=(z.degree)/(2*h);j[R]=R;z._cluster=R;for(var P=R+1;P<this.node_number;P++){if(this.areConnected(R,P,true)){var w=this.node_array[P];var af=z.degree;var ae=w.degree;D[R][P]=(U[R][P]/(2*h))-((af*ae)/Math.pow(2*h,2));D[P][R]=D[R][P];ag[R]++;ag[P]++;if(typeof ac[R]=="undefined"||D[R][P]>L[R]){ac[R]=R;aa[R]=P;L[R]=D[R][P]}}}}e=performance.now()-l;l=performance.now();for(var R=0;R<this.node_number;R++){if(typeof ac[R]!="undefined"&&(F===null||L[R]>t)){F=ac[R];C=aa[R];t=L[R]}}I=performance.now()-l;while(g>n&&F!==null){l=performance.now();var o=t;f+=o;var Z=F;var Y=C;if(Y==Z){console.log("ERROR")}F=null;C=null;t=null;var G=this.getMergeNeighbours(Z,Y,D);m+=performance.now()-l;delete ac[Y];delete aa[Y];delete L[Y];delete ac[Z];delete aa[Z];delete L[Z];l=performance.now();max_local_i=null;max_local_j=null;max_local_value=null;var J=new Array();for(var ab=0;ab<G.length;ab++){var W=G[ab];if(1==2&&ag[W]==1&&W!=Y&&W!=Z){if(n<(g-1)){J.push(W);g--}}else{if(typeof D[Y][W]!=="undefined"&&typeof D[Z][W]!=="undefined"){D[Y][W]=(D[Y][W]+D[Z][W])/2;D[W][Y]=D[Y][W];delete D[Z][W];delete D[W][Z];ag[Z]--;ag[W]--;if(aa[W]==Z||L[W]<D[Y][W]){ac[W]=W;aa[W]=Y;L[W]=D[Y][W]}}else{if(typeof D[Z][W]!=="undefined"){if(Y!=W){if(typeof D[Y][W]=="undefined"){ag[Y]++;ag[W]++}D[Y][W]=D[Z][W]-(2*q[Y]*q[W]);D[W][Y]=D[Y][W]}delete D[Z][W];delete D[W][Z];ag[Z]--;ag[W]--;if(W!=Y&&aa[W]==Z){delete ac[W];delete aa[W];delete L[W];var ad=this.getNeighbours(W,null,D);for(var T=0;T<ad.length;T++){var S=ad[T];if(typeof ac[W]=="undefined"||D[W][S]>L[W]){ac[W]=W;aa[W]=S;L[W]=D[W][S]}}}}else{if(typeof D[Y][W]!=="undefined"){D[Y][W]=D[Y][W]-(2*q[Z]*q[W]);D[W][Y]=D[Y][W];if(Z!=W&&(aa[W]==Y)){delete ac[W];delete aa[W];delete L[W];var ad=this.getNeighbours(W,null,D);for(var T=0;T<ad.length;T++){var S=ad[T];if(typeof ac[W]=="undefined"||D[W][S]>L[W]){ac[W]=W;aa[W]=S;L[W]=D[W][S]}}}}}}if(W!=Y&&W!=Z){if(max_local_i===null||max_local_value<D[Y][W]){max_local_i=Y;max_local_j=W;max_local_value=D[Y][W]}}}}for(er=0;er<J.length;er++){var O=J[er];delete D[Y][O];delete D[O][Y];delete D[Z][O];delete D[O][Z];var H=j[O];var E=j[Y];for(var V=0;V<j.length;V++){if(j[V]==H){j[V]=E}}q[Y]+=q[O];q[O]=0;delete ac[O];delete aa[O];delete L[O]}if(max_local_i!==null){ac[Y]=max_local_i;aa[Y]=max_local_j;L[Y]=max_local_value}v+=performance.now()-l;l=performance.now();q[Y]+=q[Z];q[Z]=0;for(var u=0;u<this.node_number;u++){if(typeof ac[u]!="undefined"){if(F===null||t<L[u]){F=ac[u];C=aa[u];t=L[u]}}}b+=performance.now()-l;g--;l=performance.now();var H=j[Z];var E=j[Y];for(var V=0;V<j.length;V++){if(j[V]==H){j[V]=E}}B+=performance.now()-l}for(var S=0;S<this.node_number;S++){this.node_array[S]._cluster=j[S]}};graphica.GraphModel.fn.doLayout=function(e,a){var b=performance.now();var c=e.layout;if(this.isCoarsened==false&&(c=="forceLayout"||c=="LinLogLayout")&&(this.node_number>400||this.edge_number>2000)){this.coarsenedLayout(e,a)}else{if(this.isCoarsened==false&&c!="onlyFitIntoView"&&c!="noLayout"){e.fromZero=true;this[c].call(this,e,a)}else{this[c].call(this,e,a)}}};graphica.GraphModel.fn.forceLayout=function(u,j){var m=u.width;var h=u.height;var l=u.fixed_axis||"0x0";var r;var s=u.calculate_distances;if(typeof s!="boolean"){s=false}var f=u.use_anchors;if(typeof f!="boolean"){f=false}if(typeof u.iterations!=="undefined"){r=u.iterations}else{r=500;if(s){r=750}}if(typeof j==="undefined"){j=function(){}}var n=this;var v=u.maxRepulsiveForceDistance;if(typeof v!=="number"){v=6}var o=u.k;if(typeof o!=="number"){o=2}var t=u.c;if(typeof t!=="number"){t=0.01}var e=u.maxVertexMovement;if(typeof e!=="number"){e=0.5}var b=u.responsiveMaxResulsiveForceDistance;if(typeof b!=="boolean"){b=false}if(b){o=Math.max(m,h)/5;e=Math.sqrt(m*h)/(this.node_number+1)}if(s&&!this.paths){this.Dijkstra(false)}var p=function(x,k,B){if(typeof B==="undefined"){B=0}else{B=1+Math.min(30,B)}var w=k._layoutPosX-x._layoutPosX;var c=k._layoutPosY-x._layoutPosY;var y=w*w+c*c;if(y<0.01){w=0.1*Math.random()+0.1;c=0.1*Math.random()+0.1;var y=w*w+c*c}var z;z=Math.sqrt(y);if(b){v=(x._r+k._r)}if(z<v||(B&&z<v*B)){if(b){o=v*3}var A=o*o/z;if(B){A*=B}k._layoutForceX+=A*w/z;k._layoutForceY+=A*c/z;x._layoutForceX-=A*w/z;x._layoutForceY-=A*c/z}};var a=function(A){if(A.weight==0){return}var x=A.source_node;var k=A.target_node;var w=k._layoutPosX-x._layoutPosX;var c=k._layoutPosY-x._layoutPosY;var z=w*w+c*c;if(z<0.01){w=0.1*Math.random()+0.1;c=0.1*Math.random()+0.1;var z=w*w+c*c}var B=Math.sqrt(z);if(b==false&&B>v){B=v;z=B*B}if(b){o=(x._r+k._r)/3}var y=(z-o*o)/o;y*=Math.log(A.weight)*0.5+1;k._layoutForceX-=y*w/B;k._layoutForceY-=y*c/B;x._layoutForceX+=y*w/B;x._layoutForceY+=y*c/B};var g=function(){for(var z=0;z<n.node_number;z++){var x=n.node_array[z];for(var y=z+1;y<n.node_number;y++){var w=n.node_array[y];if(s){p(x,w,n.paths[z][y])}else{p(x,w)}}}n.eachEdge(function(){a(this)});if(f){for(var z=0;z<n.node_number;z++){a({source_node:n.node_array[z],target_node:{_layoutPosX:n.node_array[z]._anchorX,_layoutPosY:n.node_array[z]._anchorY,_r:n.node_array[z]._r},weight:1})}}for(var z=0;z<n.node_number;z++){var B=n.node_array[z];var A=t*B._layoutForceX;var k=t*B._layoutForceY;var c=e;if(A>c){A=c}if(A<-c){A=-c}if(k>c){k=c}if(k<-c){k=-c}if(l=="0x0"||l=="0x1"){B._layoutPosX+=A}if(l=="0x0"||l=="1x0"){B._layoutPosY+=k}B._layoutForceX=0;B._layoutForceY=0}};if(!this.node_number){if(j){j()}return}if(typeof u.fromZero==="boolean"&&u.fromZero==true&&l=="0x0"){this.eachNode(function(){this._layoutPosX=0;this._layoutPosY=0;this._layoutForceX=0;this._layoutForceY=0})}else{this.eachNode(function(){this._layoutPosX=this._layoutPosX||0;this._layoutPosY=this._layoutPosY||0;this._layoutForceX=0;this._layoutForceY=0})}for(var q=0;q<r;q++){g()}this.fitIntoView(u);j()};graphica.GraphModel.fn.onlyFitIntoView=function(b,a){this.fitIntoView(b);a()};graphica.GraphModel.fn.noLayout=function(b,a){a()};graphica.GraphModel.fn.fitIntoView=function(f){if(typeof f.doFit==="boolean"&&f.doFit==false){return}var b=f.fixed_axis||"0x0";var a=f.width;var p=f.height;var o=Infinity,k=-Infinity,n=Infinity,j=-Infinity;for(var g=0;g<this.node_number;g++){var m=this.node_array[g]._layoutPosX;var l=this.node_array[g]._layoutPosY;if(m>k){k=m}if(m<o){o=m}if(l>j){j=l}if(l<n){n=l}}j+=(Math.max(j-n,1))*0.1;n-=(Math.max(j-n,1))*0.1;k+=(Math.max(k-o,1))*0.1;o-=(Math.max(k-o,1))*0.1;var e=j-n;var h=k-o;for(var g=0;g<this.node_number;g++){var c=this.node_array[g];if(!f.full_fit){if((h/e>a/p&&b=="0x0")||b=="0x1"){if(b=="0x0"||b=="0x1"){c._layoutPosX=graphica.Utils.map(c._layoutPosX,o,k,0,a)}if(b=="0x0"||b=="1x0"){c._layoutPosY=graphica.Utils.map(c._layoutPosY,n,j,0,e*(a/h))+(p-(e*(a/h)))/2}}else{if(b=="0x0"||b=="0x1"){c._layoutPosX=graphica.Utils.map(c._layoutPosX,o,k,0,h*(p/e))+(a-(h*(p/e)))/2}if(b=="0x0"||b=="1x0"){c._layoutPosY=graphica.Utils.map(c._layoutPosY,n,j,0,p)}}}else{if(b=="0x0"||b=="0x1"){c._layoutPosX=graphica.Utils.map(c._layoutPosX,o,k,0,a)}if(b=="0x0"||b=="1x0"){c._layoutPosY=graphica.Utils.map(c._layoutPosY,n,j,0,p)}}}};graphica.GraphModel.fn.circularLayout=function(j,e){if(!this.node_number){if(e){e()}return}var g=j.width;var c=j.height;var b=Math.min(g*0.333,c*0.333);var a={x:g*0.5,y:c*0.5};var f=360/this.node_number;var h=-90;this.eachNodeOrdered(function(){this._layoutPosX=a.x+b*Math.cos(h*Math.PI/180);this._layoutPosY=a.y+b*Math.sin(h*Math.PI/180);h+=f},j.orderedVariable,j.orderedVariableItems);if(e){e()}};graphica.GraphModel.fn.kamadaLayout=function(x,p){var s=x.width;var o=x.height;var r=x.fixed_axis||"0x0";var u=this;var a=function(B,A,E){var D=0;var C=0;for(var z=0;z<u.node_number;z++){if(B!=z){dx=u.node_array[B]._layoutPosX-u.node_array[z]._layoutPosX;dy=u.node_array[B]._layoutPosY-u.node_array[z]._layoutPosY;dd=Math.sqrt(dx*dx+dy*dy);dd=Math.max(dd,1);D+=E[B][z]*(dx-A[B][z]*dx/dd);C+=E[B][z]*(dy-A[B][z]*dy/dd)}}var y=Math.sqrt(D*D+C*C);return y};var f=function(E,D,H){var z=0;var j=0;var y=0;var J=0;var F=0;var C=0;for(v=0;v<u.node_number;v++){if(E!=v){var K=u.node_array[E]._layoutPosX-u.node_array[v]._layoutPosX;var I=u.node_array[E]._layoutPosY-u.node_array[v]._layoutPosY;var G=Math.sqrt(K*K+I*I);G=Math.max(G,1);var B=G*G*G;z+=H[E][v]*(K-D[E][v]*K/G);j+=H[E][v]*(I-D[E][v]*I/G);y+=H[E][v]*(1-D[E][v]*I*I/B);J+=H[E][v]*(D[E][v]*K*I/B);F+=H[E][v]*(D[E][v]*I*K/B);C+=H[E][v]*(1-D[E][v]*K*K/B)}}var A=[];A[0]=((-z)*C-J*(-j))/(y*C-J*F);A[1]=(y*(-j)-(-z)*F)/(y*C-J*F);return A};var m=function(z,E){var D=0;for(var C=0;C<u.node_number-1;C++){for(var B=C+1;B<u.node_number;B++){var G=u.node_array[C]._layoutPosX-u.node_array[B]._layoutPosX;var F=u.node_array[C]._layoutPosY-u.node_array[B]._layoutPosY;var A=z[C][B];var y=E[C][B];D+=0.5*y*((G*G)+(F*F)+(A*A)-(2*A*Math.sqrt((G*G)+(F*F))))}}return D};if(!this.node_number){if(p){p()}return}if(!this.paths){this.Dijkstra(false)}this.forceLayout({width:s,height:o,calculate_distances:true,iterations:5,fixed_axis:r});var k=1;for(var w=0;w<this.node_number;w++){for(var v=w+1;v<this.node_number;v++){if(this.paths[w][v]<9999){k=Math.max(k,this.paths[w][v])}}}distancia_optima=Math.min(o,s)/k*k;kamada_enlaces=0;l_edge_matrix=new Array();for(var w=0;w<this.node_number;w++){l_edge_matrix[w]=l_edge_matrix[w]||[];for(var v=w+1;v<this.node_number;v++){l_edge_matrix[w][v]=distancia_optima*this.paths[w][v];l_edge_matrix[v]=l_edge_matrix[v]||[];l_edge_matrix[v][w]=l_edge_matrix[w][v];kamada_enlaces++}}var c=1;k_edge_matrix=new Array();for(var w=0;w<this.node_number;w++){k_edge_matrix[w]=k_edge_matrix[w]||[];for(v=w+1;v<this.node_number;v++){k_edge_matrix[w][v]=c/Math.pow(this.paths[w][v],2);k_edge_matrix[v]=k_edge_matrix[v]||[];k_edge_matrix[v][w]=k_edge_matrix[w][v]}}var e=999999;var t=0;var h=0;var b=0;var n=0;var q=5000;while(n<q){for(var w=0;w<this.node_number;w++){deltaM=a(w,l_edge_matrix,k_edge_matrix);e=Math.min(e,deltaM);if(deltaM>=b){h=b;b=deltaM;t=w}}var g=0;while(h<=b){g++;var l=f(t,l_edge_matrix,k_edge_matrix);if(r=="0x0"||r=="0x1"){u.node_array[t]._layoutPosX+=l[0]}if(r=="0x0"||r=="1x0"){u.node_array[t]._layoutPosY+=l[1]}b=a(t,l_edge_matrix,k_edge_matrix);if(g>5){break}}if(h-b>0&&h-b<0.1&&n>100){break}n++}this.fitIntoView(x);if(p){p()}};graphica.GraphModel.fn.LinLogLayout=function(b,t){var a=b.width;var c=b.height;var E=b.fixed_axis||"0x0";var w=75;if(typeof b.iterations=="number"){w=b.iterations}var g=0;var e=1;e=2;if(typeof b.attrExponent==="number"){e=b.attrExponent}var s=0.05;var z=[];var J=this.getEdgeWeights(true);var h=this;var p=function(V,j){var T=h.node_array[V];if(j==null||j.node==T){return 0}if(T.weight==0){return 0}var X=graphica.Utils.distance({x:T._layoutPosX,y:T._layoutPosY},{x:j.position[0],y:j.position[1]});if(j.childCount>0&&X<j.width()){var U=0;for(var W=0;W<j.children.length;W++){var Y=j.children[W];U+=p(V,Y)}return U}if(X==0){return 0}if(g==0){return -k*T.weight*j.weight*Math.log(X)}else{return -k*T.weight*j.weight*Math.pow(X,g)/g}};var q=function(U){var T=0;for(var V=0;V<h.node_number;V++){if(typeof J[U][V]!=="undefined"){var j=J[U][V];var W=graphica.Utils.distance({x:D._layoutPosX,y:D._layoutPosY},{x:h.node_array[V]._layoutPosX,y:h.node_array[V]._layoutPosY});if(e==0){T+=j*Math.log(W)}else{T+=j*Math.pow(W,e)/e}}}return T};var H=function(T){var j=h.node_array[T];var U=graphica.Utils.distance({x:j._layoutPosX,y:j._layoutPosY},{x:z[0],y:z[1]});if(e==0){return s*Math.max(1,j.weight)*Math.log(U)}else{return s*Math.max(1,j.weight)*Math.pow(U,e)/e}};var S=function(j,T){return p(j,T)+q(j)+H(j)};var l=function(V,aa,U){var T=h.node_array[V];if(aa==null||aa.node==T){return 0}if(T.weight==0){return 0}var X=graphica.Utils.distance({x:T._layoutPosX,y:T._layoutPosY},{x:aa.position[0],y:aa.position[1]});if(aa.childCount>0&&X<aa.width()){var Z=0;for(var Y=0;Y<aa.children.length;Y++){var j=aa.children[Y];Z+=l(V,j,U)}return Z}if(X==0){return 0}var W=k*T.weight*aa.weight*Math.pow(X,g-2);U[0]-=(aa.position[0]-T._layoutPosX)*W;U[1]-=(aa.position[1]-T._layoutPosY)*W;return W*Math.abs(g-1)};var I=function(X,j){var W=0;var V=h.node_array[X];for(var Y=0;Y<h.node_number;Y++){if(typeof J[X][Y]!=="undefined"){var U=J[X][Y];var Z=graphica.Utils.distance({x:V._layoutPosX,y:V._layoutPosY},{x:h.node_array[Y]._layoutPosX,y:h.node_array[Y]._layoutPosY});if(Z==0){continue}var T=U*Math.pow(Z,e-2);W+=T*Math.abs(e-1);j[0]+=(h.node_array[Y]._layoutPosX-V._layoutPosX)*T;j[1]+=(h.node_array[Y]._layoutPosY-V._layoutPosY)*T}}return W};var R=function(V,j){var U=h.node_array[V];var W=graphica.Utils.distance({x:U._layoutPosX,y:U._layoutPosY},{x:z[0],y:z[1]});var T=s*k*Math.max(1,U.weight)*Math.pow(W,e-2);j[0]+=(z[0]-U._layoutPosX)*T;j[1]+=(z[1]-U._layoutPosY)*T;return T*Math.abs(e-1)};var v=function(W,X,j){var U=h.node_array[W];j[0]=0;j[1]=0;var V=l(W,X,j);V+=I(W,j);V+=R(W,j);if(V!=0){j[0]/=V;j[1]/=V;var Z=1;for(var Y=0;Y<2;Y++){var T=X.maxPos[Y]-X.minPos[Y];if(T>0){Z=Math.min(Z,Math.abs(T/16/j[Y]))}}j[0]*=Z;j[1]*=Z}else{j[0]=0;j[1]=0}};var x=function(){var V=[99999,99999,0];var U=[-99999,-99999,0];for(var Y=0;Y<h.node_number;Y++){var W=h.node_array[Y];if(W.weight==0){continue}V[0]=Math.min(V[0],W._layoutPosX);U[0]=Math.max(U[0],W._layoutPosX);V[1]=Math.min(V[1],W._layoutPosY);U[1]=Math.max(U[1],W._layoutPosY)}for(var X=0;X<2;X++){var T=U[X]-V[X];U[X]+=T/2;V[X]-=T/2}var j=new graphica.Utils.OctTree(null,[],V,U);for(var Y=0;Y<h.node_number;Y++){var W=h.node_array[Y];j.addNode(W,[W._layoutPosX,W._layoutPosY,0],0)}return j};var A=function(){z[0]=0;z[1]=0;var j=0;for(var U=0;U<h.node_number;U++){var T=h.node_array[U];j+=T.weight;z[0]+=T.weight*T._layoutPosX;z[1]+=T.weight*T._layoutPosY}if(j>0){z[0]/=j;z[1]/=j}};if(typeof b.preLayout==="undefined"||b.preLayout==true){this.forceLayout({width:a,height:c,iterations:20,calculate_distances:false,fixed_axis:E})}else{this.forceLayout({width:a,height:c,iterations:1,calculate_distances:false,fixed_axis:E})}for(d=0;d<this.node_number;d++){this.node_array[d].weight=J[d].reduce(function(T,j){return T+j},0);if(typeof this.node_array[d]._layoutPosX=="undefined"){this.node_array[d]._layoutPosX=Math.random()*100}if(typeof this.node_array[d]._layoutPosY=="undefined"){this.node_array[d]._layoutPosY=Math.random()*100}}var r=0;for(var O=0;O<this.node_number;O++){r+=this.node_array[O].weight}var K=r;if(K>0&&r>0){var o=r/K/K;var k=o*Math.pow(K,0.5*(e-g));var s=o*K*Math.pow(s,e-g)}else{k=1}var L=e;var P=g;var u=0;var f=[];var n=[];var m=0;var Q=new Array(this.node_number).fill(0);for(var F=1;F<=w;F++){A();var N=x();e=L;g=P;if(F<=0.6*w){e+=1.1*(1-P);g+=0.9*(1-P)}else{if(F<=0.9*w){e+=1.1*(1-P)*(0.9-F/w)/0.3;g+=0.9*(1-P)*(0.9-F/w)/0.3}}u=0;var B=0;for(var M=0;M<this.node_number;M++){var D=this.node_array[M];if(F<=0.6*w){if(Q[M]>0){B++}if(Q[M]>2){continue}}oldEnergy=S(M,N);v(M,N,n);var C=[D._layoutPosX,D._layoutPosY,0];f=C.slice(0);bestEnergy=oldEnergy;var y=0;n[0]/=32;n[1]/=32;for(var G=32;G>=1&&(y==0||y/2==G);G/=4){N.removeNode(D,C,0);C[0]=f[0]+n[0]*G;C[1]=f[1]+n[1]*G;D._layoutPosX=C[0];D._layoutPosY=C[1];N.addNode(D,C,0);curEnergy=S(M,N);if(curEnergy<bestEnergy){bestEnergy=curEnergy;y=G}}for(G=64;G<=128&&y==G/2;G*=2){N.removeNode(D,C,0);C[0]=f[0]+n[0]*G;C[1]=f[1]+n[1]*G;D._layoutPosX=C[0];D._layoutPosY=C[1];N.addNode(D,C,0);curEnergy=S(M,N);if(curEnergy<bestEnergy){bestEnergy=curEnergy;y=G}}if(y==0){Q[M]++}else{Q[M]=0}N.removeNode(D,C,0);C[0]=f[0]+n[0]*y;C[1]=f[1]+n[1]*y;if(E=="0x0"||E=="0x1"){D._layoutPosX=C[0]}if(E=="0x0"||E=="1x0"){D._layoutPosY=C[1]}N.addNode(D,C,0);u+=bestEnergy}if(B==this.node_number&&F<=0.6*w){F=Math.max(F,parseInt(0.6*w))}m=u}this.fitIntoView(b);if(t){t()}};graphica.GraphModel.fn.dagreLayout=function(j,b){var k=this;var e=j.width;var a=j.height;var c=j.fixed_axis||"0x0";var f=new dagre.graphlib.Graph();var h="TB";f.setGraph({rankdir:j.direction,ranker:"longest-path"});f.setDefaultEdgeLabel(function(){return{}});this.eachNode(function(){f.setNode(this.getId()+"",{width:10,height:10})});this.eachEdge(function(){f.setEdge(this.source_node.getId()+"",this.target_node.getId()+"")});dagre.layout(f);f.nodes().forEach(function(g){var l=k.getNode(g);if(c=="0x0"||c=="0x1"){l._layoutPosX=f.node(g).x}if(c=="0x0"||c=="1x0"){l._layoutPosY=f.node(g).y}});this.fitIntoView(j);if(b){b()}};graphica.GraphModel.fn.coarsenedLayout=function(c,e){var h=this;var b=c.fixed_axis||"0x0";var m=c.layout;var a=6;var j=[this.getSimilarityGraph()];for(var f=1;f<a;f++){j[f]=j[f-1].getCoarsenedGraph();if(j[f-1].node_number-j[f].node_number<j[f-1].node_number*0.2){break}}var l;var k=c.width;var g=c.height;if(m=="forceLayout"){l=400}else{if(m=="LinLogLayout"){l=70;c.preLayout=false}}for(f=j.length-1;f>=0;f--){c.iterations=Math.max(Math.round(l),2);if(m=="forceLayout"){l*=0.55}else{l*=0.75}if(m=="forceLayout"){if(f>0){c.width=this.node_number;c.height=this.node_number;c.doFit=false}else{c.width=k;c.height=g;c.doFit=true}}j[f].doLayout(c,function(){if(f>0){var n;j[f-1].eachNode(function(){n=j[f].getNode(this.newid);if(b=="0x0"||b=="1x0"){this._layoutPosY=n._layoutPosY}if(b=="0x0"||b=="0x1"){this._layoutPosX=n._layoutPosX}})}})}j[0].eachNode(function(){if(b=="0x0"||b=="0x1"){h.node_array[this.innerid]._layoutPosX=this._layoutPosX}if(b=="0x0"||b=="1x0"){h.node_array[this.innerid]._layoutPosY=this._layoutPosY}});if(e){e()}};graphica.GraphModel.fn.getSimilarityGraph=function(){var b=this;var a=new graphica.GraphModel();a.isCoarsened=true;this.eachNode(function(){a.addNode(this.getId())});this.eachEdge(function(){var f=b.getAndNeighbours(this.source_node.innerid,this.target_node.innerid);var e=this.weight;for(var c=0;c<f.length;c++){e+=b.getEdge(this.source_node.innerid,f[c],true).weight*b.getEdge(this.target_node.innerid,f[c],true).weight}a.addEdge(this.source_node.getId(),this.target_node.getId(),e)});return a};graphica.GraphModel.fn.getCoarsenedGraph=function(){var e=this;var b=new graphica.GraphModel();b.isCoarsened=true;var a=this.getOrderedEdges();for(var c=0;c<a.length;c++){if(typeof a[c].source_node.newid==="undefined"&&typeof a[c].target_node.newid==="undefined"){a[c].source_node.newid=a[c].source_node.innerid;a[c].target_node.newid=a[c].source_node.newid}}this.eachNode(function(){if(typeof this.newid==="undefined"){this.newid=this.innerid;if(this.degree==1){var g=this.getNeighbours();if(g.length==1&&typeof e.node_array[g[0]].newid!=="undefined"){this.newid=e.node_array[g[0]].newid}}}var f=b.addNode(this.newid)});this.eachEdge(function(){b.addEdge(this.source_node.newid,this.target_node.newid,this.weight)});return b};window.graphica=window.graphica||{};graphica.Legend=function(Y,Q,r){var g=this;this.vp=Y;this.pr=Q;this.max_width=null;if(typeof r==="number"){this.max_width=r}this.variable=this.vp.firstVariable(this.pr);this.variable_type=this.vp._ds.columnType(this.variable);this.gr=new Grape().enableEvents(false);if(typeof this.vp.getSettings(this.variable,this.pr,"label")=="string"&&this.vp.getSettings(this.variable,this.pr,"label")!=""){this.legend_str=this.vp.getSettings(this.variable,this.pr,"label")}else{this.legend_str=this.vp._ds.columnName(this.variable)}this.label_color=this.vp.legend_font_color;this.label_size=this.vp.legend_font_size;this.label_font=this.vp.legend_font;var h=this.vp.getSettings(this.variable,this.pr,"show_title");var p=10;if(this.legend_title!=""&&h!==false){this.legend_title=raceme.label(this.legend_str,0,0,this.label_color,this.label_size,"left",null,1,this.label_font);this.legend_title.attr("font-weight","bold");this.gr.addChild(this.legend_title);this.legend_title._legend_label=this.legend_str;this.legend_title._variable_name=this.vp._ds.columnName(this.variable);this.legend_title._legend_label_property=graphica.PropertyStr[Q];this.legend_title.enableEvents(true);this.vp.view.classify(this.legend_title,"axis/legend title");p=this.legend_title.getBBox().height+this.label_size}var A;var L;var y;var E;var T;if(this.pr==graphica.HUE){var m=160;if(this.vp._ds.isDateType(this.variable)){y=this.vp._ds.min(this.variable);E=this.vp._ds.max(this.variable);if(typeof y==="undefined"||typeof E=="undefined"){return}var X=this.vp._ds.tickUnit(this.variable);var O=null;if(this.vp._ds.includesTime(this.variable)&&this.vp._ds.includesDate(this.variable)==false){O="time"}A=raceme.label(y.strformat(X,O),0,p+36,this.label_color,this.label_size,"left","top",1,this.label_font);L=raceme.label(E.strformat(X,O),m,p+36,this.label_color,this.label_size,"right","top",1,this.label_font);var I=A.getBBox().width;var t=L.getBBox().width;if(I+24+t>m){m=I+t+24;L=raceme.label(E.strformat(X,O),m,p+36,this.label_color,this.label_size,"right","top",1,this.label_font)}A.addTo(this.gr);L.addTo(this.gr);this.gr.lineStyle(1,this.vp.default_hue,1,"butt","miter",4,"2 2");this.gr.line(0,p+22,0,p+32);this.gr.line(m,p+22,m,p+32);for(T=0;T<m;T++){var l;if(T==0){l=y}else{if(T==m-1){l=E}else{l=graphica.Utils.map(T,0,m-1,y.getTime(),E.getTime());l=new Date(l)}}this.gr.beginFill(this.vp.getColorByValue(l),1).lineStyle(0).rect(T,p,2,18)}}else{if(this.vp._ds.isCategorical(this.variable)){var a=this.vp.getOrderedItems(this.variable,graphica.HUE);var o=0;var ac=0;var C=0;var x=true;for(T=0;T<a.length;T++){var D=0;var P=this.vp.default_form;if(P==graphica.NONE_SHAPE||P==graphica.GEO_SHAPE||P==graphica.LINE||P==graphica.AREALINE||P==graphica.FILLED_RECTANGLE||P==graphica.CIRCLE){P=graphica.FILLED_DISK}var W=new Grape().addTo(this.gr);var s=this.vp.getFormGrape(P,150,this.vp.getColorByValue(a[T]),1).x(ac+10).y(p+6);if(isPIXI()){s.y(p+10)}W._is_legend_element=true;if(this.vp.view._viewidgroup!=-1){this.vp.view.filterWrapper(W,this.variable,this.vp._ds.rows(this.variable,a[T]))}W._alias_option_original_value=a[T];W._alias_option_alias_value=this.vp.getAlias(this.variable,graphica.HUE,a[T]);W._alias_option_variable=this.vp._ds.columnName(this.variable);W._alias_option_property="COLOR";W._color=this.vp.getColorByValue(a[T]);W.enableEvents(true);this.vp.view.classify(W,"axis/legend label");var j=raceme.label(this.vp.getAlias(this.variable,graphica.HUE,a[T])||a[T],ac+25,p,this.label_color,this.label_size,"left","top",1,this.label_font);o=j.getBBox().width+45;D=j.getBBox().height;if(this.max_width===null){p+=Math.max(this.label_size*1.5,D);ac=0;s.addTo(W);j.addTo(W)}else{if((ac+o)>this.max_width&&x==false){p+=Math.max(this.label_size*1.5,C);T--;C=0;ac=0;x=true}else{ac+=o;C=Math.max(C,D);s.addTo(W);j.addTo(W);x=false}}}}else{if(this.variable_type==="number"){var U=this.vp.getSettings(this.variable,graphica.HUE,"aggregation");if(this.vp.color_scheme_diverging&&this.vp.stepped_color){y=this.vp.min_palette_value;E=this.vp.max_palette_value}else{y=this.vp._ds.min(this.variable,U);E=this.vp._ds.max(this.variable,U)}A=raceme.label(this._format_number(y),0,p+36,this.label_color,this.label_size,"left","top",1,this.label_font);L=raceme.label(this._format_number(E),m,p+36,this.label_color,this.label_size,"right","top",1,this.label_font);if(this.vp.color_scheme_diverging){v=this.vp.middle_hue_value;if(v>y&&v<E){var q=graphica.Utils.map(v,y,E,0,m);var aa=q;w=raceme.label(this._format_number(v),aa,p+36,this.label_color,this.label_size,"center","top",1,this.label_font);if(A.getBBox().width+L.getBBox().width+w.getBBox().width+24>m){m=A.getBBox().width+L.getBBox().width+w.getBBox().width+24;L=raceme.label(this._format_number(E),m,p+36,this.label_color,this.label_size,"right","top",1,this.label_font);q=graphica.Utils.map(v,y,E,0,m);aa=q}aa=Math.max(aa,12+A.getBBox().width+w.getBBox().width/2);aa=Math.min(aa,m-12-L.getBBox().width-w.getBBox().width/2);w=raceme.label(this._format_number(v),aa,p+36,this.label_color,this.label_size,"center","top",1,this.label_font)}}this.gr.lineStyle(1,this.vp.default_hue,1,"butt","miter",4,"2 2");this.gr.line(0,p+22,0,p+32);this.gr.line(m,p+22,m,p+32);this.gr.addChild(A);this.gr.addChild(L);if(w){this.gr.line(q,p+22,q,p+27).line(q,p+27,aa,p+27).line(aa,p+27,aa,p+32);this.gr.addChild(w)}if(this.vp.stepped_color){for(T=0;T<this.vp.color_steps;T++){var l;if(T==0){l=y}else{if(T==this.vp.color_steps-1){l=E}else{l=graphica.Utils.map(T+0.5,0,this.vp.color_steps,y,E)}}this.gr.beginFill(this.vp.getColorByValue(l),1).lineStyle(0).rect(T*m/this.vp.color_steps,p,m/this.vp.color_steps,19)}}else{var l;for(T=0;T<m;T+=2){l=graphica.Utils.map(T,0,m-1,y,E);this.gr.beginFill(this.vp.getColorByValue(l),1).lineStyle(0).rect(T,p,2,18)}}}}}}else{if(this.pr==graphica.INTENSITY){var m=160;var U=this.vp.getSettings(this.variable,graphica.INTENSITY,"aggregation");y=this.vp._ds.min(this.variable,U);E=this.vp._ds.max(this.variable,U);if(typeof y==="undefined"||typeof E=="undefined"){return}if(this.vp._ds.isDateType(this.variable)){var X=this.vp._ds.tickUnit(this.variable);var O=null;if(this.vp._ds.includesTime(this.variable)&&this.vp._ds.includesDate(this.variable)==false){O="time"}A=raceme.label(y.strformat(X),0,p+36,this.label_color,this.label_size,"left","top",1,this.label_font);L=raceme.label(E.strformat(X),m,p+36,this.label_color,this.label_size,"right","top",1,this.label_font)}else{A=raceme.label(this._format_number(y),0,p+36,this.label_color,this.label_size,"left","top",1,this.label_font).addTo(this.gr);L=raceme.label(this._format_number(E),m,p+36,this.label_color,this.label_size,"right","top",1,this.label_font)}var I=A.getBBox().width;var t=L.getBBox().width;if(I+24+t>m){m=I+t+24;if(this.vp._ds.isDateType(this.variable)){L=raceme.label(E.strformat(X),m,p+36,this.label_color,this.label_size,"right","top",1,this.label_font)}else{L=raceme.label(this._format_number(E),m,p+36,this.label_color,this.label_size,"right","top",1,this.label_font)}}A.addTo(this.gr);L.addTo(this.gr);this.gr.lineStyle(1,this.vp.default_hue,1,"butt","miter",4,"2 2");this.gr.line(0,p+22,0,p+32);this.gr.line(m,p+22,m,p+32);for(T=0;T<m;T+=2){var l;if(this.vp._ds.isDateType(this.variable)){var k=graphica.Utils.map(T,0,m,0,1);this.gr.beginFill(this.vp.default_hue,k).lineStyle(0).rect(T,p,2,18)}else{if(T==0){l=y}else{if(T==m-1){l=E}else{l=graphica.Utils.map(T,0,m-1,y,E)}}this.gr.beginFill(this.vp.default_hue,this.vp.getIntensityByValue(l)).lineStyle(0).rect(T,p,2,18)}}}else{if(this.pr==graphica.SHAPE){var a=[];if(this.vp._ds.isDateType(this.variable)){var X=this.vp._ds.tickUnit(this.variable)}a=this.vp.getOrderedItems(this.variable,graphica.SHAPE,X);for(T=0;T<a.length&&T<20;T++){var W;W=new Grape().addTo(this.gr);var D=0;var s=this.vp.getFormGrape(this.vp.getForm(a[T]),150,this.vp.default_hue,1).x(10).y(p+6);if(isPIXI()){s.y(p+10)}s.addTo(W);W._is_legend_element=true;var j;if(this.vp._ds.isDateType(this.variable)){var O=null;var U=this.vp.getSettings(this.variable,graphica.SHAPE,"aggregation");if(this.vp._ds.includesTime(this.variable)&&this.vp._ds.includesDate(this.variable)==false){O="time"}if(graphica.Utils.isDateTickSmallerThan(U,this.vp._ds.tickUnit(this.variable))){U=this.vp._ds.tickUnit(this.variable)}j=raceme.label(a[T].strformat(U,O),25,p,this.label_color,this.label_size,"left","top",1,this.label_font).addTo(W);if(this.vp.view._viewidgroup!=-1){this.vp.view.filterWrapper(W,this.variable,this.vp._ds.rows(this.variable,a[T]),U)}}else{j=raceme.label(this.vp.getAlias(this.variable,graphica.SHAPE,a[T])||a[T],25,p,this.label_color,this.label_size,"left","top",1,this.label_font).addTo(W);if(this.vp.view._viewidgroup!=-1){this.vp.view.filterWrapper(W,this.variable,this.vp._ds.rows(this.variable,a[T]))}W._alias_option_original_value=a[T];W._alias_option_alias_value=this.vp.getAlias(this.variable,graphica.SHAPE,a[T]);W._alias_option_variable=this.vp._ds.columnName(this.variable);W._alias_option_property="SHAPE";W.enableEvents(true);this.vp.view.classify(W,"axis/legend label")}D=j.getBBox().height;p+=Math.max(this.label_size*1.5,D)}if(a.length>20){raceme.label("... and "+(a.length-20)+" other values",25,p,this.label_color,this.label_size,"left","middle",1,this.label_font).addTo(this.gr)}}else{if(this.pr==graphica.AREA&&this.vp.default_form==graphica.LINE){var n;var H;var c;var e=40;var B=new Grape();var U=this.vp.getSettings(this.variable,graphica.AREA,"aggregation");n=this.vp.getAreaByValue(this.vp._ds.max(this.variable,U));n=raceme.map(n,1,7854,0.5,126);n=raceme._round(n,1);var f=Math.max(n/2,this.label_size);e=Math.max(e,n*2);H=this.vp.getAreaByValue(this.vp._ds.min(this.variable,U)+((this.vp._ds.max(this.variable,U)-this.vp._ds.min(this.variable,U))/2));H=raceme.map(H,1,7854,0.5,126);H=raceme._round(H,1);var u=Math.max(n,28)+Math.max(H/2,this.label_size)+4;c=this.vp.getAreaByValue(this.vp._ds.min(this.variable,U));c=raceme.map(c,1,7854,0.5,126);c=raceme._round(c,1);var Z=Math.max(n,28)+Math.max(H,28)+Math.max(c/2,this.label_size)+8;B.lineStyle(n,this.vp.default_hue,1,"butt","round");B.line(0,f,e,f);B.lineStyle(H,this.vp.default_hue,1,"butt","round");B.line(0,u,e,u);B.lineStyle(c,this.vp.default_hue,1,"butt","round");B.line(0,Z,e,Z);B.addChild(raceme.label(this._format_number(this.vp._ds.max(this.variable)),e+4,f,this.label_color,this.label_size,"left","middle",1,this.label_font));B.addChild(raceme.label(this._format_number(this.vp._ds.min(this.variable)+((this.vp._ds.max(this.variable)-this.vp._ds.min(this.variable))/2)),e+4,u,this.label_color,this.label_size,"left","middle",1,this.label_font));B.addChild(raceme.label(this._format_number(this.vp._ds.min(this.variable)),e+4,Z,this.label_color,this.label_size,"left","middle",1,this.label_font));B.y(p);B.addTo(this.gr)}else{if(this.pr==graphica.AREA&&(this.vp.default_form!=graphica.GEO_SHAPE||this.vp.countVariables(graphica.SHAPE)>0)&&this.vp.default_form!=graphica.CIRCLE&&this.vp.default_form!=graphica.FILLED_RECTANGLE&&this.vp.default_form!=graphica.BAR&&this.vp.default_form!=graphica.AREALINE){var U=this.vp.getSettings(this.variable,this.pr,"aggregation");y=this.vp._ds.min(this.variable,U);E=this.vp._ds.max(this.variable,U);if(typeof this.vp.min_area_value==="number"){y=this.vp.min_area_value}if(typeof this.vp.max_area_value==="number"){E=this.vp.max_area_value}let is_integer=(this.vp._ds.isInteger(this.variable)&&U!="average"&&U!="median");let ticks=graphica.Utils.getNumericNiceScale(0,E,3,is_integer);var b=0;var v=0;var G=0;if(typeof ticks.ticks_values[3]!=="undefined"){b=ticks.ticks_values[3];v=ticks.ticks_values[2];G=ticks.ticks_values[1]}else{if(typeof ticks.ticks_values[2]!="undefined"){b=ticks.ticks_values[2];v=ticks.ticks_values[1]}else{if(typeof ticks.ticks_values[1]!="undefined"){b=ticks.ticks_values[1]}}}var K=this.vp.getFormGrape(graphica.DISK,this.vp.getAreaByValue(b),this.vp.default_hue);K.by("circle").attr("stroke-width",1);var z=this.vp.getFormGrape(graphica.DISK,this.vp.getAreaByValue(G),this.vp.default_hue);z.by("circle").attr("stroke-width",1);var S=this.vp.getFormGrape(graphica.DISK,this.vp.getAreaByValue(v),this.vp.default_hue);S.by("circle").attr("stroke-width",1);var J=new Grape();var N=new Grape();var F=new Grape();var V=K.getBBox();var R=z.getBBox();var ab=S.getBBox();K.x(V.width/2).y(p+V.height/2);var d=raceme.label(this._format_number(b),K.x()+V.width/2+10,K.y()-V.height/2-5,this.label_color,this.label_size,"left","top",1,this.label_font);J.lineStyle(1,this.vp.default_hue,1,"butt","miter",4,"2 2").line(K.x(),K.y()-V.height/2,K.x()+V.width/2+5,K.y()-V.height/2);S.x(K.x()).y(K.y()+V.height/2-ab.height/2);var w=raceme.label(this._format_number(v),K.x()+V.width/2+10,S.y()-ab.height/2-5,this.label_color,this.label_size,"left","top",1,this.label_font);N.lineStyle(1,this.vp.default_hue,1,"butt","miter",4,"2 2").line(S.x(),S.y()-ab.height/2,K.x()+V.width/2+5,S.y()-ab.height/2);z.x(K.x()).y(K.y()+V.height/2-R.height/2);var M=raceme.label(this._format_number(G),K.x()+V.width/2+10,z.y()-R.height/2-5,this.label_color,this.label_size,"left","top",1,this.label_font);F.lineStyle(1,this.vp.default_hue,1,"butt","miter",4,"2 2").line(z.x(),z.y()-R.height/2,K.x()+V.width/2+5,z.y()-R.height/2);this.gr.addChild(K);this.gr.addChild(J);this.gr.addChild(d);if(V.height-ab.height>this.label_size&&ab.height-R.height>this.label_size&&E*0.5>y){this.gr.addChild(S);this.gr.addChild(w);this.gr.addChild(N)}if(V.height-R.height>this.label_size&&G>y){this.gr.addChild(z);this.gr.addChild(M);this.gr.addChild(F)}}}}}}};graphica.Legend.fn=graphica.Legend.prototype;graphica.Legend.fn.getGrape=function(){return this.gr};graphica.Legend.fn._format_number=function(a){if(a>=1000000000){return graphica.Utils.round(a/1000000000,2).toString()+"G"}else{if(a>=1000000){return graphica.Utils.round(a/1000000,2).toString()+"M"}else{if(a>=10000){return graphica.Utils.round(a/1000,2).toString()+"k"}}}return graphica.Utils.round(a,2)};window.graphica=window.graphica||{};graphica.POS_X=0;graphica.POS_Y=1;graphica.AREA=3;graphica.HUE=5;graphica.INTENSITY=6;graphica.SHAPE=7;graphica.BLUR=9;graphica.SMALL_MULTIPLES=10;graphica.UNIT=15;graphica.LABEL=16;graphica.TOOLTIP=17;graphica.SUBDIVISION=18;graphica.FILTER=19;graphica.PropertyNames={AXIS_X:graphica.POS_X,AXIS_Y:graphica.POS_Y,AREA:graphica.AREA,COLOR:graphica.HUE,ALPHA:graphica.INTENSITY,SHAPE:graphica.SHAPE,BLUR:graphica.BLUR,MULTIPLES:graphica.SMALL_MULTIPLES,UNIT:graphica.UNIT,LABEL:graphica.LABEL,TOOLTIP:graphica.TOOLTIP,SUBDIVISION:graphica.SUBDIVISION,FILTER:graphica.FILTER};graphica.PropertyStr={0:"AXIS_X",1:"AXIS_Y",3:"AREA",5:"COLOR",6:"ALPHA",7:"SHAPE",9:"BLUR",10:"MULTIPLES",15:"UNIT",16:"LABEL",17:"TOOLTIP",18:"SUBDIVISION",19:"FILTER"};graphica.NONE_SHAPE=-1;graphica.DISK=0;graphica.BOX=1;graphica.TRI=2;graphica.CROSS=3;graphica.STAR=4;graphica.DIAMOND=5;graphica.FILLED_DISK=6;graphica.FILLED_BOX=7;graphica.FILLED_TRI=8;graphica.FILLED_DIAMOND=9;graphica.GEO_SHAPE=10;graphica.BAR=13;graphica.FILLED_RECTANGLE=14;graphica.LINE=15;graphica.AREALINE=16;graphica.CIRCLE=17;graphica.SLICE=18;graphica.RADAR_SLICE=19;graphica.POLAR_SLICE=20;graphica.SHAPE_NAMES={none:graphica.NONE_SHAPE,disk:graphica.DISK,box:graphica.BOX,tri:graphica.TRI,cross:graphica.CROSS,star:graphica.STAR,diamond:graphica.DIAMOND,"filled disk":graphica.FILLED_DISK,"filled box":graphica.FILLED_BOX,"filled tri":graphica.FILLED_TRI,"filled diamond":graphica.FILLED_DIAMOND,geo:graphica.GEO_SHAPE,bar:graphica.BAR,"filled rectangle":graphica.FILLED_RECTANGLE,line:graphica.LINE,area:graphica.AREALINE,circle:graphica.CIRCLE,slice:graphica.SLICE};graphica.EDGE_LINE=0;graphica.EDGE_ARROW=1;graphica.EDGE_TAPERED=2;graphica.EDGE_BUNDLING=3;graphica.EDGE_GREAT_CIRCLE=4;graphica.EDGE_FINE_ARROW=5;graphica.EDGE_CURVED=6;graphica.EDGE_CURVED_VERTICAL=7;graphica.EDGE_FORMS={line:graphica.EDGE_LINE,arrow:graphica.EDGE_ARROW,fine_arrow:graphica.EDGE_FINE_ARROW,tapered:graphica.EDGE_TAPERED,bundling:graphica.EDGE_BUNDLING,great_circle:graphica.EDGE_GREAT_CIRCLE,curved:graphica.EDGE_CURVED,curved_vertical:graphica.EDGE_CURVED_VERTICAL};graphica.default_hues=["rgb(122,195,106)","rgb(90,155,212)","rgb(250,167,91)","rgb(158,103,171)","rgb(206,112,88)","rgb(215,127,180)","rgb(234,213,20)","rgb(28,145,149)","rgb(33,139,83)","rgb(115,115,115)"];graphica.Properties=function(b,a){this.view=a;this._dataset=b;this._ds=this._dataset;this._ds_by_shape={};this._propertiesList=new graphica.PData();this.doClustering=false;this.default_intensity=1;this.default_area=113;this.default_hue="rgb(31,78,121)";this.default_form=graphica.FILLED_DISK;this.circle_chart_type="pie";this.start_marks="none";this.end_marks="none";this.line_type="none";this.default_division=0;this.default_link_target="_blank";this.base_url="";this.linkurl_variable=null;this.default_border_width=0;this.default_border_color="rgb(255,255,255)";this.custom_forms=[];this.use_custom_color={};this.custom_colors={};this.use_custom_size={};this.custom_sizes={};this.use_custom_alpha={};this.custom_alphas={};this.use_custom_bar_width={};this.custom_bar_widths={};this._dual_axis=false;this._synchronize_axis=false;this.density_map=false;this.box_plot=false;this.convex_hull=false;this.box_plot_style="filled";this.box_plot_default_color="rgb(187,187,187)";this.box_plot_colored_as_marks=false;this.box_plot_max_width=40;this.distribution_plot_in_front=false;this.distribution_plot_opacity=1;this.distribution_plot_fill_opacity=0.25;this.distribution_plot_border_width=2;this.circular_layout=false;this.reference_lines="none";this.reference_lines_type="yline";this.reference_lines_constant=0;this.reference_lines_degree=2;this.reference_lines_width=4;this.reference_lines_color="black";this.reference_lines_opacity=1;this.reference_lines_independent=true;this.prev_moving_average_data_points=5;this.next_moving_average_data_points=0;this.default_border_intensity=1;this.donut_inner_radius=0;this.default_label_color="rgb(20,20,20)";this.default_label_opacity=1;this.default_inner_color="white";this.default_inner_alpha=0.0001;this.default_label_size=14;this.default_label_pos="in";this.min_intensity=0.2;this.max_intensity=1;this.default_width=1;this.responsive_size=true;this.bar_width=0.6666;this.width_variable=null;this.opacity_variable=null;this.min_width=1;this.max_width=7;this.min_area=0;this.max_area=1000;this.min_hue="#AFDCCC";this.max_hue="#1C2B7F";this.saturation=0;this.size_range="uniform";this._frame_type="0x0";this._subframe_type="";this.all_x_are_categorical=true;this.all_y_are_categorical=true;this.all_x_are_quantitative=true;this.all_y_are_quantitative=true;this.all_quantitative_axis_variables=[];this._layout="default";this._layout_distance=0;this._layout_spatial_boundaries=true;this._is_graph_layout=false;this._graph_positions=null;this.stroke_color_on_labels="#FFFFFF";this.stepped_color=false;this.color_steps=7;this.legends_to_include=[];this.legends_user_want_to_include=[];this.user_selected_colors={};this.legend_font="";this.legend_font_color="#464646";this.legend_font_size=14;this.connection_variable="";this.interpolate_missing_values=true;this.edge_form=graphica.EDGE_LINE;this.edge_curvature=0;this.edge_bundling_on="distance";this.edges_colored_as_marks=false;this.edges_colored_as_marks_only_between_same_color_marks=false;this.label_space_width=0;this.label_config="";this.label_variables=[];this.labels_colored_as_marks=false;this.labels_opacity_as_marks=false;this.labels_size_as_marks=null;this.label_font="";this.label_placement="automatic";this.label_allow_overlapping=false;this.label_auto_contrast=true;this.stroke_on_labels=false;this.label_align="center";this.label_vertical_align="middle";this.tooltip_config="";this.tooltip_variables=[];this.marks_included="all";this.marks_to_label="auto";this.categorical_division=[];this.oneLine_oneLabel=false;this.oneLine_oneLabel_orientation_layout="vertical";this.desiredClusters=6;this.small_left_padding=16;this.small_top_padding=16;this.small_right_padding=16;this.small_bottom_padding=16;this.include_title_on_small_multiples=true;this.small_title_color="#141414";this.small_title_font_size=14;this.small_title_font="";this.default_min_num_decimals=0;this.default_max_num_decimals=2;this.default_number_prefix="";this.default_number_suffix="";this.country_specification="value";this.max_edges_displayed=2000;this.middle_hue="rgb(240,240,240)";this.middle_hue_type_of_value=null;this.middle_hue_value=null;this.middle_hue_constant=null;this.color_scheme_diverging=false;this.max_palette_value=null;this.min_palette_value=null};graphica.Properties.fn=graphica.Properties.prototype;graphica.Properties.fn.clone=function(){var a=new graphica.Properties(this._dataset,this.view);a.applyGrammar(this);a.default_area=this.default_area;a.default_form=this.default_form;a.circle_chart_type=this.circle_chart_type;a.start_marks=this.start_marks;a.end_marks=this.end_marks;a.line_type=this.line_type;a.circular_layout=this.circular_layout;a._layout_distance=this._layout_distance;a._layout_spatial_boundaries=this._layout_spatial_boundaries;a.max_area=this.max_area;a.responsive_size=this.responsive_size;a.box_plot_style=this.box_plot_style;a.box_plot_default_color=this.box_plot_default_color;a.box_plot_colored_as_marks=this.box_plot_colored_as_marks;a.reference_lines=this.reference_lines;a.reference_lines_type=this.reference_lines_type;a.reference_lines_constant=this.reference_lines_constant;a.reference_lines_degree=this.reference_lines_degree;a.reference_lines_width=this.reference_lines_width;a.reference_lines_color=this.reference_lines_color;a.reference_lines_opacity=this.reference_lines_opacity;a.reference_lines_independent=this.reference_lines_independent;a.prev_moving_average_data_points=this.prev_moving_average_data_points;a.next_moving_average_data_points=this.next_moving_average_data_points;a.init();return a};graphica.Properties.fn.link=function(a,b){var_n=a;if(typeof a==="string"){a=this._dataset.header.getId(a)}if(this._dataset.hasColumn(a)==false){return this}if(!(b>=0&&b<=19)){return this.debug("Invalid property value")}if(this.isSet(a,b)){return this.debug("Property value already assigned")}if(this._dataset.isQuantitative(a)&&(b==graphica.SHAPE||b==graphica.SMALL_MULTIPLES)){return this.debug("Property ("+b+") not compatible with numeric variables ("+this._dataset.header.names[a]+")")}if(!this._dataset.isQuantitative(a)&&(b==graphica.AREA||b==graphica.BLUR)){return this.debug("Property not compatible with categorical variables")}if((b==graphica.UNIT||b==graphica.SHAPE||b==graphica.AREA||b==graphica.HUE||b==graphica.INTENSITY||b==graphica.BLUR||b==graphica.SMALL_MULTIPLES)&&this.countVariables(b)!=0){return this.debug("This property ("+b+") has been already assigned to another variable")}this._propertiesList.add(a,b);if((b===graphica.AREA||b===graphica.HUE||b===graphica.SHAPE||b===graphica.INTENSITY)&&this.legends_to_include.indexOf(b)==-1){if(b!=graphica.AREA||(b==graphica.AREA&&(this.default_form==graphica.DISK||this.default_form==graphica.FILLED_DISK))){this.legends_to_include.push(b)}}if(b==graphica.SUBDIVISION&&this.categorical_division.indexOf(a)==-1){this.categorical_division.push(a)}return this};graphica.Properties.fn.remove_link=function(a,b){if(typeof b=="string"){b=b.toUpperCase();if(typeof graphica.PropertyNames[b]!=="undefined"){this._propertiesList.remove(a,graphica.PropertyNames[b])}}else{this._propertiesList.remove(a,b)}};graphica.Properties.fn.getOrderedItems=function(d,o,b,f,c){var i;if(typeof c!=="boolean"){c=false}if(this._ds.isCategorical(d)){if(typeof b==="undefined"){b=null}this._previousOrderedItems=this._previousOrderedItems||{};this._previousOrderedItems[d]=this._previousOrderedItems[d]||{};if(typeof this._previousOrderedItems[d][o]!=="undefined"&&b===null){if(c){return this._previousOrderedItems[d][o].slice().reverse()}return this._previousOrderedItems[d][o]}var a=this.getSettings(d,o,"sort_type");var m=this.getSettings(d,o,"sort_variable");var n=this.getSettings(d,o,"sort_categories");var e=this.getSettings(d,o,"sort_order")||"asc";var l=this.getSettings(d,o,"sort_variable_aggregation");var k=this._ds;if(b!==null){k=k.rows(b,f)}if(a&&a!="none"){if(a=="manual"){if(!n){i=k.unique(d)}else{i=k.unique(d,n)}if(b===null){this._previousOrderedItems[d][o]=i}if(c){return i.slice().reverse()}return i}else{if(a=="by variable"&&m&&m!="none"){var q=[];var j={};var p=k.groupBy(d);p.eachRow(function(s,h){var r=p.getValue(h,d);q.push(r);j[r]=p.getValue(h,m,l)});q.sort(function(r,h){if(j[r]<j[h]){return -1}if(j[r]>j[h]){return 1}return 0});if(e=="desc"){q.reverse()}if(b===null){this._previousOrderedItems[d][o]=q}if(c){return q.slice().reverse()}return q}else{if(a=="alphabetical"){i=k.unique(d);var q={};for(var g=0;g<i.length;g++){q[i[g]]=this.getAlias(d,o,i[g])||i[g];q[i[g]]=q[i[g]].toLowerCase()}i=i.sort(Intl.Collator().compare);if(e=="desc"){i.reverse()}if(b===null){this._previousOrderedItems[d][o]=i}if(c){return i.slice().reverse()}return i}}}}i=k.unique(d);if(b===null){this._previousOrderedItems[d][o]=i}if(c){return i.slice().reverse()}return i}else{if(this._ds.isDateType(d)){if(graphica.Utils.isDateTickSmallerThan(this.getSettings(d,o,"aggregation"),this._ds.tickUnit(d))){i=this._ds.unique(d,this._ds.getDateTicks(d,this._ds.tickUnit(d)).ticks_strings,this._ds.tickUnit(d));if(c){return i.slice().reverse()}return i}i=this._ds.unique(d,this._ds.getDateTicks(d,this.getSettings(d,o,"aggregation")).ticks_strings,this.getSettings(d,o,"aggregation"));if(c){return i.slice().reverse()}return i}else{if(this._ds.isQuantitative(d)){this._previousOrderedItems=this._previousOrderedItems||{};this._previousOrderedItems[d]=this._previousOrderedItems[d]||{};if(typeof this._previousOrderedItems[d][o]!=="undefined"){return this._previousOrderedItems[d][o]}i=this._ds.unique(d).sort(function(r,h){return r-h});this._previousOrderedItems[d][o]=i;if(c){return i.slice().reverse()}return i}}}return[]};graphica.Properties.fn.debug=function(a){console.log(a);return this};graphica.Properties.fn.isOrdinal=function(a){if(this._dataset.isDateType(a)){return true}return false};graphica.Properties.fn.countVariables=function(a){return this._propertiesList.keys(a).length};graphica.Properties.fn.countProperties=function(a){a=this._ds.header.getId(a);return this._propertiesList.values(a).filter(function(d,c,b){return d!=graphica.FILTER}).length};graphica.Properties.fn.getDateAggregation=function(b){var d=null;if(this._ds.isDateType(b)){for(var c=0;c<this._propertiesList.values(b).length;c++){var e=this._propertiesList.values(b)[c];if(e!=graphica.FILTER&&e!=graphica.AREA&e!=graphica.HUE&&e!=graphica.INTENSITY){var a=this.getSettings(b,e,"aggregation");if(typeof a=="string"){if(graphica.Utils.isDateTickSmallerThan(d,a)){d=a}}}}if(graphica.Utils.isDateTickSmallerThan(d,this._ds.tickUnit(b))){d=this._ds.tickUnit(b)}}return d};graphica.Properties.fn.setSettings=function(a,d,b,c){a=this._ds.header.getId(a);if(a>=0){this._propertiesList.settings(a,d,b,c);if(b=="min"){if(typeof c=="number"){if(d==graphica.AREA){this.min_area=c}if(d==graphica.INTENSITY&&c>=0&&c<=1){this.min_intensity=c}}else{if(typeof c=="string"){if(d==graphica.HUE){this.min_hue=c}}}}else{if(b=="min_value"){if(typeof c=="number"){if(d==graphica.AREA){this.min_area_value=c}if(d==graphica.INTENSITY){this.min_intensity_value=c}}}else{if(b=="max"){if(typeof c=="number"){if(d==graphica.AREA){this.max_area=c}if(d==graphica.INTENSITY&&c>=0&&c<=1){this.max_intensity=c}}else{if(typeof c=="string"){if(d==graphica.HUE){this.max_hue=c}}}}else{if(b=="max_value"){if(typeof c=="number"){if(d==graphica.AREA){this.max_area_value=c}if(d==graphica.INTENSITY){this.max_intensity_value=c}if(d==graphica.HUE){this.max_hue_value=c}}}else{if(b=="middle"){if(typeof c=="string"){if(d==graphica.HUE){this.middle_hue=c}}}else{if(b=="middle_constant"){if(typeof c=="number"){if(d==graphica.HUE){this.middle_hue_constant=c}}}else{if(b=="middle_value"){if(typeof c=="string"){if(d==graphica.HUE){this.middle_hue_type_of_value=c}}}else{if(b=="color_scheme"){if(typeof c=="string"){if(d==graphica.HUE&&c=="diverging"){this.color_scheme_diverging=true}}}else{if(b=="legend"){if(d===graphica.AREA||d===graphica.HUE||d===graphica.SHAPE||d===graphica.INTENSITY){if(c===true||c==="true"){this.legends_user_want_to_include.push(d)}else{if(c===false||c==="false"){let ppos=this.legends_to_include.indexOf(d);if(ppos!=-1){this.legends_to_include.splice(ppos,1)}}}}}else{if(b=="color_steps"){if(typeof c=="number"){c=parseInt(c);c=Math.max(2,c);if(d==graphica.HUE){this.color_steps=c}}}else{if(b=="stepped_color"){if(typeof c=="boolean"){if(d==graphica.HUE){this.stepped_color=c}}}else{if(b=="left_padding"&&typeof c=="number"){if(d==graphica.SMALL_MULTIPLES){this.small_left_padding=c}}else{if(b=="right_padding"&&typeof c=="number"){if(d==graphica.SMALL_MULTIPLES){this.small_right_padding=c}}else{if(b=="top_padding"&&typeof c=="number"){if(d==graphica.SMALL_MULTIPLES){this.small_top_padding=c}}else{if(b=="bottom_padding"&&typeof c=="number"){if(d==graphica.SMALL_MULTIPLES){this.small_bottom_padding=c}}else{if(b=="show_title"&&typeof c=="boolean"){if(d==graphica.SMALL_MULTIPLES){this.include_title_on_small_multiples=c}}else{if(b=="title_font"&&typeof c=="string"){if(d==graphica.SMALL_MULTIPLES){this.small_title_font=c}}else{if(b=="title_size"&&typeof c=="number"){if(d==graphica.SMALL_MULTIPLES){this.small_title_font_size=c}}else{if(b=="title_color"&&typeof c=="string"){if(d==graphica.SMALL_MULTIPLES){this.small_title_color=c}}else{if(b=="range"&&typeof c=="string"){if(d==graphica.AREA){this.size_range=c}}else{if(b=="custom_shape"&&(d==graphica.POS_X||d==graphica.POS_Y)){if(this.custom_forms.includes(c)==false){this.custom_forms.push(c)}}else{if(b=="use_custom_color"&&(d==graphica.POS_X||d==graphica.POS_Y)&&c===true){this.use_custom_color[a]=true}else{if(b=="custom_color"&&(d==graphica.POS_X||d==graphica.POS_Y)&&raceme._getRGB(c)){this.custom_colors[a]=c}else{if(b=="use_custom_size"&&(d==graphica.POS_X||d==graphica.POS_Y)&&c===true){this.use_custom_size[a]=true}else{if(b=="custom_size"&&(d==graphica.POS_X||d==graphica.POS_Y)&&typeof c=="number"&&c>=1){this.custom_sizes[a]=Math.round(c*c*Math.PI)}else{if(b=="use_custom_alpha"&&(d==graphica.POS_X||d==graphica.POS_Y)&&c===true){this.use_custom_alpha[a]=true}else{if(b=="custom_alpha"&&(d==graphica.POS_X||d==graphica.POS_Y)&&typeof c=="number"){this.custom_alphas[a]=c}else{if(b=="use_custom_bar_width"&&(d==graphica.POS_X||d==graphica.POS_Y)&&c===true){this.use_custom_bar_width[a]=true}else{if(b=="custom_bar_width"&&(d==graphica.POS_X||d==graphica.POS_Y)&&typeof c=="number"){this.custom_bar_widths[a]=c}else{if(b=="country_specification"&&d==graphica.UNIT){this.country_specification=c}else{if(b=="country_specification_label"&&d==graphica.UNIT){this.country_specification_label=c}else{if(b=="country_specification_variable"&&d==graphica.UNIT){this.country_specification_variable=this._ds.header.getId(c)}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}return this};graphica.Properties.fn.getDataValue=function(c,b,f,e){if(Array.isArray(c)){return c[b]}var d=this.getSettings(b,f,"aggregation");if(typeof e!=="undefined"){var a=this.Mark(e);if(typeof this._ds_by_shape[a]!=="undefined"){return this._ds_by_shape[a].getValue(c,b,d)}}return this._ds.getValue(c,b,d)};graphica.Properties.fn.getCategoricalDataValue=function(c,b,d){if(typeof d!=="undefined"){var a=this.Mark(d);if(typeof this._ds_by_shape[a]!=="undefined"){return this._ds_by_shape[a].getValue(c,b)}}return this._ds.getValue(c,b)};graphica.Properties.fn.getSettings=function(a,c,b){a=this._ds.header.getId(a);if(typeof c=="string"&&typeof graphica.PropertyNames[c]!="undefined"){c=graphica.PropertyNames[c]}if(this.isSet(a,c)){return this._propertiesList.settings(a,c,b)}return null};graphica.Properties.fn.firstVariable=function(a){return this._propertiesList.firstKey(a)};graphica.Properties.fn.secondVariable=function(a){return this._propertiesList.secondKey(a)};graphica.Properties.fn.lastVariable=function(a){var b=this._propertiesList.keys(a);return b[b.length-1]};graphica.Properties.fn.allVariables=function(a){return this._propertiesList.keys(a)};graphica.Properties.fn.isSet=function(a,b){if(typeof a==="string"){a=this._dataset.header.getId(a)}return this._propertiesList.isSet(a,b)};graphica.Properties.fn.getFormGrape=function(b,c,i,h,e){if(typeof c!="number"){c=this.default_area}var k=false;var l=false;if(b==graphica.DISK||(b==graphica.LINE&&this.start_marks=="disk")){k=true}else{if(b==graphica.FILLED_DISK||(b==graphica.LINE&&this.start_marks=="filled disk")){l=true}}var f=new Grape();if(typeof e!=="undefined"&&e){f._custom_color=e;i=e}f._form_data=new graphica.FormData();f._form_data.color(i);var d;var g;if(b==graphica.NONE_SHAPE||(b==graphica.LINE&&this.start_marks=="none")){f._form_data.form(graphica.NONE_SHAPE);var a=0.00001;f.beginFill("white",a).lineStyle(0).circle(0,0,raceme._radius(c));if(b==graphica.NONE_SHAPE){f._form_data.radius(raceme._radius(c))}f._is_invisible=true;return f}var m;if(b==graphica.BAR){b=graphica.FILLED_BOX}if(l||b==graphica.FILLED_BOX||b==graphica.FILLED_DIAMOND||b==graphica.FILLED_TRI){m=this.default_border_color||i;f.beginFill(i,h).lineStyle(this.default_border_width,m,this.default_border_intensity)}else{if(k){m=this.default_inner_color;f.beginFill(m,this.default_inner_alpha).lineStyle(this.default_border_width||1,i,h)}else{m=this.default_inner_color;f.beginFill(m,this.default_inner_alpha).lineStyle(this.default_border_width||1,i,h)}}f._form_data.form(b);if(k||l){d=raceme._radius(c);if(k&&d>=2){d-=1}f.circle(0,0,d);f._form_data.radius(d)}else{if(b==graphica.BOX||b==graphica.FILLED_BOX){g=graphica.Utils.round(Math.sqrt(c),3);if(b==graphica.BOX&&g>=3){g-=2}f.rect(-g/2,-g/2,g,g);f._form_data.radius((Math.sqrt(2)*g)/2).width(g).height(g)}else{if(b==graphica.DIAMOND||b==graphica.FILLED_DIAMOND){g=Math.sqrt(2*c);if(b==graphica.DIAMOND&&g>=3){g-=2}f.beginPath(true).moveTo(0,-g*0.5).lineTo(g*0.5,0).lineTo(0,g*0.5).lineTo(-g*0.5,0).endPath();f._form_data.radius(g/2)}else{if(b==graphica.TRI||b==graphica.FILLED_TRI){g=Math.sqrt(c/(Math.sqrt(3)/4));if(b==graphica.TRI&&g>=3){g-=2}var j=(Math.sqrt(3)/2)*g;f.beginPath(true).moveTo(0,((-j/3)*2)+j/6).lineTo(g/2,(j/3)+j/6).lineTo(-g/2,(j/3)+j/6).endPath();f._form_data.radius(j*0.75)}else{if(b==graphica.CROSS){g=Math.sqrt(2*c);if(g>=3){g-=2}f.moveTo(0,-g*0.5).lineTo(0,g*0.5).moveTo(g*0.5,0).lineTo(-g*0.5,0);d=raceme._radius(c);f.lineStyle(0).beginFill("white",0.0001);f.circle(0,0,d);f._form_data.radius(g*0.5)}else{if(b==graphica.STAR){g=Math.sqrt(2*c);if(g>=3){g-=2}f.moveTo(0,-g*0.5).lineTo(0,g*0.5);g=Math.sqrt(c);f.moveTo(-g*0.5,-g*0.5).lineTo(g*0.5,g*0.5).moveTo(-g*0.5,g*0.5).lineTo(g*0.5,-g*0.5);d=raceme._radius(c);f.lineStyle(0).beginFill("white",0.0001);f.circle(0,0,d);f._form_data.radius(g*0.75)}}}}}}return f};graphica.Properties.fn.getAlias=function(a,d,c){if(this._ds.isCategorical(a)){var b=this.getSettings(a,d,"alias");if(b){if(typeof b[c]==="string"){return b[c]}}}return""};graphica.Properties.fn.getArea=function(c,a,e){a=a||this._ds;if(typeof e!=="undefined"&&e!==null&&typeof this.use_custom_size[e]!=="undefined"){if(typeof this.custom_sizes[e]!=="undefined"){return this.custom_sizes[e]}return 113}if(this.countVariables(graphica.AREA)==0){return this.default_area}var b=this.firstVariable(graphica.AREA);var d=this.getSettings(b,graphica.AREA,"aggregation");return this.getAreaByValue(a.getValue(c,b,d))};graphica.Properties.fn.getAreaByValue=function(e){if(this.countVariables(graphica.AREA)==0){return this.default_area}var b=this.firstVariable(graphica.AREA);var c=this.getSettings(b,graphica.AREA,"aggregation");var a=Math.min(this._ds.min(b,c),0);var d=this._ds.max(b,c);if(typeof this.min_area_value==="number"){a=this.min_area_value}if(typeof this.max_area_value==="number"){d=this.max_area_value}if(this.responsive_size){this.max_area*=Math.max((this.view.frame._width*this.view.frame._height)/(800*600),0);this.responsive_size=false}return Math.max(graphica.Utils.map(e,a,d,this.max_area/100*this.min_area,this.max_area),0)};graphica.Properties.fn.getIntensity=function(c,a,e){a=a||this._ds;if(typeof e!=="undefined"&&e!==null&&typeof this.use_custom_alpha[e]!=="undefined"){if(typeof this.custom_alphas[e]!=="undefined"){return this.custom_alphas[e]}return 1}if(this.countVariables(graphica.INTENSITY)==0){return this.default_intensity}var b=this.firstVariable(graphica.INTENSITY);var d=this.getSettings(b,graphica.INTENSITY,"aggregation");var f=a.getValue(c,b,d);return this.getIntensityByValue(f)};graphica.Properties.fn.getIntensityByValue=function(g){if(g===null||typeof g==="undefined"){return this.default_intensity}if(typeof this.opacity_variable=="number"&&this._ds.isQuantitative(this.opacity_variable)){var b=this._ds.min(this.opacity_variable);var f=this._ds.max(this.opacity_variable);return graphica.Utils.map(g[this.opacity_variable],b,f,0.05,this.default_intensity)}if(this.countVariables(graphica.INTENSITY)==0){return this.default_intensity}var c=this.firstVariable(graphica.INTENSITY);if(Array.isArray(g)){g=g[c]}if(this._dataset.isDateType(c)){var h=this._ds.min(c).getTime();var a=this._ds.max(c).getTime();var d=g.getTime();return graphica.Utils.map(d,h,a,this.min_intensity,this.max_intensity)}var e=this.getSettings(c,graphica.INTENSITY,"aggregation");var b=this._ds.min(c,e);var f=this._ds.max(c,e);if(typeof this.min_intensity_value==="number"){b=this.min_intensity_value}if(typeof this.max_intensity_value==="number"){f=this.max_intensity_value}g=Math.max(g,b);g=Math.min(g,f);return graphica.Utils.map(g,b,f,this.min_intensity,this.max_intensity)};graphica.Properties.fn.getWidth=function(b){if(typeof this.width_variable=="number"&&this._ds.isQuantitative(this.width_variable)){var a=this._ds.min(this.width_variable);var c=this._ds.max(this.width_variable);return graphica.Utils.map(b,a,c,this.min_width,this.max_width)}else{return Math.max(1,this.max_width-7)}};graphica.Properties.fn.getHref=function(b){if(this.linkurl_variable===null){return""}var a;if(Array.isArray(b)){a=b[this.linkurl_variable]}else{a=this._ds.getValue(b,this.linkurl_variable)}if(typeof a!=="string"){return a.toString()}return encodeURIComponent(a)};graphica.Properties.fn.getLabelIntensity=function(b,a){if(this.labels_opacity_as_marks){return this.getIntensity(b,a)}return this.default_label_opacity};graphica.Properties.fn.getLabelColor=function(b,a){if(this.labels_colored_as_marks){return this.getColor(b,a)}return this.default_label_color};graphica.Properties.fn.getLabel=function(j,e,i,b,a,k){if(this.label_config==""){return null}if(typeof k!=="number"||k<0){k=0}if(!e){e="center"}var c=this.getLabelText(j,b,a);var f=this.default_label_size;if((this.Mark()==graphica.NONE_SHAPE&&this.labels_size_as_marks===null&&this.countVariables(graphica.AREA))||this.labels_size_as_marks===true){f=Math.max(parseInt(Math.sqrt(this.getArea(j,a))),1)}var h=this.getLabelColor(j,a);var d=this.getLabelIntensity(j,a);var g;if(k){g=raceme.paragraph(c,0,0,h,f,e,i,d,this.label_font,k).enableEvents(false)}else{g=raceme.label(c,0,0,h,f,e,i,d,this.label_font).enableEvents(false)}if(this.stroke_on_labels){g.style("stroke-width","2px");g.style("stroke",this.stroke_color_on_labels);g.style("paint-order","stroke");g.style("stroke-linejoin","round")}return g};graphica.Properties.fn.getTooltip=function(c,a,b){if(this.tooltip_variables.length==0){return""}return this.replaceVariablesWithValues(this.tooltip_config,c,this.tooltip_variables,b,a,graphica.TOOLTIP)};graphica.Properties.fn.Mark=function(a){if(typeof a!=="undefined"&&a!==null){var b=null;if(this._frame_type=="2x1C"||this._frame_type=="Nx1C"||this._frame_type=="Nx2C"||this._subframe_type=="2x1C"||this._subframe_type=="Nx1C"||this._subframe_type=="Nx2C"){b=this.getSettings(a,graphica.POS_X,"custom_shape")}else{if(this._frame_type=="1Cx2"||this._frame_type=="1CxN"||this._frame_type=="2CxN"||this._subframe_type=="1Cx2"||this._subframe_type=="1CxN"||this._subframe_type=="2CxN"){b=this.getSettings(a,graphica.POS_Y,"custom_shape")}}if(b!==null&&b!="none"&&typeof graphica.SHAPE_NAMES[b]!=="undefined"){return graphica.SHAPE_NAMES[b]}}return this.default_form};graphica.Properties.fn.getForm=function(g,b){if(this.countVariables(graphica.SHAPE)==0){return this.Mark(b)}var d=this.firstVariable(graphica.SHAPE);var j;if(Array.isArray(g)){j=g[d]}else{j=g}var h=this.getSettings(d,graphica.SHAPE,"aggregation");var f=null;if(this._ds.includesTime(d)&&this._ds.includesDate(d)==false){f="time"}if(graphica.Utils.isDateTickSmallerThan(h,this._ds.tickUnit(d))){h=this._ds.tickUnit(d)}if(j instanceof Date){j=j.strformat(h)}if(typeof this._variables_forms==="undefined"){this._variables_forms={};var a=this._ds.unique(d,null,this.getSettings(d,graphica.SHAPE,"aggregation"));var c=0;for(var e=0;e<a.length;e++){if(this._ds.isDateType(d)){this._variables_forms[a[e].strformat(h)]=c}else{this._variables_forms[a[e]]=c}c++;if(c>9){c=0}}}return this._variables_forms[j]};graphica.Properties.fn.getColor=function(c,a,e){a=a||this._ds;if(typeof e!=="undefined"&&e!==null&&typeof this.use_custom_color[e]!=="undefined"){if(typeof this.custom_colors[e]!=="undefined"){return this.custom_colors[e]}return"rgb(31,78,121)"}if(this.countVariables(graphica.HUE)==0||a.length==0){return this.default_hue}var b=this.firstVariable(graphica.HUE);var d=this.getSettings(b,graphica.HUE,"aggregation");return this.getColorByValue(a.getValue(c,b,d))};graphica.Properties.fn.getColorByValue=function(k,j){if(k===null||typeof k==="undefined"){return this.default_hue}j=j||false;if(typeof k==="undefined"){return this.default_hue}var d=this.firstVariable(graphica.HUE);if(d===null){return this.default_hue}if(Array.isArray(k)){k=k[d]}if(this._ds.isQuantitative(d)||this._ds.isDateType(d)){var n;var h;var l=false;if(this._ds.isDateType(d)){l=true;k=k.getTime();n=this._ds.min(d).getTime();h=this._ds.max(d).getTime()}else{var g=this.getSettings(d,graphica.HUE,"aggregation");if(this.color_scheme_diverging&&this.stepped_color){n=this.min_palette_value;h=this.max_palette_value}else{n=this._ds.min(d,g);h=this._ds.max(d,g)}}if(this.stepped_color){var m;var f;m=(h-n)/this.color_steps;f=Math.min(Math.floor((k-n)/m),this.color_steps-1);if(f==0){k=n}else{if(f==this.color_steps-1){k=h}else{if(this.color_scheme_diverging&&this.color_steps%2&&f==Math.min(Math.floor((this.middle_hue_value-n)/m),this.color_steps-1)){k=this.middle_hue_value}else{k=n+f*m+m*0.5}}}}if(this.color_scheme_diverging){if(k<this.middle_hue_value){return raceme._mapColors(k,n,this.middle_hue_value,this.min_hue,this.middle_hue)}else{return raceme._mapColors(k,this.middle_hue_value,h,this.middle_hue,this.max_hue)}}else{return raceme._mapColors(k,n,h,this.min_hue,this.max_hue)}}else{if(this.getSettings(d,graphica.HUE,"use_value_as_color")){if(raceme._getRGB(k)!==false){return k}return"#000000"}else{if(typeof this._variables_hues==="undefined"){this._variables_hues={};var a=this._ds.unique(d);var c=0;var b=this.default_palette||graphica.default_hues;for(var e=0;e<a.length;e++){if(raceme._getRGB(this.user_selected_colors[a[e]])){this._variables_hues[a[e]]=this.user_selected_colors[a[e]]}else{this._variables_hues[a[e]]=b[c]}c++;if(c>=b.length){c=0}}}}if(this.saturation!=0&&!j){return raceme._changeSaturation(raceme._getRGB(this._variables_hues[k]),this.saturation).getString()}return this._variables_hues[k]}};graphica.Properties.fn.is_a_interval_variable=function(a){if(this.default_form==graphica.BAR){if(this.countVariables(graphica.POS_X)&&this.lastVariable(graphica.POS_X)==a&&this._ds.header.names[a]!="graphica.com.frequency"){if(this.countVariables(graphica.POS_Y)&&this._ds.header.names[this.lastVariable(graphica.POS_Y)]=="graphica.com.frequency"){return true}}else{if(this.countVariables(graphica.POS_Y)&&this.lastVariable(graphica.POS_Y)==a&&this._ds.header.names[a]!="graphica.com.frequency"){if(this.countVariables(graphica.POS_X)&&this._ds.header.names[this.lastVariable(graphica.POS_X)]=="graphica.com.frequency"){return true}}}}return false};graphica.Properties.fn.calcFrameType=function(){var g=this;var d=this.countVariables(graphica.POS_X);var b=this.countVariables(graphica.POS_Y);var k;var j;var i;var e;if(d>0){k=this.firstVariable(graphica.POS_X);if(d>1){i=this.secondVariable(graphica.POS_X)}}if(b>0){j=this.firstVariable(graphica.POS_Y);if(b>1){e=this.secondVariable(graphica.POS_Y)}}let allxvariables=this.allVariables(graphica.POS_X);for(var h=0;h<d;h++){if(this._dataset.isQuantitative(allxvariables[h])){this.all_x_are_categorical=false}else{this.all_x_are_quantitative=false}}let allyvariables=this.allVariables(graphica.POS_Y);for(var h=0;h<b;h++){if(this._dataset.isQuantitative(allyvariables[h])){this.all_y_are_categorical=false}else{this.all_y_are_quantitative=false}}if(this.all_x_are_quantitative&&allxvariables.length){this.all_quantitative_axis_variables=allxvariables}else{if(this.all_y_are_quantitative&&allyvariables.length){this.all_quantitative_axis_variables=allyvariables}}var a="";if(this.countVariables(graphica.SMALL_MULTIPLES)==1){a="multiple"}if(d==0&&b==0&&this.countVariables(graphica.UNIT)==1&&(this._dataset.columnType(this.firstVariable(graphica.UNIT))=="geo.country"||this._dataset.columnType(this.firstVariable(graphica.UNIT))=="geo.state.province")&&(this._layout=="map"||this._layout=="map+avoid overlapping"||this.default_form==graphica.GEO_SHAPE)){this._frame_type="map"}else{if(d==0&&b==0){this._frame_type="0x0"}else{if(d==1&&b==1&&this._dataset.columnType(k)=="number"&&this._dataset.columnType(j)=="number"&&this._layout.startsWith("map")){this._frame_type="mapXY"}else{if(d==1&&b==0){this._frame_type="1x0";if(this._dataset.isCategorical(k)&&(typeof this.connectionVariable==="undefined"||this.connectionVariable!=k)&&(this.default_form!=graphica.BAR||typeof this._categorical_bar_variable==="undefined"||this._categorical_bar_variable!=k)){this._frame_type="1Cx0"}if(this._dataset.isDateType(k)&&(this.default_form==graphica.FILLED_RECTANGLE||this.default_form==graphica.CIRCLE)){this._frame_type="1Cx0"}}else{if(d==0&&b==1){this._frame_type="0x1";if(this._dataset.isCategorical(j)&&(typeof this.connectionVariable==="undefined"||this.connectionVariable!=j)&&(this.default_form!=graphica.BAR||typeof this._categorical_bar_variable==="undefined"||this._categorical_bar_variable!=j)){this._frame_type="0x1C"}if(this._dataset.isDateType(j)&&(this.default_form==graphica.FILLED_RECTANGLE||this.default_form==graphica.CIRCLE)){this._frame_type="0x1C"}}else{if((d==1&&b==1)){this._frame_type="1x1";var f=function(c){return(g._dataset.isCategorical(c)||(g._dataset.isDateType(c)&&(g.default_form==graphica.FILLED_RECTANGLE||g.default_form==graphica.CIRCLE)))};if(f(k)&&f(j)){this._frame_type="1Cx1C"}else{if(f(k)){this._frame_type="1Cx1"}else{if(f(j)){this._frame_type="1x1C"}}}}else{if((d==2&&b==2&&!this._dataset.isQuantitative(k)&&!this._dataset.isQuantitative(j))){if(this._dataset.columnType(i)=="number"&&this._dataset.columnType(e)=="number"&&this._layout.startsWith("map")){this._frame_type="1Cx1C"}else{this._frame_type="2x2"}}else{if(d==1&&b==2&&!this._dataset.isQuantitative(j)){if(this._dataset.columnType(k)=="number"&&this._dataset.columnType(e)=="number"&&this._layout.startsWith("map")){this._frame_type="0x1C"}else{this._frame_type="1x2"}}else{if(d==2&&b==1&&!this._dataset.isQuantitative(k)){if(this._dataset.columnType(i)=="number"&&this._dataset.columnType(j)=="number"&&this._layout.startsWith("map")){this._frame_type="1Cx0"}else{this._frame_type="2x1"}}else{if((b==1||b==2)&&this.all_y_are_categorical&&d>1&&this.all_x_are_quantitative){if(b==1&&this._dual_axis&&d==2){this._frame_type="2x1C"}else{if(b==2){this._frame_type="Nx2C"}else{this._frame_type="Nx1C"}}}else{if((d==1||d==2)&&this.all_x_are_categorical&&b>1&&this.all_y_are_quantitative){if(d==1&&this._dual_axis&&b==2){this._frame_type="1Cx2"}else{if(d==2){this._frame_type="2CxN"}else{this._frame_type="1CxN"}}}else{if(d==0&&b>1){this._frame_type="0xN"}else{if(b==0&&d>1){this._frame_type="Nx0"}}}}}}}}}}}}}if(this.default_form==graphica.BAR&&["0x0","1Cx0","0x1C","1Cx1C","map","mapXY"].includes(this._frame_type)){this.default_form=graphica.FILLED_BOX}if(a!=""){this._subframe_type=this._frame_type;this._frame_type=a}};graphica.Properties.fn.getDataset=function(b){var a=this.Mark(b);if(typeof this._ds_by_shape[a]!=="undefined"){return this._ds_by_shape[a]}return this._ds};graphica.Properties.fn.init=function(x){this.calcFrameType();this._ds=this._dataset;var ac;if(typeof x==="undefined"&&(this._frame_type=="2x1C"||this._frame_type=="Nx1C"||this._frame_type=="Nx2C"||this._frame_type=="1Cx2"||this._frame_type=="1CxN"||this._frame_type=="2CxN"||this._subframe_type=="2x1C"||this._subframe_type=="Nx1C"||this._subframe_type=="Nx2C"||this._subframe_type=="1Cx2"||this._subframe_type=="1CxN"||this._subframe_type=="2CxN")){for(var S=0;S<this.all_quantitative_axis_variables.length;S++){ac=this.Mark(this.all_quantitative_axis_variables[S]);if(typeof this._ds_by_shape[ac]=="undefined"){this._ds_by_shape[ac]=this.init(this.all_quantitative_axis_variables[S])}}return this._ds}ac=this.Mark(x);var g=this;var e=this.countVariables(graphica.POS_X);var W=this.countVariables(graphica.POS_Y);var aa=((e>1&&W==0)||(W>1&&e==0));var M=(e>0&&!this._dataset.isQuantitative(this.lastVariable(graphica.POS_X)))&&(W>0&&!this._dataset.isQuantitative(this.lastVariable(graphica.POS_Y)));var ae=new Array();var O=new Array();if(this.countVariables(graphica.FILTER)){var ai=[];var y=g.allVariables(graphica.FILTER);for(var U=0;U<y.length;U++){if(g._ds.isDateType(y[U])||g._ds.isCategorical(y[U])){ai.push(y[U])}}if(ai.length){this._ds=this._ds.where(function(aj){for(var i=0;i<ai.length;i++){if(g._ds.isDateType(ai[i])){if(aj[ai[i]]===null&&g.getSettings(ai[i],graphica.FILTER,"filter_nulls")===true){return false}var w=g.getSettings(ai[i],graphica.FILTER,"min");var c=g.getSettings(ai[i],graphica.FILTER,"max");if(w===null&&c===null){continue}if(g.getSettings(ai[i],graphica.FILTER,"filter_type")=="exclude"){if(w!==null){if(aj[ai[i]]>=graphica.Utils.dateFrom(w)&&(c===null||(aj[ai[i]]<=graphica.Utils.dateFrom(c)))){return false}}if(c!==null){if(aj[ai[i]]<=graphica.Utils.dateFrom(c)&&(w===null||(aj[ai[i]]>=graphica.Utils.dateFrom(w)))){return false}}}else{if(w!==null&&aj[ai[i]]<graphica.Utils.dateFrom(w)){return false}if(c!==null&&aj[ai[i]]>graphica.Utils.dateFrom(c)){return false}}}else{if(g.getSettings(ai[i],graphica.FILTER,"excluded_categories")!==null){if(g.getSettings(ai[i],graphica.FILTER,"filter_type")=="exclude"){if(typeof g.getSettings(ai[i],graphica.FILTER,"excluded_categories")[aj[ai[i]]]==="undefined"){return false}}else{if(typeof g.getSettings(ai[i],graphica.FILTER,"excluded_categories")[aj[ai[i]]]!=="undefined"){return false}}}}}return true});if(this._ds.length!=this._dataset.length){this._ds._has_been_filtered=true}}}if(this.countVariables(graphica.UNIT)==1||ac==graphica.CIRCLE||((ac==graphica.AREALINE||ac==graphica.BAR)&&!aa)||((ac==graphica.LINE)&&!aa&&(typeof this.connectionVariable=="undefined"||!this._dataset.isQuantitative(this.connectionVariable)))||(ac==graphica.NONE_SHAPE&&M)||ac==graphica.FILLED_RECTANGLE){var m=this._dataset.columnNames();for(var Z=0;Z<m.length;Z++){if(this.countVariables(graphica.UNIT)==1&&this.firstVariable(graphica.UNIT)!=Z&&this._dataset.columnType(Z)=="geo.country"&&this._dataset.columnType(this.firstVariable(graphica.UNIT))=="geo.state.province"&&this.country_specification=="variable"&&this.country_specification_variable==Z){ae.push(m[Z]);O.push(null)}else{if(m[Z]!="com.graphica.clusters"&&((typeof this.connectionVariable!="undefined"&&this.connectionVariable==Z)||this.countProperties(m[Z])>0)&&(!this._dataset.isQuantitative(m[Z]))){if(this.categorical_division.includes(Z)&&this.countProperties(m[Z])==1&&ac!=graphica.CIRCLE&&ac!=graphica.AREALINE&&ac!=graphica.BAR&&ac!=graphica.FILLED_RECTANGLE){continue}ae.push(m[Z]);O.push(this.getDateAggregation(Z))}else{if(this._dataset.isQuantitative(m[Z])&&ae.includes(m[Z])==false){if(this.countVariables(graphica.UNIT)>0&&this.firstVariable(graphica.UNIT)==Z){ae.push(m[Z]);O.push({binWidth:this.getSettings(Z,graphica.UNIT,"bin_width")||1,min:this._dataset.min(m[Z])})}else{if(this.lastVariable(graphica.POS_X)==Z&&this.is_a_interval_variable(Z)){ae.push(m[Z]);if(typeof this.getSettings(Z,graphica.POS_X,"bin_width")==="number"&&this.getSettings(Z,graphica.POS_X,"bin_width")>0){O.push({binWidth:this.getSettings(Z,graphica.POS_X,"bin_width"),min:this._dataset.min(m[Z])})}else{var V=this._dataset.getStats(m[Z],this.getSettings(m[Z],graphica.POS_X,"aggregation"));var t=graphica.Utils.getAutoBinWidth(V);O.push(t)}}else{if(this.lastVariable(graphica.POS_Y)==Z&&this.is_a_interval_variable(Z)){ae.push(m[Z]);if(typeof this.getSettings(Z,graphica.POS_Y,"bin_width")==="number"&&this.getSettings(Z,graphica.POS_Y,"bin_width")>0){O.push({binWidth:this.getSettings(Z,graphica.POS_Y,"bin_width"),min:this._dataset.min(m[Z])})}else{var V=this._dataset.getStats(m[Z],this.getSettings(m[Z],graphica.POS_Y,"aggregation"));var t=graphica.Utils.getAutoBinWidth(V);O.push(t)}}}}}}}}if(ac==graphica.CIRCLE&&(this.countVariables(graphica.SUBDIVISION)==1||this.countVariables(graphica.HUE)==1)){var H;if(this.countVariables(graphica.SUBDIVISION)==1){H=ae.indexOf(m[this.firstVariable(graphica.SUBDIVISION)])}else{H=ae.indexOf(m[this.firstVariable(graphica.HUE)])}if(H!=-1){var s=ae.concat();var Q=O.concat();s.splice(H,1);Q.splice(H,1);this._ds_without_subdivision=this._ds.groupBy(s,Q)}}this._ds=this._ds.groupBy(ae,O);this._ds._last_grouped_columns=ae.join(";")}if(this.countVariables(graphica.FILTER)){var ah=[];var y=g.allVariables(graphica.FILTER);for(var U=0;U<y.length;U++){if(g._ds.isQuantitative(y[U])){ah.push(y[U])}}if(ah.length){this._ds=this._ds.where(function(aj){for(var i=0;i<ah.length;i++){if(aj[ah[i]]===null&&g.getSettings(ah[i],graphica.FILTER,"filter_nulls")===true){return false}var w=g.getSettings(ah[i],graphica.FILTER,"min");var c=g.getSettings(ah[i],graphica.FILTER,"max");if(g.getSettings(ah[i],graphica.FILTER,"filter_type")=="exclude"){if(w!==null){if(aj[ah[i]]>=w&&(c===null||aj[ah[i]]<=c)){return false}}if(c!==null){if(aj[ah[i]]<=c&&(w===null||aj[ah[i]]>=w)){return false}}}else{if(w!==null&&aj[ah[i]]<w){return false}if(c!==null&&aj[ah[i]]>c){return false}}}return true});if(typeof this._ds_without_subdivision!=="undefined"){this._ds_without_subdivision=this._ds_without_subdivision.where(function(aj){for(var i=0;i<ah.length;i++){if(aj[ah[i]]===null&&g.getSettings(ah[i],graphica.FILTER,"filter_nulls")===true){return false}var w=g.getSettings(ah[i],graphica.FILTER,"min");var c=g.getSettings(ah[i],graphica.FILTER,"max");if(w!==null&&aj[ah[i]]<w){return false}if(c!==null&&aj[ah[i]]>c){return false}}return true})}if(!this._ds._has_been_filtered&&this._ds.length!=this._dataset.length){this._ds._has_been_filtered=true}}}if(this.oneLine_oneLabel&&((ac==graphica.LINE&&(this.label_placement=="automatic"||this.label_placement=="out"||!this.label_placement))||(ac==graphica.AREALINE&&this.label_placement=="out"))){for(var af=0;af<this.label_variables.length;af++){var a=this._ds.unique(this.label_variables[af]);for(var Z=0;Z<a.length;Z++){var z=this._ds.indexOf(a[Z],this.label_variables[af]);lb=this.getLabel(z,"left","middle",[]);this.label_space_width=Math.max(this.label_space_width,lb.getBBox().width)}}}if(this.doClustering){var C=new graphica.GraphModel();if(this._ds.edges&&(typeof this.calc_clustering=="undefined"||this.calc_clustering=="edges")){if(this._ds.length==this._dataset.length){this._ds=this._dataset.clone();this._ds.edges=this._dataset.edges.clone()}C.init(this._ds,this._ds.edges);C.newmanClustering(this.desiredClusters);var h={};var N=1;for(var Z=0;Z<C.node_array.length;Z++){var d=C.node_array[Z]._cluster+"";if(typeof h[d]==="undefined"){h[d]="cluster "+N;N++}this._ds.setValue(Z,"graphica.com.clusters",h[d])}}else{if(!this._ds.edges||(typeof this.calc_clustering!="undefined"&&this.calc_clustering=="variables")){if(typeof this.clustering_variables!="undefined"){if(ae.length==0){this._ds=this._dataset.clone();if(this._dataset.edges){this._ds.edges=this._dataset.edges.clone()}}var b=Object.keys(this.clustering_variables);var E=[];var ag=[];var f=[];for(var S=0;S<b.length;S++){var A=b[S];if(E.indexOf(A)==-1&&this._ds.hasColumn(A)&&this._ds.isQuantitative(A)){var r=this.clustering_variables[A];E.push(A);ag.push(r);f.push(this._ds.getStats(A,r))}}if(E.length>0){for(var q=0;q<this._ds.length;q++){C.addNode(q+"")}var G=[];var K=[];for(var q=0;q<this._ds.length;q++){K[q]=q;for(var o=q+1;o<this._ds.length;o++){var T=0;for(var F=0;F<E.length;F++){var D=E[F];var J=ag[F];var l=(this._ds.getValue(q,D,J)-f[F].average)/f[F].sd;var k=(this._ds.getValue(o,D,J)-f[F].average)/f[F].sd;T+=Math.pow((l-k),2)}var j=Math.sqrt(T);G.push({source:q,target:o,dist:j})}}G.sort(function(i,c){return i.dist-c.dist});for(var v=0;v<G.length;v++){var P=K[G[v].source];var Y=K[G[v].target];if(P!=Y){var p;if(G[v].dist==0){p=1}else{p=1/(G[v].dist+1)}C.addEdge(G[v].source+"",G[v].target+"",p);var n=0;for(var L=0;L<this._ds.length;L++){if(K[L]==P){n++}else{if(K[L]==Y){K[L]=P;n++}}}}if(n==this._ds.length){break}}C.newmanClustering(this.desiredClusters);var h={};var N=1;for(var Z=0;Z<C.node_array.length;Z++){var d=C.node_array[Z]._cluster+"";if(typeof h[d]==="undefined"){h[d]="cluster "+N;N++}this._ds.setValue(Z,"graphica.com.clusters",h[d])}}}}}}if(this.color_scheme_diverging&&this.countVariables(graphica.HUE)){var R=this.firstVariable(graphica.HUE);var ab=this.getSettings(R,graphica.HUE,"aggregation");var X=this._ds.getStats(R,ab);if(this.middle_hue_type_of_value=="zero"){this.middle_hue_value=0}else{if(this.middle_hue_type_of_value=="average"){this.middle_hue_value=X.average}else{if(this.middle_hue_type_of_value=="median"){this.middle_hue_value=X.median}else{if(this.middle_hue_type_of_value=="constant"){if(this.middle_hue_constant!==null){this.middle_hue_value=this.middle_hue_constant}else{this.middle_hue_value=0}}else{if(X.min<0&&X.max>0){this.middle_hue_value=0}else{this.middle_hue_value=X.average}}}}}if(this.stepped_color){this.min_palette_value=X.min;this.max_palette_value=X.max;if(this.middle_hue_value>X.min&&this.middle_hue_value<X.max){var r=(X.max-X.min)/this.color_steps;var B;if(this.color_steps%2>0){B=Math.min(Math.floor((this.middle_hue_value-X.min)/r),this.color_steps-1);B+=0.5}else{B=Math.min(Math.round((this.middle_hue_value-X.min)/r),this.color_steps-1);B=Math.max(1,B)}var I=X.min+(B)*r;if(I<this.middle_hue_value){var ad=((this.middle_hue_value-X.min)/B)*this.color_steps;this.max_palette_value=this.min_palette_value+ad}else{if(I>this.middle_hue_value){var ad=((X.max-this.middle_hue_value)/(this.color_steps-B))*this.color_steps;this.min_palette_value=this.max_palette_value-ad}}}}}return this._ds};graphica.Properties.fn.applyGrammar=function(o){if(typeof o=="undefined"){o=false}var l=this.view._settings.general;if(typeof l.label_config==="string"){this.setLabelConfig(l.label_config)}if(typeof l.label_placement==="string"){this.label_placement=l.label_placement}if(typeof l.label_align==="string"){this.label_align=l.label_align}if(typeof l.label_vertical_align==="string"){this.label_vertical_align=l.label_vertical_align}if(typeof l.tooltip_config==="string"){this.setTooltipConfig(l.tooltip_config)}if(typeof l.marks_included==="string"){this.marks_included=l.marks_included}if(typeof l.marks_to_label==="string"){this.marks_to_label=l.marks_to_label}if(typeof l.connection_variable=="string"&&l.connection_variable!=""&&this._ds.hasColumn(l.connection_variable)){this.connection_variable=l.connection_variable}if(typeof l.default_shape=="string"&&typeof graphica.SHAPE_NAMES[l.default_shape]==="number"){this.default_form=graphica.SHAPE_NAMES[l.default_shape]}if(typeof l.default_palette=="string"){this.default_palette=l.default_palette.split(";")}if(typeof l.circle_chart_type=="string"&&(l.circle_chart_type=="rose"||l.circle_chart_type=="radar")){this.circle_chart_type=l.circle_chart_type}if(typeof l.interpolate_missing_values=="boolean"){this.interpolate_missing_values=l.interpolate_missing_values}if(typeof l.saturation=="number"){this.saturation=l.saturation}if(typeof l.stroke_on_labels=="boolean"){this.stroke_on_labels=l.stroke_on_labels}if(typeof l.stroke_color_on_labels=="string"&&raceme._getRGB(l.stroke_color_on_labels)!==false){this.stroke_color_on_labels=l.stroke_color_on_labels}if(typeof l.dual_axis=="boolean"){this._dual_axis=l.dual_axis}if(typeof l.synchronize_axis=="boolean"){this._synchronize_axis=l.synchronize_axis}if(typeof l.line_marks=="string"){var a=l.line_marks;if(a="none"){this.start_marks="none";this.end_marks="none"}else{if(a=="filled disk"){this.start_marks="filled disk";this.end_marks="filled disk"}else{if(a=="disk"){this.start_marks="disk";this.end_marks="disk"}}}}if(typeof l.layout==="string"&&["default","avoid overlapping","map+avoid overlapping","map","force_directed","force_distance_directed","kamada_kawai","lin_log","dagre","dagreLR","circular"].includes(l.layout)){this._layout=l.layout;if(this._ds.edges&&["force_directed","force_distance_directed","kamada_kawai","lin_log","dagre","dagreLR"].includes(this._layout)){this._is_graph_layout=true}if(this._layout=="circular"){this.circular_layout=true}}if(typeof l.layout_distance=="number"){this._layout_distance=l.layout_distance/2}if(typeof l.layout_spatial_boundaries=="boolean"){this._layout_spatial_boundaries=l.layout_spatial_boundaries}if(typeof l.start_marks=="string"&&["none","filled disk","disk","arrow","arrow filled disk","arrow disk"].includes(l.start_marks)){this.start_marks=l.start_marks}if(typeof l.end_marks=="string"&&["none","filled disk","disk","arrow","arrow filled disk","arrow disk"].includes(l.end_marks)){this.end_marks=l.end_marks}if(typeof l.min_number_clusters=="number"){this.desiredClusters=Math.max(1,l.min_number_clusters)}if(typeof l.calc_clustering=="string"){this.calc_clustering=l.calc_clustering}if(typeof l.clustering_variables!=="undefined"){this.clustering_variables=l.clustering_variables}if(typeof l.line_type=="string"&&(l.line_type=="orthogonal"||l.line_type=="curve")){this.line_type=l.line_type}if(typeof l.default_label_size=="number"){this.default_label_size=l.default_label_size;if(this.view.vpedges){this.view.vpedges.default_label_size=this.default_label_size}}if(typeof l.legend_font=="string"){this.legend_font=l.legend_font}if(typeof l.legend_font_color=="string"){this.legend_font_color=l.legend_font_color}if(typeof l.legend_font_size=="number"){this.legend_font_size=l.legend_font_size}var b=this.view._settings.grammar;for(var m=0;m<b.length;m++){var u=b[m];if(typeof u.variable==="string"&&typeof u.property==="string"){var c=u.property.toUpperCase();if(typeof graphica.PropertyNames[c]!=="undefined"&&(!o||o.isSet(u.variable,graphica.PropertyNames[c]))){if(this._ds.columnName(u.variable)=="graphica.com.clusters"){this.doClustering=true}this.link(u.variable,graphica.PropertyNames[c]);for(var e in u){if(u.hasOwnProperty(e)){if(e!="variable"&&e!="property"){this.setSettings(u.variable,graphica.PropertyNames[c],e,u[e])}}}}}}if(this.categorical_division.length>0&&this.countVariables(graphica.HUE)&&this._dataset.isCategorical(this.firstVariable(graphica.HUE))&&this.categorical_division.indexOf(this.firstVariable(graphica.HUE))==-1){if(this.isSet(this.firstVariable(graphica.HUE),graphica.UNIT)==false&&this.isSet(this.firstVariable(graphica.HUE),graphica.POS_X)==false&&this.isSet(this.firstVariable(graphica.HUE),graphica.POS_Y)==false&&this.isSet(this.firstVariable(graphica.HUE),graphica.SMALL_MULTIPLES)==false){this.categorical_division.push(this.firstVariable(graphica.HUE))}}for(var r=0;r<this.label_variables.length;r++){var j=this.label_variables[r];for(var h=0;h<this.legends_to_include;h++){var f=this.legends_to_include[h];if(this.legends_user_want_to_include.indexOf(f)==-1){if(this.isSet(j,f)){this.legends_to_include.splice(h,1);h--}}}}if(this.default_form==graphica.LINE||this.default_form==graphica.AREALINE||this.custom_forms.includes("line")||this.custom_forms.includes("area")){if(this.countVariables(graphica.UNIT)==1){this.unitconnectionVariable=this.firstVariable(graphica.UNIT);this.unitconnectionVariableProperty=graphica.UNIT}else{if(this.countVariables(graphica.HUE)>0&&this._dataset.isCategorical(this.firstVariable(graphica.HUE))){this.unitconnectionVariable=this.firstVariable(graphica.HUE);this.unitconnectionVariableProperty=graphica.HUE}else{if(this.getLabelCategoricalVariables().length){this.unitconnectionVariable=this.getLabelCategoricalVariables()[0];this.unitconnectionVariableProperty=graphica.LABEL}else{if(this.countVariables(graphica.SMALL_MULTIPLES)>0){this.unitconnectionVariable=this.firstVariable(graphica.SMALL_MULTIPLES);this.unitconnectionVariableProperty=graphica.SMALL_MULTIPLES}else{if(this.countVariables(graphica.POS_Y)==2&&!this._dataset.isQuantitative(this.firstVariable(graphica.POS_Y))){this.unitconnectionVariable=this.firstVariable(graphica.POS_Y);this.unitconnectionVariableProperty=graphica.POS_Y}else{if(this.countVariables(graphica.POS_X)==2&&!this._dataset.isQuantitative(this.firstVariable(graphica.POS_X))){this.unitconnectionVariable=this.firstVariable(graphica.POS_X);this.unitconnectionVariableProperty=graphica.POS_X}else{if(this.countVariables(graphica.SHAPE)==1){this.unitconnectionVariable=this.firstVariable(graphica.SHAPE);this.unitconnectionVariableProperty=graphica.SHAPE}else{var t=this._ds.columnNames();for(var s=0;s<t.length;s++){if(this._ds.isQuantitative(s)==false&&this.countProperties(t[s])&&!this.isSet(s,graphica.POS_X)&&!this.isSet(s,graphica.POS_Y)){this.unitconnectionVariable=s;break}}if(typeof this.unitconnectionVariable==="undefined"){for(var s=0;s<t.length;s++){if(this._ds.isQuantitative(s)==false&&this.countProperties(t[s])&&(this.isSet(s,graphica.POS_X)||this.isSet(s,graphica.POS_Y))){this.unitconnectionVariable=s;this.unitconnectionVariableProperty=(this.isSet(s,graphica.POS_X))?graphica.POS_X:graphica.POS_Y;break}}}}}}}}}}var n=null;var g=null;var q=null;if(this.connection_variable!=""){n=this._ds.header.getId(this.connection_variable);if(this.isSet(n,graphica.POS_X)){q=graphica.POS_X}else{if(this.isSet(n,graphica.POS_Y)){q=graphica.POS_Y}else{if(this.isSet(n,graphica.HUE)){q=graphica.HUE}else{if(this.isSet(n,graphica.SHAPE)){q=graphica.SHAPE}else{if(this.isSet(n,graphica.UNIT)){q=graphica.UNIT}}}}}}else{if(this.countVariables(graphica.POS_X)>0||this.countVariables(graphica.POS_Y)>0){if(this.countVariables(graphica.POS_X)&&this._dataset.isDateType(this.lastVariable(graphica.POS_X))){n=this.lastVariable(graphica.POS_X);g=this.getSettings(n,graphica.POS_X,"aggregation");if(this.countVariables(graphica.POS_Y)){this.valueconnectionVariable=this.lastVariable(graphica.POS_Y);this.valueconnectionVariableAggregation=this.getSettings(this.valueconnectionVariable,graphica.POS_Y,"aggregation")}else{if(this.countVariables(graphica.AREA)){this.valueconnectionVariable=this.lastVariable(graphica.AREA);this.valueconnectionVariableAggregation=this.getSettings(this.valueconnectionVariable,graphica.AREA,"aggregation")}}}else{if(this.countVariables(graphica.POS_Y)&&this._dataset.isDateType(this.lastVariable(graphica.POS_Y))){n=this.lastVariable(graphica.POS_Y);g=this.getSettings(n,graphica.POS_Y,"aggregation");if(this.countVariables(graphica.POS_X)){this.valueconnectionVariable=this.lastVariable(graphica.POS_X);this.valueconnectionVariableAggregation=this.getSettings(this.valueconnectionVariable,graphica.POS_X,"aggregation")}else{if(this.countVariables(graphica.AREA)){this.valueconnectionVariable=this.lastVariable(graphica.AREA);this.valueconnectionVariableAggregation=this.getSettings(this.valueconnectionVariable,graphica.AREA,"aggregation")}}}else{if(this.countVariables(graphica.POS_X)&&!this._dataset.isQuantitative(this.lastVariable(graphica.POS_X))){n=this.lastVariable(graphica.POS_X);q=graphica.POS_X;if(this.countVariables(graphica.POS_Y)){this.valueconnectionVariable=this.lastVariable(graphica.POS_Y);this.valueconnectionVariableAggregation=this.getSettings(this.valueconnectionVariable,graphica.POS_Y,"aggregation")}else{if(this.countVariables(graphica.AREA)){this.valueconnectionVariable=this.lastVariable(graphica.AREA);this.valueconnectionVariableAggregation=this.getSettings(this.valueconnectionVariable,graphica.AREA,"aggregation")}}}else{if(this.countVariables(graphica.POS_Y)&&!this._dataset.isQuantitative(this.lastVariable(graphica.POS_Y))){n=this.lastVariable(graphica.POS_Y);this.valueconnectionVariable=this.lastVariable(graphica.POS_X);this.valueconnectionVariableAggregation=this.getSettings(this.valueconnectionVariable,graphica.POS_X,"aggregation");q=graphica.POS_Y;if(this.countVariables(graphica.POS_X)){this.valueconnectionVariable=this.lastVariable(graphica.POS_X);this.valueconnectionVariableAggregation=this.getSettings(this.valueconnectionVariable,graphica.POS_X,"aggregation")}else{if(this.countVariables(graphica.AREA)){this.valueconnectionVariable=this.lastVariable(graphica.AREA);this.valueconnectionVariableAggregation=this.getSettings(this.valueconnectionVariable,graphica.AREA,"aggregation")}}}else{if(this.countVariables(graphica.POS_X)&&this.countVariables(graphica.POS_Y)&&this._dataset.isQuantitative(this.lastVariable(graphica.POS_X))&&this._dataset.isQuantitative(this.lastVariable(graphica.POS_Y))){n=this.lastVariable(graphica.POS_X);q=graphica.POS_X}}}}}}}if(this.valueconnectionVariable==this.lastVariable(graphica.POS_X)){this.oneLine_oneLabel_orientation_layout="horizontal"}if(n!==null){this.connectionVariable=n;if(this.connectionVariable===this.unitconnectionVariable){delete this.unitconnectionVariable}this.connectionVariableLinkProperty=q;this.connectionVariableAggregation=g;if(this._dataset.isDateType(this.connectionVariable)){if(graphica.Utils.isDateTickSmallerThan(this.connectionVariableAggregation,this._dataset.tickUnit(this.connectionVariable))){this.connectionVariableAggregation=this._dataset.tickUnit(this.connectionVariable)}}if(this.marks_to_label=="first"||this.marks_to_label=="last"||this.marks_to_label=="first and last"){this.oneLine_oneLabel=true}else{if(this.marks_to_label=="auto"&&this.getLabelCategoricalVariables().length&&this.unitconnectionVariable==this.label_variables[0]){this.oneLine_oneLabel=true}}if(this._dataset.isQuantitative(this.connectionVariable)){this.interpolate_missing_values=true}}}};graphica.Properties.fn.setLabelConfig=function(d){if(typeof d!=="string"||d.trim()==""){return}this.label_config=d;var c=[];var b=/\[(.*?)\]/g;var a;while((a=b.exec(this.label_config))!=null){if(typeof this._dataset.header.ids[a[1]]!=="undefined"&&c.indexOf(a[1])==-1){c.push(this._dataset.header.getId(a[1]))}}this.label_variables=c};graphica.Properties.fn.setTooltipConfig=function(d){if(typeof d!=="string"||d.trim()==""){return}this.tooltip_config=d;var c=[];var b=/\[(.*?)\]/g;var a;while((a=b.exec(this.tooltip_config))!=null){if(typeof this._dataset.header.ids[a[1]]!=="undefined"&&c.indexOf(a[1])==-1){c.push(this._dataset.header.getId(a[1]))}}this.tooltip_variables=c};graphica.Properties.fn.replaceVariablesWithValues=function(f,b,p,c,a,o){a=a||this._ds;if(typeof p=="undefined"||!p){p=[];var n=/\[(.*?)\]/g;var h;while((h=n.exec(f))!==null){if(p.includes(h[1])==false){p.push(h[1])}}}if(p.length==0){return f}for(var e=0;e<p.length;e++){var k=a.header.getId(p[e]);if(c&&c.indexOf(k)!=-1){f=f.split("["+this._dataset.header.names[k]+"]").join("")}else{var d=this.getSettings(k,o,"aggregation");if(this._dataset.isDateType(k)){var j=this.getSettings(k,o,"label_date_format");if(j===null&&this._dataset.includesTime(k)&&this._dataset.includesDate(k)==false){j="time"}if(graphica.Utils.isDateTickSmallerThan(d,this._dataset.tickUnit(k))){d=this._dataset.tickUnit(k)}var m;if(typeof b.length!=="undefined"){m=b[k]}else{m=a.getValue(b,k)}if(m!==null){f=f.split("["+this._dataset.header.names[k]+"]").join(m.strformat(d,j))}else{f=f.split("["+this._dataset.header.names[k]+"]").join("")}}else{if(a.isQuantitative(k)){if(a.binWidth(k)){var g;if(typeof b.length!=="undefined"){g=b[k]}else{g=a.getValue(b,k)}if(a.binWidth(k)==1&&a.isInteger(k)){f=f.split("["+a.header.names[k]+"]").join(this.getFormattedNumber(g,k,o))}else{var l=g+a.binWidth(k);f=f.split("["+a.header.names[k]+"]").join(this.getFormattedNumber(g,k,o)+" - "+this.getFormattedNumber(l,k,o))}}else{var m;if(typeof b.length!=="undefined"){m=b[k]}else{m=a.getValue(b,k,d)}f=f.split("["+a.header.names[k]+"]").join(this.getFormattedNumber(m,k,o))}}else{var m;if(typeof b.length!=="undefined"){m=b[k]}else{m=a.getValue(b,k,d)}f=f.split("["+this._dataset.header.names[k]+"]").join(this.getAlias(k,o,m)||m)}}}}return f.trim()};graphica.Properties.fn.getLabelText=function(c,b,a){if(this.label_variables.length==0){return""}return this.replaceVariablesWithValues(this.label_config,c,this.label_variables,b,a,graphica.LABEL)};graphica.Properties.fn.getFormattedNumber=function(d,a,g,c){if(typeof c!=="boolean"){c=false}var b;var e;e=this.getSettings(a,g,"maximum_fraction_digits");if(e===null){e=this.default_max_num_decimals}b=this.getSettings(a,g,"minimum_fraction_digits");var f={useGrouping:false};if(b){b=Math.max(b,0);b=Math.min(b,20);f.minimumFractionDigits=b}if(b&&e){e=Math.max(b,e)}if(e){e=Math.max(e,0);e=Math.min(e,20);f.maximumFractionDigits=e}else{if(b){e=b}}if(c==false){d=graphica.Utils.round(d,e);d=d.toLocaleString("en-US",f)}else{d=d.toLocaleString("en-US",f)}if(this.getSettings(a,g,"number_prefix")){d=this.getSettings(a,g,"number_prefix")+d}if(this.getSettings(a,g,"number_suffix")){d+=this.getSettings(a,g,"number_suffix")}return d};graphica.Properties.fn.getLabelCategoricalVariables=function(){var b=[];for(var a=0;a<this.label_variables.length;a++){if(this._dataset.isCategorical(this.label_variables[a])||this._dataset.isDateType(this.label_variables[a])){b.push(this.label_variables[a])}}return b};graphica.Properties.fn.getTooltipCategoricalVariables=function(){var b=[];for(var a=0;a<this.tooltip_variables.length;a++){if(this._dataset.isCategorical(this.tooltip_variables[a])||this._dataset.isDateType(this.tooltip_variables[a])){b.push(this.tooltip_variables[a])}}return b};graphica.PData=function(){this._keys=[];this._values=[];this._settings=[];this._length=0};graphica.PData.prototype.add=function(a,b){if(this.isSet(a,b)){return this}if(typeof this._keys[a]==="undefined"){this._keys[a]=[];this._settings[a]=[]}if(typeof this._values[b]==="undefined"){this._values[b]=[]}this._keys[a].push(b);this._settings[a].push({});this._values[b].push(a);return this};graphica.PData.prototype.remove=function(b,d){if(!this.isSet(b,d)){return this}var c=this._keys[b].indexOf(d);if(c!=-1){this._keys[b].splice(c,1)}var a=this._values[d].indexOf(b);if(a!=-1){this._values[d].splice(a,1)}};graphica.PData.prototype.isSet=function(a,b){if(typeof this._keys[a]!=="undefined"&&typeof this._values[b]!=="undefined"&&this._keys[a].indexOf(b)!=-1){return true}return false};graphica.PData.prototype.values=function(b){var a=[];if(typeof this._keys[b]!=="undefined"){a=this._keys[b]}return a};graphica.PData.prototype.keys=function(b){var a=[];if(typeof this._values[b]!=="undefined"){a=this._values[b]}return a};graphica.PData.prototype.settings=function(a,d,b,e){var c=this.values(a).indexOf(d);if(typeof b==="undefined"){return this._settings[a][c]}else{if(typeof e==="undefined"){if(typeof this._settings[a][c]!=="undefined"&&typeof this._settings[a][c][b]!=="undefined"){return this._settings[a][c][b]}return null}else{if(c!=-1){this._settings[a][c][b]=e}}}return this};graphica.PData.prototype.firstValue=function(a){if(typeof this._keys[a]!=="undefined"){return this._keys[a][0]}return null};graphica.PData.prototype.firstKey=function(a){if(typeof this._values[a]!=="undefined"){return this._values[a][0]}return null};graphica.PData.prototype.secondKey=function(a){if(typeof this._values[a]!=="undefined"){return this._values[a][1]}return null};if(typeof SVGElement!=="undefined"){SVGElement.prototype.getTransformToElement=SVGElement.prototype.getTransformToElement||function(a){return a.getScreenCTM().inverse().multiply(this.getScreenCTM())}}if(typeof window==="undefined"){if(typeof global!=="undefined"){window=global}else{if(typeof WorkerGlobalScope!=="undefined"){window=WorkerGlobalScope}}}raceme=window.raceme={_idgen:0};window.isPIXI=function(){return((typeof BLOCK_PIXI=="undefined"||!BLOCK_PIXI)&&typeof PIXI!=="undefined")};window.main=function(a){if(typeof _main_scripts==="undefined"){_main_scripts=[a]}else{_main_scripts.push(a)}};window.by=raceme.by=function(f){if(typeof f!=="string"){return new GrapeGroup()}var e=f.split(":");var c=e[0];if(e.length==2&&raceme._clearString(c)=="id"){var d=e[1];var a=document.getElementById(d);if(a!==null){return new Grape(a)}return null}return new Grape(document.documentElement).by(f)};raceme.addChild=function(a){return new Grape(document.documentElement).addChild(a)};raceme.ajax=function(c){if(typeof c==="object"){c.url=raceme.dV(c.url,"http://localhost/");if(c.method!="POST"&&c.method!="HEAD"){c.method="GET"}c.data=raceme.dV(c.data,"");if(c.format!="XML"&&c.format!="blob"){c.format="text"}var a;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{a=new ActiveXObject("Microsoft.XMLHTTP")}if(typeof c.data!=="string"){c.data=c.data.toString()}if(c.method=="GET"&&c.data!=""){c.url+="?"+c.data}if(c.format=="XML"&&a.overrideMimeType){a.overrideMimeType("text/xml")}else{if(c.format=="XML"){c.format="text"}else{if(c.format=="blob"){a.responseType="blob"}}}a.open(c.method,c.url,true);var d=c;a.onreadystatechange=function(){if(a.readyState==4){if(typeof c.always!=="undefined"){c.always.call(d)}if(a.status==200||a.status==304){if(typeof c.done!=="undefined"){if(c.format=="XML"&&a.responseXML!=null){if(a.responseXML.xml){c.done.call(d,a.responseXML.xml,"XML")}c.done.call(d,a.responseXML,"XML")}else{if(c.format=="blob"){c.done.call(d,a.response)}else{c.done.call(d,a.responseText,"text")}}}}else{if(typeof c.fail!=="undefined"){c.fail.call(d,a.status)}}}};if((c.method=="POST"||c.method=="HEAD")&&c.data!=""){a.send(c.data)}else{a.send()}return a}return null};raceme.getTagSplit=function(e){var c=[];e=e.split("\n").join("<br/>");const d=function(g){if(g.nodeType==3){c.push({type:"text",content:g.nodeValue})}else{if(g.nodeType==1){c.push({type:"tag",content:"<"+g.tagName.toLowerCase()+">"})}if(g.childNodes){for(var f=0;f<g.childNodes.length;f++){d(g.childNodes[f])}}if(g.nodeType==1&&g.tagName!="BR"){c.push({type:"tag",content:"</"+g.tagName.toLowerCase()+">"})}}};var a=document.createElement("template");a.innerHTML=e;d(a.content);return c};raceme.label=function(u,q,p,B,v,D,G,d,L,M){u=raceme.dV(u,"");if(typeof u!=="string"&&u.toString){u=u.toString()}M=M||false;q=raceme.dV(q,0);p=raceme.dV(p,0);B=raceme.dV(B,"black");v=raceme.dV(v,14);D=raceme.dV(D,"left");D=raceme._clearString(D);G=raceme.dV(G,"top");if(G===null){G="top"}G=raceme._clearString(G);d=raceme.dV(d,1);L=raceme.dV(L,"");var K;var F,E;if(M||u.indexOf("|")==-1){var m=new Grape("text");m.style("white-space","pre");if(isPIXI()){B=raceme._rgb2hex(B);if(!L&&typeof window.GlobalFontFamily!=="undefined"){L=GlobalFontFamily}u=u.split(/<br ?\/?>/).join("\n");var e=document.createElement("template");e.innerHTML=u;u=e.innerHTML;u=raceme._decodeHTMLEntities(u);m.pixi=new TaggedText(u,{"default":{fill:B,fontSize:v,fontFamily:L||"Inter",lineSpacing:1.25},strong:{fontWeight:"bold"},b:{fontWeight:"bold"},em:{fontStyle:"italic"},i:{fontStyle:"italic"},u:{textDecoration:"underline"},strike:{textDecoration:"line-through",fill:B},sup:{fontScaleWidth:0.7,fontScaleHeight:0.7,valign:"top"},sub:{fontScaleWidth:0.7,fontScaleHeight:0.7,valign:"bottom"}},{drawWhitespace:true});m.pixi._grape=m}m._font_size=v;m.attr("x",q).attr("y",p).attr("font-size",v);if(B!="black"){m.attr("fill",B)}if(d!=1){m.opacity(d);m._original_opacity=d}if(L){m.style("font-family",L)}var w=0;var h=false;var g=false;var o=false;var I=false;var l=false;var f=false;var r=1.25;var t=new Grape("tspan").addTo(m);t.attr("x",q);var A=raceme.getTagSplit(u);var a=0;for(var F=0;F<A.length;F++){var k=A[F];if(k.type=="tag"){if(k.content=="<b>"||k.content=="<strong>"){h=true}else{if(k.content=="</b>"||k.content=="</strong>"){h=false}else{if(k.content=="<i>"||k.content=="<em>"){g=true}else{if(k.content=="</i>"||k.content=="</em>"){g=false}else{if(k.content=="<u>"){o=true}else{if(k.content=="</u>"){o=false}else{if(k.content=="<strike>"){I=true}else{if(k.content=="</strike>"){I=false}else{if(k.content=="<sub>"){f=true}else{if(k.content=="</sub>"){f=false}else{if(k.content=="<sup>"){l=true}else{if(k.content=="</sup>"){l=false}else{if(k.content=="<br>"){w++;if(t&&t.getChildren().length==0){t.text(" ")}t=new Grape("tspan").attr("x",q).addTo(m);if(a!=0){t.attr("dy",-a+v*1.25);a=0}else{t.attr("dy",v*1.25)}}}}}}}}}}}}}}}else{var C=new Grape("tspan").addTo(t);if(h){C.attr("font-weight","bold")}if(g){C.attr("font-style","italic")}if(o){C.attr("text-decoration","underline")}else{if(I){C.attr("text-decoration","line-through")}}if(f){if(a==0){a=v*0.25}else{if(a==-v*0.25){a=v*0.5}}C.attr("dy",a);C.attr("font-size","0.7em");a=v*0.25}else{if(l){if(a==0){a=-v*0.25}else{if(a==v*0.25){a=-v*0.5}}C.attr("dy",a);C.attr("font-size","0.7em");a=-v*0.25}else{if(a!=0){C.attr("dy",-a);a=0}}}C.text(k.content)}}if(t&&t.getChildren().length==0){t.text(" ")}m.align(D);m.verticalAlign(G);return m}else{K=u.trim().split("\n");var J=[];var n=1;var c=new Grape().x(q).y(p);c._font_size=v;for(F=0;F<K.length;F++){J[F]=K[F].split("|");n=Math.max(n,J[F].length)}var z=0;for(E=0;E<n;E++){var s="";for(var F=0;F<K.length;F++){if(typeof J[F][E]!=="undefined"){s+=J[F][E]}if(F<K.length-1){s+="\n"}}var H=raceme.label(s,0,0,B,v,D,G,d,L);if(D=="center"){H.x(H.x()+H.getBBox().width/2)}else{if(D=="right"){H.x(H.x()+H.getBBox().width)}}H.x(H.x()+z);c.addChild(H);z=c.getBBox().width+12}return c}};raceme.paragraph=function(p,o,n,i,q,m,e,h,l,d){var c=p.split(" ");var a=c[0];for(var k=1;k<c.length;k++){var f=a+" "+c[k];var g=raceme.label(f,o,n,i,q,m,e,h,l);if(g.getBBox().width<d){a=f}else{a=a+"\n"+c[k]}}return raceme.label(a,o,n,i,q,m,e,h,l)};raceme.image=function(e,c,g,f,a){e=raceme.dV(e,"");c=raceme.dV(c,0);g=raceme.dV(g,0);f=raceme.dV(f,"");a=raceme.dV(a,"");var d=new Grape("image").attr("href",e).attr("x",c).attr("y",g).attr("width",f).attr("height",a);if(f===""){d.load(function(h){this.width(h.target.width)})}if(a===""){d.load(function(h){this.height(h.target.height)})}return d};raceme.wheelValue=function(a){if(a.wheelDelta){return a.wheelDelta/120}else{if(a.detail){return -a.detail}else{return 0}}};raceme.cursorPoint=function(d){var a=d.currentTarget||d.target;if(a.nodeType!=1){a=d.target}if(!a.ownerSVGElement){return{x:d.offsetX,y:d.offsetY}}var c=a.ownerSVGElement.createSVGPoint();c.x=d.clientX;c.y=d.clientY;return c.matrixTransform(a.ownerSVGElement.getScreenCTM().inverse())};raceme.window={};raceme.window.width=function(){return document.documentElement.clientWidth};raceme.window.height=function(){return document.documentElement.clientHeight};window.GrapeGroup=function(){this._items=[];this.length=0;this._animations=[];this._img=null};GrapeGroup.fn=GrapeGroup.prototype;window.Grape=function(e,j,h,c){if(typeof h!=="undefined"){if(h==false||h=="false"){h=false}else{h=true}}else{h=false}var g;this.isShape=false;this.pixi=null;this.redrawpixi=function(){};this._raceme_attributes={};this._raceme_styles={};this._isInDOM=false;e=raceme.dV(e,"g");if(e===null){e="g"}j=raceme.dV(j,"svg");if(j=="html"){this._isInDOM=true}if(typeof e==="string"){if(e=="img"||e=="div"){j="html"}if(j=="svg"){this.seed=document.createElementNS("http://www.w3.org/2000/svg",e)}else{this.seed=document.createElement(e)}g=this.tagName();if(g=="svg"){this.style("overflow","hidden");this.attr("viewBox","0 0 500 500").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink")}else{if(g=="circle"||g=="ellipse"||g=="rect"||g=="line"||g=="path"||g=="polygon"||g=="polyline"||g=="image"||g=="text"){this.isShape=true}}}else{if(e instanceof Grape){return e}if(typeof e._grape!=="undefined"&&e._grape instanceof Grape){return e._grape}this.seed=e;this._isInDOM=true;if(this.seed.attributes){for(var f=0;f<this.seed.attributes.length;f++){var a=this.seed.attributes[f];if(a.specified){this._raceme_attributes[a.name]=a.value}}}g=this.tagName();if(g=="circle"||g=="ellipse"||g=="rect"||g=="line"||g=="path"||g=="polygon"||g=="polyline"||g=="image"||g=="text"){this.isShape=true}}this.seed._grape=this;if(!this.isShape&&isPIXI()){if(g=="canvas"){var k=this.width()||800;var d=this.height()||600;this.pixi=new PIXI.Application({width:k,height:d,antialias:true,resolution:c||window.devicePixelRatio||1,autoDensity:true,view:this.seed,transparent:true,forceCanvas:(this.hasAttr("nowebgl")||h)});this.pixi.renderer.plugins.interaction.moveWhenInside=true;this.pixi._grape=this}else{if(g=="g"){this.pixi=new PIXI.Graphics();this.pixi._grape=this}else{if(g=="title"){this.pixi=new PIXI.Graphics();this.pixi._grape=this;this.pixi.visible=false}}}}else{if(this.isShape&&isPIXI()){if(g=="image"){this.pixi=new PIXI.Sprite();this.pixi._grape=this}else{if(g=="text"){this.pixi=new PIXI.Text("");this.pixi._grape=this}else{this.pixi=new PIXI.Graphics();this.pixi._grape=this}}this.linestylepixi=function(){var n=1;if(this.hasAttr("stroke-width")){n=this.attr("stroke-width")}var l=1;if(this.hasAttr("stroke-opacity")){l=this.attr("stroke-opacity")}var i="butt";if(this.hasAttr("stroke-linecap")){i=this.attr("stroke-linecap")}var m="miter";if(this.hasAttr("stroke-linejoin")){m=this.attr("stroke-linejoin")}if(this.hasAttr("stroke")&&this.attr("stroke")!="none"){this.pixi.lineStyle({width:n,color:raceme._pixiColor(this.attr("stroke")),alpha:l,aligment:this.current_stroke_alignment,cap:i,join:m})}};this.fillstylepixi=function(){var i=1;if(this.hasAttr("fill-opacity")){i=this.attr("fill-opacity")}if(this.style("fill-opacity")){i=this.style("fill-opacity")}var l=null;if(this.hasAttr("fill")){l=raceme._pixiColor(this.attr("fill"))}else{if(this.style("fill")&&this.style("fill")!="none"){l=raceme._pixiColor(this.style("fill"))}}if(l!==null){this.pixi.beginFill(l,i)}};if(g=="circle"||g=="ellipse"){this.redrawpixi=function(){this.pixi.clear();this.linestylepixi();this.fillstylepixi();if(this.hasAttr("rx")){this.pixi.drawEllipse(0,0,this.attr("rx"),this.attr("ry"))}else{this.pixi.drawCircle(0,0,this.attr("r"))}}}else{if(g=="rect"){this.redrawpixi=function(){this.pixi.clear();this.linestylepixi();this.fillstylepixi();if(this.hasAttr("rx")){this.pixi.drawRoundedRect(0,0,this.width(),this.height(),this.attr("rx"))}else{this.pixi.drawRect(0,0,this.width(),this.height())}}}else{if(g=="line"){this.redrawpixi=function(){this.pixi.clear();this.linestylepixi();this.pixi.moveTo(this.attr("x1"),this.attr("y1"));if(!this.hasAttr("stroke-dasharray")){this.pixi.lineTo(this.attr("x2"),this.attr("y2"))}else{var i=this.attr("stroke-dasharray").split(",");var m=1;var l=1;if(typeof i[0]!=="undefined"){m=parseFloat(i[0])}if(typeof i[1]!=="undefined"){l=parseFloat(i[1])}this.pixi.drawDashLine(this.attr("x2"),this.attr("y2"),m,l)}}}else{if(g=="path"){this.redrawpixi=function(){this.pixi.clear();this.linestylepixi();this.fillstylepixi();if(this.hasAttr("d")){var t=dPathParse(this.attr("d"));var w=0;var v=0;var o=0;var m=0;for(var z=0;z<t.length;z++){var p=t[z];if(p.code=="m"){w+=p.end.x;v+=p.end.y;this.pixi.moveTo(w,v)}else{if(p.code=="M"){w=p.end.x;v=p.end.y;this.pixi.moveTo(w,v)}else{if(p.code=="h"){w+=p.value;this.pixi.moveTo(w,v)}else{if(p.code=="H"){w=p.value;this.pixi.moveTo(w,v)}else{if(p.code=="V"){v=p.value;this.pixi.moveTo(w,v)}else{if(p.code=="v"){v+=p.value;this.pixi.moveTo(w,v)}else{if(p.code=="Z"||p.code=="z"){this.pixi.closePath()}else{if(p.code=="l"){w+=p.end.x;v+=p.end.y;this.pixi.lineTo(w,v)}else{if(p.code=="L"){w=p.end.x;v=p.end.y;this.pixi.lineTo(w,v)}else{if(p.code=="A"){var E=w;var n=v;var C=p.end.x;var l=p.end.y;var x=p.radii.x;var D=Math.min(E,C)+(Math.max(E,C)-Math.min(E,C))/2;var B=Math.min(n,l)+(Math.max(n,l)-Math.min(n,l))/2;var y=raceme.distance({x:E,y:n},{x:C,y:l})/2;x=Math.max(x,y);var A=Math.sqrt((x*x)-(y*y));var F=raceme.rect2polar(C-D,l-B);var s=raceme.polar2rect(A,F.angle-90);var r=raceme.polar2rect(A,F.angle+90);s.x+=D;s.y+=B;r.x+=D;r.y+=B;if(p.clockwise==p.large){o=s.x;m=s.y}else{o=r.x;m=r.y}var q=raceme.rect2polar(w-o,v-m);var u=raceme.rect2polar(C-o,l-m);this.pixi.arc(o,m,x,q.angle*(Math.PI/180),u.angle*(Math.PI/180),!p.clockwise);w=C;v=l}else{if(p.code=="C"){o=w;m=v;w=p.end.x;v=p.end.y;this.pixi.bezierCurveTo(p.cp1.x,p.cp1.y,p.cp2.x,p.cp2.y,w,v)}else{if(p.code=="c"){o+=w;m+=v;w=p.end.x;v=p.end.y;this.pixi.bezierCurveTo(o+p.cp1.x,m+p.cp1.y,o+p.cp2.x,m+p.cp2.y,w,v)}else{if(p.code=="s"||p.code=="q"){o=w;m=v;w+=p.end.x;v+=p.end.y;this.pixi.quadraticCurveTo(o+p.cp.x,m+p.cp.y,w,v)}else{if(p.code=="Q"||p.code=="S"){o=w;m=v;w=p.end.x;v=p.end.y;this.pixi.quadraticCurveTo(o+p.cp.x,m+p.cp.y,w,v)}}}}}}}}}}}}}}}}}}}}}}}this.is_beginFill=false;this.current_fill_color="none";this.current_fill_alpha=1;this.is_beginPath=false;this.current_path="";this.is_beginPath_closed=false;this.current_stroke_thickness=0;this.current_stroke_color="none";this.current_stroke_caps="butt";this.current_stroke_joints="miter";this.current_stroke_miterLimit=4;this.current_stroke_alpha=1;this.current_stroke_dasharray="1";this.current_stroke_alignment=0.5;this.currentX=0;this.currentY=0;this._animations=[];this._events=[];this._prev_display=null};Grape.fn=Grape.prototype;function GrapeEvent(c,a,d){this._function=a;this._type=c;d=raceme.dV(d,"none");if(typeof d!=="string"){d=d.toString()}this._id=d}GrapeGroup.fn.by=function(e){if(this.length==0||typeof e!=="string"){return new GrapeGroup()}var e=e.split(":");var c=new GrapeGroup();var a=e[0];a=raceme._clearString(a);if(e.length==1){this.each(function(){if(raceme._clearString(this.tagName())==a){c.push(this)}})}else{if(e.length==2){if(a=="id"){return raceme.by("id:"+e[1])}else{var d=e[1];this.each(function(){if(a=="class"){if(this.containsClass(d)){c.push(this)}}else{if(raceme._clearString(this.attr(a))==d){c.push(this)}}})}}}return c};Grape.fn.by=function(h){if(typeof h!=="string"){return new GrapeGroup()}var h=h.split(":");var d=new GrapeGroup();var a=h[0];if(this.tagName()=="canvas"&&this.pixi&&this.pixi.stage){if(h.length==1){var g=function(j){for(var k=0;k<j.children.length;k++){if(j.children[k]._grape&&j.children[k]._grape.tagName()==a){d.push(j.children[k]._grape)}g(j.children[k])}};g(this.pixi.stage)}}else{if(h.length==1){var c=this.seed.getElementsByTagName(a);for(var e=0;e<c.length;e++){d.push(new Grape(c[e]))}}else{if(h.length==2){var f=h[1];if(raceme._clearString(a)=="id"){return raceme.by("id:"+f)}else{var c=this.getChildren();c.each(function(){if(raceme._clearString(a)=="class"){if(this.containsClass(f)){d.push(this)}}else{if(raceme._clearString(this.attr(a))==f){d.push(this)}}d.push(this.by(a+":"+f))})}}}}return d};Grape.fn.clone=function(){raceme._applyAttributesandStyle(this.seed);var a=new Grape(this.seed.cloneNode(true));if(this.pixi&&this.pixi.clone){a.pixi=this.clonePixi(this.pixi,this);a.pixi._grape=a}return a};Grape.fn.clonePixi=function(e,a){var c=e.clone();if(typeof a._transform==="undefined"){a._transform=raceme._transform2obj(a.attr("transform"))}c.setTransform(a._transform.x,a._transform.y,a._transform.scalex,a._transform.scaley,a._transform.rotation*(Math.PI/180),a._transform.skewx,a._transform.skewy);for(var d=0;d<e.children.length;d++){if(e.children[d].clone){c.addChild(this.clonePixi(e.children[d],e.children[d]._grape))}}return c};GrapeGroup.fn.show=function(){return this.each(Grape.fn.show)};Grape.fn.show=function(){if(this.style("display")=="none"){if(this._prev_display!==null){this.style("display",this._prev_display)}else{this.style("display","inline")}if(this.pixi){this.pixi.visible=true}}return this};GrapeGroup.fn.hide=function(){return this.each(Grape.fn.hide)};Grape.fn.hide=function(){if(this.style("display")!="none"){this._prev_display=this.style("display");this.style("display","none");if(this.pixi){this.pixi.visible=false}}return this};GrapeGroup.fn.attr=function(){if(typeof arguments[0]==="undefined"){return this}if(typeof arguments[1]!=="undefined"){if(raceme._likeArray(arguments[1])===false){return this.each(Grape.fn.attr,arguments)}return this.eachValue(Grape.fn.attr,arguments[1],arguments[0])}var a=[];this.each(function(){a.push(this.attr(arguments[0]))},arguments);return a};Grape.fn.attr=function(a,e){if(typeof a==="string"&&this.seed.nodeType==1){if(typeof e==="undefined"){if(this.hasAttr(a)==false){if(typeof raceme._defaultAttributeValues[a]!=="undefined"){return raceme._defaultAttributeValues[a]}return""}return this._raceme_attributes[a]}else{if(this.tagName()=="circle"||this.tagName()=="ellipse"){if(a=="cx"){return this.x(e)}if(a=="cy"){return this.y(e)}}if(e===""||e===null){this.removeAttr(a)}else{if(a=="href"&&(this.tagName()=="image"||this.tagName()=="filter"||this.tagName()=="textPath")){this._raceme_attributes[a]=e;if(this._isInDOM||a=="id"){this.seed.setAttributeNS("http://www.w3.org/1999/xlink",a,e)}}else{if(e!==e){return this}this._raceme_attributes[a]=e;if(this._isInDOM||a=="id"){this.seed.setAttribute(a,e)}}}}}if(this.pixi&&typeof a!=="undefined"&&typeof e!=="undefined"){var d=this.tagName();if(d=="canvas"){if(a=="width"||a=="height"){this.pixi.renderer.resize(this.width()/window.devicePixelRatio,this.height()/window.devicePixelRatio);this.style("width",this.width()/window.devicePixelRatio+"px").style("height",this.height()/window.devicePixelRatio+"px")}}else{if(d=="image"&&a=="href"){this.pixi.texture=PIXI.Texture.from(e)}else{if(this.isShape&&this.redrawpixi){var c=["width","height","r","rx","ry","fill-opacity","fill","stroke","stroke-width","stroke-opacity","d","x","y"];if(c.includes(a)){this.redrawpixi()}if(d=="text"){if(a=="fill"){this.pixi.defaultStyle.fill=raceme._rgb2hex(e);this.pixi.update()}else{if(a=="stroke"){this.pixi.defaultStyle.stroke=raceme._rgb2hex(e);this.pixi.update()}else{if(a=="stroke-width"){this.pixi.defaultStyle.strokeThickness=parseInt(e);this.pixi.update()}else{if(a=="font-weight"){this.pixi.defaultStyle.fontWeight=e;this.pixi.update()}else{if(a=="x"){if(this.attr("text-anchor")=="end"){this.pixi.x=e-this.pixi.getBounds().width}else{if(this.attr("text-anchor")=="middle"){this.pixi.x=e-this.pixi.getBounds().width/2}else{this.pixi.x=e}}}else{if(a=="y"){if(this.attr("dominant-baseline")=="text-before-edge"||this.attr("dominant-baseline")=="baseline"){this.pixi.y=e-this.pixi.getBounds().height}else{if(this.attr("dominant-baseline")=="central"){this.pixi.y=e-this.pixi.getBounds().height/2}else{this.pixi.y=e}}}}}}}}}}}}if(a=="opacity"&&typeof this.pixi.alpha=="number"){this.pixi.alpha=e}}return this};GrapeGroup.fn.align=function(){return this._applyFunction(Grape.fn.align,arguments)};Grape.fn.align=function(a){if(typeof a!=="string"||this.tagName()!="text"){return this}if(a=="left"){this.attr("text-anchor","start")}else{if(a=="right"){this.attr("text-anchor","end");if(this.pixi){this.pixi.x-=this.pixi.getBounds().width}}else{this.attr("text-anchor","middle");if(this.pixi){this.pixi.x-=this.pixi.getBounds().width/2}}}return this};GrapeGroup.fn.verticalAlign=function(){return this._applyFunction(Grape.fn.verticalAlign,arguments)};Grape.fn.verticalAlign=function(c){var a;if(typeof c!=="string"||this.tagName()!="text"){return this}if(c=="top"){this.attr("dominant-baseline","hanging");a=this.getChildren();a.each(function(){this.attr("dominant-baseline","hanging");this.getChildren().attr("dominant-baseline","hanging")})}else{if(c=="bottom"){a=this.getChildren();if(a.length>1){this.attr("dominant-baseline","text-before-edge");a.item(0).attr("dy","-"+(a.length*1.25)+"em");a.each(function(){this.attr("dominant-baseline","text-before-edge");this.getChildren().attr("dominant-baseline","text-before-edge")})}else{this.attr("dominant-baseline","baseline");a.each(function(){this.attr("dominant-baseline","baseline");this.getChildren().attr("dominant-baseline","baseline")})}if(this.pixi){this.pixi.y-=this.pixi.getBounds().height}}else{this.attr("dominant-baseline","central");a=this.getChildren();if(a.length>1){a.item(0).attr("dy","-"+((a.length*1.25)/2)+"em")}a.each(function(){this.attr("dominant-baseline","central");this.getChildren().attr("dominant-baseline","central")});if(this.pixi){this.pixi.y-=this.pixi.getBounds().height/2}}}return this};GrapeGroup.fn.opacity=function(){return this._applyFunction(Grape.fn.opacity,arguments)};Grape.fn.opacity=function(a){if(typeof a!=="undefined"&&a!==null){a=Math.max(Math.min(a,1),0)}return this.style("opacity",a)};GrapeGroup.fn.fill=function(){return this._applyFunction(Grape.fn.fill,arguments)};Grape.fn.fill=function(a){if(typeof a==="undefined"){return this.style("fill")}this.seed.style.fill=a;return this};GrapeGroup.fn.width=function(){return this._applyFunction(Grape.fn.width,arguments)};Grape.fn.width=function(a){return this.attr("width",a)};GrapeGroup.fn.height=function(){return this._applyFunction(Grape.fn.height,arguments)};Grape.fn.height=function(a){return this.attr("height",a)};GrapeGroup.fn.zoomable=function(){return this._applyFunction(Grape.fn.zoomable,arguments)};Grape.fn.zoomable=function(f,e,h,c,d,a){if(typeof a!=="boolean"){a=true}this._zoomable=true;this._zoom_w=raceme.dV(h,100);this._zoom_h=raceme.dV(c,100);this._zoom_x=raceme.dV(f,0);this._zoom_y=raceme.dV(e,0);this._zoom_max=raceme.dV(d,5);this._zoom_factor=0.5;this._current_zooming=false;this._sumelementszoom=0;this._nonscalables=this.by("class:nonscalable");this._must_scale=this.by("class:must_scale");this._nonscalableborder=this.by("class:nonscalable_border");this._force_redraw_elements=this.by("class:forceredrawelement");this._force_redraw_elements_non_animated=this.by("class:forceredrawelementnonanimated");this._sumelementszoom=this._nonscalables.length+this._nonscalableborder.length+this._force_redraw_elements.length*3+this._force_redraw_elements_non_animated.length;this.startPanning=null;this.endPanning=null;this.changePanning=null;this.startZoom=null;this.endZoom=null;if(a){var g=new Grape("rect","svg").attr("fill","white").opacity(0).x(this._zoom_x).y(this._zoom_y).attr("width",this._zoom_w).attr("height",this._zoom_h);this.addChild(g);g.toBack();var i=this;this.drag(function(j){i._startPanning(j)},function(j){i._changePanning(j);if(i._callwhenchange){i._callwhenchange.call()}},function(j){i._endPanning(j)}).mousewheel(function(j){i._scrollMouse(j);j.preventDefault();return false});this.dblclic(function(j){if(i.scale()>(i._zoom_max*0.5)){i.setZoom(1,true,j)}else{i.setZoom(i._zoom_max*0.66,true,j)}});this.dbltap(function(j){if(i.scale()>(i._zoom_max*0.5)){i.setZoom(1,true,j)}else{i.setZoom(i._zoom_max*0.66,true,j)}});this.mousewheel(function(j){i._scrollMouse(j);j.preventDefault();return false})}return this};GrapeGroup.fn.zoomIn=function(a){return this.each(Grape.fn.zoomIn)};Grape.fn.zoomIn=function(a){this.setZoom(this.scale()+this._zoom_factor,true,a);return this};GrapeGroup.fn.zoomOut=function(a){return this.each(Grape.fn.zoomOut)};Grape.fn.zoomOut=function(a){this.setZoom(this.scale()-this._zoom_factor,true,a);return this};GrapeGroup.fn.focusZoom=function(a,c){return this._applyFunction(Grape.fn.focusZoom,arguments)};Grape.fn.focusZoom=function(f,g){if(typeof g!=="boolean"){g=true}var h=f.x2-f.x;var c=f.y2-f.y;f.x-=h*0.05;f.x2+=h*0.05;f.y-=c*0.05;f.y2+=c*0.05;h=f.x2-f.x;c=f.y2-f.y;var e=f.x+(h)/2;var d=f.y+(c)/2;var a=Math.min(this._zoom_w/(h),this._zoom_h/(c));this.setZoom(a,g,e,d)};GrapeGroup.fn.setZoom=function(){return this._applyFunction(Grape.fn.setZoom,arguments)};Grape.fn.setZoom=function(d,g,i,m){g=raceme.dV(g,true);var f=Math.max(1,Math.min(this._zoom_max,d));var c=this.scale();if(f!=c){if(this.startZoom){this.startZoom.call(this)}this._zoom_factor=0.5+((f-1)*0.5);var a;var j;var n;var l;if(typeof m!=="undefined"){n=i;l=m}else{if(i){if(i.touches&&i.touches[0]){i=i.touches[0]}var o=raceme.cursorPoint(i);n=o.x;l=o.y}else{n=this._zoom_w/2;l=this._zoom_h/2}}var p=raceme.map(n,this.x(),this.x()+this._zoom_w*c,0,this._zoom_w);var k=raceme.map(l,this.y(),this.y()+this._zoom_h*c,0,this._zoom_h);if(typeof m!=="undefined"){j=-(f*p)+this._zoom_w/2+this._zoom_x;a=-(f*k)+this._zoom_h/2+this._zoom_y}else{j=-(f*p)+n;a=-(f*k)+l}j=Math.max(j,-(this._zoom_w*f)+this._zoom_w-((f-1)*this._zoom_x));j=Math.min(j,-(f-1)*this._zoom_x);a=Math.max(a,-(this._zoom_h*f)+this._zoom_h-((f-1)*this._zoom_y));a=Math.min(a,-(f-1)*this._zoom_y);var h=this;if(this._sumelementszoom<10000&&g){this._current_zooming=true;this._force_redraw_elements_non_animated.each(function(){if(this._pre_force_redraw){this._pre_force_redraw()}});this.animate(400).ease("out").move(j,a).scale(f).meanwhile(function(){h._force_redraw_elements.each(function(){this._force_redraw()});if(h._callwhenchange){h._callwhenchange.call()}}).done(function(){if(h.endZoom!==null){h.endZoom.call(this)}this._current_zooming=false;this._force_redraw_elements_non_animated.each(function(){this._force_redraw()});this._nonscalableborder.each(function(){var e=this.attr("stroke-width");this.attr("stroke-width",(e*c)/f)})});this._nonscalables.animate(400).ease("out").scale(1/f);this._must_scale.animate(400).ease("out").scale(f)}else{this.move(j,a).scale(f);this._nonscalables.scale(1/f);this._must_scale.scale(f);this._force_redraw_elements.each(function(){this._force_redraw()});this._force_redraw_elements_non_animated.each(function(){this._force_redraw()});this._nonscalableborder.each(function(){var e=this.attr("stroke-width");this.attr("stroke-width",(e*c)/f)});if(this.endZoom!==null){this.endZoom.call(this)}if(h._callwhenchange){h._callwhenchange.call()}}}return this};GrapeGroup.fn.getChildren=function(){var a=new GrapeGroup();this.each(function(){a.push(this.getChildren())});return a};Grape.fn.getChildren=function(){var c=new GrapeGroup();var a=this.seed.firstChild;while(a){if(a.nodeType==1){c.push(new Grape(a))}a=a.nextSibling}return c};Grape.fn.isChildOf=function(a){return raceme._contains(a.seed,this.seed)};GrapeGroup.fn.first=GrapeGroup.fn.firstChild=function(){return this.firstItem().firstChild()};Grape.fn.first=Grape.fn.firstChild=function(){return this.getChildren().firstItem()};GrapeGroup.fn.last=GrapeGroup.fn.lastChild=function(){return this.lastItem().lastChild()};Grape.fn.last=Grape.fn.lastChild=function(){return this.getChildren().lastItem()};GrapeGroup.fn.getParents=function(){var a=new GrapeGroup();this.each(function(){a.push(this.getParent())});return a};Grape.fn.getParent=function(){if(this.seed.parentNode&&this.tagName()!="svg"&&this.seed.nodeType==1){return new Grape(this.seed.parentNode)}return null};GrapeGroup.fn.remove=function(){return this.each(Grape.fn.remove)};Grape.fn.remove=function(){if(this.pixi){var a=this.getParent();if(a&&a.pixi){a.pixi.removeChild(this.pixi)}}if(this.seed.parentNode){this.seed.parentNode.removeChild(this.seed)}return this};GrapeGroup.fn.clear=function(){return this.each(Grape.fn.clear)};Grape.fn.clear=function(){this.getChildren().each(function(){this.remove()});while(this.seed.firstChild){this.seed.removeChild(this.seed.firstChild)}if(this.pixi){if(this.pixi.stage){for(var a=this.pixi.stage.children.length-1;a>=0;a--){this.pixi.stage.removeChild(this.pixi.stage.children[a])}}else{if(this.pixi.clear){this.pixi.clear()}}}return this};GrapeGroup.fn.toFront=function(){return this.each(Grape.fn.toFront)};Grape.fn.toFront=function(){var a=this.getParent();if(a!==null){a.removeChild(this);a.addChild(this)}return this};GrapeGroup.fn.toBack=function(){return this.each(Grape.fn.toBack)};Grape.fn.toBack=function(){var a=this.getParent();if(a!==null){if(a.seed.childNodes.length<2){return this}a.removeChild(this);a.seed.insertBefore(this.seed,a.seed.childNodes.item(0));if(a.pixi){a.pixi.addChildAt(this.pixi,0)}}return this};GrapeGroup.fn.toIndexPosition=function(){return this._applyFunction(Grape.fn.toIndexPosition,arguments)};Grape.fn.toIndexPosition=function(c){if(typeof c==="undefined"||c===null){return this}if(c==0){return this.toBack()}var a=this.getParent();if(a!==null){if(c>=a.seed.children.length){return this.toFront()}a.removeChild(this);a.seed.insertBefore(this.seed,a.seed.children[c]);if(a.pixi){a.pixi.addChildAt(this.pixi,c)}}return this};Grape.fn.isBeforeOf=function(c){if(!c||!c.seed){return false}if(this.seed.parentNode===c.seed.parentNode){for(var a=this.seed.previousElementSibling;a;a=a.previousElementSibling){if(a===c.seed){return true}}}return false};GrapeGroup.fn.getClip=function(){return this.each(Grape.fn.clip)};Grape.fn.getClip=function(a){var d=raceme._generateId();var c=new Grape("clipPath","svg").id(d).addChild(a);this.attr("clip-path","url(#"+d+")");return c};GrapeGroup.fn.x=function(){return this._applyFunction(Grape.fn.x,arguments)};Grape.fn.x=function(c,a){return this.transform("x",c,a)};GrapeGroup.fn.y=function(){return this._applyFunction(Grape.fn.y,arguments)};Grape.fn.y=function(c,a){return this.transform("y",c,a)};GrapeGroup.fn.move=function(){return this._applyFunction(Grape.fn.move,arguments)};Grape.fn.move=function(a,d,c){if(arguments.length!=2){return this}return this.x(a,true).y(d,c)};GrapeGroup.fn.scale=function(){return this._applyFunction(Grape.fn.scale,arguments)};Grape.fn.scale=function(c,a){this.scalex(c,true);return this.scaley(c,a)};GrapeGroup.fn.scalex=function(){return this._applyFunction(Grape.fn.scalex,arguments)};Grape.fn.scalex=function(c,a){return this.transform("scalex",c,a)};GrapeGroup.fn.scaley=function(){return this._applyFunction(Grape.fn.scaley,arguments)};Grape.fn.scaley=function(c,a){return this.transform("scaley",c,a)};GrapeGroup.fn.rotation=function(){return this._applyFunction(Grape.fn.rotation,arguments)};Grape.fn.rotation=function(c,a){return this.transform("rotation",c,a)};GrapeGroup.fn.rotationcx=function(){return this._applyFunction(Grape.fn.rotationcx,arguments)};Grape.fn.rotationcx=function(c,a){return this.transform("rotationcx",c,a)};GrapeGroup.fn.rotationcy=function(){return this._applyFunction(Grape.fn.rotationcy,arguments)};Grape.fn.rotationcy=function(c,a){return this.transform("rotationcy",c,a)};GrapeGroup.fn.skewx=function(){return this._applyFunction(Grape.fn.skewx,arguments)};Grape.fn.skewx=function(c,a){return this.transform("skewx",c,a)};GrapeGroup.fn.skewy=function(){return this._applyFunction(Grape.fn.skewy,arguments)};Grape.fn.skewy=function(c,a){return this.transform("skewy",c,a)};GrapeGroup.fn.text=function(){return this._applyFunction(Grape.fn.text,arguments)};Grape.fn.text=function(a){if(typeof a==="undefined"){var c=this.seed.childNodes;var e="";for(var d=0;d<c.length;d++){if(c.item(d).nodeType==3){e+=c.item(d).nodeValue}else{if(c.item(d).nodeType==1){e+=new Grape(c.item(d)).text()}}}return e}if(typeof a=="number"){a=a.toString()}for(var d=0;d<this.seed.childNodes.length;d++){if(this.seed.childNodes[d].nodeType==3){this.seed.childNodes[d].nodeValue=""}}if(a!=""){this.seed.appendChild(document.createTextNode(a))}return this};GrapeGroup.fn.innerHTML=function(){return this._applyFunction(Grape.fn.innerHTML,arguments)};Grape.fn.innerHTML=function(a){if(typeof a==="undefined"){return this.seed.innerHTML}this.seed.innerHTML=a;return this};GrapeGroup.fn.textContent=function(){return this._applyFunction(Grape.fn.textContent,arguments)};Grape.fn.textContent=function(a){if(typeof a==="undefined"){return this.seed.textContent}this.seed.textContent=a;return this};GrapeGroup.fn.search=function(){var a=new GrapeGroup();this.each(function(){if(this.search(arguments[0],arguments[1])){a.push(this)}},arguments);return a};Grape.fn.search=function(a,c){if(typeof a!=="string"){return false}if(c!=true){if(raceme._clearString(this.text()).search(raceme._clearString(a))==-1){return false}return true}else{if(this.text().search(a)==-1){return false}return true}};GrapeGroup.fn.ajax=function(){if(typeof arguments[0]!=="undefined"){if(raceme._likeArray(arguments[0])===false){return this.each(Grape.fn.ajax,arguments)}return this.eachValue(Grape.fn.ajax,arguments[0])}return this};Grape.fn.ajax=function(a){raceme.ajax.call(this,a);return this};GrapeGroup.fn.removeAttr=function(){return this.each(Grape.fn.removeAttr,arguments)};Grape.fn.removeAttr=function(a){if(typeof a!=="undefined"){if(this.hasAttr(a)){delete this._raceme_attributes[a];this.seed.removeAttribute(a)}}return this};Grape.fn.hasAttr=function(a){if(typeof a=="string"){return(typeof this._raceme_attributes[a]!=="undefined")}return false};GrapeGroup.fn.style=function(){if(typeof arguments[0]!=="undefined"&&typeof arguments[1]!=="undefined"){if(raceme._likeArray(arguments[1])===false){return this.each(Grape.fn.style,arguments)}return this.eachValue(Grape.fn.style,arguments[1],arguments[0])}if(arguments[0]===null){return this.each(function(){this.style(null)})}var a=[];this.each(function(){a.push(this.style(arguments[0]))},arguments);return a};Grape.fn.style=function(a,d){if(typeof a!=="undefined"){if(a===null){return this.attr("style",null)}if(typeof d==="undefined"){if(this._isInDOM){var e=raceme._getStyle(this.seed);if(typeof e[a]!="undefined"){return e[a]}if(typeof raceme._defaultStylesValues[a]!="undefined"){return raceme._defaultStylesValues[a]}return""}else{if(typeof this._raceme_styles[a]!="undefined"){return this._raceme_styles[a]}if(typeof raceme._defaultStylesValues[a]!="undefined"){return raceme._defaultStylesValues[a]}return""}}else{if(d===null){return this}if(this._isInDOM){this.seed.style.setProperty(a,d.toString(),"")}this._raceme_styles[a]=d.toString();if(this.pixi){if(this.isShape){var c=["fill-opacity","fill","stroke","stroke-width","stroke-opacity"];if(c.indexOf(a)!=-1){this.redrawpixi()}}if(a=="font-family"){a="fontFamily"}if(a=="opacity"){this.pixi.alpha=d}else{if(a=="cursor"){this.pixi.cursor=d}else{if(this.tagName()=="text"){if(a=="fill"){this.pixi.defaultStyle.fill=raceme._rgb2hex(d);this.pixi.update()}else{if(a=="stroke"){this.pixi.defaultStyle.stroke=raceme._rgb2hex(d);this.pixi.update()}else{if(a=="stroke-width"){this.pixi.defaultStyle.strokeThickness=parseInt(d);this.pixi.update()}else{if(a=="font-weight"){this.pixi.defaultStyle.fontWeight=d;this.pixi.update()}}}}}else{if(this.pixi.style&&typeof this.pixi.style[a]!=="undefined"){if(a=="fill"||a=="stroke"){this.pixi.style[a]=raceme._pixiColor(d)}else{this.pixi.style[a]=d}}else{if(a=="stroke-width"&&typeof this.pixi.style!=="undefined"&&typeof this.pixi.style.strokeThickness!=="undefined"){this.pixi.style.strokeThickness=parseFloat(d.replace("px",""))}}}}}}}}else{return raceme._getStyle(this.seed)}return this};GrapeGroup.fn.addTo=function(a){a.addChild(this);return this};Grape.fn.addTo=function(a){a.addChild(this);return this};GrapeGroup.fn.addClass=function(){return this._applyFunction(Grape.fn.addClass,arguments)};Grape.fn.addClass=function(a){if(typeof a!=="undefined"&&a!==null){if(this.containsClass(a)==false){this.attr("class",this.attr("class")+" "+a)}}return this};GrapeGroup.fn.removeClass=function(){return this.each(Grape.fn.removeClass,arguments)};Grape.fn.removeClass=function(e){if(typeof e==="undefined"||e===null){return this.removeAttr("class")}if(this.containsClass(e)==true){var d=this.attr("class").split(" ");var c="";for(var a=0;a<d.length;a++){if(d[a]!=e){c+=" "+d[a]}}this.attr("class",c)}return this};GrapeGroup.fn.containsClass=function(c){for(var a=0;a<this.length;a++){if(this._items[a].containsClass(c)){return true}}return false};Grape.fn.containsClass=function(c){if(typeof c==="undefined"){return false}var a=this.attr("class").split(" ");if(a.indexOf(c)!=-1){return true}return false};GrapeGroup.fn.getBBox=function(){var c=null;var e=null;var a=null;var d=null;this.each(function(){var f=this.getBBox();if(c===null){c=f.x1;e=f.y1;a=f.x2;d=f.y2}else{c=Math.min(c,f.x1);e=Math.min(e,f.y1);a=Math.max(a,f.x2);d=Math.max(d,f.y2)}});if(c===null){return{x1:0,y1:0,width:0,height:0,x2:0,y2:0}}return{x1:c,y1:e,width:(a-c),height:(d-e),x2:a,y2:d}};Grape.fn.getBBox=function(){var g={x:0,y:0,x1:0,y1:0,width:0,height:0,x2:0,y2:0};if(this._isInDOM==false&&this.pixi&&this.pixi.getBounds){const a=new TaggedText("",{},{skipUpdate:true,skipDraw:true});var e=this.pixi.getBounds();g.x=e.x;g.x1=g.x;g.y=e.y;g.y1=g.y;g.width=e.width;g.height=e.height;g.y2=g.y1+g.height;g.x2=g.x1+g.width}else{if(this.seed.getBBox){if(this.seed.ownerSVGElement){raceme._applyAttributesandStyle(this.seed);var d=this.seed.getBBox();g.x1=this.point(d.x,d.y).x;g.y1=this.point(d.x,d.y).y;g.width=d.width;g.height=d.height;g.x2=g.x1+g.width;g.y2=g.y1+g.height;g.x=g.x1;g.y=g.y1}else{var f=new Grape("svg");var c=this.clone();f.addChild(c);f.addTo(by("body").item(0));g=c.getBBox();f.remove()}}else{g={x:this.seed.offsetLeft,y:this.seed.offsetTop,width:this.seed.offsetWidth,height:this.seed.offsetHeight};g.x1=g.x;g.y1=g.y;g.x2=g.x1+g.width;g.y2=g.y1+g.height}}return g};GrapeGroup.fn.lineStyle=function(){return this.each(Grape.fn.lineStyle,arguments)};Grape.fn.lineStyle=function(e,d,h,f,a,c,g,i){if(this.isShape){if(this.getParent()===null){return this}return this.getParent().lineStyle(e,d,h,f,a,c,g,i)}this.current_stroke_thickness=raceme.dV(e,0);this.current_stroke_color=raceme.dV(d,"none");this.current_stroke_caps=raceme.dV(f,"butt");this.current_stroke_joints=raceme.dV(a,"miter");this.current_stroke_miterLimit=raceme.dV(c,4);this.current_stroke_alpha=raceme.dV(h,1);this.current_stroke_dasharray=raceme.dV(g,"1");this.current_stroke_alignment=raceme.dV(i,0.5);if(this.pixi){this.pixi.lineStyle({width:this.current_stroke_thickness,color:raceme._pixiColor(this.current_stroke_color),alpha:this.current_stroke_alpha,aligment:this.current_stroke_alignment,cap:this.current_stroke_caps,join:this.current_stroke_joints})}return this};GrapeGroup.fn.beginFill=function(){return this.each(Grape.fn.beginFill,arguments)};Grape.fn.beginFill=function(a,c){if(this.isShape&&this.getParent()===null){return this}if(this.isShape){return this.getParent().beginFill(a,c)}this.is_beginFill=true;this.current_fill_color=raceme.dV(a,"none");this.current_fill_alpha=raceme.dV(c,1);if(this.pixi){if(this.current_fill_color=="none"){this.pixi.endFill()}else{this.pixi.beginFill(raceme._pixiColor(this.current_fill_color),this.current_fill_alpha)}}return this};GrapeGroup.fn.endFill=function(){return this.each(Grape.fn.endFill)};Grape.fn.endFill=function(){if(this.isShape){if(this.getParent()===null){return this}return this.getParent().endFill()}this.is_beginFill=false;this.current_fill_color="none";this.current_fill_alpha=1;if(this.pixi){this.pixi.endFill()}return this};GrapeGroup.fn.beginPath=function(){return this.each(Grape.fn.beginPath,arguments)};Grape.fn.beginPath=function(a){if(this.isShape){if(this.getParent()===null){return this}return this.getParent().beginPath(a)}this.is_beginPath=true;this.current_path="";this.currentX=0;this.currentY=0;this.is_beginPath_closed=raceme.dV(a,false);return this};GrapeGroup.fn.endPath=function(){return this.each(Grape.fn.endPath)};Grape.fn.endPath=function(){if(this.isShape){if(this.getParent()===null){return this}return this.getParent().endPath()}this.is_beginPath=false;this.currentX=0;this.currentX=0;if(this.current_path!=""){if(this.is_beginPath_closed){this.current_path=this.current_path+" z"}var a=new Grape("path");a.attr("d",this.current_path);this._applyStrokeandFill(a);a.addTo(this)}return this};GrapeGroup.fn.moveTo=function(){return this.each(Grape.fn.moveTo,arguments)};Grape.fn.moveTo=function(a,c){if(this.isShape){if(this.getParent()===null){return this}return this.getParent().moveTo(a,c)}a=raceme.dV(a,0);c=raceme.dV(c,0);if(this.is_beginPath){this.current_path=this.current_path+"M "+a+" "+c+" "}this.currentX=a;this.currentY=c;return this};GrapeGroup.fn.lineTo=function(){return this.each(Grape.fn.lineTo,arguments)};Grape.fn.lineTo=function(c,e,a){if(a!=false){a=true}if(this.isShape){if(this.getParent()===null){return this}return this.getParent().lineTo(c,e)}c=raceme.dV(c,0);e=raceme.dV(e,0);if(this.is_beginPath){if(this.current_path==""){this.moveTo(0,0)}this.current_path+="L "+c+" "+e+" ";this.currentX=c;this.currentY=e;return this}else{var d=new Grape("line");if((c==this.currentX||e==this.currentY)&&a){d.attr("shape-rendering","crispEdges")}d.attr("x1",this.currentX).attr("y1",this.currentY).attr("x2",c).attr("y2",e);this._applyStrokeandFill(d);this.currentX=c;this.currentY=e;return d.addTo(this)}};GrapeGroup.fn.line=function(){return this.each(Grape.fn.line,arguments)};Grape.fn.line=function(d,f,c,e,a){if(this.isShape){if(this.getParent()===null){return this}return this.getParent().line(d,f,c,e,a)}return this.moveTo(d,f).lineTo(c,e,a)};GrapeGroup.fn.circle=GrapeGroup.fn.ellipse=function(){return this.each(Grape.fn.circle,arguments)};Grape.fn.circle=Grape.fn.ellipse=function(a,f,e,d){if(this.isShape){if(this.getParent()===null){return this}return Grape.fn.circle.call(this.getParent(),a,f,e,d)}if(!this.is_beginPath&&arguments.length>0){var c;if(arguments.length==1){c=new Grape("circle").attr("cx",this.currentX).attr("cy",this.currentY).attr("r",a);if(c.pixi){c.pixi.x=this.currentX;c.pixi.y=this.currentY}}else{if(arguments.length==2){c=new Grape("ellipse").attr("cx",this.currentX).attr("cy",this.currentY).attr("rx",a).attr("ry",f);if(c.pixi){c.pixi.x=this.currentX;c.pixi.y=this.currentY}}else{if(arguments.length==3){c=new Grape("circle").attr("cx",a).attr("cy",f).attr("r",e);if(c.pixi){c.pixi.x=a;c.pixi.y=f}}else{c=new Grape("ellipse").attr("cx",a).attr("cy",f).attr("rx",e).attr("ry",d);if(c.pixi){c.pixi.x=a;c.pixi.y=f}}}}this._applyStrokeandFill(c);return c.addTo(this)}return this};GrapeGroup.fn.rect=function(){return this.each(Grape.fn.rect,arguments)};Grape.fn.rect=function(c,h,f,a,g,d){if(this.isShape){if(this.getParent()===null){return this}return Grape.fn.rect.apply(this.getParent(),arguments)}if(!this.is_beginPath&&arguments.length>0){var e=new Grape("rect");if(arguments.length==1){e.attr("x",this.currentX).attr("y",this.currentY).attr("width",c).attr("height",c).attr("shape-rendering","crispEdges");if(e.pixi){e.pixi.x=this.currentX;e.pixi.y=this.currentY}}else{if(arguments.length==2){e.attr("x",this.currentX).attr("y",this.currentY).attr("width",c).attr("height",h).attr("shape-rendering","crispEdges");if(e.pixi){e.pixi.x=this.currentX;e.pixi.y=this.currentY}}else{if(arguments.length==3){e.attr("x",c).attr("y",h).attr("width",f).attr("height",f).attr("shape-rendering","crispEdges");if(e.pixi){e.pixi.x=c;e.pixi.y=h}}else{if(arguments.length==4){e.attr("x",c).attr("y",h).attr("width",f).attr("height",a).attr("shape-rendering","crispEdges");if(e.pixi){e.pixi.x=c;e.pixi.y=h}}else{if(arguments.length==5){e.attr("x",c).attr("y",h).attr("width",f).attr("height",a).attr("rx",g);if(e.pixi){e.pixi.x=c;e.pixi.y=h}}else{e.attr("x",c).attr("y",h).attr("width",f).attr("height",a).attr("rx",g).attr("ry",d);if(e.pixi){e.pixi.x=c;e.pixi.y=h}}}}}}this._applyStrokeandFill(e);return e.addTo(this)}return this};GrapeGroup.fn.arcTo=function(){return this.each(Grape.fn.arcTo,arguments)};Grape.fn.arcTo=function(f,c,e,a,d){if(arguments.length<3){return this}a=raceme.dV(a,0);d=raceme.dV(d,1);if(this.is_beginPath){if(this.current_path==""){this.moveTo(0,0)}this.current_path+="A "+e+" "+e+" 0 "+a+" "+d+" "+f+" "+c+" "}return this};GrapeGroup.fn.curveTo=function(){return this.each(Grape.fn.curveTo,arguments)};Grape.fn.curveTo=function(e,c,d,g,a,f){if(arguments.length!=6){return this}if(this.is_beginPath){if(this.current_path==""){this.moveTo(0,0)}this.current_path+="C "+d+" "+g+" "+a+" "+f+" "+e+" "+c+" "}return this};GrapeGroup.fn.quadraticCurveTo=function(){return this.each(Grape.fn.quadraticCurveTo,arguments)};Grape.fn.quadraticCurveTo=function(d,a,c,e){if(arguments.length!=4){return this}if(this.is_beginPath){if(this.current_path==""){this.moveTo(0,0)}this.current_path+="Q "+c+" "+e+" "+d+" "+a+" "}return this};GrapeGroup.fn.splineCurve=function(){return this.each(Grape.fn.splineCurve,arguments)};Grape.fn.splineCurve=function(r){if(!r||!r.length){return this}if(this.is_beginPath){var g=0.5;var e,d,c,a,k,h,x,v,u,o,n,l,m;var t,j,f,w,s,p;for(var q=0;q<r.length-1;q++){e=q==0?r[0]:r[q-1];d=r[q];c=r[q+1];a=q+2<r.length?r[q+2]:c;x=Math.sqrt(Math.pow(e.x-d.x,2)+Math.pow(e.y-d.y,2));v=Math.sqrt(Math.pow(d.x-c.x,2)+Math.pow(d.y-c.y,2));u=Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2));t=Math.pow(u,g);f=Math.pow(u,2*g);j=Math.pow(v,g);w=Math.pow(v,2*g);p=Math.pow(x,g);s=Math.pow(x,2*g);o=2*s+3*p*j+w;n=2*f+3*t*j+w;l=3*p*(p+j);if(l>0){l=1/l}m=3*t*(t+j);if(m>0){m=1/m}k={x:(-w*e.x+o*d.x+s*c.x)*l,y:(-w*e.y+o*d.y+s*c.y)*l};h={x:(f*d.x+n*c.x-w*a.x)*m,y:(f*d.y+n*c.y-w*a.y)*m};if(k.x==0&&k.y==0){k=d}if(h.x==0&&h.y==0){h=c}this.curveTo(c.x,c.y,k.x,k.y,h.x,h.y)}}return this};GrapeGroup.squircle=function(){return this.each(Grape.fn.squircle,arguments)};Grape.fn.squircle=function(c,i,g,a){if(this.isShape){if(this.getParent()===null){return this}return this.getParent().squircle(c,i,g,a)}if(this.is_beginPath==false){var e=0;var d=0;var f=0;var h=0;if(arguments.length==1){e=this.currentX;d=this.currentY;f=c;h=f}else{if(arguments.length==2){e=this.currentX;d=this.currentY;f=c;h=i}else{if(arguments.length==3){e=c;d=i;f=g;h=f}else{if(arguments.length==4){e=c;d=i;f=g;h=a}else{return this}}}}this.beginPath();this.moveTo(e,d+h/2);this.curveTo(e+f/2,d+h,e,d+h,e,d+h);this.curveTo(e+f,d+h/2,e+f,d+h,e+f,d+h);this.curveTo(e+f/2,d,e+f,d,e+f,d);this.curveTo(e,d+h/2,e,d,e,d);return this.endPath()}return this};GrapeGroup.fn.arc=function(){return this.each(Grape.fn.arc,arguments)};Grape.fn.arc=function(h,f,a,e,g,k){if(this.isShape){if(this.getParent()===null){return this}return this.getParent().arc(h,f,a,e,g,k)}if(!this.is_beginPath){h=raceme.dV(h,0);f=raceme.dV(f,0);a=raceme.dV(a,10);e=raceme.dV(e,0);g=raceme.dV(g,360);k=raceme.dV(k,false);e=Math.max(Math.min(e,360),-360);g=Math.max(Math.min(g,360),-360);if(e<0){e=360-e}if(g<0){g=360-g}if(e>g){var l=e;e=g;g=l}if(g-e>=360){return this.circle(h,f,a)}var i=0;if((g-e)>180){i=1}var d=h+raceme.polar2rect(a,e).x;var n=f+raceme.polar2rect(a,e).y;var c=h+raceme.polar2rect(a,g).x;var m=f+raceme.polar2rect(a,g).y;if(k){this.beginPath(true);this.moveTo(h,f).lineTo(d,n).arcTo(c,m,a,i);this.endPath();return this}else{if(this.is_beginFill&&this.current_fill_color!="none"){var j=this.current_stroke_color;this.current_stroke_color="none";this.beginPath(true);this.moveTo(h,f).lineTo(d,n).arcTo(c,m,a,i);this.endPath();this.current_stroke_color=j;this.is_beginFill=false;this.beginPath(false);this.moveTo(d,n).arcTo(c,m,a,i);this.endPath();this.is_beginFill=true}else{this.beginPath(false);this.moveTo(d,n).arcTo(c,m,a,i);this.endPath()}}}return this};GrapeGroup.fn.pieSlice=function(){return this.each(Grape.fn.pieSlice,arguments)};Grape.fn.pieSlice=function(d,k,o,p,h,g){if(this.isShape){if(this.getParent()===null){return this}return this.getParent().pieSlice(d,k,o,p)}if(!this.is_beginPath){d=raceme.dV(d,0);k=raceme.dV(k,0);h=raceme.dV(h,0);g=raceme.dV(g,0);o=raceme.dV(o,0);p=raceme.dV(p,360);if(o+90>p+90){var j=o;o=p;p=j}if(p-o>=360){p-=0.00001}var i=0;if((p-o)>180){i=1}var c=h+raceme.polar2rect(d,o).x;var m=g+raceme.polar2rect(d,o).y;var a=h+raceme.polar2rect(d,p).x;var l=g+raceme.polar2rect(d,p).y;var q=h+raceme.polar2rect(k,o).x;var f=g+raceme.polar2rect(k,o).y;var n=h+raceme.polar2rect(k,p).x;var e=g+raceme.polar2rect(k,p).y;this.beginPath(true);this.moveTo(c,m).arcTo(a,l,d,i).lineTo(n,e).arcTo(q,f,k,i,0);this.endPath()}return this};GrapeGroup.fn.label=function(){return this.each(Grape.fn.label,arguments)};Grape.fn.label=function(i,h,g,d,j,f,a,c,e){if(this.isShape){if(this.getParent()===null){return this}return this.getParent().label(i,h,g,d,j,f,a,c,e)}if(!this.is_beginPath){return raceme.label(i,h,g,d,j,f,a,c,e).addTo(this)}return this};GrapeGroup.fn.image=function(){return this.each(Grape.fn.image,arguments)};Grape.fn.image=function(d,c,f,e,a){if(this.isShape){if(this.getParent()===null){return this}return this.getParent().image(d,c,f,e,a)}if(this.tagName()=="filter"||(this.getParent()!=null&&this.getParent().tagName()=="filter")){return this.fe("feImage")}if(!this.is_beginPath){return raceme.image(d,c,f,e,a).addTo(this)}return thid};GrapeGroup.fn.enableEvents=function(){return this.each(Grape.fn.enableEvents,arguments)};Grape.fn.enableEvents=function(a){if(a===false){if(this.pixi){this.pixi.interactive=false}return this.style("pointer-events","none")}if(this.pixi){this.pixi.interactive=true}return this.style("pointer-events","visible")};GrapeGroup.fn.addEvent=function(){return this.each(Grape.fn.addEvent,arguments)};Grape.fn.addEvent=function(e,f,h,c){if(typeof e!=="string"||typeof f==="undefined"){return this}var g=this;var a=function(i){if(e=="paste"){setTimeout(function(){f.call(g,i)},0)}else{f.call(g,i)}};this._events.push(new GrapeEvent(e,a,h));if(e=="load"&&(this.tagName()=="image"||this.tagName()=="IMG")){this._img=new Image();if(this._img.addEventListener){this._img.addEventListener("load",a,false)}else{if(this._img.attachEvent){this._img.attachEvent("load",a,false)}}if(this.tagName()=="image"){this._img.src=this.attr("href")}else{this._img.src=this.attr("src")}this.seed.src=this._img.src}else{if(this.seed.addEventListener){this.seed.addEventListener(e,a,c)}else{if(this.seed.attachEvent){this.seed.attachEvent(e,a)}}if(this.pixi){this.pixi.interactive=true;var d=e;if(d=="click"){d="pointertap"}else{if(d=="mouseenter"){d="mouseover"}else{if(d=="mouseleave"){d="mouseout"}}}if(d=="mousewheel"){this.pixi.interactiveMousewheel=true;this.pixi.on(d,function(j,i){f.call(g,i)})}else{if(d=="dblclick"){this.pixi.on("mousedown",function(i){if(!g.raceme_tmp_pixi_clicked){g.raceme_tmp_pixi_clicked=setTimeout(function(){g.raceme_tmp_pixi_clicked=null},300)}else{clearTimeout(g.raceme_tmp_pixi_clicked);g.raceme_tmp_pixi_clicked=null;f.call(g,i.data.originalEvent)}})}else{this.pixi.on(d,function(i){i.stopPropagation();f.call(g,i.data.originalEvent)});if(d=="pointertap"){this.pixi.on("rightclick",function(i){i.stopPropagation();f.call(g,i.data.originalEvent)})}else{if(d=="mousedown"){this.pixi.on("rightdown",function(i){i.stopPropagation();f.call(g,i.data.originalEvent)})}else{if(d=="mouseup"){this.pixi.on("rightup",function(i){i.stopPropagation();f.call(g,i.data.originalEvent)})}}}}}}}return this};GrapeGroup.fn.removeEvent=function(){return this.each(Grape.fn.removeEvent,arguments)};Grape.fn.removeEvent=function(a){var d=[];for(var c=0;c<this._events.length;c++){if(typeof a==="undefined"||a===null||this._events[c]._id==a||this._events[c]._type==a){if(this._events[c]._type=="load"&&this._img!=null){this._img.removeEventListener("load",this._events[c]._function)}this.seed.removeEventListener(this._events[c]._type,this._events[c]._function)}else{d.push(this._events[c])}}this._events=d;return this};GrapeGroup.fn.trigger=function(){return this.each(Grape.fn.trigger,arguments)};Grape.fn.trigger=function(c){if(c=="focus"){this.seed.focus();return this}if(c=="focusout"){this.seed.blur();return this}if(c=="blur"&&this.seed.blur){this.seed.blur();return this}if(c=="click"&&this.seed.click){this.seed.click();return this}c=raceme.dV(c,"");for(var d=0;d<this._events.length;d++){if(c==""||this._events[d]._id==c||this._events[d]._type==c){var a=raceme._newEvent(this._events[d]._type);this.seed.dispatchEvent(a)}}return this};GrapeGroup.fn.click=GrapeGroup.fn.clic=function(){return this.each(Grape.fn.click,arguments)};Grape.fn.click=Grape.fn.clic=function(c,d,a){if(arguments.length==0){return this.trigger("click")}a=raceme.dV(a,true);if(a===true){this.style("cursor","pointer")}return this.addEvent("click",c,d)};GrapeGroup.fn.dblclick=GrapeGroup.fn.dblclic=function(){return this.each(Grape.fn.dblclick,arguments)};Grape.fn.dblclick=Grape.fn.dblclic=function(c,d,a){if(arguments.length==0){return this.trigger("dblclick")}a=raceme.dV(a,false);if(a===true){this.style("cursor","pointer")}return this.addEvent("dblclick",c,d)};GrapeGroup.fn.dbltap=function(){return this.each(Grape.fn.dbltap,arguments)};Grape.fn.dbltap=function(a,d){var c=this;this.touchstart(function(f){if(!c.raceme_tmp_tapped){c.raceme_tmp_tapped=setTimeout(function(){c.raceme_tmp_tapped=null},300)}else{clearTimeout(c.raceme_tmp_tapped);c.raceme_tmp_tapped=null;a.call(c,f)}})};GrapeGroup.fn.fixedclic=GrapeGroup.fn.fixedclick=function(){return this.each(Grape.fn.fixedclic,arguments)};Grape.fn.fixedclic=Grape.fn.fixedclick=function(c,e,a){if(arguments.length==0){return this.trigger("fixedclic")}a=raceme.dV(a,true);if(a===true){this.style("cursor","pointer")}this.mousedown(function(f){this.temporal_cursor_position={x:f.clientX,y:f.clientY}});var d=this;return this.mouseup(function(f){if(this.temporal_cursor_position&&raceme.distance(this.temporal_cursor_position,{x:f.clientX,y:f.clientY})<6){c.call(d,f)}})};GrapeGroup.fn.mousedown=function(){return this.each(Grape.fn.mousedown,arguments)};Grape.fn.mousedown=function(a,c){if(arguments.length==0){return this.trigger("mousedown")}return this.addEvent("mousedown",a,c)};GrapeGroup.fn.touchstart=function(){return this.each(Grape.fn.touchstart,arguments)};Grape.fn.touchstart=function(a,c){if(arguments.length==0){return this.trigger("touchstart")}return this.addEvent("touchstart",a,c,{passive:true})};GrapeGroup.fn.mouseup=function(){return this.each(Grape.fn.mouseup,arguments)};Grape.fn.mouseup=function(a,c){if(arguments.length==0){return this.trigger("mouseup")}return this.addEvent("mouseup",a,c)};GrapeGroup.fn.touchend=function(){return this.each(Grape.fn.touchend,arguments)};Grape.fn.touchend=function(a,c){if(arguments.length==0){return this.trigger("touchend")}return this.addEvent("touchend",a,c)};GrapeGroup.fn.mousemove=function(){return this.each(Grape.fn.mousemove,arguments)};Grape.fn.mousemove=function(a,c){if(arguments.length==0){return this.trigger("mousemove")}return this.addEvent("mousemove",a,c)};GrapeGroup.fn.touchmove=function(){return this.each(Grape.fn.touchmove,arguments)};Grape.fn.touchmove=function(a,c){if(arguments.length==0){return this.trigger("touchmove")}return this.addEvent("touchmove",a,c)};GrapeGroup.fn.mouseover=function(){return this.each(Grape.fn.mouseover,arguments)};Grape.fn.mouseover=function(a,c){if(arguments.length==0){return this.trigger("mouseover")}return this.addEvent("mouseover",a,c)};GrapeGroup.fn.mouseenter=function(){return this.each(Grape.fn.mouseenter,arguments)};Grape.fn.mouseenter=function(a,c){if(arguments.length==0){return this.trigger("mouseenter")}return this.addEvent("mouseenter",a,c)};GrapeGroup.fn.mouseleave=function(){return this.each(Grape.fn.mouseleave,arguments)};Grape.fn.mouseleave=function(a,c){if(arguments.length==0){return this.trigger("mouseleave")}return this.addEvent("mouseleave",a,c)};GrapeGroup.fn.mouseout=function(){return this.each(Grape.fn.mouseout,arguments)};Grape.fn.mouseout=function(a,c){if(arguments.length==0){return this.trigger("mouseout")}return this.addEvent("mouseout",a,c)};GrapeGroup.fn.mousewheel=function(){return this.each(Grape.fn.mousewheel,arguments)};Grape.fn.mousewheel=function(c,d,a){if(arguments.length==0){this.trigger("mousewheel");this.trigger("DOMMouseScroll")}this.addEvent("mousewheel",c,d,a);return this.addEvent("DOMMouseScroll",c,d,a)};GrapeGroup.fn.drag=function(){return this.each(Grape.fn.drag,arguments)};Grape.fn.drag=function(d,c,a){if(typeof d=="undefined"){return this}var e=this;this.touchstart(function(f){d.call(e,f);e._initDrag(f,c,a)});return this.mousedown(function(f){if(f.which!=3){d.call(e,f);e._initDrag(f,c,a)}})};GrapeGroup.fn.change=function(){return this.each(Grape.fn.change,arguments)};Grape.fn.change=function(a,c){if(arguments.length==0){return this.trigger("change")}return this.addEvent("change",a,c)};GrapeGroup.fn.load=function(){return this.each(Grape.fn.load,arguments)};Grape.fn.load=function(a,c){if(arguments.length==0){return this.trigger("load")}return this.addEvent("load",a,c)};GrapeGroup.fn.paste=function(){return this.each(Grape.fn.paste,arguments)};Grape.fn.paste=function(a,c){if(arguments.length==0){return this.trigger("paste")}return this.addEvent("paste",a,c)};GrapeGroup.fn.blur=function(){return this.each(Grape.fn.blur,arguments)};Grape.fn.blur=function(a,c){if(arguments.length==0){return this.trigger("blur")}return this.addEvent("blur",a,c)};GrapeGroup.fn.focus=function(){return this.each(Grape.fn.focus,arguments)};Grape.fn.focus=function(a,c){if(arguments.length==0){return this.trigger("focus")}return this.addEvent("focus",a,c)};GrapeGroup.fn.focusout=function(){return this.each(Grape.fn.focusout,arguments)};Grape.fn.focusout=function(a,c){if(arguments.length==0){return this.trigger("focusout")}return this.addEvent("focusout",a,c)};GrapeGroup.fn.keypress=function(){return this.each(Grape.fn.keypress,arguments)};Grape.fn.keypress=function(a,c){if(arguments.length==0){return this.trigger("keypress")}return this.addEvent("keypress",a,c)};GrapeGroup.fn.keydown=function(){return this.each(Grape.fn.keydown,arguments)};Grape.fn.keydown=function(a,c){if(arguments.length==0){return this.trigger("keydown")}return this.addEvent("keydown",a,c)};GrapeGroup.fn.keyup=function(){return this.each(Grape.fn.keyup,arguments)};Grape.fn.keyup=function(a,c){if(arguments.length==0){return this.trigger("keyup")}return this.addEvent("keyup",a,c)};GrapeGroup.fn.select=function(){return this.each(Grape.fn.select,arguments)};Grape.fn.select=function(a,c){if(arguments.length==0){return this.trigger("select")}return this.addEvent("select",a,c)};GrapeGroup.fn.input=function(){return this.each(Grape.fn.input,arguments)};Grape.fn.input=function(a,c){if(arguments.length==0){return this.trigger("input")}return this.addEvent("input",a,c)};GrapeGroup.fn.scroll=function(){return this.each(Grape.fn.scroll,arguments)};Grape.fn.scroll=function(a,c){if(arguments.length==0){return this.trigger("input")}return this.addEvent("scroll",a,c)};GrapeGroup.fn.error=function(){return this.each(Grape.fn.error,arguments)};Grape.fn.error=function(a,c){if(arguments.length==0){return this.trigger("input")}return this.addEvent("error",a,c)};GrapeGroup.fn.drop=function(){return this.each(Grape.fn.drop,arguments)};Grape.fn.drop=function(a,c){if(arguments.length==0){return this.trigger("drop")}return this.addEvent("drop",a,c)};GrapeGroup.fn.draggable=function(){return this.each(Grape.fn.draggable,arguments)};Grape.fn.draggable=function(a){if(typeof a!=="undefined"&&a==false){this.attr("draggable","false");return this}this.attr("draggable","true");this.addEvent("dragstart",function(d){var c=this;if(this._hideDragGhost){var f=document.createElement("img");f.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";d.dataTransfer.setDragImage(f,0,0)}if(this._cloneable){c=this.clone();if(this._allowedDragGroup){c._allowedDragGroup=this._allowedDragGroup}if(this._onDragEnd_callback){c._onDragEnd_callback=this._onDragEnd_callback}if(this._onDragStart_callback){c._onDragStart_callback=this._onDragStart_callback}if(this._onClone_callback){this._onClone_callback(this,c)}c.draggable()}window._dragged_element=c;if(this._onDragStart_callback){this._onDragStart_callback(this)}});this.addEvent("dragend",function(c){if(this._onDragEnd_callback){this._onDragEnd_callback(this)}window._dragged_element=null});return this};GrapeGroup.fn.dragGroup=function(){return this.each(Grape.fn.dragGroup,arguments)};Grape.fn.dragGroup=function(a){this._allowedDragGroup=a;return this};GrapeGroup.fn.hideDragGhost=function(){return this.each(Grape.fn.hideDragGhost,arguments)};Grape.fn.hideDragGhost=function(){this._hideDragGhost=true;return this};GrapeGroup.fn.droppable=function(){return this.each(Grape.fn.droppable,arguments)};Grape.fn.droppable=function(a){var c=this;if(typeof a!=="undefined"&&a==false){this._droppable=false;return this}this._allowedDragGroup=a;this._droppable=true;this.addEvent("drop",function(d){if(d.stopPropagation){d.stopPropagation()}});this.addEvent("dragenter",function(f){f.preventDefault();if(typeof window._dragged_element!=="undefined"&&window._dragged_element!=null){var d=window._dragged_element;if(c._allowedDragGroup&&d._allowedDragGroup!=c._allowedDragGroup){return}if(!d.getParent()||!d.isChildOf(this.getParent())){d.addTo(this)}}});this.addEvent("dragleave",function(g){var g=g.originalEvent||g;var f=document.elementFromPoint(g.pageX,g.pageY);if(f&&!this.seed.contains(f)){var d=window._dragged_element;if(c._allowedDragGroup&&d._allowedDragGroup!=c._allowedDragGroup){return}if(d&&d.getParent()&&d.isChildOf(this)){this.removeChild(d)}}});return this};GrapeGroup.fn.cloneable=function(){return this.each(Grape.fn.cloneable,arguments)};Grape.fn.cloneable=function(a){if(typeof a!=="undefined"&&a==false){this._cloneable=false;return this}this._cloneable=true;return this};GrapeGroup.fn.sortable=function(){return this.each(Grape.fn.sortable,arguments)};Grape.fn.sortable=function(){var a=this;this.addEvent("dragstart",function(c){window._sortable_element=new Grape(c.target);if(a._onSortStart_callback){a._onSortStart_callback(window._sortable_element)}});this.addEvent("dragend",function(c){if(a._onSortEnd_callback){a._onSortEnd_callback(window._sortable_element)}window._sortable_element=null});this.addEvent("dragover",function(f){f.preventDefault();if(typeof window._sortable_element!=="undefined"&&window._sortable_element!=null){var c=window._sortable_element;if(a._allowedDragGroup&&c._allowedDragGroup!=a._allowedDragGroup){return}if(!c.getParent()||!c.isChildOf(this.getParent())){return}if(f.target&&new Grape(f.target).attr("draggable")=="true"){var d=new Grape(f.target);if(d.seed!=c.seed&&f.target!=f.currentTarget){if(c.isBeforeOf(d)){d.getParent().seed.insertBefore(c.seed,d.seed)}else{d.getParent().seed.insertBefore(c.seed,d.seed.nextElementSibling)}if(a._onSort_callback){a._onSort_callback(c)}}}}});return this};GrapeGroup.fn.onSortStart=function(){return this.each(Grape.fn.onSortStart,arguments)};Grape.fn.onSortStart=function(a){this._onSortStart_callback=a;return this};GrapeGroup.fn.onSortEnd=function(){return this.each(Grape.fn.onSortEnd,arguments)};Grape.fn.onSortEnd=function(a){this._onSortEnd_callback=a;return this};GrapeGroup.fn.onClone=function(){return this.each(Grape.fn.onClone,arguments)};Grape.fn.onClone=function(a){this._onClone_callback=a;return this};GrapeGroup.fn.onSort=function(){return this.each(Grape.fn.onSort,arguments)};Grape.fn.onSort=function(a){this._onSort_callback=a;return this};GrapeGroup.fn.onDragStart=function(){return this.each(Grape.fn.onDragStart,arguments)};Grape.fn.onDragStart=function(a){this._onDragStart_callback=a;return this};GrapeGroup.fn.onDragEnd=function(){return this.each(Grape.fn.onDragEnd,arguments)};Grape.fn.onDragEnd=function(a){this._onDragEnd_callback=a;return this};GrapeGroup.fn.animate=function(d,a){var c=new AnimationGroup(this,d,a);this._animations.push(c);return c};Grape.fn.animate=function(d,a){var c=new GrapeAnimation(this,d,a);this._animations.push(c);return c};GrapeGroup.fn.delay=function(a){return this.animate(0,a)};Grape.fn.delay=function(a){return this.animate(0,a)};GrapeGroup.fn.ease=function(){return this.eachAnimation(AnimationGroup.fn.ease,arguments)};Grape.fn.ease=function(){return this.eachAnimation(GrapeAnimation.fn.ease,arguments)};GrapeGroup.fn.stop=function(){return this.eachAnimation(AnimationGroup.fn.stop)};Grape.fn.stop=function(){return this.eachAnimation(GrapeAnimation.fn.stop)};GrapeGroup.fn.restart=function(){return this.eachAnimation(AnimationGroup.fn.restart)};Grape.fn.restart=function(){return this.eachAnimation(GrapeAnimation.fn.restart)};GrapeGroup.fn.pause=function(){return this.eachAnimation(AnimationGroup.fn.pause,arguments)};Grape.fn.pause=function(){return this.eachAnimation(GrapeAnimation.fn.pause,arguments)};GrapeGroup.fn.resume=function(){return this.eachAnimation(AnimationGroup.fn.resume)};Grape.fn.resume=function(){return this.eachAnimation(GrapeAnimation.fn.resume)};GrapeGroup.fn.togglePause=function(){return this.eachAnimation(AnimationGroup.fn.togglePause)};Grape.fn.togglePause=function(){return this.eachAnimation(GrapeAnimation.fn.togglePause)};GrapeGroup.fn.item=function(a){if(this.length==0){return null}if(typeof a==="undefined"){return this.item(this.length-1)}if(a>=0&&a<this.length){return this._items[a]}return null};GrapeGroup.fn.putFirst=function(c){if(c>=0&&c<this.length){var a=this._items[c];this._items.splice(c,1);this._items.unshift(a)}return this};GrapeGroup.fn.each=function(a,c){for(var d=0;d<this.length;d++){a.apply(this._items[d],c)}return this};GrapeGroup.fn.sort=function(a){this._items.sort(a);return this};GrapeGroup.fn.eachValue=function(c,d,a){if(typeof a==="undefined"){for(var e=0;e<this.length&&e<d.length;e++){c.call(this._items[e],d[e])}}else{for(var e=0;e<this.length&&e<d.length;e++){c.call(this._items[e],a,d[e])}}return this};GrapeGroup.fn.eachAnimation=function(a,c){for(var d=0;d<this._animations.length;d++){a.apply(this._animations[d],c)}return this};GrapeGroup.fn.lastItem=function(){return this.item()};GrapeGroup.fn.firstItem=function(){return this.item(0)};GrapeGroup.fn.push=function(c){if(typeof c==="undefined"){return this}if(typeof c._items!=="undefined"){for(var a=0;a<c.length;a++){this.push(c._items[a])}}else{this._items.push(c);this.length++}return this};GrapeGroup.fn._applyFunction=function(a,c){if(typeof c[0]!=="undefined"){if(raceme._likeArray(c[0])===false){return this.each(a,c)}return this.eachValue(a,c[0])}var d=[];this.each(function(){d.push(a.call(this))});return d};Grape.fn.save=function(a){a=raceme.dV(a,"svg.svg");var c=document.createElement("a");c.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent((new XMLSerializer()).serializeToString(this.seed)));c.setAttribute("download",a);c.click()};Grape.fn.addChild=function(e){var d=this;if(e instanceof Grape){if(this.pixi&&e.pixi){if(e.tagName()=="canvas"){this.seed.appendChild(e.pixi.view);return this}else{if(this.tagName()=="canvas"){this.pixi.stage.addChild(e.pixi);return this}else{this.pixi.addChild(e.pixi)}}}this.seed.appendChild(e.seed)}else{if(e instanceof GrapeGroup){e.each(function(){d.addChild(this)})}else{if(typeof e==="string"){var c;var a;if(window.DOMParser){c=new DOMParser();a=c.parseFromString(e,"application/xml")}else{a=new ActiveXObject("Microsoft.XMLDOM");a.async=false;a.loadXML(e)}if(a.documentElement.tagName=="svg"){a.documentElement.style.setProperty("overflow","hidden")}this.seed.appendChild(a.documentElement)}else{if(e.nodeType){if(e.nodeType==9){if(e.documentElement.tagName=="svg"){e.documentElement.style.setProperty("overflow","hidden")}this.seed.appendChild(e.documentElement)}else{if(e.nodeType==1){if(e.tagName=="svg"){e.style.setProperty("overflow","hidden")}this.seed.appendChild(e)}}}}}}return this};Grape.fn.removeChild=function(a){if(a instanceof Grape){this.seed.removeChild(a.seed);if(this.pixi&&a.pixi){this.pixi.removeChild(a.pixi)}}return this};Grape.fn.replace=function(a){if(a instanceof Grape){if(this.seed.parentNode){this.seed.parentNode.replaceChild(a.seed,this.seed)}return a}return this};GrapeGroup.fn.filter=function(){return this.each(Grape.fn.filter,arguments)};Grape.fn.filter=function(c){if(c instanceof Grape&&c.tagName()=="filter"){var a=c.id();if(a===""){a=raceme._generateId();c.id(a)}this.style("filter","url(#"+a+")")}else{if(typeof c==="string"&&raceme.by("id:"+c) instanceof Grape&&raceme.by("id:"+c).tagName()=="filter"){this.style("filter","url(#"+c+")")}}return this};Grape.fn.fe=function(a){if(this.tagName()==="filter"){return new Grape(a).addTo(this)}else{if(this.getParent().tagName()==="filter"){return new Grape(a).addTo(this.getParent())}}return this};Grape.fn.blend=function(){return this.fe("feBlend")};Grape.fn.colorMatrix=function(){return this.fe("feColorMatrix")};Grape.fn.componentTransfer=function(){return this.fe("feComponentTransfer")};Grape.fn.funcA=function(){if(this.tagName()==="feComponentTransfer"){return new Grape("feFuncA").addTo(this)}else{if(this.tagName().substr(0,this.tagName().length-1)==="feFunc"&&this.getParent().tagName()==="feComponentTransfer"){this.getParent().funcA()}}return this};Grape.fn.funcR=function(){if(this.tagName()==="feComponentTransfer"){return new Grape("feFuncR").addTo(this)}else{if(this.tagName().substr(0,this.tagName().length-1)==="feFunc"&&this.getParent().tagName()==="feComponentTransfer"){this.getParent().funcR()}}return this};Grape.fn.funcG=function(){if(this.tagName()==="feComponentTransfer"){return new Grape("feFuncG").addTo(this)}else{if(this.tagName().substr(0,this.tagName().length-1)==="feFunc"&&this.getParent().tagName()==="feComponentTransfer"){this.getParent().funcG()}}return this};Grape.fn.funcB=function(){if(this.tagName()==="feComponentTransfer"){return new Grape("feFuncB").addTo(this)}else{if(this.tagName().substr(0,this.tagName().length-1)==="feFunc"&&this.getParent().tagName()==="feComponentTransfer"){this.getParent().funcB()}}return this};Grape.fn.composite=function(){return this.fe("feComposite")};Grape.fn.convolveMatrix=function(){return this.fe("feConvolveMatrix")};Grape.fn.diffuseLighting=function(){return this.fe("feDiffuseLighting")};Grape.fn.displacementMap=function(){return this.fe("feDisplacementMap")};Grape.fn.flood=function(){return this.fe("feFlood")};Grape.fn.gaussianBlur=function(){return this.fe("feGaussianBlur")};Grape.fn.merge=function(){return this.fe("feMerge")};Grape.fn.morphology=function(){return this.fe("feMorphology")};Grape.fn.offset=function(){return this.fe("feOffset")};Grape.fn.specularLighting=function(){return this.fe("feSpecularLighting")};Grape.fn.tile=function(){return this.fe("feTile")};Grape.fn.turbulence=function(){return this.fe("feTurbulence")};Grape.fn.mergeNode=function(){if(this.tagName()==="feMerge"){return new Grape("feMergeNode").addTo(this)}else{if(this.tagName()==="feMergeNode"&&this.getParent().tagName()==="feMerge"){return this.getParent().mergeNode()}}return this};Grape.fn.shadow=function(d,c,f,e){if(this.tagName()==="filter"){d=raceme.dV(d,0);c=raceme.dV(c,0);f=raceme.dV(f,1);e=raceme.dV(e,1);this.gaussianBlur().attr("in","SourceAlpha").attr("stdDeviation",f);this.offset().attr("dx",d).attr("dy",c).attr("result","offsetblur");this.componentTransfer().funcA().attr("type","linear").attr("slope",e);this.merge().mergeNode().mergeNode().attr("in","SourceGraphic");if(this.getParent()&&this.getParent().pixi&&PIXI.filters.DropShadowFilter){var a=raceme.rect2polar(d,c);this.getParent().pixi.filters=[new PIXI.filters.DropShadowFilter({alhpa:e/2,blur:f/2,rotation:a.angle,distance:a.r})]}return this}else{if(this.getParent()&&this.getParent().tagName()==="filter"){return this.getParent().shadow(d,c,f,e)}}return this};Grape.fn.getPolygon=function(c){c=raceme.dV(c,true);var e=new raceme.Polygon();if(this.tagName()=="path"){var h=this.seed;var a=h.getTotalLength();var g=h.getPointAtLength(0);var f=Math.max(parseInt(a/50),1);if(c){e.add(raceme._elementPoint(this.seed,g.x,g.y))}else{e.add({x:g.x,y:g.y})}for(var d=1;d<a;d+=f){g=h.getPointAtLength(d);if(c){e.add(raceme._elementPoint(this.seed,g.x,g.y))}else{e.add({x:g.x,y:g.y})}}}if(e.item(0).x!=e.item(e.length-1).x||e.item(0).y!=e.item(e.length-1).y){e.add({x:e.item(0).x,y:e.item(0).y})}return e};Grape.fn.getSubPaths=function(){var a=null;var l=null;var k=true;var c=new Array();if(this.tagName()=="path"){var h=this.attr("d");h=h.split(/z|Z/);for(var f=0;f<h.length-1;f++){c[f]=new raceme.Polygon();h[f]=h[f].split(" ");for(var e=0;e<h[f].length;e++){var g=h[f][e].split(",");if(g.length==2){if(a===null||k==false){a=parseFloat(g[0]);l=parseFloat(g[1])}else{a+=parseFloat(g[0]);l+=parseFloat(g[1])}c[f].add({x:a,y:l})}else{if(g.length==1){if(g[0]=="l"||g[0]=="m"){k=true}else{if(g[0]=="M"||g[0]=="L"){k=false}else{if(g[0]!==""&&typeof h[f][e+1]!=="undefined"&&isNaN(g[0])==false){if(a===null||k==false){a=parseFloat(h[f][e]);l=parseFloat(h[f][e+1])}else{a+=parseFloat(h[f][e]);l+=parseFloat(h[f][e+1])}e++;c[f].add({x:a,y:l})}}}}}}if(c[f].item(c[f].length-1).x!=c[f].item(0).x||c[f].item(c[f].length-1).y!=c[f].item(0).y){c[f].add({x:c[f].item(0).x,y:c[f].item(0).y})}}}return c};raceme.subpaths2path=function(d){var a="";var k=0;var h=0;for(var e=0;e<d.length;e++){a+="m ";for(var c=0;c<d[e].length;c++){var g=d[e].item(c).x-k;var f=d[e].item(c).y-h;a+=raceme._round(g,1)+","+raceme._round(f,1)+" ";k=d[e].item(c).x;h=d[e].item(c).y}if(e==d.length-1){a+="z"}else{a+="z "}}return a};Grape.fn.tagName=function(){if(this.seed.tagName=="CANVAS"){return"canvas"}return this.seed.tagName};Grape.fn.id=function(a){return this.attr("id",a)};Grape.fn.viewbox=function(c,f,d,a){if(raceme._clearString(this.tagName())==="svg"){var e=this.seed.viewBox.baseVal||{x:0,y:0,width:0,height:0};if(typeof c==="undefined"){return e}e.x=c;if(typeof f!=="undefined"){e.y=f}if(typeof d!="undefined"){e.width=d}if(typeof a!="undefined"){e.height=a}return this.attr("viewBox",e.x+" "+e.y+" "+e.width+" "+e.height)}return this};Grape.fn.point=function(a,c){return raceme._elementPoint(this.seed,a,c)};Grape.fn.selectedIndex=function(){return this.seed.selectedIndex};Grape.fn.selectedValue=function(){return this.seed.options[this.selectedIndex()].value};Grape.fn.selectedText=function(){return this.seed.options[this.selectedIndex()].text};Grape.fn.enable=function(){this.seed.disabled=false;return this};Grape.fn.enabled=function(){return !this.seed.disabled};Grape.fn.disable=function(){this.seed.disabled=true;return this};Grape.fn.disabled=function(){return this.seed.disabled};Grape.fn.checked=function(){return this.seed.checked};Grape.fn.clearOptions=function(){this.seed.options.length=0;return this};Grape.fn.pushOption=function(c,a){this.seed.options[this.seed.options.length]=new Option(c,a)};Grape.fn.value=function(a){if(typeof a==="undefined"){return this.seed.value}this.seed.value=a;return this};GrapeGroup.fn.topOffset=function(){return this._applyFunction(Grape.fn.topOffset,arguments)};Grape.fn.topOffset=function(a){if(typeof a!=="undefined"){if(this.seed.offsetParent){this.seed.offsetParent.scrollTop=this.seed.offsetTop-a}}else{return this.seed.offsetTop-this.seed.offsetParent.scrollTop}};GrapeGroup.fn.scrollTop=function(){return this._applyFunction(Grape.fn.scrollTop,arguments)};Grape.fn.scrollTop=function(a){if(typeof a!=="undefined"){this.seed.scrollTop=a}else{return this.seed.scrollTop}return this};Grape.fn.eachAnimation=function(a,c){for(var d=0;d<this._animations.length;d++){a.apply(this._animations[d],c)}return this};Grape.fn._applyStrokeandFill=function(a){if(this.current_stroke_thickness!=0&&this.current_stroke_color!="none"){if(this.current_stroke_color!="none"){a.attr("stroke",this.current_stroke_color)}if(this.current_stroke_thickness!=1){a.attr("stroke-width",this.current_stroke_thickness);if(this.current_stroke_caps!="butt"){a.attr("stroke-linecap",this.current_stroke_caps)}if(this.current_stroke_joints!="miter"){a.attr("stroke-linejoin",this.current_stroke_joints)}if(this.current_stroke_miterLimit!=4){a.attr("stroke-miterlimit",this.current_stroke_miterLimit)}}if(this.current_stroke_alpha!=1){a.attr("stroke-opacity",this.current_stroke_alpha)}if(this.current_stroke_dasharray!="1"){a.attr("stroke-dasharray",this.current_stroke_dasharray)}}if(this.is_beginFill){a.style("fill",this.current_fill_color);if(this.current_fill_alpha!=1){a.style("fill-opacity",this.current_fill_alpha)}}if(a.pixi&&a.isShape&&a.redrawpixi){a.redrawpixi()}return this};Grape.fn.transform=function(a,f,d){if(typeof this._transform==="undefined"){this._transform=raceme._transform2obj(this.attr("transform"))}if(typeof f==="undefined"){return this._transform[a]}f=raceme._round(f,3);this._transform[a]=f;if(d){return this}if(this.seed instanceof SVGElement){this.attr("transform",raceme._obj2transform(this._transform))}else{this.style("transform",raceme._obj2transform(this._transform))}if(this.pixi){var e=0;var c=0;if(this.tagName()=="text"){if(this.attr("text-anchor")=="end"){e=this.pixi.getLocalBounds().width}else{if(this.attr("text-anchor")=="middle"){e=this.pixi.getLocalBounds().width/2}}if(this.attr("dominant-baseline")=="text-before-edge"||this.attr("dominant-baseline")=="baseline"){c=this.pixi.getLocalBounds().height}else{if(this.attr("dominant-baseline")=="central"){c=this.pixi.getLocalBounds().height/2}}}this.pixi.setTransform(this._transform.x,this._transform.y,this._transform.scalex,this._transform.scaley,this._transform.rotation*(Math.PI/180),this._transform.skewx,this._transform.skewy,e,c)}return this};Grape.fn._startPanning=function(a){this._panningX=a.clientX;this._panningY=a.clientY;if(a.touches&&a.touches[0]){this._panningX=a.touches[0].clientX;this._panningY=a.touches[0].clientY}if(this.startPanning!==null){this.startPanning.call(this,a)}return false};Grape.fn._changePanning=function(g){if(typeof this._panningX=="undefined"){this._panningX=g.clientX;this._panningY=g.clientY}var d=this._panningX-g.clientX;var c=this._panningY-g.clientY;var a=this.x()-d;var f=this.y()-c;a=Math.max(a,-(this._zoom_w*this.scale())+this._zoom_w-((this.scale()-1)*this._zoom_x));a=Math.min(a,-(this.scale()-1)*this._zoom_x);f=Math.max(f,-(this._zoom_h*this.scale())+this._zoom_h-((this.scale()-1)*this._zoom_y));f=Math.min(f,-(this.scale()-1)*this._zoom_y);this.move(a,f);this._panningX=g.clientX;this._panningY=g.clientY;if(this.changePanning!==null){this.changePanning.call(this,g)}return false};Grape.fn._endPanning=function(a){if(this.endPanning!==null){this.endPanning.call(this,a)}};Grape.fn._scrollMouse=function(a){if(raceme.wheelValue(a)!=0&&this._current_zooming==false){if(raceme.wheelValue(a)>0){this.setZoom(this.scale()+this._zoom_factor/2,true,a)}else{this.setZoom(this.scale()-this._zoom_factor/2,true,a)}}};Grape.fn._initDrag=function(f,d,c){if(f.button!=2){var g=this;var a=new Grape(document);if(typeof d!=="undefined"){a.touchmove(function(h){if(h.targetTouches[0]){d.call(g,h.targetTouches[0])}},"dragevents");a.mousemove(function(h){d.call(g,h)},"dragevents")}a.touchend(function(h){if(h.changedTouches[0]){g._endDrag(h.changedTouches[0],c,a)}},"dragevents");a.mouseup(function(h){g._endDrag(h,c,a)},"dragevents")}};Grape.fn._endDrag=function(d,c,a){var f=this;a.removeEvent("dragevents");if(typeof c!=="undefined"){c.call(this,d)}};GenericAnimation=function(){};GenericAnimation.fn=GenericAnimation.prototype;GenericAnimation.fn.constructor=GenericAnimation;GenericAnimation.fn.x=function(a){a=raceme.dV(a,0);this._start(a,Grape.fn.x);return this};GenericAnimation.fn.y=function(a){a=raceme.dV(a,0);this._start(a,Grape.fn.y);return this};GenericAnimation.fn.move=function(a,c){return this.x(a).y(c)};GenericAnimation.fn.rotate=function(a){a=raceme.dV(a,0);this._start(a,Grape.fn.rotation);return this};GenericAnimation.fn.scale=function(a){a=raceme.dV(a,1);this._start(a,Grape.fn.scale);return this};GenericAnimation.fn.scalex=function(a){a=raceme.dV(a,1);this._start(a,Grape.fn.scalex);return this};GenericAnimation.fn.scaley=function(a){a=raceme.dV(a,1);this._start(a,Grape.fn.scaley);return this};GenericAnimation.fn.skewx=function(a){a=raceme.dV(a,0);this._start(a,Grape.fn.skewx);return this};GenericAnimation.fn.skewy=function(a){a=raceme.dV(a,0);this._start(a,Grape.fn.skewy);return this};GenericAnimation.fn.topOffset=function(a){a=raceme.dV(a,0);this._start(a,Grape.fn.topOffset);return this};GenericAnimation.fn.scrollTop=function(a){a=raceme.dV(a,0);this._start(a,Grape.fn.scrollTop);return this};GenericAnimation.fn.fill=function(a){a=raceme.dV(a,0);this._start(a,Grape.fn.fill);return this};GenericAnimation.fn.attr=function(a,c){if(typeof a==="undefined"){return this}c=raceme.dV(c,0);this._start(c,Grape.fn.attr,a);return this};GenericAnimation.fn.style=function(a,c){if(typeof a==="undefined"||c===null){return this}c=raceme.dV(c,0);this._start(c,Grape.fn.style,a);return this};GenericAnimation.fn.opacity=function(a){return this.style("opacity",a)};GenericAnimation.fn.width=function(a){return this.attr("width",a)};GenericAnimation.fn.height=function(a){return this.attr("height",a)};GenericAnimation.fn.show=function(){this._start(null,Grape.fn.show)};GenericAnimation.fn.hide=function(){this._start(null,Grape.fn.hide)};GenericAnimation.fn.done=function(a){this._callback=a;return this};GenericAnimation.fn.meanwhile=function(a){this._meanwhile=a;return this};GenericAnimation.fn.stop=function(){if(this._next_animation){this._next_animation.stop()}if(this._interval!==null){raceme.clearInterval(this._interval)}this._interval=null;return this};GenericAnimation.fn.defrost=function(){if(this._freeze===true){this._start_time=Date.now()||new Date().getTime();this._delayed=0;this._finish=this._start_time+this._duration+this._init_delay;this._freeze=false;for(var a=0;a<this._freezeAnimations.length;a++){this._start(this._freezeAnimations[a].val,this._freezeAnimations[a].fun,this._freezeAnimations[a].attrPassed)}this._freezeAnimations=[]}return this};GenericAnimation.fn.frost=function(){this._freeze=true;return this};GenericAnimation.fn.animate=function(c,a){var d=new this.constructor(this._grape,c,a);d._freeze=true;this._next_animation=d;return d};GenericAnimation.fn.ease=function(c,a){this._easeFunction=raceme._getEaseFunction(c,a);return this};GenericAnimation.fn.pause=function(a){if(this._next_animation&&this._next_animation._freeze===false){this._next_animation.pause(a)}else{if(this._pause===false){this._pause=true;this._paused_moment=Date.now()||new Date().getTime();if(typeof a==="undefined"){this._is_time_delayed=false}else{this._is_time_delayed=true;this._delayed+=a}}else{if(typeof a!=="undefined"){this._is_time_delayed=true;this._delayed+=a}}}return this};GenericAnimation.fn.resume=function(){if(this._next_animation&&this._next_animation._freeze===false){this._next_animation.resume()}else{if(this._pause===true){var a=Date.now()||new Date().getTime();var c=(a)-this._paused_moment;this._finish+=c;this._is_time_delayed=false}this._pause=false}return this};GenericAnimation.fn.isPaused=function(){if(this._pause){return true}if(this._next_animation&&this._next_animation._freeze===false){return this._next_animation.isPaused()}return false};GenericAnimation.fn.togglePause=function(){if(this.isPaused()){return this.resume()}return this.pause()};GenericAnimation.fn.restart=function(){this.stop();if(this._next_animation){this._next_animation.frost();this._next_animation.restart()}if(this._concurrentAnimations.length>0){var a=[];for(var c=0;c<this._concurrentAnimations.length;c++){a[c]=this._concurrentAnimations[c]}this._concurrentAnimations=[];this._start_time=Date.now()||new Date().getTime();this._delayed=0;this._finish=this._start_time+this._duration+this._init_delay;for(var c=0;c<a.length;c++){if(raceme._likeArray(this._grape)){for(var d=0;d<this._grape.length;d++){if(a[c].attrPassed){a[c].fun.call(this._grape.item(d),a[c].attrPassed,a[c].init_value[d])}else{a[c].fun.call(this._grape.item(d),a[c].init_value[d])}}}else{if(a[c].attrPassed){a[c].fun.call(this._grape,a[c].attrPassed,a[c].init_value)}else{a[c].fun.call(this._grape,a[c].init_value)}}}for(var c=0;c<a.length;c++){this._start(a[c].val,a[c].fun,a[c].attrPassed)}}};AnimationGroup=function(a,d,c){this._grape=a;this._duration=raceme.dV(d,2000);this._easeFunction=raceme._getEaseFunction();this._init_delay=raceme.dV(c,0);this._delayed=0;this._is_time_delayed=false;this._dinterval=Math.min(16,this._duration);this._start_time=Date.now()||new Date().getTime();this._finish=this._start_time+this._duration+this._init_delay;this._interval=null;this._concurrentAnimations=[];this._freezeAnimations=[];this._freeze=false;this._pause=false;this._resume_pause_time=null};AnimationGroup.prototype=new GenericAnimation;AnimationGroup.fn=AnimationGroup.prototype;AnimationGroup.fn.constructor=AnimationGroup;AnimationGroup.fn._start=function(i,d,c){if(this._freeze===false){var a=[];for(var h=0;h<this._grape.length;h++){if(c){a[h]=d.call(this._grape.item(h),c)}else{a[h]=d.call(this._grape.item(h))}}var e=[];if(raceme._likeArray(i)){e=i}else{e=raceme._filledArray(this._grape.length,i)}for(var h=0;h<this._grape.length;h++){if(typeof e[h]==="string"&&e[h].length>2&&raceme._getRGB(e[h])===false){e[h]=raceme._getOperation(a[h],e[h])}}var g="number";if(raceme._getRGB(e[0])!==false){g="color"}this._concurrentAnimations.push({val:e,fun:d,attrPassed:c,init_value:a,value_type:g});if(this._interval===null){var j=this;this._interval=raceme.setInterval(function(){j._current_time=Date.now()||new Date().getTime();if(j._pause==false){if(j._current_time>j._start_time+j._init_delay+j._delayed){var n=1-(j._finish-j._current_time)/j._duration;var m=j._easeFunction(n);for(var k=0;k<j._grape.length;k++){for(var l=0;l<j._concurrentAnimations.length;l++){var f=j._concurrentAnimations[l];if(f.attrPassed){f.fun.call(j._grape.item(k),f.attrPassed,raceme.map(m,0,1,f.init_value[k],f.val[k]))}else{f.fun.call(j._grape.item(k),raceme.map(m,0,1,f.init_value[k],f.val[k]))}}}if(typeof j._meanwhile!=="undefined"&&j._meanwhile!==null){j._meanwhile.call(j._grape,n,m)}if(j._current_time>j._finish){for(var k=0;k<j._grape.length;k++){for(var l=0;l<j._concurrentAnimations.length;l++){var f=j._concurrentAnimations[l];if(f.attrPassed){f.fun.call(j._grape.item(k),f.attrPassed,f.val[k])}else{f.fun.call(j._grape.item(k),f.val[k])}}}raceme.clearInterval(j._interval);j._interval=null;if(typeof j._callback!=="undefined"){j._callback.call(j._grape)}if(j._next_animation instanceof AnimationGroup){j._next_animation.defrost()}}}}else{if(j._is_time_delayed==true&&j._current_time>j._start_time+j._init_delay+j._delayed){j.resume()}}},this._dinterval)}}else{this._freezeAnimations.push({val:i,fun:d,attrPassed:c})}};GrapeAnimation.prototype=new GenericAnimation;GrapeAnimation.fn=GrapeAnimation.prototype;GrapeAnimation.fn.constructor=GrapeAnimation;function GrapeAnimation(a,d,c){this._grape=a;this._duration=raceme.dV(d,2000);this._easeFunction=raceme._getEaseFunction();this._init_delay=raceme.dV(c,0);this._delayed=0;this._is_time_delayed=false;this._dinterval=Math.min(16,this._duration);this._start_time=Date.now()||new Date().getTime();this._finish=this._start_time+this._duration+this._init_delay;this._interval=null;this._concurrentAnimations=[];this._freezeAnimations=[];this._freeze=false;this._pause=false;this._resume_pause_time=null}GrapeAnimation.fn._start=function(f,c,a){if(this._freeze===false){var e;if(f!==null){if(a){e=c.call(this._grape,a)}else{e=c.call(this._grape)}}var d="number";if(typeof f==="string"&&f.length>2&&raceme._getRGB(f)===false){f=raceme._getOperation(e,f)}this._concurrentAnimations.push({val:f,fun:c,attrPassed:a,init_value:e,value_type:d});if(this._interval===null){var g=this;this._interval=raceme.setInterval(function(){g._current_time=Date.now()||new Date().getTime();if(g._pause==false){if(g._current_time>g._start_time+g._init_delay+g._delayed){var k=1-(g._finish-g._current_time)/g._duration;var j=g._easeFunction(k);for(var i=0;i<g._concurrentAnimations.length;i++){var h=g._concurrentAnimations[i];if(h.val!==null){if(h.attrPassed){h.fun.call(g._grape,h.attrPassed,raceme.map(j,0,1,h.init_value,h.val))}else{h.fun.call(g._grape,raceme.map(j,0,1,h.init_value,h.val))}}}if(typeof g._meanwhile!=="undefined"&&g._meanwhile!==null){g._meanwhile.call(g._grape,k,j)}if(g._current_time>g._finish){for(var i=0;i<g._concurrentAnimations.length;i++){var h=g._concurrentAnimations[i];if(h.attrPassed){h.fun.call(g._grape,h.attrPassed,h.val)}else{h.fun.call(g._grape,h.val)}}raceme.clearInterval(g._interval);g._interval=null;if(typeof g._callback!=="undefined"){g._callback.call(g._grape)}if(g._next_animation instanceof GrapeAnimation){g._next_animation.defrost()}}}}else{if(g._is_time_delayed==true&&g._current_time>g._start_time+g._init_delay+g._delayed){g.resume()}}},this._dinterval)}}else{this._freezeAnimations.push({val:f,fun:c,attrPassed:a})}};raceme._execute_main_scripts=function(){window.racemedomobserver=new MutationObserver(function(e,d){e.forEach(function(g){if(g.type=="childList"){var f;for(f=0;f<g.removedNodes.length;f++){new Grape(g.removedNodes[f])._isInDOM=false}for(f=0;f<g.addedNodes.length;f++){raceme._applyAttributesandStyle(g.addedNodes[f])}}})});racemedomobserver.observe(document.documentElement,{attributes:false,childList:true,subtree:true});raceme.by("svg").style("overflow","hidden");var c=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=c;if(typeof _main_scripts!=="undefined"){for(var a=0;a<_main_scripts.length;a++){_main_scripts[a].call(window)}}};raceme._applyAttributesandStyle=function(c){if(c.nodeType==3){return}var g=new Grape(c);g._isInDOM=true;var f=Object.keys(g._raceme_attributes);var a;var d;for(a=0;a<f.length;a++){d=f[a];if(g.tagName()!="canvas"){try{if(d=="href"&&(g.tagName()=="image"||g.tagName()=="filter"||g.tagName()=="textPath")){g.seed.setAttributeNS("http://www.w3.org/1999/xlink",d,g._raceme_attributes[d])}else{g.seed.setAttribute(d,g._raceme_attributes[d])}}catch(h){console.log(h)}}}var f=Object.keys(g._raceme_styles);if(g.seed.style){for(a=0;a<f.length;a++){d=f[a];g.seed.style.setProperty(d,g._raceme_styles[d].toString(),"")}}g.getChildren().each(function(){raceme._applyAttributesandStyle(this.seed)})};restart=function(){if(this instanceof Grape||this instanceof GrapeGroup){this.restart()}};raceme._generateId=function(){var c=new Date().getTime();var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var d=(c+Math.random()*16)%16|0;c=Math.floor(c/16);return(e=="x"?d:(d&7|8)).toString(16)});return a};raceme._getEaseFunction=function(c,a){c=raceme.dV(c,"linear");if(c=="linear"){return raceme.linear_function}a=raceme.dV(a,"cube");if(c=="inBounce"){return raceme.inBounce}if(c=="bounce"||c=="outBounce"){return raceme.outBounce}if(c=="inoutBounce"){return raceme.inoutBounce}if(a=="sin"){if(c=="inout"){return raceme.inoutSin}if(c=="in"){return raceme.inSin}return raceme.outSin}if(a=="quad"){if(c=="inout"){return raceme.inoutQuad}if(c=="in"){return raceme.inQuad}return raceme.outQuad}if(a=="cube"){if(c=="inout"){return raceme.inoutCube}if(c=="in"){return raceme.inCube}return raceme.outCube}if(a=="qrt"){if(c=="inout"){return raceme.inoutQrt}if(c=="in"){return raceme.inQrt}return raceme.outQrt}if(a=="qnt"){if(c=="inout"){return raceme.inoutQnt}if(c=="in"){return raceme.inQnt}return raceme.outQnt}if(a=="expo"){if(c=="inout"){return raceme.inoutExpo}if(c=="in"){return raceme.inExpo}return outExpo}if(a=="circ"){if(c=="inout"){return raceme.inoutCirc}if(c=="in"){return raceme.inCirc}}return raceme.linear_function};raceme._check=function(a){a=raceme.dV(a,0);return Math.max(0,Math.min(1,a))};raceme.linear_function=function(a){a=raceme._check(a);return a};raceme.inoutSin=function(a){a=raceme._check(a);return -0.5*(Math.cos(Math.PI*a)-1)};raceme.inSin=function(a){a=raceme._check(a);return -Math.cos(a*Math.PI/2)+1};raceme.outSin=function(a){a=raceme._check(a);return Math.sin(a*Math.PI/2)};raceme.inoutQuad=function(a){a=raceme._check(a);if((a/=0.5)<1){return 0.5*a*a}return -0.5*(--a*(a-2)-1)};raceme.inQuad=function(a){a=raceme._check(a);return a*a};raceme.outQuad=function(a){a=raceme._check(a);return -a*(a-2)};raceme.inoutCube=function(a){a=raceme._check(a);if((a/=0.5)<1){return 0.5*a*a*a}a-=2;return 0.5*(a*a*a+2)};raceme.inCube=function(a){a=raceme._check(a);return a*a*a};raceme.outCube=function(a){a=raceme._check(a);return --a*a*a+1};raceme.inoutQrt=function(a){a=raceme._check(a);if((a/=0.5)<1){return 0.5*a*a*a*a}a-=2;return -0.5*(a*a*a*a-2)};raceme.inQrt=function(a){a=raceme._check(a);return a*a*a*a};raceme.outQrt=function(a){a=raceme._check(a);return -(--a*a*a*a-1)};raceme.inoutQnt=function(a){a=raceme._check(a);if((a/=0.5)<1){return 0.5*a*a*a*a*a}a-=2;return 0.5*(a*a*a*a*a+2)};raceme.inQnt=function(a){a=raceme._check(a);return a*a*a*a*a};raceme.outQnt=function(a){a=raceme._check(a);return --a*a*a*a*a+1};raceme.inoutExpo=function(a){a=raceme._check(a);if((a/=0.5)<1){return 0.5*Math.pow(2,10*(a-1))}a--;return 0.5*(-Math.pow(2,-10*a)+2)};raceme.inExpo=function(a){a=raceme._check(a);return Math.pow(2,10*(a-1))};raceme.outExpo=function(a){a=raceme._check(a);return -Math.pow(2,-10*a)+1};raceme.inoutCirc=function(a){a=raceme._check(a);if((a/=0.5)<1){return -0.5*(Math.sqrt(1-a*a)-1)+b}a-=2;return 0.5*(Math.sqrt(1-a*a)+1)};raceme.inCirc=function(a){a=raceme._check(a);return -(Math.sqrt(1-a*a)-1)};raceme.outCirc=function(a){a=raceme._check(a);return Math.sqrt(1-(--a*a))};raceme.inBounce=function(a){a=raceme._check(a);return 1-raceme.outBounce(1-a)};raceme.outBounce=function(a){a=raceme._check(a);if(a<(1/2.75)){return(7.5625*a*a)}else{if(a<(2/2.75)){return(7.5625*(a-=(1.5/2.75))*a+0.75)}else{if(a<(2.5/2.75)){return(7.5625*(a-=(2.25/2.75))*a+0.9375)}else{return(7.5625*(a-=(2.625/2.75))*a+0.984375)}}}};raceme.inoutBounce=function(a){a=raceme._check(a);if(a<0.5){return raceme.inBounce(a*2)*0.5}return raceme.outBounce(a*2-1)*0.5+0.5};raceme._clearString=function(a){if(typeof a!=="string"){a=a.toString()}return a.replace(/^\s+|\s+$/g,"").toLowerCase()};raceme._string2clearArray=function(e,d){var c=e.split(d);var a=c.length;while(--a>=0){c[a]=raceme._clearString(c[a])}return c};raceme._filledArray=function(a,d){var c=new Array(a);while(--a>=0){c[a]=d}return c};raceme._RGBColor=function(d,c,a){this.r=raceme.dV(d,0);this.g=raceme.dV(c,0);this.b=raceme.dV(a,0)};raceme._RGBColor.prototype.getString=function(){return"rgb("+this.r+","+this.g+","+this.b+")"};raceme._RGBColor.prototype.RGBtoXYZ=function(){var g=(this.r/255);var f=(this.g/255);var e=(this.b/255);if(g>0.04045){g=Math.pow(((g+0.055)/1.055),2.4)*100}else{g=(g/12.92)*100}if(f>0.04045){f=Math.pow(((f+0.055)/1.055),2.4)*100}else{f=(f/12.92)*100}if(e>0.04045){e=Math.pow(((e+0.055)/1.055),2.4)*100}else{e=(e/12.92)*100}var d=g*0.4124+f*0.3576+e*0.1805;var c=g*0.2126+f*0.7152+e*0.0722;var a=g*0.0193+f*0.1192+e*0.9505;return new raceme._RGBColor(d,c,a)};raceme._RGBColor.prototype.XYZtoRGB=function(){var e=this.r/100;var c=this.g/100;var a=this.b/100;var g=e*3.2406+c*-1.5372+a*-0.4986;var f=e*-0.9689+c*1.8758+a*0.0415;var d=e*0.0557+c*-0.204+a*1.057;if(g>0.0031308){g=1.055*(Math.pow(g,(1/2.4)))-0.055}else{g=12.92*g}if(f>0.0031308){f=1.055*(Math.pow(f,(1/2.4)))-0.055}else{f=12.92*f}if(d>0.0031308){d=1.055*(Math.pow(d,(1/2.4)))-0.055}else{d=12.92*d}return new raceme._RGBColor(Math.floor(g*255),Math.floor(f*255),Math.floor(d*255))};raceme._RGBColor.prototype.toHSL=function(){var k=this.r/255;var j=this.g/255;var c=this.b/255;var a=Math.max(k,j,c);var e=Math.min(k,j,c);var i;var f;var d=(a+e)/2;if(a==e){i=0;f=0}else{if(d>0.5){f=(a-e)/(2-a-e)}else{f=(a-e)/(a+e)}if(a==k){i=(j-c)/(a-e)+(j<c?6:0)}else{if(a==j){i=(c-k)/(a-e)+2}else{if(a==c){i=(k-j)/(a-e)+4}}}i/=6}return[i,f,d]};raceme._getRGBfromHSL=function(m){var i=m[0];var n=m[1];var f=m[2];var a,j,k;if(n==0){return new raceme._RGBColor(255,255,255)}function e(l,h,g){if(g<0){g+=1}if(g>1){g-=1}if(g<1/6){return l+(h-l)*6*g}if(g<1/2){return h}if(g<2/3){return l+(h-l)*(2/3-g)*6}return l}var c=f<0.5?f*(1+n):f+n-f*n;var d=2*f-c;a=e(d,c,i+1/3);j=e(d,c,i);k=e(d,c,i-1/3);return new raceme._RGBColor(parseInt(a*255),parseInt(j*255),parseInt(k*255))};raceme._changeSaturation=function(c,d){var a=c.toHSL();a[1]+=d;a[1]=Math.min(1,a[1]);a[1]=Math.max(0.001,a[1]);return raceme._getRGBfromHSL(a)};raceme._getRGB=function(d){if(typeof d!=="string"){return false}var c=d.replace(/[^\d,]/g,"").split(",");if(c.length==3){return new raceme._RGBColor(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]))}var a=raceme._hex2rgb(d);if(a!==false){return a}if(isNaN(d)===false){return false}return raceme._getRGB(raceme._name2rgb(d))};raceme._hex2rgb=function(c){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(c);if(a){return new raceme._RGBColor(parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16))}return false};raceme._rgb2hex=function(a){var c=raceme._getRGB(a);return"#"+((1<<24)+(c.r<<16)+(c.g<<8)+c.b).toString(16).slice(1)};raceme._getContrastColor=function(d){var c=raceme._getRGB(d);var a=((c.r*299)+(c.g*587)+(c.b*114))/1000;if(a>=128){return"black"}return"white"};raceme._pixiColor=function(a){if(a=="none"||a==""){a="black"}a=new raceme._getRGB(a);return((a.r<<16)+(a.g<<8)+(a.b|0))};raceme._named_colors={aliceblue:"rgb(240,248,255)",antiquewhite:"rgb(250,235,215)",aqua:"rgb(0,255,255)",aquamarine:"rgb(127,255,212)",azure:"rgb(240,255,255)",beige:"rgb(245,245,220)",bisque:"rgb(255,228,196)",black:"rgb(0,0,0)",blanchedalmond:"rgb(255,235,205)",blue:"rgb(0,0,255)",blueviolet:"rgb(138,43,226)",brown:"rgb(165,42,42)",burlywood:"rgb(222,184,135)",cadetblue:"rgb(95,158,160)",chartreuse:"rgb(127,255,0)",chocolate:"rgb(210,105,30)",coral:"rgb(255,127,80)",cornflowerblue:"rgb(100,149,237)",cornsilk:"rgb(255,248,220)",crimson:"rgb(220,20,60)",cyan:"rgb(0,255,255)",darkblue:"rgb(0,0,139)",darkcyan:"rgb(0,139,139)",darkgoldenrod:"rgb(184,134,11)",darkgray:"rgb(169,169,169)",darkgreen:"rgb(0,100,0)",darkgrey:"rgb(169,169,169)",darkkhaki:"rgb(189,183,107)",darkmagenta:"rgb(139,0,139)",darkolivegreen:"rgb(85,107,47)",darkorange:"rgb(255,140,0)",darkorchid:"rgb(153,50,204)",darkred:"rgb(139,0,0)",darksalmon:"rgb(233,150,122)",darkseagreen:"rgb(143,188,143)",darkslateblue:"rgb(72,61,139)",darkslategray:"rgb(47,79,79)",darkslategrey:"rgb(47,79,79)",darkturquoise:"rgb(0,206,209)",darkviolet:"rgb(148,0,211)",deeppink:"rgb(255,20,147)",deepskyblue:"rgb(0,191,255)",dimgray:"rgb(105,105,105)",dimgrey:"rgb(105,105,105)",dodgerblue:"rgb(30,144,255)",firebrick:"rgb(178,34,34)",floralwhite:"rgb(255,250,240)",forestgreen:"rgb(34,139,34)",fuchsia:"rgb(255,0,255)",gainsboro:"rgb(220,220,220)",ghostwhite:"rgb(248,248,255)",gold:"rgb(255,215,0)",goldenrod:"rgb(218,165,32)",gray:"rgb(128,128,128)",grey:"rgb(128,128,128)",green:"rgb(0,128,0)",greenyellow:"rgb(173,255,47)",honeydew:"rgb(240,255,240)",hotpink:"rgb(255,105,180)",indianred:"rgb(205,92,92)",indigo:"rgb(75,0,130)",ivory:"rgb(255,255,240)",khaki:"rgb(240,230,140)",lavender:"rgb(230,230,250)",lavenderblush:"rgb(255,240,245)",lawngreen:"rgb(124,252,0)",lemonchiffon:"rgb(255,250,205)",lightblue:"rgb(173,216,230)",lightcoral:"rgb(240,128,128)",lightcyan:"rgb(224,255,255)",lightgoldenrodyellow:"rgb(250,250,210)",lightgray:"rgb(211,211,211)",lightgreen:"rgb(144,238,144)",lightgrey:"rgb(211,211,211)",lightpink:"rgb(255,182,193)",lightsalmon:"rgb(255,160,122)",lightseagreen:"rgb(32,178,170)",lightskyblue:"rgb(135,206,250)",lightslategray:"rgb(119,136,153)",lightslategrey:"rgb(119,136,153)",lightsteelblue:"rgb(176,196,222)",lightyellow:"rgb(255,255,224)",lime:"rgb(0,255,0)",limegreen:"rgb(50,205,50)",linen:"rgb(250,240,230)",magenta:"rgb(255,0,255)",maroon:"rgb(128,0,0)",mediumaquamarine:"rgb(102,205,170)",mediumblue:"rgb(0,0,205)",mediumorchid:"rgb(186,85,211)",mediumpurple:"rgb(147,112,219)",mediumseagreen:"rgb(60,179,113)",mediumslateblue:"rgb(123,104,238)",mediumspringgreen:"rgb(0,250,154)",mediumturquoise:"rgb(72,209,204)",mediumvioletred:"rgb(199,21,133)",midnightblue:"rgb(25,25,112)",mintcream:"rgb(245,255,250)",mistyrose:"rgb(255,228,225)",moccasin:"rgb(255,228,181)",navajowhite:"rgb(255,222,173)",navy:"rgb(0,0,128)",oldlace:"rgb(253,245,230)",olive:"rgb(128,128,0)",olivedrab:"rgb(107,142,35)",orange:"rgb(255,165,0)",orangered:"rgb(255,69,0)",orchid:"rgb(218,112,214)",palegoldenrod:"rgb(238,232,170)",palegreen:"rgb(152,251,152)",paleturquoise:"rgb(175,238,238)",palevioletred:"rgb(219,112,147)",papayawhip:"rgb(255,239,213)",peachpuff:"rgb(255,218,185)",peru:"rgb(205,133,63)",pink:"rgb(255,192,203)",plum:"rgb(221,160,221)",powderblue:"rgb(176,224,230)",purple:"rgb(128,0,128)",red:"rgb(255,0,0)",rosybrown:"rgb(188,143,143)",royalblue:"rgb(65,105,225)",saddlebrown:"rgb(139,69,19)",salmon:"rgb(250,128,114)",sandybrown:"rgb(244,164,96)",seagreen:"rgb(46,139,87)",seashell:"rgb(255,245,238)",sienna:"rgb(160,82,45)",silver:"rgb(192,192,192)",skyblue:"rgb(135,206,235)",slateblue:"rgb(106,90,205)",slategray:"rgb(112,128,144)",slategrey:"rgb(112,128,144)",snow:"rgb(255,250,250)",springgreen:"rgb(0,255,127)",steelblue:"rgb(70,130,180)",tan:"rgb(210,180,140)",teal:"rgb(0,128,128)",thistle:"rgb(216,191,216)",tomato:"rgb(255,99,71)",turquoise:"rgb(64,224,208)",violet:"rgb(238,130,238)",wheat:"rgb(245,222,179)",white:"rgb(255,255,255)",whitesmoke:"rgb(245,245,245)",yellow:"rgb(255,255,0)",yellowgreen:"rgb(154,205,50)"};raceme._name2rgb=function(c){var a=raceme._clearString(c);if(typeof raceme._named_colors[a]==="string"){return raceme._named_colors[a]}return false};raceme.defaultValue=raceme.dV=function(c,a){return(typeof c!=="undefined")?c:a};raceme._defaultAttributeValues={"fill-opacity":1,"stroke-opacity":1,"stroke-width":1,"stroke-miterlimit":4,fill:"rgb(0,0,0)",stroke:"rgb(0,0,0)",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0,offset:0,"stop-opacity":1,"stop-color":"rgb(0,0,0)"};raceme._defaultStylesValues={opacity:1};raceme._transform2obj=function(d){d=raceme.dV(d,"");d=raceme._clearString(d);d=d.replace(","," ");d=d.replace("\\s+"," ");var a={x:0,y:0,scalex:1,scaley:1,rotation:0,rotationcx:0,rotationcy:0,skewx:0,skewy:0};if(d==""){return a}d=d.split(")");for(var e=0;e<d.length;e++){var f=d[e].split("(");if(f.length==2){f[0]=raceme._clearString(f[0]);f[1]=raceme._clearString(f[1]);var c=f[1].split(" ");if(f[0]=="scale"){a.scalex=parseFloat(c[0]);if(c.length>1){a.scaley=parseFloat(c[1])}else{a.scaley=a.scalex}}else{if(f[0]=="translate"){a.x=parseFloat(c[0]);if(c.length>1){a.y=parseFloat(c[1])}}else{if(f[0]=="rotate"){a.rotation=parseFloat(c[0]);if(c.length>1){a.rotationcx=parseFloat(c[1])}if(c.length>2){a.rotationcy=parseFloat(c[2])}}else{if(f[0]=="skewX"){a.skewx=parseFloat(c[0])}else{if(f[0]=="skewY"){a.skewy=parseFloat(c[0])}}}}}}}return a};raceme._obj2transform=function(a){var c="";if(a.x!=0||a.y!=0){c+="translate("+a.x+" "+a.y+") "}if(a.scalex!=1||a.scaley!=1){if(a.scaley==a.scalex){c+="scale("+a.scalex+") "}else{c+="scale("+a.scalex+" "+a.scaley+") "}}if(a.rotation!=0||a.rotationcx!=0||a.rotationcy!=0){c+="rotate("+a.rotation+" "+a.rotationcx+" "+a.rotationcy+") "}if(a.skewx!=0){c+="skewX("+a.skewx+") "}if(a.skewy!=0){c+="skewY("+a.skewy+") "}return c};raceme._likeArray=function(a){if(a!==null&&typeof a==="object"&&typeof a.length==="number"){return true}return false};raceme._decodeHTMLEntities=function(e){var d=[["amp","&"],["apos","'"],["#x27","'"],["#x2F","/"],["#39","'"],["#47","/"],["lt","<"],["gt",">"],["nbsp"," "],["quot",'"']];for(var c=0,a=d.length;c<a;++c){e=e.replace(new RegExp("&"+d[c][0]+";","g"),d[c][1])}return e};raceme._round=function(c,a){if(typeof c==="undefined"){return 0}if(typeof a==="undefined"||a==0){return Math.round(c)}return(+parseFloat(c).toFixed(a))};raceme._mapValues=function(j,c,h,a,g){if(c==h||a==g){return a}var n=false;var m=Math.min(c,h);var f=Math.max(c,h);if(m!=c){n=true}var d=false;var e=Math.min(a,g);var i=Math.max(a,g);if(e!=a){d=true}var l;if(n==false){l=(j-m)*(i-e)/(f-m)}else{l=(f-j)*(i-e)/(f-m)}var k;if(d==false){k=l+e}else{k=i-l}return raceme._round(k,3)};raceme._mapValuesUnits=function(h,g,c,e,a){var d=raceme._getUnit(e);var f=raceme._mapValues(h,g,c,parseFloat(raceme._getVal(e)),parseFloat(raceme._getVal(a)));return f.toString()+d};raceme._getUnit=function(c){if(typeof c!=="string"||c.length<2){return""}if(c.substring(c.length-1)=="%"){return"%"}var a=c.substring(c.length-2);if(a=="px"||a=="%"||a=="in"||a=="cm"||a=="mm"||a=="em"||a=="ex"||a=="pt"||a=="pc"){return a}return""};raceme._getVal=function(c){if(typeof c!=="string"){return c}var a=raceme._getUnit(c);return c.replace(a,"")};raceme._getOperation=function(d,a){if(typeof d==="string"){var c=raceme._getUnit(d);d=raceme._getVal(d);a=raceme._getVal(a);if(a.length>2){if(a.substring(0,2)=="+="){return raceme._round((parseFloat(d)+parseFloat(a.substring(2))),3).toString()+c}else{if(a.substring(0,2)=="-="){return raceme._round((parseFloat(d)-parseFloat(a.substring(2))),3).toString()+c}else{if(a.substring(0,2)=="*="){return raceme._round((parseFloat(d)*parseFloat(a.substring(2))),3).toString()+c}else{if(a.substring(0,2)=="/="){return raceme._round((parseFloat(d)/parseFloat(a.substring(2))),3).toString()+c}}}}}return a+c}else{if(a.length>2){if(a.substring(0,2)=="+="){return raceme._round(d+parseFloat(a.substring(2)),3)}else{if(a.substring(0,2)=="-="){return raceme._round(d-parseFloat(a.substring(2)),3)}else{if(a.substring(0,2)=="*="){return raceme._round(d*parseFloat(a.substring(2)),3)}else{if(a.substring(0,2)=="/="){return raceme._round(d/parseFloat(a.substring(2)),3)}}}}}}return""};raceme._contains=function(c,a){if(c==a){return true}if(typeof a==="undefined"||typeof c==="undefined"){return false}if(c.contains&&a.nodeType==1){return c.contains(a)}if(c.compareDocumentPosition){return(c.compareDocumentPosition(a)===16)}while(a&&c!=a){a=a.parentNode}return a==c};raceme._mapColors=function(j,c,f,a,e){if(arguments.length!=5){return"rgb(0,0,0)"}var d;var h;if(typeof a==="string"){d=raceme._getRGB(a)}else{d=a}if(typeof e==="string"){h=raceme._getRGB(e)}else{h=e}var l=Math.max(j,c);l=Math.min(l,f);d=d.RGBtoXYZ();h=h.RGBtoXYZ();var k=Math.round(raceme._mapValues(l,c,f,d.r,h.r));var g=Math.round(raceme._mapValues(l,c,f,d.g,h.g));var i=Math.round(raceme._mapValues(l,c,f,d.b,h.b));return new raceme._RGBColor(k,g,i).XYZtoRGB().getString()};raceme.map=function(f,e,c,d,a){if(arguments.length!=5){return""}if(typeof d==="string"){if(raceme._getUnit(d)!=""){return raceme._mapValuesUnits(f,e,c,d,a)}if(raceme._getRGB(d)!==false){return raceme._mapColors(f,e,c,d,a)}if(isNaN(parseFloat(d))||isNaN(parseFloat(a))){return""}}return raceme._mapValues(f,e,c,d,a)};raceme._elementPoint=function(i,c,h){var d=new Grape(i);var f;var a;if(i.ownerSVGElement){f=i.ownerSVGElement.createSVGPoint();if(typeof c!=="undefined"&&typeof h!=="undefined"){f.x=c;f.y=h}else{a=i.getBBox();f.x=a.x;f.y=a.y}return f.matrixTransform(i.getTransformToElement(i.ownerSVGElement))}else{if(d.pixi){if(typeof c!=="undefined"&&typeof h!=="undefined"){return{x:d.pixi.transform.worldTransform.tx+(c*d.pixi.transform.worldTransform.a),y:d.pixi.transform.worldTransform.ty+(h*d.pixi.transform.worldTransform.d)}}var e=d.pixi.getGlobalPosition();var g=d.pixi.getLocalBounds();return{x:e.x+g.x,y:e.y+g.y}}else{if(typeof c!=="undefined"&&typeof h!=="undefined"){f={x:c,y:h}}else{a=d.getBBox();f={x:a.x,y:a.y}}d=d.getParent();while(d){f.x*=d.scale();f.y*=d.scale();f.x+=d.x();f.y+=d.y();d=d.getParent()}return f}}};raceme._getStyle=function(d){var c={};var a;if(window.getComputedStyle&&window.getComputedStyle(d,null).length>0){return window.getComputedStyle(d,null)}else{if(d.currentStyle){return d.currentStyle}else{if(d.style){return d.style}}}return c};raceme._newEvent=function(d){var a;try{a=new Event(d)}catch(c){a=document.createEvent("Event");a.initEvent(d,false,true)}return a};raceme._area=function(a){return Math.pow(a,2)*Math.PI};raceme._radius=function(a){return Math.sqrt(a/Math.PI)};raceme.polar2rect=function(a,d){var c=a*Math.cos(d*(Math.PI/180));var e=a*Math.sin(d*(Math.PI/180));return{x:c,y:e}};raceme.rect2polar=function(d,e){var a;var c=Math.sqrt(Math.pow(d,2)+Math.pow(e,2));if(d==0){if(e>0){a=Math.PI/2}else{a=3*Math.PI/2}}else{if(d<0){a=Math.atan(e/d)+Math.PI}else{if(e<0){a=Math.atan(e/d)+2*Math.PI}else{a=Math.atan(e/d)}}}a*=(180/Math.PI);return{r:c,angle:a}};raceme.arc_length=function(a,c){return(c/360)*2*Math.PI*a};raceme.distance=function(c,a){return Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2))};raceme.normalize=function(c){var a=raceme.distance({x:0,y:0},{x:c.x,y:c.y});if(a!=0){return{x:c.x/a,y:c.y/a}}return c};raceme.mult=function(a,c){return{x:a.x*c,y:a.y*c}};raceme.setInterval=function(c,e){if(window.requestAnimationFrame){var a=0;var d={running:true,fn:function(){if(d.running){c.call();window.requestAnimationFrame(d.fn)}}};window.requestAnimationFrame(d.fn);return d}return setInterval(c,e)};raceme.clearInterval=function(a){if(window.requestAnimationFrame){a.running=false}else{clearInterval(a);a=null}};raceme.Polygon=function(c){this._area=0;this._points=new Array();this.length=0;this.min=null;this.max=null;if(typeof c!=="undefined"){for(var a=0;a<c.length;a++){this.add(c[a])}}};raceme.Polygon.fn=raceme.Polygon.prototype;raceme.Polygon.fn.item=function(a){if(a==-1){a=this.length-1}a=Math.min(a,this.length-1);a=Math.max(a,0);return this._points[a]};raceme.Polygon.fn.add=function(a){this._points.push(a);this.length++;if(this.min===null){this.min={x:a.x,y:a.y};this.max={x:a.x,y:a.y}}else{this.min.x=Math.min(this.min.x,a.x);this.min.y=Math.min(this.min.y,a.y);this.max.x=Math.max(this.max.x,a.x);this.max.y=Math.max(this.max.y,a.y)}return this};raceme.Polygon.fn.area=function(){var c,a;var d=0;for(c=0;c<this.length;c++){a=(c+1)%this.length;d+=this.item(c).x*this.item(a).y;d-=this.item(c).y*this.item(a).x}d/=2;return(d<0?-d:d)};raceme.Polygon.fn.centroid=function(){var d,a,g;a=this.length-1;var m=0;var k=0;for(d=0;d<this.length;d++){var l=this.item(d);var h=this.item(a);g=l.x*h.y-h.x*l.y;m+=(l.x+h.x)*g;k+=(l.y+h.y)*g;a=d}g=this.area()*6;var e={x:Math.abs(m/g),y:Math.abs(k/g)};if(this.pointInside(e)==false){var c=this.innerCentroid();if(c!==null){return c}}return e};raceme.Polygon.fn.innerCentroid=function(k){if(typeof k==="undefined"){k=20}var h=(this.max.y-this.min.y)/k;var g=(this.max.x-this.min.x)/k;var a=null;var d=null;var c=null;for(var f=0;f<k;f++){for(var e=0;e<k;e++){var m=this.min.x+(g/2+(f*g));var l=this.min.y+(h/2+(e*h));if(this.pointInside({x:m,y:l})){if(a===null||this.sumDistancefromBorders({x:m,y:l})<a){a=this.sumDistancefromBorders({x:m,y:l});d=f;c=e}}}}if(d===null){return null}return{x:this.min.x+(g/2+(d*g)),y:this.min.y+(h/2+(c*h))}};raceme.Polygon.fn.sumDistancefromBorders=function(d){var a=0;for(var c=0;c<this.length;c++){a+=raceme.distance(d,this.item(c))}return a};raceme.Polygon.fn.pointInside=function(l){var d=false;for(var g=0,f=this.length-1;g<this.length;f=g++){var k=this.item(g).x;var e=this.item(g).y;var h=this.item(f).x;var c=this.item(f).y;var a=((e>l.y)!=(c>l.y))&&(l.x<(h-k)*(l.y-e)/(c-e)+k);if(a){d=!d}}return d};raceme.Tooltip=function(a,c){var e=this;this.rootsvg=a;this.tooltip=new Grape().addClass("viz_tooltip");this._settings=c||{};this.tooltip_tx=new Grape();this.tooltip_bg=new Grape();this._opacity_tooltip=1;if(typeof this._settings.tooltip_alpha=="number"&&this._settings.tooltip_alpha>=0&&this._settings.tooltip_alpha<=1){this._opacity_tooltip=this._settings.tooltip_alpha}this._color_text="rgb(245,246,247)";if(typeof this._settings.default_tooltip_color!=="undefined"){this._color_text=this._settings.default_tooltip_color}this._font_size=15;if(typeof this._settings.default_tooltip_size!=="undefined"){this._font_size=this._settings.default_tooltip_size}this._font="";if(typeof this._settings.tooltip_font!=="undefined"){this._font=this._settings.tooltip_font}this._background_color="rgb(65,67,68)";if(raceme._getRGB(this._settings.tooltip_background_color)!==false){this._background_color=this._settings.tooltip_background_color}if(this._opacity_tooltip<0.4||raceme._getContrastColor(this._background_color)!="white"){this._color_text="rgb(20,20,20)"}this._tooltip_align="left";if(this._settings.tooltip_align&&(this._settings.tooltip_align=="left"||this._settings.tooltip_align=="right"||this._settings.tooltip_align=="center")){this._tooltip_align=this._settings.tooltip_align}this.tooltip.hide().enableEvents(false).addChild(this.tooltip_bg).addChild(this.tooltip_tx);this.rootsvg.addChild(this.tooltip);this.targetGrape=null;this.globaltexttooltip="";if(!this._settings.tooltip_type||this._settings.tooltip_type!="system"){var d=this.rootsvg.by("title");d.each(function(){var f=this.getParent();if(f){f._tooltiptext=this.text();f.by("title").remove();f.addClass("tooltipeable");f.mouseover(function(g){if(!this._is_hidden_by_filter){e._show(this,false,g)}});if(f._mouseposition){f.mousemove(function(g){e._show(this,false,g)})}}})}};raceme.Tooltip.fn=raceme.Tooltip.prototype;raceme.Tooltip.fn.update=function(){if(this.targetGrape&&this.tooltip.opacity()>0){this._show(this.targetGrape,true)}};raceme.Tooltip.fn._show=function(o,g,r){var m=this;this.targetGrape=o;var q=true;var i;if(typeof g==="undefined"){g=false}if(g){i=this.globaltexttooltip}else{i=o._tooltiptext;this.globaltexttooltip=i}this.tooltip.attr("opacity",0);this.tooltip.show();i=raceme.defaultValue(i,"");if(raceme._clearString(i)==""){return}var j;j=Math.max(parseInt(this._font_size/3),2);j=Math.min(j,10);this.tooltip_tx.clear();this.tooltip_tx.label(i,0,0,this._color_text,this._font_size,this._tooltip_align,"top",1,this._font);this.tooltip_tx.by("text").attr("dominant-baseline","text-before-edge");this.tooltip_tx.by("tspan").attr("dominant-baseline","text-before-edge");this.tooltip_tx.enableEvents(false);if(g==false){o.mouseout(function(v){if(this.style("visibility")!="hidden"){m.tooltip.stop();m.tooltip.hide();m.tooltip.opacity(0);this.removeEvent("mouseout")}})}var u=150;var a=this.tooltip_tx.getBBox();var f={};if(r&&o._mouseposition){var l=raceme.cursorPoint(r);centerx=l.x;centery=l.y}else{if(o.tagName()=="path"){f.width=0;f.height=0;u=0;if(o.hasAttr("data-center-x")){var t=o.point(o.attr("data-center-x"),o.attr("data-center-y"));centerx=t.x;centery=t.y}else{var d=o.getPolygon().centroid();centerx=d.x;centery=d.y}}else{if(o.hasAttr("data-center-x")){centerx=o.attr("data-center-x");centery=o.attr("data-center-y")}else{f=o.getBBox();centerx=o.point().x+(f.width/2);if(o._is_invisible||o._is_filled_rectangle){centery=o.point().y+(f.height/2)}else{centery=o.point().y}}}}var h=this.rootsvg.viewbox();if(this.rootsvg.tagName()=="canvas"){h={x:0,y:0,width:parseInt(this.rootsvg.style("width").replace("px","")),height:parseInt(this.rootsvg.style("height").replace("px",""))}}var n=centerx;var c=h.width-centerx;this.tooltip_tx.x(centerx);this.tooltip_bg.clear();this.tooltip_bg.x(centerx).y(centery);var s=false;var k=this._drawBox(this.tooltip_bg,a.width+j*4,a.height+j*2,j,s,n,c);this.tooltip_tx.x(this.tooltip_tx.x()-k);if((centery-a.height-j*4)<h.y){s=true;this.tooltip_bg.clear();this._drawBox(this.tooltip_bg,a.width+j*4,a.height+j*2,j,s,n,c);if(!o._is_invisible&&!o._is_filled_rectangle&&!o._mouseposition&&f.height){centery+=f.height/2}if((centery+a.height+30+j)>(h.y+h.height)&&f.height){centery-=f.height/2}this.tooltip_bg.y(parseInt(centery+(a.height+25)/2));this.tooltip_tx.y(parseInt(centery+11))}else{this.tooltip_bg.y(parseInt(centery-(a.height+25)/2));this.tooltip_tx.y(parseInt(centery-(a.height+13)))}if(this._tooltip_align=="left"||i.indexOf("|")!=-1){this.tooltip_tx.x(this.tooltip_tx.x()-a.width/2)}else{if(this._tooltip_align=="right"){this.tooltip_tx.x(this.tooltip_tx.x()+a.width/2)}}if(g==false){var p;if(s==false){if(u==0){p=-10}else{p=-16}}else{if(u==0){p=10}else{p=16}}if(r&&o._mouseposition){this.tooltip.opacity(1)}else{this.tooltip.opacity(0).y(p).animate(200,u).ease("out").opacity(1).y(0)}}};raceme.Tooltip.fn._drawBox=function(i,d,j,h,g,a,f){var c;var e=0;if(a<d/2){e=a-d/2}else{if(f<d/2){e=-(f-d/2)}}i.beginFill(this._background_color,this._opacity_tooltip).rect(-d/2-1-e,-j/2-1,d+2,j+2,2,2);i.lineStyle(0);if(g==false){i.beginPath().moveTo(0,j/2+h).lineTo(h,j/2).lineTo(-h,j/2).endPath(true)}else{i.beginPath().moveTo(0,-j/2-h).lineTo(h,-j/2).lineTo(-h,-j/2).endPath(true)}return e};if(typeof document!=="undefined"){if(document.readyState==="complete"){raceme._execute_main_scripts()}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",raceme._execute_main_scripts,false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",raceme._execute_main_scripts)}}}};window.graphica=window.graphica||{};graphica.treemap={};graphica.treemap.InternalNode=function(b,a){this.weight=0;this.frame={x:0,y:0,width:0,height:0};this.weight=b;this.data=a};graphica.treemap.InternalNode.weigh=function(b){var a=new Array();var d=new Array();b.level=0;d.push(b);while(d.length>0){var c=d.pop();if(!a[c.level]){a[c.level]=new Array()}a[c.level].push(c);if(c.nodes){for(var h=0;h<c.nodes.length;++h){var f=c.nodes[h];f.level=c.level+1;f.parent=c;d.push(f)}}}for(var h=a.length-2;h>=0;--h){for(var g=0;g<a[h].length;++g){var l=0;for(var e=0;e<a[h][g].nodes.length;++e){l=l+a[h][g].nodes[e].weight}a[h][g].weight=l}}};graphica.treemap.Squarifier=function(){};graphica.treemap.Squarifier.squarify=function(B,A,u,g){var f=B.slice(0);this.scaleWeights(B,A,u);f.sort(function(d,c){return c.weight-d.weight});f.push(new graphica.treemap.InternalNode(0,null));var a=u<A;var o=a?u:A;var n=0,m=0;var i=A;var v=u;var k=[];while(f.length>0){var G=f[0];var t=G.weight;var q=this.sum(k);var C=this.min(k);var E=this.max(k);var b=this.worst(q+t,Math.min(C,t),Math.max(E,t),o);var p=this.worst(q,C,E,o);if(k.length==0||b<p){k.push(G);f.shift()}else{var h=n;var e=m;var l=q/o;var D;for(D=0;D<k.length;++D){var F=k[D].weight/l;if(a){g(h,e,l,F,k[D]);e=e+F}else{g(h,e,F,l,k[D]);h=h+F}}if(a){n=n+l;i=i-l}else{m=m+l;v=v-l}a=v<i;o=a?v:i;k=[]}}};graphica.treemap.Squarifier.worst=function(d,c,a,b){return Math.max(b*b*a/(d*d),d*d/(b*b*c))};graphica.treemap.Squarifier.scaleWeights=function(d,c,a){var e=c*a/this.sum(d);for(var b=0;b<d.length;b++){d[b].weight=e*d[b].weight}};graphica.treemap.Squarifier.max=function(a){return Math.max.apply(Math,this.weights(a))};graphica.treemap.Squarifier.min=function(a){return Math.min.apply(Math,this.weights(a))};graphica.treemap.Squarifier.sum=function(c){var b=0;for(var a=0;a<c.length;++a){b=b+c[a].weight}return b};graphica.treemap.Squarifier.weights=function(a){return a.map(function(b){return b.weight},a)};graphica.treemap.squarify=function(b,g){graphica.treemap.InternalNode.weigh(b);var a=new Array();a.push(b);while(a.length>0){var e=a.shift();if(e.nodes&&e.nodes.length>0){graphica.treemap.Squarifier.squarify(e.nodes,e.frame.width,e.frame.height,function(h,k,i,f,j){j.frame={x:e.frame.x+h,y:e.frame.y+k,width:i,height:f}});for(var d=0;d<e.nodes.length;++d){var c=e.nodes[d];if(c.nodes&&c.nodes.length>0){a.push(c)}}}}a.push(b);while(a.length>0){var e=a.pop();g(e.frame.x,e.frame.y,e.frame.width,e.frame.height,e);if(e.nodes){for(var d=0;d<e.nodes.length;++d){a.push(e.nodes[d])}}}};if(typeof window!=="undefined"){window.graphica=window.graphica||{};var graphica=window.graphica}else{self.graphica=self.graphica||{};var graphica=self.graphica}graphica.Utils={};graphica.Utils.log10=function(a){return Math.LOG10E*Math.log(Math.max(a,0.000001))};graphica.Utils.log2=function(a){return Math.LOG2E*Math.log(Math.max(a,0.125))};graphica.Utils.round=function(b,a){if(typeof b==="undefined"){return 0}if(typeof a==="undefined"||a==0){return Math.round(b)}return(+parseFloat(b).toFixed(a))};graphica.Utils.getAutoBinWidth=function(a){var e=2*(a.q3-a.q1)/Math.cbrt(a.n);var c=Math.round((a.max-a.min)/e);var b=graphica.Utils.getNumericNiceScale(a.min,a.max,c);e=(b.max-b.min)/(b.ticks-1);return{binWidth:e,min:b.min}};graphica.Utils.getNumericNiceScale=function(g,n,s,f,h){if(typeof h!=="boolean"){h=false}if(typeof f!=="boolean"){f=false}var m=n-g;if(m==0){return{min:g,max:n,ticks:3,ticks_values:["",graphica.Utils.round(g,2),""]}}if(f&&s>m){s=m}var t=m/s;if(f&&t<1){s=m+1;m=1}var c=0;var e=0;while(t<=0.1){t*=10;e++}while(t>=1){t/=10;c++}if(h&&(g%0.1*Math.pow(10,c)==0||n%0.1*Math.pow(10,c)==0)&&t<=0.1){t=0.1*Math.pow(10,c)}else{if(h&&(g%(0.2*Math.pow(10,c))==0||n%(0.2*Math.pow(10,c))==0)&&t<=0.2){t=0.2*Math.pow(10,c)}else{if(h&&(g%(0.25*Math.pow(10,c))==0||n%(0.25*Math.pow(10,c))==0)&&t<=0.25){t=0.25*Math.pow(10,c)}else{if(h&&(g%(0.3*Math.pow(10,c))==0||n%(0.3*Math.pow(10,c))==0)&&t<=0.3){t=0.3*Math.pow(10,c)}else{if(h&&(g%(0.4*Math.pow(10,c))==0||n%(0.4*Math.pow(10,c))==0)&&t<=0.4){t=0.4*Math.pow(10,c)}else{if(h&&(g%(0.5*Math.pow(10,c))==0||n%(0.5*Math.pow(10,c))==0)&&t<=0.5){t=0.5*Math.pow(10,c)}else{if(h&&(g%(0.6*Math.pow(10,c))==0||n%(0.6*Math.pow(10,c))==0)&&t<=0.6){t=0.6*Math.pow(10,c)}else{if(h&&(g%(0.7*Math.pow(10,c))==0||n%(0.7*Math.pow(10,c))==0)&&t<=0.7){t=0.7*Math.pow(10,c)}else{if(h&&(g%(0.75*Math.pow(10,c))==0||n%(0.75*Math.pow(10,c))==0)&&t<=0.75){t=0.75*Math.pow(10,c)}else{if(h&&(g%(0.8*Math.pow(10,c))==0||n%(0.8*Math.pow(10,c))==0)&&t<=0.8){t=0.8*Math.pow(10,c)}else{if(h&&(g%(0.9*Math.pow(10,c))==0||n%(0.9*Math.pow(10,c))==0)&&t<=0.9){t=0.9*Math.pow(10,c)}else{if(h&&(g%(1*Math.pow(10,c))==0||n%(1*Math.pow(10,c))==0)&&t<=1){t=Math.pow(10,c)}else{if(t<=0.1){t=0.1*Math.pow(10,c)}else{if(t<=0.2){t=0.2*Math.pow(10,c)}else{if(t<=0.25){t=0.25*Math.pow(10,c)}else{if(t<=0.3){t=0.3*Math.pow(10,c)}else{if(t<=0.4){t=0.4*Math.pow(10,c)}else{if(t<=0.5){t=0.5*Math.pow(10,c)}else{if(t<=0.6){t=0.6*Math.pow(10,c)}else{if(t<=0.7){t=0.7*Math.pow(10,c)}else{if(t<=0.75){t=0.75*Math.pow(10,c)}else{if(t<=0.8){t=0.8*Math.pow(10,c)}else{if(t<=0.9){t=0.9*Math.pow(10,c)}else{if(t<=1){t=Math.pow(10,c)}}}}}}}}}}}}}}}}}}}}}}}}while(e>0){t/=10;e--}var k=t*parseInt(g/t);if(k>g){g=t*parseInt(-1+g/t)}else{g=k}var q=parseFloat((t*parseInt(n/t)).toFixed(6));if(q<n){n=parseFloat((t*parseInt(1+n/t)).toFixed(6))}else{n=q}m=n-g;s=m/t;var a=[];var b=g;var p=m/s;for(var o=0;o<(s+1)&&b<(n+p);o++){if(f==false||graphica.Utils.decimals(b)==0){a.push(graphica.Utils.round(b,12))}b+=p}s=a.length;return{min:g,max:n,ticks:s,ticks_values:a}};graphica.Utils.fmod=function(e,c){return Number((e-(Math.floor(e/c)*c)).toPrecision(8))};graphica.Utils.map=function(m,b,h,a,g){if(b==h||a==g){return a}var q=false;var p=Math.min(b,h);var f=Math.max(b,h);if(p!=b){q=true}var c=false;var e=Math.min(a,g);var k=Math.max(a,g);if(e!=a){c=true}var o=(m-p)*(k-e)/(f-p);if(q){o=(f-m)*(k-e)/(f-p)}var n=o+e;if(c){n=k-o}return n};graphica.Utils.distance=function(b,a){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))};graphica.Utils.normalize=function(a){let mgn=graphica.Utils.distance({x:0,y:0},{x:a.x,y:a.y});if(mgn!=0){return{x:a.x/mgn,y:a.y/mgn}}return a};graphica.Utils.mult=function(a,b){return{x:a.x*b,y:a.y*b}};graphica.Utils.polar2rect=function(a,c){var b=a*Math.cos(c*(Math.PI/180));var e=a*Math.sin(c*(Math.PI/180));return{x:b,y:e}};graphica.Utils.rect2polar=function(c,e){var a;var b=Math.sqrt(Math.pow(c,2)+Math.pow(e,2));if(c==0){if(e>0){a=Math.PI/2}else{a=3*Math.PI/2}}else{if(c<0){a=Math.atan(e/c)+Math.PI}else{if(e<0){a=Math.atan(e/c)+2*Math.PI}else{a=Math.atan(e/c)}}}a*=(180/Math.PI);return{r:b,angle:a}};graphica.Utils.rotatePoint=function(f,e,b,a,c){c=c*Math.PI/180;return{x:Math.cos(c)*(f-b)-Math.sin(c)*(e-a)+b,y:Math.sin(c)*(f-b)+Math.cos(c)*(e-a)+a}};graphica.Utils.middleOf=function(b,a){return b+((a-b)/2)};graphica.Utils.middlePoint=function(g,e){var b=Math.min(g.x,e.x);var f=Math.max(g.x,e.x);var a=Math.min(g.y,e.y);var c=Math.max(g.y,e.y);return{x:b+((f-b)/2),y:a+((c-a)/2)}};graphica.Utils.radius=function(a){return Math.sqrt(a/Math.PI)};graphica.Utils.area=function(a){return Math.pow(a,2)*Math.PI};graphica.Utils.mapLin2Log=function(m,c,h,b,g){var e=c;var a=h;var n=Math.log(b);var k=Math.log(g);var f=(k-n)/(a-e);return Math.exp(n+f*(m-e))};graphica.Utils.decimals=function(b){var a=(""+b).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(!a){return 0}return Math.max(0,(a[1]?a[1].length:0)-(a[2]?+a[2]:0))};graphica.Utils.cosArctan=function(b,a){var c=(a==0)?0:b/a;return(a>0)?(1/Math.sqrt(1+(c*c))):(-1/Math.sqrt(1+(c*c)))};graphica.Utils.sinArctan=function(b,a){var c=(a==0)?0:b/a;return(a>0)?(c/Math.sqrt(1+(c*c))):(-c/Math.sqrt(1+(c*c)))};graphica.Utils.intersectRect=function(e,b,f){if(typeof f==="number"){var c={x:e.x-f,y:e.y-f,width:e.width+f*2,height:e.height+f*2};var a={x:b.x-f,y:b.y-f,width:b.width+f*2,height:b.height+f*2};return graphica.Utils.intersectRect(c,a)}return !(b.x>e.x+(e.width)||b.x+(b.width)<e.x||b.y>e.y+(e.height)||b.y+(b.height)<e.y)};graphica.Utils.intersectRectCircle=function(f,g){var c=Math.abs(g.x-f.x-f.width/2);var a=Math.abs(g.y-f.y-f.height/2);if(c>(f.width/2+g.radius)){return false}if(a>(f.height/2+g.radius)){return false}if(c<=(f.width/2)){return true}if(a<=(f.height/2)){return true}var e=c-f.width/2;var b=a-f.height/2;return(e*e+b*b<=(g.radius*g.radius))};graphica.Utils.intersectPolygons=function(o,c){var q=[o,c];var g,b,s,m,h,k,e,a;for(m=0;m<q.length;m++){var p=q[m];for(h=0;h<p.length;h++){var f=(h+1)%p.length;var w=p[h];var t=p[f];var n={x:t.y-w.y,y:w.x-t.x};g=b=undefined;for(k=0;k<o.length;k++){s=n.x*o[k].x+n.y*o[k].y;if(typeof g=="undefined"||s<g){g=s}if(typeof b=="undefined"||s>b){b=s}}e=a=undefined;for(k=0;k<c.length;k++){s=n.x*c[k].x+n.y*c[k].y;if(typeof e=="undefined"||s<e){e=s}if(typeof a=="undefined"||s>a){a=s}}if(b<e||a<g){return false}}}return true};graphica.Utils.radioOfRectangle=function(f,b,g){g=g*(Math.PI/180);var k=Math.cos(g);var e=Math.sin(g);var a,h;if(f*Math.abs(e)<b*Math.abs(k)){a=Math.sign(k)*f/2;h=Math.tan(g)*a}else{h=Math.sign(e)*b/2;a=(1/Math.tan(g))*h}return graphica.Utils.distance({x:0,y:0},{x:a,y:h})};graphica.Utils.lineBetween2Boxes=function(b,k,f,a,h,e){f/=2;e/=2;var p=a-b;var o=h-k;var g=function(A,t,q,C,s,B){if(Math.abs(t/A)<B/s){return{x:q+(A>0?s:-s),y:C+t*s/Math.abs(A)}}else{return{x:q+A*B/Math.abs(t),y:C+(t>0?B:-B)}}};var n=g(p,o,b,k,f,f);var m=g(-p,-o,a,h,e,e);var c=graphica.Utils.distance(n,m);return{x1:n.x,y1:n.y,x2:m.x,y2:m.y,length:c}};graphica.Utils.lineBetween2Circles=function(b,o,e,a,m,c){var k={length:0};var f=graphica.Utils.distance({x:b,y:o},{x:a,y:m});var h,g;var p,n;if(f<=e+c){k.x1=b;k.x2=a;k.y1=o;k.y2=m;return k}h=graphica.Utils.rect2polar(a-b,m-o);g=graphica.Utils.rect2polar(b-a,o-m);p=graphica.Utils.polar2rect(e,h.angle);n=graphica.Utils.polar2rect(c,g.angle);k.x1=b+p.x;k.y1=o+p.y;k.x2=a+n.x;k.y2=m+n.y;k.length=f-(e+c);return k};graphica.Utils.perpendicularofSegment=function(b,e,a,c,g){var f=Math.atan2(c-e,a-b);if(typeof pos!=="number"){pos=0}if(typeof g!=="number"){g=0}return{x1:Math.sin(f)*g+b,y1:-Math.cos(f)*g+e,x2:-Math.sin(f)*g+b,y2:Math.cos(f)*g+e}};graphica.Utils.clockwiseOrder=function(a,g,c,b,f,e){return(c-a)*(e-g)-(f-a)*(b-g)};graphica.Utils.clockwiseAngle=function(c,b,f,e){var a=Math.atan2(b,c)-Math.atan2(e,f);if(a<0){a+=2*Math.PI}return a};graphica.Utils.getControlPointsofCurve=function(b,m,a,k,h,c){if(typeof c!=="boolean"){c=false}var p=graphica.Utils.rect2polar(a-b,k-m);var g=graphica.Utils.map(h,0,1,p.r*0.25,p.r*0.75);if(c==false){var o=graphica.Utils.map(h,0,1,p.angle,p.angle-90)}else{var o=graphica.Utils.map(h,0,1,p.angle,p.angle+90)}var n=graphica.Utils.polar2rect(g,o);if(c==false){var e=graphica.Utils.map(h,0,1,p.angle-180,p.angle-90)}else{var e=graphica.Utils.map(h,0,1,p.angle+180,p.angle+90)}var f=graphica.Utils.polar2rect(g,e);return{p1:{x:b+n.x,y:m+n.y},p2:{x:a+f.x,y:k+f.y}}};graphica.Utils.objInterpolation=function(g,e){var f=-1;var c=-1;for(var b=0;b<g.length;b++){if(typeof g[b]==="undefined"){if(f>-1){if(c<=b){for(u=b+1;u<g.length;u++){if(typeof g[u]!=="undefined"){c=u;break}}}if(c>b){g[b]={};for(var a=0;a<e.length;a++){var h=e[a];g[b][h]=graphica.Utils.map(b,f,c,g[f][h],g[c][h])}}}}else{f=b}}return g};graphica.Utils.isValidDate=function(a){if(Object.prototype.toString.call(a)!=="[object Date]"){return false}return !isNaN(a.getTime())};graphica.Utils.dateTimeFormats={"en-US":{month:new Intl.DateTimeFormat("en-US",{month:"long",timeZone:"UTC"}),day:new Intl.DateTimeFormat("en-US",{day:"numeric",timeZone:"UTC"}),"month-year":new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",timeZone:"UTC"}),"day-month-year":new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",timeZone:"UTC"}),hour:new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"numeric",second:"numeric",timeZone:"UTC",hourCycle:"h23"}),"date-and-time":new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZone:"UTC",hourCycle:"h23"}),"default":new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",timeZone:"UTC"})}};Date.prototype.strformat=function(b,a,e){var c;if(isNaN(this)){return""}if(typeof a==="undefined"||a==null||["year","quarter","month","quarter-year","month-year","day","day-month-year","time","date-and-time"].includes(a)==false){a=null}if(a===null){if(b=="month"){a="month-year"}else{if(b=="quarter"){a="quarter-year"}else{if(b=="day"){a="day-month-year"}else{if(b=="hour"||b=="minute"||b=="second"){a="date-and-time"}else{a=b}}}}}var e=e||"en-US";if(a=="year"){return this.getUTCFullYear()+""}else{if(a=="quarter"){return"Q"+Math.floor(((this.getUTCMonth()+3)/3))}else{if(a=="month"){return graphica.Utils.dateTimeFormats[e]["month"].format(this)}else{if(a=="day"){return graphica.Utils.dateTimeFormats[e]["day"].format(this)}else{if(a=="quarter-year"){return"Q"+Math.floor(((this.getUTCMonth()+3)/3))+" "+this.getUTCFullYear()}else{if(a=="month-year"){return graphica.Utils.dateTimeFormats[e]["month-year"].format(this)}else{if(a=="day-month-year"){return graphica.Utils.dateTimeFormats[e]["day-month-year"].format(this)}else{if(a=="time"){if(b=="hour"){return this.getUTCHours().toString().padStart(2,"0")+"h"}else{if(b=="minute"){return this.getUTCHours().toString().padStart(2,"0")+":"+this.getUTCMinutes().toString().padStart(2,"0")}else{return graphica.Utils.dateTimeFormats[e]["hour"].format(this)}}}else{if(a=="date-and-time"){return graphica.Utils.dateTimeFormats[e]["date-and-time"].format(this)}else{return graphica.Utils.dateTimeFormats[e]["default"].format(this)}}}}}}}}}};Date.prototype.faststrformat=function(b){var a=new Date(this);if(typeof b=="string"){if(b=="year"){a.setUTCMonth(0);a.setUTCDate(1);a.setUTCHours(0,0,0,0)}else{if(b=="month"){a.setUTCDate(1);a.setUTCHours(0,0,0,0)}else{if(b=="quarter"){a.setUTCDate(1);a.setUTCHours(0,0,0,0);a.setUTCMonth(Math.floor(a.getUTCMonth()/3)*3)}else{if(b=="day"){a.setUTCHours(0,0,0,0)}else{if(b=="hour"){a.setUTCMinutes(0);a.setUTCSeconds(0);a.setUTCMilliseconds(0)}else{if(b=="minute"){a.setUTCSeconds(0);a.setUTCMilliseconds(0)}else{if(b=="second"){a.setUTCMilliseconds(0)}}}}}}}}return a.toUTCString()};graphica.Utils.compareDates=function(a,c,b){if(typeof b=="undefined"||b===null||b=="second"){a=graphica.Utils.dateFrom(a);c=graphica.Utils.dateFrom(c);a.setUTCMilliseconds(0);c.setUTCMilliseconds(0);if(a.getTime()<c.getTime()){return -1}else{if(a.getTime()>c.getTime()){return 1}}}else{if(b=="year"){if(a.getUTCFullYear()<c.getUTCFullYear()){return -1}else{if(a.getUTCFullYear()>c.getUTCFullYear()){return 1}}}else{if(b=="month"){if(a.getUTCFullYear()<c.getUTCFullYear()||(a.getUTCFullYear()==c.getUTCFullYear()&&a.getUTCMonth()<c.getUTCMonth())){return -1}else{if(a.getUTCFullYear()>c.getUTCFullYear()||(a.getUTCFullYear()==c.getUTCFullYear()&&a.getUTCMonth()>c.getUTCMonth())){return 1}}}else{if(b=="quarter"){if(a.getUTCFullYear()<c.getUTCFullYear()||(a.getUTCFullYear()==c.getUTCFullYear()&&(Math.floor(a.getUTCMonth()/3)*3)<(Math.floor(c.getUTCMonth()/3)*3))){return -1}else{if(a.getUTCFullYear()>c.getUTCFullYear()||(a.getUTCFullYear()==c.getUTCFullYear()&&(Math.floor(a.getUTCMonth()/3)*3)>(Math.floor(c.getUTCMonth()/3)*3))){return 1}}}else{if(b=="day"){a=graphica.Utils.dateFrom(a);c=graphica.Utils.dateFrom(c);a.setUTCHours(0,0,0,0);c.setUTCHours(0,0,0,0);if(a.getTime()<c.getTime()){return -1}else{if(a.getTime()>c.getTime()){return 1}}}else{if(b=="hour"){a=graphica.Utils.dateFrom(a);c=graphica.Utils.dateFrom(c);a.setUTCMinutes(0);a.setUTCSeconds(0);a.setUTCMilliseconds(0);c.setUTCMinutes(0);c.setUTCSeconds(0);c.setUTCMilliseconds(0);if(a.getTime()<c.getTime()){return -1}else{if(a.getTime()>c.getTime()){return 1}}}else{if(b=="minute"){a=graphica.Utils.dateFrom(a);c=graphica.Utils.dateFrom(c);a.setUTCSeconds(0);a.setUTCMilliseconds(0);c.setUTCSeconds(0);c.setUTCMilliseconds(0);if(a.getTime()<c.getTime()){return -1}else{if(a.getTime()>c.getTime()){return 1}}}}}}}}}return 0};graphica.Utils.dateFrom=function(b){if(typeof b==="string"){b=b.trim();if(b.match(/(^[0-9]|^[01][0-9]|^2[0-3]):([0-9]|[0-5][0-9]):([0-9]$|[0-5][0-9]$)/g)){b=b.split(":");let dt=new Date(Date.UTC(0));dt.setUTCHours(parseInt(b[0]),parseInt(b[1]),parseInt(b[2]),0);return dt}else{if(b.match(/(^[0-9]|^[01][0-9]|2[0-3]):([0-9]$|[0-5][0-9]$)/g)){b=b.split(":");let dt=new Date(Date.UTC(0));dt.setUTCHours(parseInt(b[0]),parseInt(b[1]),0,0);return dt}}var a=b;if(a.includes("GMT")==false){a+=" GMT"}a=new Date(a);if(graphica.Utils.isValidDate(a)){return a}return new Date(b)}else{if(graphica.Utils.isValidDate(b)){return new Date(b.valueOf())}}return null};graphica.Utils.isDateTickSmallerThan=function(c,a){var b=["second","minute","hour","day","month","quarter","year"];if(a==null){return false}if(c==null){return true}else{return(b.indexOf(c)<b.indexOf(a))}};graphica.Utils.differenceInDays=function(e,c){var g=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate());var f=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate());return Math.floor((f-g)/(1000*60*60*24))};graphica.Utils.differenceInMonths=function(f,e){var c;c=(e.getFullYear()-f.getFullYear())*12;c-=f.getMonth()+1;c+=e.getMonth();if(e.getDate()>=f.getDate()){c++}return c<=0?0:c};graphica.Utils.squareWidthIntoRectangle=function(a,h,g){a=Math.max(a,1);var c=Math.ceil(Math.sqrt(g*a/h));var f,e;if(Math.floor(c*h/a)*c<g){f=h/Math.ceil(c*h/a)}else{f=a/c}var b=Math.ceil(Math.sqrt(g*h/a));if(Math.floor(b*a/h)*b<g){e=a/Math.ceil(a*b/h)}else{e=h/b}return Math.max(f,e)};graphica.Utils.generateId=function(){return raceme._generateId()};graphica.Utils.oneDimensionLabelPlacement=function(b,g,k,e){var h=10;for(var f=0;f<h;f++){if(g=="vertical"){for(var m=0;m<b.length;m++){var c=0;for(var n=0;n<b.length;n++){if(n==m){continue}if(b[m].x>b[n].x+b[n].width||b[m].x+b[m].width<b[n].x){continue}if(b[m].y<b[n].y){if(b[n].y-b[m].y<b[m].height*0.9){c-=b[m].height*0.45}}else{if(b[m].y-b[n].y<b[m].height*0.9){c+=b[m].height*0.45}}}b[m].y+=c;if(b[m].y+b[m].height*0.5>e){b[m].y=e-b[m].height*0.5}else{if(b[m].y-b[m].height*0.5<k){b[m].y=k+b[m].height*0.5}}}}else{if(g=="horizontal"){for(var m=0;m<b.length;m++){var a=0;for(var n=0;n<b.length;n++){if(n==m){continue}if(b[m].y>b[n].y+b[n].height||b[m].y+b[m].height<b[n].y){continue}if(b[m].x<b[n].x){if(b[n].x-b[m].x<(b[m].width*0.5+b[n].width*0.5)){a-=((b[m].width*0.5+b[n].width*0.5)-(b[n].x-b[m].x))}}else{if(b[m].x-b[n].x<(b[m].width*0.5+b[n].width*0.5)){a+=((b[m].width*0.5+b[n].width*0.5)-(b[m].x-b[n].x))}}}b[m].x+=a;if(b[m].x+b[m].width*0.5>e){b[m].x=e-b[m].width*0.5}else{if(b[m].x-b[m].width*0.5<k){b[m].x=k+b[m].width*0.5}}}}}}return b};graphica.Utils.labelPlacement=function(E,s,o){var g=2;var A=s*o;var h=Math.sqrt(A/E.length)*2;if(E.length>0){for(var e=0;e<g;e++){let q_tree=new graphica.Utils.QTree(h/8);q_tree.insert(E);q_tree.update();for(var k=0;k<E.length;k++){if(E[k].onlyRepulsionElement){continue}var c=0;var q=0;var a=E[k].x;var n=E[k].y;let cv=E[k];let candidates=q_tree.candidates(cv);for(var t=0;t<candidates.length;t++){var m=candidates[t].id;var b=E[m].circle_x;var p=E[m].circle_y;var D=a-b;var C=n-p;var f=graphica.Utils.distance({x:a,y:n},{x:b,y:p});if(f>E[m].circle_r&&m!=k){f-=E[m].circle_r}if(f>0&&f<h/2){c+=(D/f)*((h)/f);q+=(C/f)*((h)/f)}if(m!=k){b=E[m].x;p=E[m].y;var D=a-b;var C=n-p;var f=graphica.Utils.distance({x:a,y:n},{x:b,y:p});if(f>0&&f<h/4){c+=(D/f)*((h)/f);q+=(C/f)*((h)/f)}}}c-=(2*h/Math.abs(a-s));c+=(2*h/Math.abs(a));q-=(2*h/Math.abs(n-o));q+=(2*h/Math.abs(n));if(s-a<h){c-=(h-Math.abs(a-s))}if(a<h){c+=(h-Math.abs(a))}if(o-n<h){q-=(h-Math.abs(n-o))}if(n<h){q+=(h-Math.abs(n))}E[k].x+=c;E[k].y+=q;var B=graphica.Utils.rect2polar(E[k].x-E[k].circle_x,E[k].y-E[k].circle_y).angle;var w=graphica.Utils.polar2rect(E[k].circle_r,B);E[k].angle=B;E[k].x=E[k].circle_x+w.x;E[k].y=E[k].circle_y+w.y}}}return E};graphica.Utils.bubbleLayout=function(e,h,a,c,f,g,k,b){if(!e.length||e.length<2){return e}if(c=="0x0"){if(e[0].form==graphica.DISK){for(let i=0;i<e.length;i++){let theta=2.39998131*i;let radius=Math.sqrt(theta);let x=Math.cos(theta)*radius;let y=Math.sin(theta)*radius;e[i].x=e[i].limits.x1+(e[i].limits.width/2)+x;e[i].y=e[i].limits.y1+(e[i].limits.height/2)+y}}else{for(let i=0;i<e.length;i++){e[i].x=e[i].limits.x1+(e[i].limits.width/2)-e[i].width/2;e[i].y=e[i].limits.y1+(e[i].limits.height/2)-e[i].height/2}}}if(f||c=="map"||c=="mapXY"||e[0].form==graphica.FILLED_BOX){if(c=="map"&&e.length){e=graphica.Utils.cartogramLayout(e,h,a,g);if(e[0].form==graphica.FILLED_BOX){e=graphica.Utils.nodeOverlap(e,h,a,c,g,k,b)}}else{e=graphica.Utils.nodeOverlap(e,h,a,c,g,k,b)}}else{e=graphica.Utils.CirclePacking(e,h,a,c,g,k)}return e};graphica.Utils.fermatSpiralLayout=function(c,e,a){let scaleFactor=Math.sqrt((Math.min(e,a)*Math.min(e,a))/c.length)/2;var b=(scaleFactor/2)/(c.length+1);for(let i=0;i<c.length;i++){let theta=2.39998131*i;let radius=scaleFactor*Math.sqrt(theta);let x=Math.cos(theta)*radius;let y=Math.sin(theta)*radius;c[i].x=(e/2)+x;c[i].y=(a/2)+y;scaleFactor-=b}return c};graphica.Utils.cartogramLayout=function(b,c,m,k,a){var g,f;var h=new graphica.GraphModel();for(g=0;g<b.length;g++){var e=h.addNode();e._anchorX=b[g].x;e._anchorY=b[g].y;e._layoutPosX=b[g].x;e._layoutPosY=b[g].y;if(b[g].form==graphica.FILLED_BOX){e._r=b[g].width/2+k/2}else{e._r=b[g].r+k/2}}h.forceLayout({use_anchors:true,width:c,height:m,doFit:false,iterations:100,responsiveMaxResulsiveForceDistance:true},function(){h.eachNode(function(){b[this.id].x=this._layoutPosX;b[this.id].y=this._layoutPosY})});return b};graphica.Utils.nodeOverlap=function(w,t,n,p,s,q,e){if(typeof e!=="number"){e=1}var c=1;var a=1;if(typeof s!=="number"){s=0}if(typeof q!="boolean"){q=true}if(p=="0x0"){if(t!==null){if(n>t){a=n/t}else{c=t/n}}}c/=e*2;a/=e*2;var D=t*n;var k=Math.sqrt(D/w.length);function E(f){return{x:(f/2*Math.cos(f)),y:(f/2*Math.sin(f))}}var b=(w[0].form==graphica.DISK);if(b){w.sort(function(g,f){return f.r-g.r})}else{w.sort(function(g,f){return f.height*f.width-g.height*g.width})}let q_tree=new graphica.Utils.QTree(k/2);q_tree.insert(w[0],0);q_tree.update();for(var C=1;C<w.length;C++){var A=1;var m=w[C];var o=false;outer_loop:while(o==false){o=true;let candidates=q_tree.candidates(m);for(var B=0;B<candidates.length;B++){var h=w[candidates[B].id];if(((b&&graphica.Utils.distance({x:h.x,y:h.y},{x:m.x,y:m.y})<(m.r+h.r+s))||(b==false&&graphica.Utils.intersectRect(m,h,s)))){do{var F=E(A);if(["0x0","0x1","1Cx1","1CxN","2CxN","1Cx2","map","mapXY","1Cx2C","2Cx1C","2Cx1","2Cx2C","2Cx2"].includes(p)){m.x+=F.x*c;if(typeof m.limits!=="undefined"&&q){if(b){if(m.x>m.limits.x1+m.limits.width){m.x=m.limits.x1+m.limits.width-m.r;o=true;break outer_loop}if(m.x<m.limits.x1+m.r){m.x=m.limits.x1+m.r;o=true;break outer_loop}}else{if(m.x>m.limits.x1+m.limits.width){m.x=m.limits.x1+m.limits.width;o=true;break outer_loop}if(m.x<m.limits.x1){m.x=m.limits.x1;o=true;break outer_loop}}}}if(["0x0","1x0","1x1C","Nx1C","Nx2C","2x1C","map","mapXY","1Cx2C","2Cx1C","1x2C","2Cx2C","2x2C"].includes(p)){m.y+=F.y*a;if(typeof m.limits!=="undefined"&&q){if(b){if(m.y>m.limits.y1+m.limits.height){m.y=m.limits.y1+m.limits.height-m.r;o=true;break outer_loop}if(m.y<m.limits.y1+m.r){m.y=m.limits.y1+m.r;o=true;break outer_loop}}else{if(m.y>m.limits.y1+m.limits.height){m.y=m.limits.y1+m.limits.height;o=true;break outer_loop}if(m.y<m.limits.y1){m.y=m.limits.y1;o=true;break outer_loop}}}}A++}while(((b&&graphica.Utils.distance({x:h.x,y:h.y},{x:m.x,y:m.y})<(m.r+h.r+s))||(b==false&&graphica.Utils.intersectRect(m,h,s))));o=false;break}}}q_tree.insert(m,C);q_tree.update()}return w};graphica.Utils.CirclePacking=function(b,c,q,e,p,a){if(typeof e=="undefined"){e="0x0"}var n=1;var m=1;if(typeof p!=="number"){p=0}if(typeof a!=="boolean"){a=true}if(e=="0x0"){if(c!==null){if(q>c){m=q/c}else{n=c/q}}}var g=["0x0","0x1","1Cx1","1CxN","2CxN","1Cx2","1Cx2C","2Cx1C","2Cx1","2Cx2C","2Cx2"].includes(e);var o=["0x0","1x0","1x1C","Nx1C","Nx2C","2x1C","1Cx2C","2Cx1C","1x2C","2Cx2C","2x2C"].includes(e);var s=100;var k=performance.now();for(var h=0;h<s&&(performance.now()-k)/1000<3;h++){let q_tree=new graphica.Utils.QTree();q_tree.insert(b);q_tree.update();let ci,cj;let v={};for(var f=0;f<b.length;f++){let ci=b[f];let candidates=q_tree.candidates(ci);for(let z=0;z<candidates.length;z++){let j=candidates[z].id;let cj=b[j];if(f!=j){if(cj.x==ci.x&&g){cj.x+=(Math.random())-0.5}if(cj.y==ci.y&&o){cj.y+=(Math.random())-0.5}let dx=cj.x-ci.x;let dy=cj.y-ci.y;let r=ci.r+cj.r;r+=p;let d=(dx*dx)+(dy*dy);if(d<(r*r)-0.01){v.x=dx;v.y=dy;v=graphica.Utils.normalize(v);v=graphica.Utils.mult(v,(r-Math.sqrt(d))*1.1);if(g){cj.x+=((v.x/2/m));ci.x-=((v.x/2/m));if(typeof cj.limits!=="undefined"&&a){cj.x=Math.min(cj.limits.x1+cj.limits.width-cj.r,cj.x);cj.x=Math.max(cj.limits.x1+cj.r,cj.x);ci.x=Math.min(ci.limits.x1+ci.limits.width-ci.r,ci.x);ci.x=Math.max(ci.limits.x1+ci.r,ci.x)}}if(o){cj.y+=((v.y/2/n));ci.y-=((v.y/2/n));if(typeof cj.limits!=="undefined"&&a){cj.y=Math.min(cj.limits.y1+cj.limits.height-cj.r,cj.y);cj.y=Math.max(cj.limits.y1+cj.r,cj.y);ci.y=Math.min(ci.limits.y1+ci.limits.height-ci.r,ci.y);ci.y=Math.max(ci.limits.y1+ci.r,ci.y)}}}}}}}return b};graphica.Utils.QTree=function(a){this.elements=[];this.q;this.default_r=a;this.insert=function(c,b){if(c){if(c.length){for(let i=0;i<c.length;i++){this.insert(c[i],i)}}else{let el={};if(typeof c.width!="undefined"){el={id:b,x:c.x,y:c.y,width:c.width,height:c.height}}else{if(typeof c.r!="undefined"){el={id:b,x:c.x-c.r,y:c.y-c.r,width:c.r*2,height:c.r*2}}else{el={id:b,x:c.x-this.default_r,y:c.y-this.default_r,width:this.default_r*2,height:this.default_r*2}}}this.elements.push(el)}}};this.update=function(){let minx=Infinity;let maxx=-Infinity;let miny=Infinity;let maxy=-Infinity;let i;for(i=0;i<this.elements.length;i++){minx=Math.min(minx,this.elements[i].x);maxx=Math.max(maxx,this.elements[i].x+this.elements[i].width);miny=Math.min(miny,this.elements[i].y);maxy=Math.max(maxy,this.elements[i].y+this.elements[i].height)}this.q=new graphica.Quadtree({x:minx,y:miny,width:maxx-minx,height:maxy-miny});for(i=0;i<this.elements.length;i++){this.q.insert(this.elements[i])}};this.candidates=function(b){if(typeof b.r!=="undefined"){return this.q.retrieve({id:b.id,x:b.x-b.r,y:b.y-b.r,width:b.r*2,height:b.r*2})}else{if(this.default_r){return this.q.retrieve({id:b.id,x:b.x-this.default_r,y:b.y-this.default_r,width:this.default_r*2,height:this.default_r*2})}}return this.q.retrieve(b)}};graphica.Utils.OctTree=function(e,b,c,a){this.MAX_DEPTH=18;this.node=e;if(!b.length){b=[0,0,0]}this.position=b;this.children=new Array();this.childCount=0;this.sizeCount=8;if(typeof e!="undefined"&&e!=null){this.weight=e.weight}else{this.weight=0}this.minPos=c;this.maxPos=a;this.sumPos=new Array();this.difPos=new Array();for(var f=0;f<2;f++){this.sumPos[f]=c[f]+a[f];this.difPos[f]=a[f]-c[f]}this.addNode=function(h,g,m){if(h.weight==0){return}if(this.node!=null){this.addNode2(this.node,this.position,m);this.node=null}for(var k=0;k<2;k++){this.position[k]=(this.weight*this.position[k]+h.weight*g[k])/(this.weight+h.weight)}this.weight+=h.weight;this.addNode2(h,g,m)};this.addNode2=function(m,k,o){if(o==this.MAX_DEPTH){if(this.childCount==this.sizeCount){this.sizeCount*=2}this.children[this.childCount++]=new graphica.Utils.OctTree(m,k.slice(0),k.slice(0),k.slice(0));return}childIndex=0;for(var n=0;n<2;n++){if(k[n]>(this.minPos[n]+this.maxPos[n])/2){childIndex+=1<<n}}if(typeof this.children[childIndex]=="undefined"){var h=[];var g=[];for(var n=0;n<2;n++){if((childIndex&1<<n)==0){h[n]=this.minPos[n];g[n]=this.sumPos[n]/2}else{h[n]=this.sumPos[n]/2;g[n]=this.maxPos[n]}}this.childCount++;this.children[childIndex]=new graphica.Utils.OctTree(m,k.slice(0),h.slice(0),g.slice(0))}else{this.children[childIndex].addNode(m,k.slice(0),o+1)}};this.removeNode=function(k,g,n){if(k.weight==0){return}if(this.weight<=k.weight){this.weight=0;this.node=null;this.children=[];this.childCount=0;return}for(var m=0;m<2;m++){this.position[m]=(this.weight*this.position[m]-k.weight*g[m])/(this.weight-k.weight)}this.weight-=k.weight;var o;if(n==this.MAX_DEPTH){o=0;while(this.children[o].node!=k){o++}for(var h=o;h<this.childCount;h++){this.children[h]=this.children[h+1]}delete this.children[this.childCount];this.childCount--}else{o=0;for(var m=0;m<2;m++){if(g[m]>this.sumPos[m]/2){o+=1<<m}}this.children[o].removeNode(k,g.slice(0),n+1);if(this.children[o].weight==0){delete this.children[o];this.childCount--}}};this.width=function(){var g=0;for(var h=0;h<2;h++){if(this.difPos[h]>g){g=this.difPos[h]}}return g};this.getHeight=function(){var g=-1;for(var h=0;h<this.children.length;h++){if(this.children[h]!=null){g=Math.max(g,this.children[h].getHeight())}}return g+1}};graphica.Utils.polylabel=function(f,w,m){w=w||1;var D,B,C,A;for(var q=0;q<f[0].length;q++){var n=f[0][q];if(!q||n[0]<D){D=n[0]}if(!q||n[1]<B){B=n[1]}if(!q||n[0]>C){C=n[0]}if(!q||n[1]>A){A=n[1]}}var o=C-D;var k=A-B;var b=Math.min(o,k);var t=b/2;if(b===0){return[D,B]}var s=new graphica.Queue([],function(p,h){return h.max-p.max});for(var e=D;e<C;e+=b){for(var c=B;c<A;c+=b){s.push(new graphica.Utils.Cell(e+t,c+t,t,f))}}var E=graphica.Utils.getCentroidCell(f);var g=new graphica.Utils.Cell(D+o/2,B+k/2,0,f);if(g.d>E.d){E=g}var F=s.length;while(s.length){var a=s.pop();if(a.d>E.d){E=a;if(m){console.log("found best %d after %d probes",Math.round(10000*a.d)/10000,F)}}if(a.max-E.d<=w){continue}t=a.h/2;s.push(new graphica.Utils.Cell(a.x-t,a.y-t,t,f));s.push(new graphica.Utils.Cell(a.x+t,a.y-t,t,f));s.push(new graphica.Utils.Cell(a.x-t,a.y+t,t,f));s.push(new graphica.Utils.Cell(a.x+t,a.y+t,t,f));F+=4}if(m){console.log("num probes: "+F);console.log("best distance: "+E.d)}return[E.x,E.y]};graphica.Utils.Cell=function(a,e,c,b){this.x=a;this.y=e;this.h=c;this.d=graphica.Utils.pointToPolygonDist(a,e,b);this.max=this.d+this.h*Math.SQRT2};graphica.Utils.pointToPolygonDist=function(s,o,q){var c=false;var t=Infinity;for(var f=0;f<q.length;f++){var e=q[f];for(var h=0,m=e.length,g=m-1;h<m;g=h++){var p=e[h];var n=e[g];if((p[1]>o!==n[1]>o)&&(s<(n[0]-p[0])*(o-p[1])/(n[1]-p[1])+p[0])){c=!c}t=Math.min(t,graphica.Utils.getSegDistSq(s,o,p,n))}}return(c?1:-1)*Math.sqrt(t)};graphica.Utils.getCentroidCell=function(p){var c=0;var q=0;var n=0;var s=p[0];for(var g=0,k=s.length,e=k-1;g<k;e=g++){var o=s[g];var m=s[e];var h=o[0]*m[1]-m[0]*o[1];q+=(o[0]+m[0])*h;n+=(o[1]+m[1])*h;c+=h*3}if(c===0){return new graphica.Utils.Cell(s[0][0],s[0][1],0,p)}return new graphica.Utils.Cell(q/c,n/c,0,p)};graphica.Utils.getSegDistSq=function(k,f,g,e){var h=g[0];var c=g[1];var o=e[0]-h;var n=e[1]-c;if(o!==0||n!==0){var m=((k-h)*o+(f-c)*n)/(o*o+n*n);if(m>1){h=e[0];c=e[1]}else{if(m>0){h+=o*m;c+=n*m}}}o=k-h;n=f-c;return o*o+n*n};graphica.Utils.intersectionPoints=function(o,n){var c=[];var f=graphica.Utils.distance(n,o);if(f==0){return c}if(f>n.r+o.r){return c}if(f<Math.abs(o.r-n.r)){return c}var s=n.x-o.x;var q=n.y-o.y;var p=(Math.pow(o.r,2)-Math.pow(n.r,2)+Math.pow(f,2))/(2*f);var m=o.x+(s*p/f);var g=o.y+(q*p/f);var k=Math.sqrt(Math.pow(o.r,2)-Math.pow(p,2));var e=-q*(k/f);var b=s*(k/f);c.push({x:m+e,y:g+b,elm1:o.id,elm2:n.id});c.push({x:m-e,y:g-b,elm1:o.id,elm2:n.id});return c};graphica.Utils.getIntersectionPoints=function(g){var a=[];for(var f=0;f<g.length;f++){for(var c=f+1;c<g.length;c++){var e=g[f];var b=g[c];a=a.concat(graphica.Utils.intersectionPoints(e,b))}}return a};graphica.Utils.getContours=function(k,O){var P=new Grape();var n=O||{};var w=n.fill||"black";var c=0.5;if(typeof n["fill-opacity"]=="number"){c=n["fill-opacity"]}var T=n.stroke||"black";var S=1;if(typeof n["stroke-opacity"]=="number"){S=n["stroke-opacity"]}var K=n["stroke-width"]||1;var R;var Q;var M;var J=[];for(R=0;R<k.length;R++){for(Q=R+1;Q<k.length;Q++){var g=graphica.Utils.distance(k[R],k[Q]);if(k[R].r>=g+k[Q].r){k.splice(Q,1);Q--}else{if(k[Q].r>=g+k[R].r){k.splice(R,1);R--;break}}}}var N=[];for(R=0;R<k.length;R++){k[R].id=R;k[R].cluster=R;N[R]=[R]}var E=[];for(R=0;R<k.length;R++){for(Q=R+1;Q<k.length;Q++){var U=graphica.Utils.distance(k[R],k[Q]);if(U<(k[R].r+k[Q].r)){var t=k[R].cluster;var p=k[Q].cluster;N[p]=[];for(M=0;M<k.length;M++){if(k[M].cluster==p){N[t].push(M);k[M].cluster=t}}}}}for(var R=0;R<N.length;R++){var b=N[R];if(b.length==0){continue}for(M=0;M<b.length;M++){b[M]=k[b[M]]}P.lineStyle(K,T,S);P.beginFill(w,c);if(b.length==1){P.circle(b[0].x,b[0].y,b[0].r)}else{P.beginPath(true);var f=graphica.Utils.getIntersectionPoints(b);for(M=0;M<f.length;M++){var a=f[M];if(typeof J[a.elm1]=="undefined"){J[a.elm1]=[a]}else{J[a.elm1].push(a)}if(typeof J[a.elm2]=="undefined"){J[a.elm2]=[a]}else{J[a.elm2].push(a)}}var h=null;for(M=0;M<b.length;M++){var q=b[M];if(h==null||q.y-q.r<h.y-h.r){h=q}}var I=null;var s;for(M=0;M<J[h.id].length;M++){var D=J[h.id][M];if(I==null||D.y<I){I=D.y;s=D}}P.moveTo(s.x,s.y);var C=k[s.elm1];var A=k[s.elm2];var F;if(graphica.Utils.clockwiseOrder(C.x,C.y,A.x,A.y,s.x,s.y)<0){F=A}else{F=C}var e=s;do{var B=[];for(M=0;M<J[F.id].length;M++){var a=J[F.id][M];if(a.elm1!=e.elm1||a.elm2!=e.elm2||a.x!=e.x||a.y!=e.y){B.push(a)}}var G=B[0];var o=graphica.Utils.clockwiseAngle(e.x-F.x,e.y-F.y,G.x-F.x,G.y-F.y);for(M=0;M<B.length;M++){var H=B[M];var L=graphica.Utils.clockwiseAngle(e.x-F.x,e.y-F.y,H.x-F.x,H.y-F.y);if(L>o){G=H;o=L}}var m;if(o<Math.PI){m=1}else{m=0}P.arcTo(G.x,G.y,F.r,m);e=G;if(e.elm1!=F.id){F=k[e.elm1]}else{F=k[e.elm2]}}while((e.x!=s.x||e.y!=s.y));P.endPath()}}return P};graphica.Utils.getArrowhead=function(b,f,a,e){var c=new Grape();c.beginFill(a,e).beginPath().moveTo(0,0).lineTo(b*0.5,0).lineTo(0,b).lineTo(-b*0.5,0).endPath();c.rotation(f-90);return c};graphica.Utils.getFineArrowhead=function(c,b,g,a,f){var e=new Grape();e.lineStyle(c,a,f,"round","round",0).beginFill("none").beginPath(false).moveTo(-b*0.75,0).lineTo(0,b).lineTo(b*0.75,0).endPath();e.rotation(g-90);return e};graphica.Utils.drawEdge=function(o,w,s,f,q,p,h,C,B){var n;var g;var a;C=C||1;if(typeof B!=="boolean"){B=false}if(typeof f!=="number"||f<=0||f>1){f=false}if(typeof w=="undefined"){w=graphica.EDGE_LINE}if(w==graphica.EDGE_BUNDLING){if(s){o.lineStyle(p,q,h);o.beginFill("none");o.beginPath();o.moveTo(s[0].x,s[0].y);if(s.length>2){o.splineCurve(s)}else{o.lineTo(s[1].x,s[1].y)}o.endPath()}}else{if(w==graphica.EDGE_LINE){if(f===false){o.lineStyle(p,q,h);o.line(s[0].x,s[0].y,s[1].x,s[1].y)}else{var n=graphica.Utils.getControlPointsofCurve(s[0].x,s[0].y,s[1].x,s[1].y,f,B);o.lineStyle(p,q,h).beginPath().beginFill("none").moveTo(s[0].x,s[0].y).curveTo(s[1].x,s[1].y,n.p1.x,n.p1.y,n.p2.x,n.p2.y).endPath()}}else{if(w==graphica.EDGE_CURVED){let mid=graphica.Utils.middleOf(s[0].x,s[1].x);o.lineStyle(p,q,h).beginFill("none");o.beginPath().moveTo(s[0].x,s[0].y).curveTo(s[1].x,s[1].y,mid,s[0].y,mid,s[1].y).endPath()}else{if(w==graphica.EDGE_CURVED_VERTICAL){let mid=graphica.Utils.middleOf(s[0].y,s[1].y);o.lineStyle(p,q,h).beginFill("none");o.beginPath().moveTo(s[0].x,s[0].y).curveTo(s[1].x,s[1].y,s[0].x,mid,s[1].x,mid).endPath()}else{if(w==graphica.EDGE_TAPERED){if(f===false){var A=graphica.Utils.perpendicularofSegment(s[0].x,s[0].y,s[1].x,s[1].y,p);o.beginFill(q,h);o.beginPath();o.moveTo(s[0].x,s[0].y).lineTo(A.x1,A.y1).lineTo(s[1].x,s[1].y).lineTo(A.x2,A.y2).endPath()}else{n=graphica.Utils.getControlPointsofCurve(s[0].x,s[0].y,s[1].x,s[1].y,f,B);A=graphica.Utils.perpendicularofSegment(s[0].x,s[0].y,n.p1.x,n.p1.y,p);per2=graphica.Utils.perpendicularofSegment(s[1].x,s[1].y,n.p2.x,n.p2.y,p);g=graphica.Utils.getControlPointsofCurve(A.x1,A.y1,per2.x2,per2.y2,f,B);a=graphica.Utils.getControlPointsofCurve(A.x2,A.y2,per2.x1,per2.y1,f,B);o.beginFill(q,h);o.beginPath();o.moveTo(A.x1,A.y1).curveTo(s[1].x,s[1].y,g.p1.x,g.p1.y,g.p2.x,g.p2.y).curveTo(A.x2,A.y2,a.p2.x,a.p2.y,a.p1.x,a.p1.y).endPath()}}else{if(w==graphica.EDGE_ARROW||w==graphica.EDGE_FINE_ARROW){var c;if(w==graphica.EDGE_FINE_ARROW){c=p*2.5;c=Math.max(c,7*C)}else{c=p*3;c=Math.max(c,10*C)}var e;if(f===false){var k=graphica.Utils.lineBetween2Circles(s[0].x,s[0].y,0,s[1].x,s[1].y,(w==graphica.EDGE_FINE_ARROW)?c+p/2:c);var m=raceme.rect2polar(s[1].x-s[0].x,s[1].y-s[0].y).angle;if(w==graphica.EDGE_FINE_ARROW){e=graphica.Utils.getFineArrowhead(p,c,m,q,h)}else{e=graphica.Utils.getArrowhead(c,m,q,h)}if(k.length){o.addChild(e);o.lineStyle(p,q,h);if(w==graphica.EDGE_FINE_ARROW){var t=graphica.Utils.lineBetween2Circles(s[0].x,s[0].y,0,s[1].x,s[1].y,p/2);o.line(k.x1,k.y1,t.x2,t.y2)}else{o.line(k.x1,k.y1,k.x2,k.y2)}e.x(k.x2).y(k.y2)}}else{if(w==graphica.EDGE_FINE_ARROW){k=graphica.Utils.lineBetween2Circles(s[0].x,s[0].y,0,s[1].x,s[1].y,p/2);s[1].y=k.y2;s[1].x=k.x2}n=graphica.Utils.getControlPointsofCurve(s[0].x,s[0].y,s[1].x,s[1].y,f,B);var m=raceme.rect2polar(s[1].x-n.p2.x,s[1].y-n.p2.y);if(w==graphica.EDGE_FINE_ARROW){e=graphica.Utils.getFineArrowhead(p,c,m,q,h)}else{e=graphica.Utils.getArrowhead(c,m,q,h)}var b=raceme.polar2rect(c,m.angle);e.rotation(m.angle-90);o.lineStyle(p,q,h).beginPath().beginFill("none").moveTo(s[0].x,s[0].y);if(w==graphica.EDGE_FINE_ARROW){o.curveTo(s[1].x,s[1].y,n.p1.x,n.p1.y,n.p2.x,n.p2.y)}else{o.curveTo(s[1].x-b.x,s[1].y-b.y,n.p1.x,n.p1.y,n.p2.x,n.p2.y)}o.endPath();o.addChild(e);e.x(s[1].x-b.x).y(s[1].y-b.y)}}}}}}}return o};graphica.Utils.hull={};graphica.Utils.hull.convex=function(h){var g=function(n,m,k){return(m[0]-n[0])*(k[1]-n[1])-(m[1]-n[1])*(k[0]-n[0])};var e=function(m){const k=[];for(let l=0;l<m.length;l++){while(k.length>=2&&(g(k[k.length-2],k[k.length-1],m[l])<=0)){k.pop()}k.push(m[l])}k.pop();return k};var c=function(m){const n=m.reverse(),k=[];for(let u=0;u<n.length;u++){while(k.length>=2&&(g(k[k.length-2],k[k.length-1],n[u])<=0)){k.pop()}k.push(n[u])}k.pop();return k};const f=e(h),b=c(h);const a=b.concat(f);a.push(h[0]);return a};graphica.Utils.hull.formatUtil={toXy:function(a,b){if(b===undefined){return a.slice()}return a.map(function(c){const e=new Function("pt","return [pt"+b[0]+",pt"+b[1]+"];");return e(c)})},fromXy:function(a,b){if(b===undefined){return a.slice()}return a.map(function(e){const c=new Function("pt","const o = {}; o"+b[0]+"= pt[0]; o"+b[1]+"= pt[1]; return o;");return c(e)})}};graphica.Utils.hull.Grid=function(c,g){this._cells=[];this._cellSize=g;this._reverseCellSize=1/g;for(let i=0;i<c.length;i++){const b=c[i];const a=this.coordToCellNum(b[0]);const f=this.coordToCellNum(b[1]);if(!this._cells[a]){const e=[];e[f]=[b];this._cells[a]=e}else{if(!this._cells[a][f]){this._cells[a][f]=[b]}else{this._cells[a][f].push(b)}}}};graphica.Utils.hull.Grid.prototype={cellPoints:function(a,b){return(this._cells[a]!==undefined&&this._cells[a][b]!==undefined)?this._cells[a][b]:[]},rangePoints:function(g){const f=this.coordToCellNum(g[0]);const c=this.coordToCellNum(g[1]);const b=this.coordToCellNum(g[2]);const a=this.coordToCellNum(g[3]);const e=[];for(let x=f;x<=b;x++){for(let y=c;y<=a;y++){for(let i=0;i<this.cellPoints(x,y).length;i++){e.push(this.cellPoints(x,y)[i])}}}return e},removePoint:function(b){const e=this.coordToCellNum(b[0]);const c=this.coordToCellNum(b[1]);const a=this._cells[e][c];let pointIdxInCell;for(let i=0;i<a.length;i++){if(a[i][0]===b[0]&&a[i][1]===b[1]){pointIdxInCell=i;break}}a.splice(pointIdxInCell,1);return a},trunc:Math.trunc||function(a){return a-a%1},coordToCellNum:function(a){return this.trunc(a*this._reverseCellSize)},extendBbox:function(b,a){return[b[0]-(a*this._cellSize),b[1]-(a*this._cellSize),b[2]+(a*this._cellSize),b[3]+(a*this._cellSize)]}};graphica.Utils.hull.intersect=function(o,m){var k=function(w,B,s,A,q,t){const p=((t-B)*(s-w))-((A-B)*(q-w));return p>0?true:p<0?false:true};const c=o[0][0],h=o[0][1],b=o[1][0],g=o[1][1],a=m[0][0],f=m[0][1],n=m[1][0],e=m[1][1];return k(c,h,a,f,n,e)!==k(b,g,a,f,n,e)&&k(c,h,b,g,a,f)!==k(c,h,b,g,n,e)};graphica.Utils.hull._filterDuplicates=function(a){const c=[a[0]];let lastPoint=a[0];for(let i=1;i<a.length;i++){const b=a[i];if(lastPoint[0]!==b[0]||lastPoint[1]!==b[1]){c.push(b)}lastPoint=b}return c};graphica.Utils.hull._sortByX=function(a){return a.sort(function(e,c){return(e[0]-c[0])||(e[1]-c[1])})};graphica.Utils.hull._sqLength=function(e,c){return Math.pow(c[0]-e[0],2)+Math.pow(c[1]-e[1],2)};graphica.Utils.hull._cos=function(n,f,e){const k=[f[0]-n[0],f[1]-n[1]],h=[e[0]-n[0],e[1]-n[1]],m=graphica.Utils.hull._sqLength(n,f),c=graphica.Utils.hull._sqLength(n,e),g=k[0]*h[0]+k[1]*h[1];return g/Math.sqrt(m*c)};graphica.Utils.hull._intersect=function(b,c){for(let i=0;i<c.length-1;i++){const a=[c[i],c[i+1]];if(b[0][0]===a[0][0]&&b[0][1]===a[0][1]||b[0][0]===a[1][0]&&b[0][1]===a[1][1]){continue}if(graphica.Utils.hull.intersect(b,a)){return true}}return false};graphica.Utils.hull._occupiedArea=function(a){let minX=Infinity;let minY=Infinity;let maxX=-Infinity;let maxY=-Infinity;for(let i=a.length-1;i>=0;i--){if(a[i][0]<minX){minX=a[i][0]}if(a[i][1]<minY){minY=a[i][1]}if(a[i][0]>maxX){maxX=a[i][0]}if(a[i][1]>maxY){maxY=a[i][1]}}return[maxX-minX,maxY-minY]};graphica.Utils.hull._bBoxAround=function(a){return[Math.min(a[0][0],a[1][0]),Math.min(a[0][1],a[1][1]),Math.max(a[0][0],a[1][0]),Math.max(a[0][1],a[1][1])]};graphica.Utils.hull._midPoint=function(e,b,a){const c=Math.cos(90/(180/Math.PI));let point=null,angle1Cos=c,angle2Cos=c,a1Cos,a2Cos;for(let i=0;i<b.length;i++){a1Cos=graphica.Utils.hull._cos(e[0],e[1],b[i]);a2Cos=graphica.Utils.hull._cos(e[1],e[0],b[i]);if(a1Cos>angle1Cos&&a2Cos>angle2Cos&&!graphica.Utils.hull._intersect([e[0],b[i]],a)&&!graphica.Utils.hull._intersect([e[1],b[i]],a)){angle1Cos=a1Cos;angle2Cos=a2Cos;point=b[i]}}return point};graphica.Utils.hull._concave=function(e,c,g,f,b){let midPointInserted=false;for(let i=0;i<e.length-1;i++){const h=[e[i],e[i+1]];const a=h[0][0]+","+h[0][1]+","+h[1][0]+","+h[1][1];if(graphica.Utils.hull._sqLength(h[0],h[1])<c||b.has(a)){continue}let scaleFactor=0;let bBoxAround=graphica.Utils.hull._bBoxAround(h);let bBoxWidth;let bBoxHeight;let midPoint;do{bBoxAround=f.extendBbox(bBoxAround,scaleFactor);bBoxWidth=bBoxAround[2]-bBoxAround[0];bBoxHeight=bBoxAround[3]-bBoxAround[1];midPoint=graphica.Utils.hull._midPoint(h,f.rangePoints(bBoxAround),e);scaleFactor++}while(midPoint===null&&(g[0]>bBoxWidth||g[1]>bBoxHeight));if(bBoxWidth>=g[0]&&bBoxHeight>=g[1]){b.add(a)}if(midPoint!==null){e.splice(i+1,0,midPoint);f.removePoint(midPoint);midPointInserted=true}}if(midPointInserted){return graphica.Utils.hull._concave(e,c,g,f,b)}return e};graphica.Utils.hull.hull=function(g,n,h){let maxEdgeLen=n||20;const m=graphica.Utils.hull._filterDuplicates(graphica.Utils.hull._sortByX(graphica.Utils.hull.formatUtil.toXy(g,h)));if(m.length<4){return m.concat([m[0]])}const c=graphica.Utils.hull._occupiedArea(m);const e=0.6;const k=[c[0]*e,c[1]*e];const f=graphica.Utils.hull.convex(m);if(n===null){var a=f}else{const o=m.filter(function(p){return f.indexOf(p)<0});const b=Math.ceil(1/(m.length/(c[0]*c[1])));var a=graphica.Utils.hull._concave(f,Math.pow(maxEdgeLen,2),k,new graphica.Utils.hull.Grid(o,b),new Set())}if(h){return graphica.Utils.hull.formatUtil.fromXy(a,h)}else{return a}};graphica.Utils.simpleheat=function(a){this._canvas=a=typeof a==="string"?document.getElementById(a):a;this._ctx=a.getContext("2d");this._width=a.width;this._height=a.height;this._max=1;this._data=[]};graphica.Utils.simpleheat.prototype={defaultRadius:25,defaultGradient:{0.4:"blue",0.6:"cyan",0.7:"lime",0.8:"yellow",1:"red"},data:function(a){this._data=a;return this},max:function(a){this._max=a;return this},add:function(a){this._data.push(a);return this},clear:function(){this._data=[];return this},radius:function(c,f){f=f===undefined?15:f;var e=this._circle=this._createCanvas(),b=e.getContext("2d"),a=this._r=c+f;e.width=e.height=a*2;b.shadowOffsetX=b.shadowOffsetY=a*2;b.shadowBlur=f;b.shadowColor="black";b.beginPath();b.arc(-a,-a,c,0,Math.PI*2,true);b.closePath();b.fill();return this},resize:function(){this._width=this._canvas.width;this._height=this._canvas.height},gradient:function(f){var b=this._createCanvas(),a=b.getContext("2d"),e=a.createLinearGradient(0,0,0,256);b.width=1;b.height=256;for(var c in f){e.addColorStop(+c,f[c])}a.fillStyle=e;a.fillRect(0,0,1,256);this._grad=a.getImageData(0,0,1,256).data;return this},draw:function(g){if(!this._circle){this.radius(this.defaultRadius)}if(!this._grad){this.gradient(this.defaultGradient)}var b=this._ctx;b.clearRect(0,0,this._width,this._height);for(var c=0,a=this._data.length,e;c<a;c++){e=this._data[c];b.globalAlpha=Math.min(Math.max(e[2]/this._max,g===undefined?0.05:g),1);if(!isNaN(e[0]-this._r)&&!isNaN(e[1]-this._r)){b.drawImage(this._circle,e[0]-this._r,e[1]-this._r)}}var f=b.getImageData(0,0,this._width,this._height);this._colorize(f.data,this._grad);b.putImageData(f,0,0);return this},_colorize:function(f,e){for(var c=0,a=f.length,b;c<a;c+=4){b=f[c+3]*4;if(b){f[c]=e[b];f[c+1]=e[b+1];f[c+2]=e[b+2]}}},_createCanvas:function(){if(typeof document!=="undefined"){return document.createElement("canvas")}else{return new this._canvas.constructor()}}};graphica.Utils.getDensityMap=function(a,f,e){if(typeof e==="undefined"){e=1}var b=Math.abs(Math.sqrt(f.width*f.height)/100);b=Math.max(b,2);var m=[];a.each(function(){if(typeof this._is_multiple_element!=="undefined"){this.getChildren().each(function(){m.push([this.x()-f.x,this.y()-f.y,1])})}else{m.push([this.x()-f.x,this.y()-f.y,1])}});var c=document.createElement("canvas");c.setAttribute("width",f.width);c.setAttribute("height",f.height);new graphica.Utils.simpleheat(c).data(m).radius(b/e,15/e).draw();var g=c.toDataURL();var h=new Grape("image","svg");h.attr("href",g);h.width(f.width);h.height(f.height);h.x(f.x);h.y(f.y);return h};graphica.Utils.getConvexHull=function(o){var e=new Grape();var a=1;for(var C in o.grgroupByCategory){var h=[];for(var p=0;p<o.grgroupByCategory[C].length;p++){if(p==0){a=o.grgroupByCategory[C][p].scale()}h.push([o.grgroupByCategory[C][p].x(),o.grgroupByCategory[C][p].y(),(o.grgroupByCategory[C][p]._form_data.radius()+4)*a])}if(h.length==2){var s=[];var B=graphica.Utils.rect2polar(h[0][0]-h[1][0],h[0][1]-h[1][1]).angle;var m=B-180;s.push([h[0][0]-graphica.Utils.polar2rect(h[0][2],B-240).x,h[0][1]-graphica.Utils.polar2rect(h[0][2],B-240).y,0]);s.push([h[0][0]-graphica.Utils.polar2rect(h[0][2],B-120).x,h[0][1]-graphica.Utils.polar2rect(h[0][2],B-120).y,0]);s.push([h[1][0]-graphica.Utils.polar2rect(h[1][2],m-120).x,h[1][1]-graphica.Utils.polar2rect(h[1][2],m-120).y,0]);s.push([h[1][0]-graphica.Utils.polar2rect(h[1][2],m-240).x,h[1][1]-graphica.Utils.polar2rect(h[1][2],m-240).y,0]);h=s}h=graphica.Utils.hull.hull(h,null);if(h.length>3){var n=0;var k=0;for(var p=0;p<h.length;p++){n+=h[p][0];k+=h[p][1]}n=n/h.length;k=k/h.length;var f=o._properties.getColorByValue(o.grgroupByCategory[C][0]._row);e.beginPath(true);e.lineStyle(o._properties.distribution_plot_border_width*a,f,1,"butt","round",4,"1",1);e.beginFill(f,o._properties.distribution_plot_fill_opacity);var g=[];for(var q=0;q<h.length;q++){var c=h[q][0];var b=h[q][1];var t=raceme.rect2polar(c-n,b-k);var w=t.angle;var A=t.r+h[q][2];t=raceme.polar2rect(A,w);c=n+t.x;b=k+t.y;if(q==0){e.moveTo(c,b)}else{e.lineTo(c,b)}}e.endPath()}e.by("path").addClass("nonscalable_border")}return e};graphica.Utils.getBoxPlots=function(B,E,H){var h=new Grape();h.enableEvents(false);var J="filled";var g=B._properties;if(typeof g.box_plot_style=="string"){J=g.box_plot_style}var M="rgb(187,187,187)";if(typeof g.box_plot_default_color=="string"){M=g.box_plot_default_color}var f=false;if(typeof g.box_plot_colored_as_marks=="boolean"){f=g.box_plot_colored_as_marks}var A=40;if(typeof g.box_plot_max_width=="number"){A=g.box_plot_max_width}if(B._sub_frames.length&&B._frame_type=="multiple"){var o=g.getOrderedItems(B.multiple_var,graphica.SMALL_MULTIPLES);o=B._dataset.split(B.multiple_var,o);for(var N=0;N<B._sub_frames.length;N++){h.addChild(graphica.Utils.getBoxPlots(B._sub_frames[N],o[N]))}return h}var E=E||B._dataset;var m=B._frame_type;var p=[];var L=[];var F;var D=null;var C=null;if(m=="1x0"){F=[B.axis_x]}else{if(m=="0x1"){F=[B.axis_y]}else{if(m=="1x1C"||(m=="1x1"&&B.axis_y._is_date_type)){F=[B.axis_x];D=B.axis_y}else{if(m=="1Cx1"||(m=="1x1"&&B.axis_x._is_date_type)){F=[B.axis_y];D=B.axis_x}else{if(m=="1x2"){if(B.axis_x._is_variable_quantitative&&!B.axis_y2._is_variable_quantitative){F=[B.axis_x];D=B.axis_y;C=B.axis_y2}else{if(!B.axis_x._is_variable_quantitative&&B.axis_y2._is_variable_quantitative){F=[B.axis_y2];D=B.axis_x;C=B.axis_y}else{return h}}}else{if(m=="2x1"){if(B.axis_y._is_variable_quantitative&&!B.axis_x2._is_variable_quantitative){F=[B.axis_y];D=B.axis_x;C=B.axis_x2}else{if(!B.axis_y._is_variable_quantitative&&B.axis_x2._is_variable_quantitative){F=[B.axis_x2];D=B.axis_y;C=B.axis_x}else{return h}}}else{if(m=="1CxN"||m=="2CxN"||m=="1Cx2"){F=B.naxis_y;D=B.axis_x}else{if(m=="Nx1C"||m=="Nx2C"||m=="2x1C"){F=B.naxis_x;D=B.axis_y}else{return h}}}}}}}}if(D!=null){p.push(D._variable);L.push(D._stat);if(C!=null){p.push(C._variable);L.push(C._stat)}}var w=E.multiple_split(p,L);var K=[];for(var Q=0;Q<F.length;Q++){K.push(F[Q]._variable)}for(N=0;N<F.length;N++){if(typeof H!="undefined"&&H!==null&&H!=K[N]){continue}for(var O=0;O<w.length;O++){var b=w[O].getStats(K[N],F[N]._stat);var k=F[N].getPoint(b.minq,true,true);var t=F[N].getPoint(b.q1,true,true);var s=F[N].getPoint(b.median,true,true);var q=F[N].getPoint(b.q3,true,true);var n=F[N].getPoint(b.maxq,true,true);var P={x:B._dataspace.x,y:B._dataspace.y,width:B._dataspace.width,height:B._dataspace.height};var G;var a;if(D!=null){G=w[O].getValue(0,D._variable);a=D.getPoint(G);if(D._orientation=="vertical"){P.y+=a;P.height=D.getSpacePoint();P.y-=P.height/2}else{P.x+=a;P.width=D.getSpacePoint();P.x-=P.width/2}}if(C!=null){G=w[O].getValue(0,C._variable);a=C.getPoint(G);if(C._orientation=="vertical"){P.y+=a;P.height=C.getSpacePoint();P.y-=P.height/2}else{P.x+=a;P.width=C.getSpacePoint();P.x-=P.width/2}}if(F.length>1){if(F[N]._orientation=="vertical"){P.y=F[N].y()}else{P.x=F[N].x()}}var e=new Grape();e.addTo(h);if(f){M=g.getColorByValue(w[O].row(0))}e.x(P.x).y(P.y);e.lineStyle(1,M);if(J=="hollow"){e.beginFill("none")}else{e.beginFill(M)}var R=0;var I;if(F[N]._orientation=="vertical"){R=P.width/2;I=Math.max(Math.min(A,P.width*0.66),0);if(J!="box"){e.moveTo(R,k).lineTo(R,t);e.moveTo(R,q).lineTo(R,n);if(t<q){e.rect(R-I/2,t,I,Math.max((s-t)-1,0));e.rect(R-I/2,s+1,I,Math.max((q-s)-1,0))}else{e.rect(R-I/2,q,I,Math.max((s-q)-1,0));e.rect(R-I/2,s+1,I,Math.max((t-s)-1,0))}}else{if(k<n){e.rect(R-I/2,k,I,Math.max((n-k),0))}else{e.rect(R-I/2,n,I,Math.max((k-n),0))}}}else{R=P.height/2;I=Math.max(Math.min(A,P.height*0.66),0);if(J!="box"){e.moveTo(k,R).lineTo(t,R);e.moveTo(q,R).lineTo(n,R);if(t<q){e.rect(t,R-I/2,Math.max((s-t)-1,0),I);e.rect(s+1,R-I/2,Math.max((q-s)-1,0),I)}else{e.rect(q,R-I/2,Math.max((s-q)-1,0),I);e.rect(s+1,R-I/2,Math.max((t-s)-1,0),I)}}else{if(k<n){e.rect(k,R-I/2,Math.max((n-k),0),I)}else{e.rect(n,R-I/2,Math.max((k-n),0),I)}}}}}return h};graphica.Utils.getPathFromCoor=function(e,b,c,f,a){var g=[];var m;var n;var k=new Grape();k.lineStyle(0);k.beginFill(f,a);k.beginPath(true);if(e.length>1){m=graphica.Utils.rect2polar(e[1]-e[0],b[1]-b[0]).angle;n=graphica.Utils.polar2rect(c/2,m-90);k.moveTo(e[0]+n.x,b[0]+n.y);g.push(m);for(var h=1;h<e.length;h++){m=graphica.Utils.rect2polar(e[h]-e[h-1],b[h]-b[h-1]).angle;n=graphica.Utils.polar2rect(c/2,m-90);k.lineTo(e[h]+n.x,b[h]+n.y);g.push(m)}for(var h=e.length-1;h>=0;h--){m=g[h];n=graphica.Utils.polar2rect(c/2,m+90);k.lineTo(e[h]+n.x,b[h]+n.y)}}k.endPath();return k};graphica.Utils.getReferenceLine=function(M,b,o,P,e,p,aa){var A=new Grape();var o=o||b._dataset;var O=b._properties;var q=null;var U=null;if(O.reference_lines=="constant"){O.reference_lines_independent=false}if(b._sub_frames.length&&b._frame_type=="multiple"){var c;if(O.reference_lines_independent){var c=O.getOrderedItems(b.multiple_var,graphica.SMALL_MULTIPLES);c=o.split(b.multiple_var,c)}else{c=[o]}for(var aq=0;aq<b._sub_frames.length;aq++){A.addChild(graphica.Utils.getReferenceLine(M,b._sub_frames[aq],c[aq]))}return A}else{if(typeof P==="undefined"&&["2x1","1x2","2x2","2CxN","Nx2C","1Cx1","1x1C"].includes(b._frame_type)&&O.reference_lines!="constant"){var n,Q;if(b._frame_type=="2x1"||b._frame_type=="2CxN"||b._frame_type=="1Cx1"){n=b.axis_x._variable;P="x"}else{if(b._frame_type=="1x2"||b._frame_type=="Nx2C"||b._frame_type=="1x1C"){n=b.axis_y._variable;P="y"}else{if(O.reference_lines_type=="yline"){n=b.axis_y._variable;P="y";Q=b.axis_x._variable;p="x"}else{n=b.axis_x._variable;P="x";Q=b.axis_y._variable;p="y"}}}var J=o.unique(n);var a=[];if(O.reference_lines_independent&&b._parent_frame!="multiple"){a=o.split(n,J)}if(J.length>1){for(var aq=0;aq<J.length;aq++){var ad=o;if(O.reference_lines_independent&&b._parent_frame!="multiple"){ad=a[aq]}if(typeof Q=="undefined"){A.addChild(graphica.Utils.getReferenceLine(M,b,ad,P,J[aq]))}else{secondcats=ad.unique(Q);if(O.reference_lines_independent&&b._parent_frame!="multiple"){secondcatds=a[aq].split(Q,secondcats)}for(var ap=0;ap<secondcats.length;ap++){if(O.reference_lines_independent&&b._parent_frame!="multiple"){ad=secondcatds[ap]}A.addChild(graphica.Utils.getReferenceLine(M,b,ad,P,J[aq],p,secondcats[ap]))}}}return A}else{if(J.length){e=J[0]}}}}var av=(O.Mark()==graphica.LINE||O.Mark()==graphica.FILLED_DISK||O.Mark()==graphica.DISK);if(O.reference_lines_independent&&b._parent_frame!="multiple"&&O.countVariables(graphica.HUE)>0&&o.isQuantitative(O.firstVariable(graphica.HUE))==false&&av){U=O.firstVariable(graphica.HUE);var I=o.unique(U);if(I.length>1){var ar=o.split(U,I);for(var aq=0;aq<I.length;aq++){A.addChild(graphica.Utils.getReferenceLine(M,b,ar[aq],P,e))}return A}else{if(I.length==1){q=O.getColorByValue(I[0])}}}var R=b._frame_type;var W;var L;var al;var K;var N;var au;var T={x:b._dataspace.x,y:b._dataspace.y,width:b._dataspace.width,height:b._dataspace.height};if(typeof P!=="undefined"){if(P=="x"){T.x+=b.axis_x.getPoint(e)-b.axis_x.getSpacePoint(e)/2;T.width=b.axis_x.getSpacePoint(e)}else{if(P=="y"){T.y+=b.axis_y.getPoint(e)-b.axis_y.getSpacePoint(e)/2;T.height=b.axis_y.getSpacePoint(e)}}if(typeof p!=="undefined"){if(p=="x"){T.x+=b.axis_x.getPoint(aa)-b.axis_x.getSpacePoint(aa)/2;T.width=b.axis_x.getSpacePoint(aa)}else{if(p=="y"){T.y+=b.axis_y.getPoint(aa)-b.axis_y.getSpacePoint(aa)/2;T.height=b.axis_y.getSpacePoint(aa)}}}}if(["linear","exponential","log","power","polynomial"].includes(O.reference_lines)&&((R=="1x2"&&b.axis_y2._is_variable_quantitative&&(b.axis_x._is_variable_quantitative||b.axis_x._is_date_type))||(R=="2x1"&&b.axis_y._is_variable_quantitative&&(b.axis_x2._is_date_type||b.axis_x2._is_variable_quantitative))||(R=="2CxN"&&(b.axis_x2._is_date_type||b.axis_x2._is_variable_quantitative))||(R=="1x1"&&b.axis_y._is_variable_quantitative)||((R=="1CxN"||R=="1Cx2")&&b.axis_x._is_date_type)||(R=="2x2"&&b.axis_y2._is_variable_quantitative&&(b.axis_x2._is_variable_quantitative||b.axis_x2._is_date_type)))){if(R=="2x1"||R=="2x2"||R=="2CxN"){W=b.axis_x2._variable;al=b.axis_x2._stat;N=b.axis_x2}else{W=b.axis_x._variable;al=b.axis_x._stat;N=b.axis_x}var ax=[];if(R=="1CxN"||R=="2CxN"||R=="1Cx2"){ax=b.naxis_y}else{if(R=="1x2"||R=="2x2"){ax=[b.axis_y2]}else{ax=[b.axis_y]}}for(var ag=0;ag<ax.length;ag++){L=ax[ag]._variable;K=ax[ag]._stat;if(!(M===null||L==M)){continue}var ae=[];for(var at=0;at<o.length;at++){var ah;if(N._is_date_type){var az=o.getValue(at,W,al);ah=[o.getDateTickPosition(W,az,al)+1,o.getValue(at,L,K)]}else{ah=[o.getValue(at,W,al),o.getValue(at,L,K)]}if(ah[0]!==null&&ah[1]!==null){ae.push(ah)}}A.x(T.x).y(T.y);var g=null;if(O.reference_lines=="linear"){g=graphica.Utils.regression.linear(ae)}else{if(O.reference_lines=="exponential"){g=graphica.Utils.regression.exponential(ae)}else{if(O.reference_lines=="log"){g=graphica.Utils.regression.logarithmic(ae)}else{if(O.reference_lines=="power"){g=graphica.Utils.regression.power(ae)}else{if(O.reference_lines=="polynomial"){g=graphica.Utils.regression.polynomial(ae,{order:O.reference_lines_degree,precision:100,period:null})}}}}}if(g!==null){var aw=[];var V=[];if(N._scale=="log10"||N._scale=="log2"){var Z=T.width;var ap=Math.pow(N._max/N._min,1/(Z-1));for(var aq=0;aq<Z;aq++){ai=N._min*Math.pow(ap,aq);if((O.reference_lines!="log"&&O.reference_lines!="power")||ai>0){aw.push(N.getPoint(ai,true));V.push(ax[ag].getPoint(g.predict(ai)[1],true))}}}else{if(N._is_date_type){for(var aq=0;aq<o.getDateTicksNumber(W,al);aq++){aw.push(N.getPoint(o.getDateTickValue(W,aq,al),true));V.push(ax[ag].getPoint(g.predict(aq+1)[1],true))}}else{for(var aq=1;aq<T.width;aq++){var ai=graphica.Utils.map(aq,0,T.width,N._min,N._max);if((O.reference_lines!="log"&&O.reference_lines!="power")||ai>0){aw.push(N.getPoint(ai,true));V.push(ax[ag].getPoint(g.predict(ai)[1],true))}}}}var ac=graphica.Utils.getPathFromCoor(aw,V,O.reference_lines_width,q||O.reference_lines_color,O.reference_lines_opacity);ac.addTo(A);if(R!="1Cx2"&&R!="2x1C"){ac.y(ag*(T.height/ax.length))}if(O.reference_lines=="linear"){ac.lastChild().addChild(new Grape("title").text(g.string+"\nr2: "+g.r2))}else{ac.lastChild().addChild(new Grape("title").text(g.string))}ac.lastChild()._mouseposition=true;if(R=="1Cx2"||R=="2x1C"){A.addChild(ac.getClip(new Grape("rect","svg").x(0).y(0).width(T.width).height(T.height)))}else{A.addChild(ac.getClip(new Grape("rect","svg").x(0).y(0).width(T.width).height(T.height/ax.length)))}if(ac.pixi){var S=new PIXI.Graphics();S.beginFill(16724736);if(R=="1Cx2"||R=="2x1C"){S.drawRect(T.x,T.y+(ag*(T.height)),T.width,T.height)}else{S.drawRect(T.x,T.y+(ag*(T.height/ax.length)),T.width,T.height/ax.length)}S.endFill();ac.pixi.mask=S}}}}else{if(O.reference_lines=="moving average"){var w=[];var ax=[];if(R=="1x1"){if((b.axis_x._is_date_type&&b.axis_y._is_variable_quantitative)||(b.axis_y._is_date_type&&b.axis_x._is_variable_quantitative)){w=[b.axis_x];ax=[b.axis_y]}}if(R=="2x2"){if((b.axis_x2._is_date_type&&b.axis_y2._is_variable_quantitative)||(b.axis_y2._is_date_type&&b.axis_x2._is_variable_quantitative)){w=[b.axis_x2];ax=[b.axis_y2]}}else{if(R=="1Cx2"||R=="1CxN"){if(b.axis_x._is_date_type){w=[b.axis_x];ax=b.naxis_y}}else{if(R=="2x1C"||R=="Nx1C"){if(b.axis_y._is_date_type){w=b.naxis_x;ax=[b.axis_y]}}else{if(R=="1x2"){if((b.axis_x._is_date_type&&b.axis_y2._is_variable_quantitative)||(b.axis_y2._is_date_type&&b.axis_x._is_variable_quantitative)){w=[b.axis_x];ax=[b.axis_y2]}}else{if(R=="2x1"){if((b.axis_x2._is_date_type&&b.axis_y._is_variable_quantitative)||(b.axis_y._is_date_type&&b.axis_x2._is_variable_quantitative)){w=[b.axis_x2];ax=[b.axis_y]}}else{if(R=="2CxN"){if(b.axis_x2._is_date_type){w=[b.axis_x2];ax=b.naxis_y}}else{if(R=="Nx2C"){if(b.axis_y2._is_date_type){ax=[b.axis_y2];w=b.naxis_x}}}}}}}}var ab=O.prev_moving_average_data_points;var F=O.next_moving_average_data_points;if(w.length&&ax.length){for(var at=0;at<w.length;at++){var E=w[at];for(var aq=0;aq<ax.length;aq++){var Y=[];var D=ax[aq];var am=[];var ak=[];var f;var C;if(E._is_date_type){f=E;C=D}else{f=D;C=E}if(!(M===null||C._variable==M)){continue}var m=o.getDateTicks(f._variable,f._tick_unit);var H=[];var X=[];o.eachRow(function(aB,aA){if(aB[f._variable]!==null){var aC=aB[f._variable].faststrformat(f._tick_unit);var t=m.ticks_strings.indexOf(aC);if(t!=-1){var k=o.getValue(aA,C._variable,C._stat);if(k!==null){if(typeof H[t]=="undefined"){H[t]=k;X[t]=1}else{X[t]++;H[t]+=k}}}}});for(var ap=0;ap<m.ticks_strings.length;ap++){var ao=0;var s=0;for(var af=Math.max(0,ap-ab);(af<=ap+F&&af<m.ticks_strings.length);af++){if(typeof X[af]==="undefined"){X[af]=0}if(typeof H[af]==="undefined"){H[af]=0}ao+=H[af];s+=X[af]}if(s){if(E._is_date_type){Y.push({x:E.getPoint(m.ticks[ap],true),y:D.getPoint((ao/s),true)})}else{Y.push({x:E.getPoint((ao/s),true),y:D.getPoint(m.ticks[ap],true)})}}}if(Y.length>1){var ac=new Grape().lineStyle(O.reference_lines_width,q||O.reference_lines_color,O.reference_lines_opacity);ac.beginFill("none");ac.beginPath();ac.moveTo(Y[0].x,Y[0].y);ac.splineCurve(Y);ac.endPath();ac.addTo(A);if(R=="1Cx2"||R=="2x1C"){ac.x(T.x).y(T.y)}else{ac.x(T.x+at*(T.width/w.length)).y(T.y+aq*(T.height/ax.length))}}}}}}else{if(["average","median","constant"].includes(O.reference_lines)){var B;var an;var ac=new Grape().lineStyle(O.reference_lines_width,q||O.reference_lines_color,O.reference_lines_opacity);if(O.reference_lines_type=="yline"&&(R=="1CxN"||R=="2CxN"||R=="1Cx2"||((R=="1x1"||R=="0x1"||R=="1Cx1"||R=="2x1")&&b.axis_y._is_variable_quantitative)||((R=="1x2"||R=="2x2")&&b.axis_y2._is_variable_quantitative))){var ax=[];if(R=="1CxN"||R=="2CxN"||R=="1Cx2"){ax=b.naxis_y}else{if(R=="1x2"||R=="2x2"){ax=[b.axis_y2]}else{ax=[b.axis_y]}}var aj=b._dataspace.height/ax.length;if(R=="1Cx2"){aj=0}for(var ay=0;ay<ax.length;ay++){if(!(M===null||ax[ay]._variable==M)){continue}if(["average","median"].includes(O.reference_lines)){an=o.getStats(ax[ay]._variable,ax[ay]._stat);B=O.reference_lines=="average"?an.average:an.median}else{B=O.reference_lines_constant}if(B>=ax[ay]._min&&B<=ax[ay]._max){B=ax[ay].getPoint(B)+aj*ay;ac.moveTo(T.x,T.y+B).lineTo(T.x+T.width,T.y+B);ac.addTo(A)}}}else{if(O.reference_lines_type=="xline"&&(R=="2x1C"||R=="Nx1C"||R=="Nx2C"||((R=="1x1"||R=="1x0"||R=="1x1C"||R=="1x2")&&b.axis_x._is_variable_quantitative)||((R=="2x1"||R=="2x2")&&b.axis_x2._is_variable_quantitative))){var w=[];if(R=="Nx1C"||R=="2x1C"||R=="Nx2C"){w=b.naxis_x}else{if(R=="2x1"||R=="2x2"){w=[b.axis_x2]}else{w=[b.axis_x]}}var h=b._dataspace.width/w.length;if(R=="2x1C"){h=0}for(var ay=0;ay<w.length;ay++){if(!(M===null||w[ay]._variable==M)){continue}if(["average","median"].includes(O.reference_lines)){an=o.getStats(w[ay]._variable,w[ay]._stat);B=O.reference_lines=="average"?an.average:an.median}else{B=O.reference_lines_constant}if(B>=w[ay]._min&&B<=w[ay]._max){B=w[ay].getPoint(B)+h*ay;var G=w[ay].getSpacePoint(B);ac.moveTo(T.x+B,T.y).lineTo(T.x+B,T.y+T.height);ac.addTo(A)}}}}}}}return A};graphica.StackedArray=function(c,e,a){this.ds=c;this.values={};if(Array.isArray(e)==false){e=[e]}this.categorical_variables=e;this.date_aggregations=[];for(var b=0;b<this.categorical_variables.length;b++){this.date_aggregations.push(a.getDateAggregation(this.categorical_variables[b]))}};graphica.StackedArray.fn=graphica.StackedArray.prototype;graphica.StackedArray.fn._getKey=function(c){var b=[];for(var a=0;a<this.categorical_variables.length;a++){if(this.ds.isDateType(this.categorical_variables[a])&&typeof c[this.categorical_variables[a]]!=="string"){if(this.date_aggregations[a]!==null){b.push(c[this.categorical_variables[a]].faststrformat(this.date_aggregations[a]))}else{b.push(c[this.categorical_variables[a]].faststrformat(this.ds.tickUnit(this.categorical_variables[a])))}}else{b.push(c[this.categorical_variables[a]])}}return b.join("\0")};graphica.StackedArray.fn.getElement=function(b){var a=this._getKey(b);return this.values[a]};graphica.StackedArray.fn.setElement=function(b,c){var a=this._getKey(b);this.values[a]=c};graphica.GreatCircle=function(f,b){this.start={lon:f.x,lat:f.y,x:(Math.PI/180)*f.x,y:(Math.PI/180)*f.y};this.end={lon:b.x,lat:b.y,x:(Math.PI/180)*b.x,y:(Math.PI/180)*b.y};var a=this.start.x-this.end.x;var c=this.start.y-this.end.y;this.dis=Math.sqrt(Math.pow(a,2)+Math.pow(c,2));var e=Math.pow(Math.sin(c/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(a/2),2);this.g=2*Math.asin(Math.sqrt(e))};graphica.GreatCircle.prototype.interpolate=function(c){var b=Math.sin((1-c)*this.g)/Math.sin(this.g);var m=Math.sin(c*this.g)/Math.sin(this.g);var a=b*Math.cos(this.start.y)*Math.cos(this.start.x)+m*Math.cos(this.end.y)*Math.cos(this.end.x);var k=b*Math.cos(this.start.y)*Math.sin(this.start.x)+m*Math.cos(this.end.y)*Math.sin(this.end.x);var h=b*Math.sin(this.start.y)+m*Math.sin(this.end.y);var e=(180/Math.PI)*Math.atan2(h,Math.sqrt(Math.pow(a,2)+Math.pow(k,2)));var g=(180/Math.PI)*Math.atan2(k,a);return[g,e]};graphica.GreatCircle.prototype.arc=function(){var F=20;if(this.g==Math.PI||isNaN(this.g)){F=2}if(this.dis<0.1){F=2}else{F=1+Math.round(this.dis/0.1)}var h=[];if(this.start.lon==this.end.lon&&this.start.lat==this.end.lat){h.push([this.start.lon,this.start.lat]);h.push([this.end.lon,this.end.lat]);return[h]}else{if(!F||F<=2){h.push([this.start.lon,this.start.lat]);h.push([this.end.lon,this.end.lat])}else{var O=1/(F-1);for(var K=0;K<F;++K){var s=O*K;var G=this.interpolate(s);h.push(G)}}}var w=false;var q=0;var A=100;var N=180-A;var m=-180+A;var f=360-A;for(var J=1;J<h.length;++J){var a=h[J-1][0];var g=h[J][0];var b=Math.abs(g-a);if(b>f&&((g>N&&a<m)||(a>N&&g<m))){w=true}else{if(b>q){q=b}}}var t=[];if(w&&q<A){var B=[];t.push(B);for(var I=0;I<h.length;++I){var p=parseFloat(h[I][0]);if(I>0&&Math.abs(p-h[I-1][0])>f){var o=parseFloat(h[I-1][0]);var E=parseFloat(h[I-1][1]);var n=parseFloat(h[I][0]);var D=parseFloat(h[I][1]);if(o>-180&&o<m&&n==180&&I+1<h.length&&h[I-1][0]>-180&&h[I-1][0]<m){B.push([-180,h[I][1]]);I++;B.push([h[I][0],h[I][1]]);continue}else{if(o>N&&o<180&&n==-180&&I+1<h.length&&h[I-1][0]>N&&h[I-1][0]<180){B.push([180,h[I][1]]);I++;B.push([h[I][0],h[I][1]]);continue}}if(o<m&&n>N){var M=o;o=n;n=M;var L=E;E=D;D=L}if(o>N&&n<m){n+=360}if(o<=180&&n>=180&&o<n){var c=(180-o)/(n-o);var e=c*D+(1-c)*E;B.push([h[I-1][0]>N?180:-180,e]);B=[];B.push([h[I-1][0]>N?-180:180,e]);t.push(B)}else{B=[];t.push(B)}B.push([p,h[I][1]])}else{B.push([h[I][0],h[I][1]])}}}else{var C=[];t.push(C);for(var H=0;H<h.length;++H){C.push([h[H][0],h[H][1]])}}return t};graphica.FibonacciHeap=function(a){this.minNode=undefined;this.nodeCount=0;if(a){this.compare=a}};graphica.FibonacciHeap.prototype.clear=function(){this.minNode=undefined;this.nodeCount=0};graphica.FibonacciHeap.prototype.decreaseKey=function(b,c){if(typeof b==="undefined"){throw new Error("Cannot decrease key of non-existent node")}if(this.compare({key:c},{key:b.key})>0){throw new Error("New key is larger than old key")}b.key=c;var a=b.parent;if(a&&this.compare(b,a)<0){graphica.FibonacciHeapUtils.cut(b,a,this.minNode,this.compare);graphica.FibonacciHeapUtils.cascadingCut(a,this.minNode,this.compare)}if(this.compare(b,this.minNode)<0){this.minNode=b}};graphica.FibonacciHeap.prototype.extractMinimum=function(){var b=this.minNode;if(b){if(b.child){var c=b.child;do{c.parent=undefined;c=c.next}while(c!==b.child)}var a;if(b.next!==b){a=b.next}graphica.FibonacciHeapUtils.removeNodeFromList(b);this.nodeCount--;this.minNode=graphica.FibonacciHeapUtils.mergeLists(a,b.child,this.compare);if(this.minNode){this.minNode=graphica.FibonacciHeapUtils.consolidate(this.minNode,this.compare)}}return b};graphica.FibonacciHeap.prototype.findMinimum=function(){return this.minNode};graphica.FibonacciHeap.prototype.insert=function(a,c){var b=new graphica.FibonacciHeapUtils.Node(a,c);this.minNode=graphica.FibonacciHeapUtils.mergeLists(this.minNode,b,this.compare);this.nodeCount++;return b};graphica.FibonacciHeap.prototype.isEmpty=function(){return this.minNode===undefined};graphica.FibonacciHeap.prototype.size=function(){if(this.isEmpty()){return 0}return graphica.FibonacciHeapUtils.getNodeListSize(this.minNode)};graphica.FibonacciHeap.prototype.union=function(a){this.minNode=graphica.FibonacciHeapUtils.mergeLists(this.minNode,a.minNode,this.compare);this.nodeCount+=a.nodeCount};graphica.FibonacciHeap.prototype.compare=function(e,c){if(e.key>c.key){return 1}if(e.key<c.key){return -1}return 0};graphica.FibonacciHeapUtils={};graphica.FibonacciHeapUtils.NodeListIterator=function(b){this.index=-1;this.items=[];var a=b;do{this.items.push(a);a=a.next}while(b!==a)};graphica.FibonacciHeapUtils.NodeListIterator.prototype.hasNext=function(){return this.index<this.items.length-1};graphica.FibonacciHeapUtils.NodeListIterator.prototype.next=function(){return this.items[++this.index]};graphica.FibonacciHeapUtils.cut=function(b,a,e,c){b.parent=undefined;a.degree--;if(b.next===b){a.child=undefined}else{a.child=b.next}graphica.FibonacciHeapUtils.removeNodeFromList(b);e=graphica.FibonacciHeapUtils.mergeLists(e,b,c);b.isMarked=false;return e};graphica.FibonacciHeapUtils.cascadingCut=function(b,e,c){var a=b.parent;if(a){if(b.isMarked){e=graphica.FibonacciHeapUtils.cut(b,a,e,c);e=graphica.FibonacciHeapUtils.cascadingCut(a,e,c)}else{b.isMarked=true}}return e};graphica.FibonacciHeapUtils.consolidate=function(h,f){var a=[];var e=new graphica.FibonacciHeapUtils.NodeListIterator(h);while(e.hasNext()){var g=e.next();while(a[g.degree]){if(f(g,a[g.degree])>0){var b=g;g=a[g.degree];a[g.degree]=b}graphica.FibonacciHeapUtils.linkHeaps(a[g.degree],g,f);a[g.degree]=undefined;g.degree++}a[g.degree]=g}h=undefined;for(var c=0;c<a.length;c++){if(a[c]){a[c].next=a[c];a[c].prev=a[c];h=graphica.FibonacciHeapUtils.mergeLists(h,a[c],f)}}return h};graphica.FibonacciHeapUtils.removeNodeFromList=function(c){var b=c.prev;var a=c.next;b.next=a;a.prev=b;c.next=c;c.prev=c};graphica.FibonacciHeapUtils.linkHeaps=function(a,b,c){graphica.FibonacciHeapUtils.removeNodeFromList(a);b.child=graphica.FibonacciHeapUtils.mergeLists(a,b.child,c);a.parent=b;a.isMarked=false};graphica.FibonacciHeapUtils.mergeLists=function(e,c,g){if(!e&&!c){return undefined}if(!e){return c}if(!c){return e}var f=e.next;e.next=c.next;e.next.prev=e;c.next=f;c.next.prev=c;return g(e,c)<0?e:c};graphica.FibonacciHeapUtils.getNodeListSize=function(b){var a=0;var c=b;do{a++;if(c.child){a+=graphica.FibonacciHeapUtils.getNodeListSize(c.child)}c=c.next}while(c!==b);return a};graphica.FibonacciHeapUtils.Node=function(a,b){this.key=a;this.value=b;this.prev=this;this.next=this;this.degree=0;this.parent=undefined;this.child=undefined;this.isMarked=undefined};graphica.Utils.approximateBezier=function(e,h){var a=function(q,p){var o=1;for(var m=q-p+1;m<=q;m++){o*=m}for(m=1;m<=p;m++){o/=m}return o};var g=[];var c=0;e.forEach(function(k){k.binom=a(e.length-1,c);c+=1});for(var b=0;b<=1;b+=1/(h)){var f={x:0,y:0};var c=0;e.forEach(function(k){var n=Math.pow((1-b),e.length-1-c);var m=n*Math.pow(b,c);f.x+=k.binom*m*k.x;f.y+=k.binom*m*k.y;c+=1});g.push(f)}g.push({x:e[e.length-1].x,y:e[e.length-1].y});return g};graphica.RangeSlider=function(b,c,f,g,m,e,a,h,n){var k=this;this.width=b;this.reversed=f;if(typeof e=="undefined"){this.scale="lin"}else{if(e!="log2"&&e!="log10"){e="lin"}this.scale=e}this.orientation=c;this.range=g;if(n){this.rangeType="continuous"}else{this.rangeType="discrete"}if(this.rangeType=="discrete"){this.range.min=g[0];this.range.max=g[g.length-1]}this.update_fn=m;if(typeof a==="undefined"){this.current_min=g.min}else{this.current_min=a;if(this.rangeType=="continuous"){this.current_min=Math.max(this.current_min,g.min)}else{if(g.indexOf(this.current_min)==-1){this.current_min=g.min}}}if(typeof h==="undefined"){this.current_max=g.max}else{this.current_max=h;if(this.rangeType=="continuous"){this.current_max=Math.min(this.current_max,g.max)}else{if(g.indexOf(this.current_max)==-1){this.current_max=g.max}}}this.start_grape=new Grape();this.end_grape=new Grape();this.range_grape=new Grape();this.gr=new Grape();if(this.range.max!=this.range.min){this.gr._reset_slider=function(){k.reset()};this.start_grape.lineStyle(3,"#5c96f8").beginFill("white").circle(0,0,6);this.end_grape.lineStyle(3,"#5c96f8").beginFill("white").circle(0,0,6);this.range_grape.addTo(this.gr);this.start_grape.addTo(this.gr);this.end_grape.addTo(this.gr);this.updateMinMax();this.updateRangeGrape();if(this.current_min==this.current_max){if(this.orientation=="vertical"){if(this.current_min==this.range.min){this.start_grape.toFront()}if(this.current_max==this.range.max){this.end_grape.toFront()}}else{if(this.current_min==this.range.min){this.end_grape.toFront()}if(this.current_max==this.range.max){this.start_grape.toFront()}}}this.end_grape.drag(function(o){if(k.orientation=="vertical"){k._diff_mouse=raceme.cursorPoint(o).y-(this.y()+k.gr.y())}else{k._diff_mouse=raceme.cursorPoint(o).x-(this.x()+k.gr.x())}},function(q){var o;if(k.orientation=="vertical"){o=raceme.cursorPoint(q).y-k.gr.y()-k._diff_mouse}else{o=raceme.cursorPoint(q).x-k.gr.x()-k._diff_mouse}if(k.rangeType=="discrete"){var p=k.width/(k.range.length-1);o=parseInt((o+p/2)/p)*p}if(k.orientation=="horizontal"){o=Math.max(o,k.start_grape.x());o=Math.min(o,k.width);this.x(o)}else{o=Math.max(o,0);o=Math.min(o,k.start_grape.y());this.y(o)}k.updateRangeGrape();k.updateCall()},function(o){this.toFront()});this.start_grape.drag(function(o){if(k.orientation=="vertical"){k._diff_mouse=raceme.cursorPoint(o).y-(this.y()+k.gr.y())}else{k._diff_mouse=raceme.cursorPoint(o).x-(this.x()+k.gr.x())}},function(q){var o;if(k.orientation=="vertical"){o=raceme.cursorPoint(q).y-k.gr.y()-k._diff_mouse}else{o=raceme.cursorPoint(q).x-k.gr.x()-k._diff_mouse}if(k.rangeType=="discrete"){var p=k.width/(k.range.length-1);o=parseInt((o+p/2)/p)*p}if(k.orientation=="horizontal"){o=Math.max(o,0);o=Math.min(o,k.end_grape.x());this.x(o)}else{o=Math.min(o,k.width);o=Math.max(o,k.end_grape.y());this.y(o)}k.updateRangeGrape();k.updateCall()},function(o){this.toFront()});this.range_grape.drag(function(o){if(k.orientation=="vertical"){k._diff_mouse=raceme.cursorPoint(o).y-(this.y()+k.gr.y())}else{k._diff_mouse=raceme.cursorPoint(o).x-(this.x()+k.gr.x())}},function(p){var q;if(k.orientation=="vertical"){q=raceme.cursorPoint(p).y-k.gr.y()-k._diff_mouse}else{q=raceme.cursorPoint(p).x-k.gr.x()-k._diff_mouse}if(k.rangeType=="discrete"){var o=k.width/(k.range.length-1);q=parseInt((q+o/2)/o)*o}if(k.orientation=="horizontal"){q=Math.max(q,0);q=Math.min(q,k.width-(k.end_grape.x()-k.start_grape.x()));k.end_grape.x(q+(k.end_grape.x()-k.start_grape.x()));k.start_grape.x(q);k.updateRangeGrape();k.updateCall()}else{q=Math.max(q,0);q=Math.min(q,k.width-(k.start_grape.y()-k.end_grape.y()));k.start_grape.y(q+(k.start_grape.y()-k.end_grape.y()));k.end_grape.y(q);k.updateRangeGrape();k.updateCall()}},function(o){})}};graphica.RangeSlider.fn=graphica.RangeSlider.prototype;graphica.RangeSlider.fn.reset=function(){if(this.rangeType=="continuous"){this.current_min=this.range.min}else{this.current_min=this.range[0]}if(this.rangeType=="continuous"){this.current_max=this.range.max}else{this.current_max=this.range[this.range.length-1]}this.updateMinMax();this.updateRangeGrape()};graphica.RangeSlider.fn.getGrape=function(){return this.gr};graphica.RangeSlider.fn.updateRangeGrape=function(){if(this.orientation=="horizontal"){this.range_grape.clear().x(this.start_grape.x()).beginFill("#5c96f8",0).rect(0,-8,this.end_grape.x()-this.start_grape.x(),16).beginFill("#5c96f8").rect(0,-2,this.end_grape.x()-this.start_grape.x(),4)}else{this.range_grape.clear().y(this.end_grape.y()).beginFill("#5c96f8",0).rect(-8,0,16,this.start_grape.y()-this.end_grape.y()).beginFill("#5c96f8").rect(-2,0,4,this.start_grape.y()-this.end_grape.y())}};graphica.RangeSlider.fn.updateCall=function(){var e=this.current_min;var b=this.current_max;var c=graphica.Utils.map;if(this.rangeType=="continuous"){if(this.orientation=="horizontal"){if(this.scale=="lin"){if(this.reversed){this.current_min=c(this.end_grape.x(),this.width,0,this.range.min,this.range.max);this.current_max=c(this.start_grape.x(),this.width,0,this.range.min,this.range.max)}else{this.current_min=c(this.start_grape.x(),0,this.width,this.range.min,this.range.max);this.current_max=c(this.end_grape.x(),0,this.width,this.range.min,this.range.max)}}else{if(this.scale=="log2"||this.scale=="log10"){if(this.reversed){this.current_min=graphica.Utils.mapLin2Log(this.end_grape.x(),this.width,0,this.range.min,this.range.max);this.current_max=graphica.Utils.mapLin2Log(this.start_grape.x(),this.width,0,this.range.min,this.range.max)}else{this.current_min=graphica.Utils.mapLin2Log(this.start_grape.x(),0,this.width,this.range.min,this.range.max);this.current_max=graphica.Utils.mapLin2Log(this.end_grape.x(),0,this.width,this.range.min,this.range.max)}}}}else{if(this.scale=="lin"){if(this.reversed){this.current_min=c(this.end_grape.y(),0,this.width,this.range.min,this.range.max);this.current_max=c(this.start_grape.y(),0,this.width,this.range.min,this.range.max)}else{this.current_min=c(this.start_grape.y(),this.width,0,this.range.min,this.range.max);this.current_max=c(this.end_grape.y(),this.width,0,this.range.min,this.range.max)}}else{if(this.scale=="log2"||this.scale=="log10"){if(this.reversed){this.current_min=graphica.Utils.mapLin2Log(this.width-this.end_grape.y(),this.width,0,this.range.min,this.range.max);this.current_max=graphica.Utils.mapLin2Log(this.width-this.start_grape.y(),this.width,0,this.range.min,this.range.max)}else{this.current_min=graphica.Utils.mapLin2Log(this.width-this.start_grape.y(),0,this.width,this.range.min,this.range.max);this.current_max=graphica.Utils.mapLin2Log(this.width-this.end_grape.y(),0,this.width,this.range.min,this.range.max)}}}}}else{var a=this.width/(this.range.length-1);var g;var f;if(this.orientation=="horizontal"){g=Math.round(this.start_grape.x()/a);f=Math.round(this.end_grape.x()/a);if(this.reversed){this.current_min=this.range[this.range.length-1-f];this.current_max=this.range[this.range.length-1-g]}else{this.current_min=this.range[g];this.current_max=this.range[f]}}else{g=Math.round(this.end_grape.y()/a);f=Math.round(this.start_grape.y()/a);if(this.reversed){this.current_min=this.range[this.range.length-1-f];this.current_max=this.range[this.range.length-1-g]}else{this.current_min=this.range[g];this.current_max=this.range[f]}}}if(e!=this.current_min||b!=this.current_max){this.update_fn.call(this,this.current_min,this.current_max)}};graphica.RangeSlider.fn.updateMinMax=function(){if(this.rangeType=="continuous"){if(this.orientation=="horizontal"){this.start_grape.x(graphica.Utils.map(this.current_min,this.range.min,this.range.max,0,this.width));this.end_grape.x(graphica.Utils.map(this.current_max,this.range.min,this.range.max,0,this.width))}else{this.start_grape.y(graphica.Utils.map(this.current_min,this.range.min,this.range.max,this.width,0));this.end_grape.y(graphica.Utils.map(this.current_max,this.range.min,this.range.max,this.width,0))}}else{var a=this.range.indexOf(this.current_min);if(a==-1){a=0}var c=this.range.indexOf(this.current_max);if(c==-1){c=0}if(c<a){c=a}var b=this.width/(this.range.length-1);if(this.orientation=="horizontal"){this.start_grape.x(a*b);this.end_grape.x(c*b)}else{this.start_grape.y(c*b);this.end_grape.y(a*b)}}};graphica.Queue=function(b,a){this.data=b||[];this.length=this.data.length;this.compare=a||function(e,c){return e<c?-1:e>c?1:0};if(this.length>0){for(let i=(this.length>>1)-1;i>=0;i--){this._down(i)}}};graphica.Queue.prototype.push=function(a){this.data.push(a);this.length++;this._up(this.length-1)};graphica.Queue.prototype.pop=function(){if(this.length===0){return undefined}const b=this.data[0];const a=this.data.pop();this.length--;if(this.length>0){this.data[0]=a;this._down(0)}return b};graphica.Queue.prototype.peek=function(){return this.data[0]};graphica.Queue.prototype._up=function(g){const e=this.data;const c=this.compare;const b=e[g];while(g>0){const a=(g-1)>>1;const f=e[a];if(c(b,f)>=0){break}e[g]=f;g=a}e[g]=b};graphica.Queue.prototype._down=function(g){const f=this.data;const e=this.compare;const c=this.length>>1;const b=f[g];while(g<c){let left=(g<<1)+1;let best=f[left];const a=left+1;if(a<this.length&&e(f[a],best)<0){left=a;best=f[a]}if(e(best,b)>=0){break}f[g]=best;g=left}f[g]=b};graphica.Quadtree=function(c,b,a,e){this.max_objects=b||10;this.max_levels=a||4;this.level=e||0;this.bounds=c;this.objects=[];this.nodes=[]};graphica.Quadtree.prototype.split=function(){var c=this.level+1,b=Math.round(this.bounds.width/2),e=Math.round(this.bounds.height/2),a=Math.round(this.bounds.x),f=Math.round(this.bounds.y);this.nodes[0]=new graphica.Quadtree({x:a+b,y:f,width:b,height:e},this.max_objects,this.max_levels,c);this.nodes[1]=new graphica.Quadtree({x:a,y:f,width:b,height:e},this.max_objects,this.max_levels,c);this.nodes[2]=new graphica.Quadtree({x:a,y:f+e,width:b,height:e},this.max_objects,this.max_levels,c);this.nodes[3]=new graphica.Quadtree({x:a+b,y:f+e,width:b,height:e},this.max_objects,this.max_levels,c)};graphica.Quadtree.prototype.getIndex=function(b){var a=-1,e=this.bounds.x+(this.bounds.width/2),f=this.bounds.y+(this.bounds.height/2),c=(b.y<f&&b.y+b.height<f),g=(b.y>f);if(b.x<e&&b.x+b.width<e){if(c){a=1}else{if(g){a=2}}}else{if(b.x>e){if(c){a=0}else{if(g){a=3}}}}return a};graphica.Quadtree.prototype.insert=function(c){var b=0,a;if(typeof this.nodes[0]!=="undefined"){a=this.getIndex(c);if(a!==-1){this.nodes[a].insert(c);return}}this.objects.push(c);if(this.objects.length>this.max_objects&&this.level<this.max_levels){if(typeof this.nodes[0]==="undefined"){this.split()}while(b<this.objects.length){a=this.getIndex(this.objects[b]);if(a!==-1){this.nodes[a].insert(this.objects.splice(b,1)[0])}else{b=b+1}}}};graphica.Quadtree.prototype.retrieve=function(c){var a=this.getIndex(c),e=this.objects;if(typeof this.nodes[0]!=="undefined"){if(a!==-1){e=e.concat(this.nodes[a].retrieve(c))}else{for(var b=0;b<this.nodes.length;b=b+1){e=e.concat(this.nodes[b].retrieve(c))}}}return e};graphica.Quadtree.prototype.clear=function(){this.objects=[];for(var a=0;a<this.nodes.length;a=a+1){if(typeof this.nodes[a]!=="undefined"){this.nodes[a].clear()}}this.nodes=[]};graphica.FormData=function(){this._x=0;this._y=0;this._radius=0;this._form=graphica.FILLED_DISK;this._color="#000000";this._allow_label_overlapping=false;this._allow_label_mark_overlapping=false;this._orientation="horizontal";this._reversed=false;this._is_mark_of_line=false};graphica.FormData.fn=graphica.FormData.prototype;graphica.FormData.fn.x=function(a){if(typeof a==="undefined"){return this._x}this._x=a;return this};graphica.FormData.fn.y=function(a){if(typeof a==="undefined"){return this._y}this._y=a;return this};graphica.FormData.fn.radius=function(a){if(typeof a==="undefined"){return this._radius}this._radius=a;return this};graphica.FormData.fn.form=function(a){if(typeof a==="undefined"){return this._form}this._form=a;return this};graphica.FormData.fn.color=function(a){if(typeof a==="undefined"){return this._color}this._color=a;return this};graphica.FormData.fn.width=function(a){if(typeof a==="undefined"){if(typeof this._width==="undefined"){return this.radius()*2}else{return this._width}}this._width=a;return this};graphica.FormData.fn.height=function(a){if(typeof a==="undefined"){if(typeof this._height==="undefined"){return this.radius()*2}else{return this._height}}this._height=a;return this};graphica.FormData.fn.allow_label_overlapping=function(a){if(typeof a!=="boolean"){return this._allow_label_overlapping}this._allow_label_overlapping=a;return this};graphica.FormData.fn.allow_label_mark_overlapping=function(a){if(typeof a!=="boolean"){return this._allow_label_mark_overlapping}this._allow_label_mark_overlapping=a;return this};graphica.FormData.fn.orientation=function(a){if(typeof a==="undefined"){return this._orientation}if(a=="horizontal"||a=="vertical"){this._orientation=a}return this};graphica.FormData.fn.poligon=function(a){if(typeof a==="undefined"){return this._poligon}this._poligon=a;return this};graphica.FormData.fn.parent=function(a){if(typeof a==="undefined"){return this._parent}this._parent=a;return this};graphica.FormData.fn.xin=function(a){if(typeof a==="undefined"){return this._xin}this._xin=a;return this};graphica.FormData.fn.yin=function(a){if(typeof a==="undefined"){return this._yin}this._yin=a;return this};graphica.FormData.fn.xout=function(a){if(typeof a==="undefined"){return this._xout}this._xout=a;return this};graphica.FormData.fn.yout=function(a){if(typeof a==="undefined"){return this._yout}this._yout=a;return this};graphica.FormData.fn.init_angle=function(a){if(typeof a==="undefined"){return this._init_angle}this._init_angle=a;return this};graphica.FormData.fn.end_angle=function(a){if(typeof a==="undefined"){return this._end_angle}this._end_angle=a;return this};graphica.FormData.fn.end_angle=function(a){if(typeof a==="undefined"){return this._end_angle}this._end_angle=a;return this};graphica.FormData.fn.angle=function(a){if(typeof a==="undefined"){return this._angle}this._angle=a;return this};graphica.FormData.fn.reversed=function(a){if(typeof a!=="boolean"){return this._reversed}this._reversed=a;return this};graphica.LabelGroup=function(a,b){GrapeGroup.call(this);this._properties=a;this._frame=b;this._label_distance=10};graphica.LabelGroup.prototype=Object.create(GrapeGroup.prototype);graphica.LabelGroup.prototype.constructor=graphica.LabelGroup;graphica.LabelGroup.fn=graphica.LabelGroup.prototype;graphica.LabelGroup.fn.check_overlapping=function(p){if(typeof p!=="boolean"){p=true}if(!this.length||this._properties.label_allow_overlapping){return}var q=performance.now();var e;var c;var a=[];var b=[];for(var m=0;m<this.length;m++){c=this.item(m);if(performance.now()-q>3000){for(var A=m;A<this.length;A++){a[A]=0}break}if(typeof c._original_opacity!=="undefined"){a[m]=c._original_opacity}else{a[m]=1}b[m]=false;if(c._is_hidden_by_filter&&typeof c._prev_highlight_opacity!=="undefined"){a[m]=c._prev_highlight_opacity;continue}if(c._hide_by_highlight||c._is_hidden_by_filter||c._is_hidden_by_overflow){a[m]=0;continue}if(c._refelm._form_data.allow_label_overlapping()||c._tmp_highlight_allow_overlap){continue}if(typeof c._polygon_from_rotated_text!="undefined"){c._tmpbbox=c._tmpbbox||c.getBBox()}else{c._tmpbbox=c.getBBox()}for(var o=0;o<this.length;o++){e=this.item(o);if(e._hide_by_highlight||e._is_hidden_by_filter){continue}if(o<m&&a[o]>0){if(typeof c._polygon_from_rotated_text!=="undefined"){if(graphica.Utils.intersectPolygons(c._polygon_from_rotated_text,e._polygon_from_rotated_text)){a[m]=0;b[m]=true;break}}else{if(graphica.Utils.intersectRect(c._tmpbbox,e._tmpbbox,-4)){a[m]=0;b[m]=true;break}}}if(c._refelm._form_data.allow_label_mark_overlapping()){continue}if(o!=m&&e._refelm._form_data.form()!=graphica.SLICE&&e._refelm._form_data.form()!=graphica.RADAR_SLICE&&e._refelm._form_data.form()!=graphica.POLAR_SLICE&&this._properties.default_form!=graphica.LINE&&this._properties.default_form!=graphica.AREALINE){var n=e._refelm.scale();if(e._refelm._form_data.form()==graphica.BAR||e._refelm._form_data.form()==graphica.FILLED_BOX){var k;var h;var k={x:e._refelm.x()-e._refelm._form_data.width()/2,y:e._refelm.y()-e._refelm._form_data.height()/2,width:e._refelm._form_data.width(),height:e._refelm._form_data.height()};h=c._tmpbbox;if(graphica.Utils.intersectRect(k,h)){a[m]=0;b[m]=true;break}}else{var f;var g;f={x:e._refelm.x()/n,y:e._refelm.y()/n,radius:e._refelm._form_data.radius()};g={x:c.x()/n-c._tmpbbox.width/2,y:c.y()/n-c._tmpbbox.height/2,width:c._tmpbbox.width,height:c._tmpbbox.height};if(graphica.Utils.intersectRectCircle(g,f)){a[m]=0;b[m]=true}}}}}for(m=0;m<this.length;m++){if(p){this.item(m).opacity(a[m])}if(b[m]){this.item(m).enableEvents(false)}this.item(m)._is_hidden_by_overlap=b[m];if(typeof this._prev_highlight_opacity!=="undefined"){delete this._prev_highlight_opacity}}};graphica.LabelGroup.fn.changeContrastColor=function(f,e){var c=f.attr("fill");var a=raceme._getContrastColor(c);var b=raceme._getContrastColor(e.color());if(a==b){f.attr("fill",b)}};graphica.LabelGroup.fn.automatic_placement=function(a,g){if(!this.length){return}g=g||[];var o;var F;var A;var s;var f;var c;var J=new Array();var t=false;var b=(this._properties.label_auto_contrast!==false&&this._properties.stroke_on_labels==false);var I=this._properties.label_placement;var k=this._properties.label_align;var E=this._properties.label_vertical_align;if(!I){I="automatic"}var G=I;if(this.item(0)._refelm._form_data.form()==graphica.FILLED_RECTANGLE){for(o=0;o<this.length;o++){f=this.item(o);c=f._refelm._form_data;if(b&&c.color()){this.changeContrastColor(f,c)}}return}if(I=="automatic"){if(this.item(0)._refelm._form_data.form()==graphica.SLICE||this.item(0)._refelm._form_data.form()==graphica.RADAR_SLICE||this.item(0)._refelm._form_data.form()==graphica.POLAR_SLICE){I="out"}else{if(this.item(0)._refelm._form_data.form()==graphica.BAR){if(this.item(0)._refelm._form_data.orientation()=="horizontal"){I="in";k="left"}else{I="out";E="top"}}else{if(this.item(0)._refelm._form_data.form()==graphica.GEO_SHAPE){I="in"}else{if(this.item(0)._refelm._form_data.form()==graphica.AREALINE){if(this._properties.oneLine_oneLabel){I="in"}else{I="out"}}else{if(this.item(0)._refelm._form_data.form()==graphica.NONE_SHAPE&&!this.item(0)._refelm._form_data._is_mark_of_line){I="in"}}}}}}else{if(I=="out"){if(this.item(0)._refelm._form_data.form()==graphica.GEO_SHAPE){I="in"}}else{if(I=="in"){if(this.item(0)._refelm._form_data.form()==graphica.AREALINE&&!this._properties.oneLine_oneLabel){I="out"}}}}if(this.item(0)._refelm._form_data.form()==graphica.AREALINE){if(this.item(0)._refelm._form_data.poligon()){for(o=0;o<this.length;o++){if(this.item(o)._refelm._form_data.poligon()[0].length&&I=="in"){var C=graphica.Utils.polylabel(this.item(o)._refelm._form_data.poligon(),1);this.item(o)._refelm._form_data.x(C[0]).y(C[1])}else{if(this.item(o)._refelm._form_data.poligon()[0].length&&I=="out"){}else{this.item(o)._refelm._form_data.x(0).y(0)}}}}}if(I=="radial"){var q={x:this._frame._dataspace.x+this._frame._dataspace.width/2,y:this._frame._dataspace.y+this._frame._dataspace.height/2};for(o=0;o<this.length;o++){f=this.item(o);f.align("center");f._tmpbbox=f._tmpbbox||f.getBBox();c=f._refelm._form_data;c.allow_label_mark_overlapping(true);var A;var s;var m=0;if(c.form()==graphica.SLICE){A=c.parent().x()+c.xout();s=c.parent().y()+c.yout()}else{if(c.form()==graphica.POLAR_SLICE||c.form()==graphica.RADAR_SLICE){A=c.parent().x()+c.xin();s=c.parent().y()+c.yin()}else{if(c.form()==graphica.GEO_SHAPE||c.form()==graphica.AREALINE){A=c.x();s=c.y()}else{m=(c._form==graphica.NONE_SHAPE)?0:c._radius;A=f._refelm.x();s=f._refelm.y()}}}lblbb=f._tmpbbox;var n=raceme.rect2polar(A-q.x,s-q.y).angle;if(n<90||n>270){f.rotation(n);f.x(A+raceme.polar2rect(m+4+(lblbb.width/2),n).x/a);f.y(s+raceme.polar2rect(m+4+(lblbb.width/2),n).y/a)}else{f.x(A+raceme.polar2rect(m+4+(lblbb.width/2),n).x/a);f.y(s+raceme.polar2rect(m+4+(lblbb.width/2),n).y/a);f.rotation(n+180)}f._polygon_from_rotated_text=[];f._polygon_from_rotated_text.push(graphica.Utils.rotatePoint(f.x()-lblbb.width/2/a,f.y()-lblbb.height/2/a,f.x(),f.y(),n));f._polygon_from_rotated_text.push(graphica.Utils.rotatePoint(f.x()+lblbb.width/2/a,f.y()-lblbb.height/2/a,f.x(),f.y(),n));f._polygon_from_rotated_text.push(graphica.Utils.rotatePoint(f.x()+lblbb.width/2/a,f.y()+lblbb.height/2/a,f.x(),f.y(),n));f._polygon_from_rotated_text.push(graphica.Utils.rotatePoint(f.x()-lblbb.width/2/a,f.y()+lblbb.height/2/a,f.x(),f.y(),n))}}else{if(I=="in"){for(o=0;o<this.length;o++){f=this.item(o);c=f._refelm._form_data;var H=false;f.align(k);if(c.form()!=graphica.RADAR_SLICE&&c.form()!=graphica.POLAR_SLICE){if(E=="top"){f.verticalAlign("bottom")}else{if(E=="bottom"){f.verticalAlign("top")}else{f.verticalAlign(E)}}}if(c.form()==graphica.SLICE||c.form()==graphica.RADAR_SLICE||c.form()==graphica.POLAR_SLICE){f._tmpbbox=f._tmpbbox||f.getBBox();A=c.parent().x()+c.xin()/a;s=c.parent().y()+c.yin()/a}else{if(c.form()==graphica.GEO_SHAPE){A=c.x();s=c.y()}else{if(c.form()==graphica.AREALINE){A=c.x();s=c.y();f._tmpbbox=f._tmpbbox||f.getBBox();if(A+2+f._tmpbbox.width/2>this._frame._dataspace.x+this._frame._dataspace.width){A=this._frame._dataspace.x+this._frame._dataspace.width-f._tmpbbox.width/2}else{if(A-2-f._tmpbbox.width/2<this._frame._dataspace.x){A=this._frame._dataspace.x+f._tmpbbox.width/2}}}else{if(c.form()==graphica.BAR){f._tmpbbox=f._tmpbbox||f.getBBox();if(G=="automatic"){t=true}if(G=="automatic"&&c.orientation()=="horizontal"&&f._tmpbbox.width+4>c.width()&&c.width()+f._tmpbbox.width+4<this._frame._dataspace.width){if(c.reversed()){A=f._refelm.x()-c.width()/2-3;H=true;f.align("right")}else{A=f._refelm.x()+c.width()/2+3;H=true;f.align("left")}}else{if((k=="left"&&!c.reversed())||(k=="right"&&c.reversed())){A=f._refelm.x()-c.width()/2+2;f.align("left")}else{if((k=="right"&&!c.reversed())||(k=="left"&&c.reversed())){A=f._refelm.x()+c.width()/2-2;f.align("right")}else{A=f._refelm.x();f.align("center")}}}if(G=="automatic"&&c.orientation()=="vertical"&&f._tmpbbox.height+4>c.height()&&c.height()+f._tmpbbox.height+4<this._frame._dataspace.height){if(c.reversed()){s=f._refelm.y()+c.height()/2+3;H=true;f.verticalAlign("top")}else{s=f._refelm.y()-c.height()/2-3;H=true;f.verticalAlign("bottom")}}else{if((E=="top"&&!c.reversed())||(E=="bottom"&&c.reversed())){s=f._refelm.y()-c.height()/2+f._tmpbbox.height}else{if((E=="bottom"&&!c.reversed())||(E=="top"&&c.reversed())){f.verticalAlign("bottom");s=f._refelm.y()+c.height()/2-2}else{s=f._refelm.y()}}}f._finallyOutside=H}else{f._tmpbbox=f._tmpbbox||f.getBBox();if(f._tmpbbox&&c&&(f._tmpbbox.width>c.width()||f._tmpbbox.height>c.height())){H=true}A=f._refelm.x();s=f._refelm.y()}}}}f.x(A);f.y(s);if(c.form()==graphica.BAR&&!H){f._tmpbbox=f._tmpbbox||f.getBBox();var B=f._refelm._form_data._orientation;if(f._tmpbbox&&c&&((f._tmpbbox.width>c.width()&&B=="horizontal")||(f._tmpbbox.height>c.height()&&B=="vertical"))){f._is_hidden_by_overflow=true}}if(b&&c.color()&&!H&&c.form()>graphica.DIAMOND&&c.form()!=graphica.RADAR_SLICE&&c.form()!=graphica.POLAR_SLICE&&c.form()!=graphica.GEO_SHAPE){this.changeContrastColor(f,c)}if(c.form()==graphica.RADAR_SLICE||c.form()==graphica.POLAR_SLICE){var D=c._angle;if(typeof D!=="undefined"){this.adjust_position_to_angle(f,D)}}if(this._properties.default_form==graphica.NONE_SHAPE||this._properties.default_form==graphica.DISK||this._properties.default_form==graphica.FILLED_DISK||this._properties.default_form==graphica.BAR){this.item(o)._refelm._form_data.allow_label_mark_overlapping(true)}}if(t){this._items.sort(function(w,p){if(w._finallyOutside==false&&p._finallyOutside==true){return -1}else{if(w._finallyOutside==true&&p._finallyOutside==false){return 1}else{return 0}}})}}else{if(I=="out"){for(o=0;o<this.length;o++){f=this.item(o);c=f._refelm._form_data;var e=false;if(c.form()==graphica.SLICE||c.form()==graphica.RADAR_SLICE||c.form()==graphica.POLAR_SLICE){A=c.parent().x()+c.xout()/a;s=c.parent().y()+c.yout()/a}else{if(c.form()==graphica.AREALINE){f._tmpbbox=f._tmpbbox||f.getBBox();if(c.orientation()=="vertical"){f.attr("text-anchor","left");A=c.x()+this._label_distance;s=c.y()}else{A=c.x();s=c.y()+f._tmpbbox.height}}else{if(c.form()==graphica.BAR){f._tmpbbox=f._tmpbbox||f.getBBox();if(c.orientation()=="horizontal"){if(c.reversed()){f.align("right");A=f._refelm.x()-c.width()/2-4}else{f.align("left");A=f._refelm.x()+c.width()/2+4}if((E=="top"&&!c.reversed())||(E=="bottom"&&c.reversed())){s=f._refelm.y()-c.height()/2+2;f.verticalAlign("top")}else{if((E=="top"&&c.reversed())||(E=="bottom"&&!c.reversed())){f.verticalAlign("bottom");s=f._refelm.y()+c.height()/2-2}else{f.verticalAlign("middle");s=f._refelm.y()}}}else{if(c.reversed()){s=f._refelm.y()+c.height()/2+f._tmpbbox.height/2}else{s=f._refelm.y()-c.height()/2-f._tmpbbox.height}f.verticalAlign("top");if(k=="left"){A=f._refelm.x()-c.width()/2+2;f.align("left")}else{if(k=="right"){A=f._refelm.x()+c.width()/2-2;f.align("right")}else{A=f._refelm.x()}}}}else{A=f._refelm.x();s=f._refelm.y()}}}f.x(A);f._tmpbbox=f._tmpbbox||f.getBBox();if(c.form()==graphica.SLICE||c.form()==graphica.RADAR_SLICE||c.form()==graphica.POLAR_SLICE||c.form()==graphica.GEO_SHAPE||c.form()==graphica.BAR||c.form()==graphica.AREALINE||c.form()==graphica.LINE){f.y(s)}else{f.y(s-(f._tmpbbox.height*0.5)/a-c.radius()/a)}if(c.form()==graphica.SLICE||c.form()==graphica.RADAR_SLICE||c.form()==graphica.POLAR_SLICE){var D=c._angle;if(typeof D!=="undefined"){this.adjust_position_to_angle(f,D)}}if(e&&b&&c.color()){this.changeContrastColor(f,c)}}}else{if(I=="automatic"){for(o=0;o<this.length;o++){f=this.item(o);f._tmpbbox=f._tmpbbox||f.getBBox();c=f._refelm._form_data;var h={};if(this._properties.default_form==graphica.LINE){h.x=f.x();h.y=f.y()}else{h.x=f._refelm.x()*a;h.y=f._refelm.y()*a}h.circle_x=h.x;h.circle_y=h.y;h.width=f._tmpbbox.width;h.height=f._tmpbbox.height;h.circle_r=c.radius();h.onlyRepulsionElement=false;J.push(h)}if(this._properties.default_form==graphica.LINE&&this._properties.oneLine_oneLabel){J=graphica.Utils.oneDimensionLabelPlacement(J,this._properties.oneLine_oneLabel_orientation_layout,this._frame._dataspace.y,this._frame._dataspace.y+this._frame._dataspace.height)}else{if(this._properties.default_form==graphica.LINE&&(this._frame._frame_type=="0xN")){J=graphica.Utils.oneDimensionLabelPlacement(J,"vertical",this._frame._dataspace.y,this._frame._dataspace.y+this._frame._dataspace.height)}else{for(o=0;o<g.length;o++){J.push({x:g[o].x,y:g[o].y,onlyRepulsionElement:true,circle_x:g[o].x,circle_y:g[o].y,circle_r:10})}J=graphica.Utils.labelPlacement(J,this._frame._dataspace.width*a,this._frame._dataspace.height*a)}}for(o=0;o<this.length;o++){f=this.item(o);c=f._refelm._form_data;f.x(J[o].x/a);f.y(J[o].y/a);D=J[o].angle;if(typeof D!=="undefined"){this.adjust_position_to_angle(f,D,a)}}}}}}};graphica.LabelGroup.fn.adjust_position_to_angle=function(e,c,b){var a;if(c<0){c=360+c}b=b||1;if(c>280||c<80){e.x(e.x()+e._tmpbbox.width/b/2+2/b)}else{if(c<260&&c>100){e.x(e.x()-e._tmpbbox.width/b/2-2/b)}else{if(c>=260&&c<=280){a=graphica.Utils.map(c,260,280,0,e._tmpbbox.width/b);e.x(e.x()-(e._tmpbbox.width/b/2)+a)}else{if(c>=80&&c<=100){a=graphica.Utils.map(c,80,100,e._tmpbbox.width/b,0);e.x(e.x()-(e._tmpbbox.width/b/2)+a)}}}}if(c>180&&c<360){e.y(e.y()-e._tmpbbox.height/2/b)}else{if(c<180&&c>0){e.y(e.y()+e._tmpbbox.height/2/b)}}if(this._properties.label_align=="left"){e.x(e.x()-e._tmpbbox.width/2)}else{if(this._properties.label_align=="right"){e.x(e.x()+e._tmpbbox.width/2)}}};graphica.Utils.regression={round:function(c,a){var b=Math.pow(10,a);return Math.round(c*b)/b},_toConsumableArray:function(a){if(Array.isArray(a)){for(var c=0,b=Array(a.length);c<a.length;c++){b[c]=a[c]}return b}else{return Array.from(a)}},DEFAULT_OPTIONS:{order:2,precision:10,period:null},determinationCoefficient:function(f,b){var e=[];var k=[];f.forEach(function(n,m){if(n[1]!==null){k.push(n);e.push(b[m])}});var c=k.reduce(function(m,n){return m+n[1]},0);var a=c/k.length;var g=k.reduce(function(m,n){var o=n[1]-a;return m+o*o},0);var h=k.reduce(function(m,o,n){var p=e[n];var q=o[1]-p[1];return m+q*q},0);return 1-h/g},gaussianElimination:function(w,c){var A=w;var a=w.length-1;var f=[c];for(var p=0;p<a;p++){var s=p;for(var m=p+1;m<a;m++){if(Math.abs(A[p][m])>Math.abs(A[p][s])){s=m}}for(var h=p;h<a+1;h++){var o=A[h][p];A[h][p]=A[h][s];A[h][s]=o}for(var g=p+1;g<a;g++){for(var e=a;e>=p;e--){A[e][g]-=A[e][p]*A[p][g]/A[p][p]}}}for(var q=a-1;q>=0;q--){var t=0;for(var b=q+1;b<a;b++){t+=A[b][q]*f[b]}f[q]=(A[a][q]-t)/A[q][q]}return f},linear:function linear(e,p){p=p||graphica.Utils.regression.DEFAULT_OPTIONS;var f=[0,0,0,0,0];var g=0;for(var b=0;b<e.length;b++){if(e[b][1]!==null){g++;f[0]+=e[b][0];f[1]+=e[b][1];f[2]+=e[b][0]*e[b][0];f[3]+=e[b][0]*e[b][1];f[4]+=e[b][1]*e[b][1]}}var c=g*f[2]-f[0]*f[0];var h=g*f[3]-f[0]*f[1];var k=c===0?0:graphica.Utils.regression.round(h/c,p.precision);var o=graphica.Utils.regression.round(f[1]/g-k*f[0]/g,p.precision);var a=function a(n){return[graphica.Utils.regression.round(n,p.precision),graphica.Utils.regression.round(k*n+o,p.precision)]};var m=e.map(function(n){return a(n[0])});return{points:m,predict:a,equation:[k,o],r2:graphica.Utils.regression.round(graphica.Utils.regression.determinationCoefficient(e,m),p.precision),string:o===0?"y = "+k+"x":"y = "+k+"x + "+o}},exponential:function exponential(m,A){A=A||graphica.Utils.regression.DEFAULT_OPTIONS;m=m.filter(function(n){return n[1]>0});var f=m.length;if(f<=1){return null}var w=m.map(function(n){return n[0]});var t=m.map(function(n){return n[1]});var h=w.reduce(function(n,B){return n+B},0);var q=t.map(function(n){return Math.log(n)});var a=w.map(function(n){return n*n});var s=a.reduce(function(n,B){return n+B},0);var c=q.reduce(function(n,B){return n+B},0);var k=w.map(function(B,n){return B*q[n]});var o=k.reduce(function(n,B){return n+B},0);var g=Math.exp((c*s-h*o)/(f*s-(h*h)));if(isNaN(g)){g=m[0][0]}var e=(f*o-h*c)/(f*s-(h*h));if(isNaN(e)){e=0}var b=function b(n){return[graphica.Utils.regression.round(n,A.precision),graphica.Utils.regression.round(g*Math.exp(e*n),A.precision)]};var p=m.map(function(n){return b(n[0])});return{points:p,predict:b,equation:[g,e],string:"y = "+g+"e^("+e+"x)"}},logarithmic:function logarithmic(g,p){p=p||graphica.Utils.regression.DEFAULT_OPTIONS;g=g.filter(function(a){return a[0]>0});var h=[0,0,0,0];var k=g.length;if(k<=1){return null}for(var c=0;c<k;c++){if(g[c][1]!==null){h[0]+=Math.log(g[c][0]);h[1]+=g[c][1]*Math.log(g[c][0]);h[3]+=Math.pow(Math.log(g[c][0]),2);h[2]+=g[c][1]}}var m=(k*h[1]-h[2]*h[0])/(k*h[3]-h[0]*h[0]);if(isNaN(m)){m=0}var e=graphica.Utils.regression.round(m,p.precision);var f=graphica.Utils.regression.round((h[2]-e*h[0])/k,p.precision);var b=function b(a){return[graphica.Utils.regression.round(a,p.precision),graphica.Utils.regression.round(graphica.Utils.regression.round(f+e*Math.log(a),p.precision),p.precision)]};var o=g.map(function(a){return b(a[0])});return{points:o,predict:b,equation:[f,e],string:"y = "+f+" + "+e+" ln(x)"}},power:function power(h,s){s=s||graphica.Utils.regression.DEFAULT_OPTIONS;h=h.filter(function(a){return(a[0]>0&&a[1]>0)});var k=[0,0,0,0,0];var m=h.length;if(m<=1){return null}for(var f=0;f<m;f++){if(h[f][1]!==null){k[0]+=Math.log(h[f][0]);k[1]+=Math.log(h[f][1])*Math.log(h[f][0]);k[2]+=Math.log(h[f][1]);k[3]+=Math.pow(Math.log(h[f][0]),2)}}var o=(m*k[1]-k[0]*k[2])/(m*k[3]-Math.pow(k[0],2));var p=(k[2]-o*k[0])/m;var g=graphica.Utils.regression.round(Math.exp(p),s.precision);var e=graphica.Utils.regression.round(o,s.precision);var c=function c(a){return[graphica.Utils.regression.round(a,s.precision),graphica.Utils.regression.round(graphica.Utils.regression.round(g*Math.pow(a,e),s.precision),s.precision)]};var q=h.map(function(a){return c(a[0])});return{points:q,predict:c,equation:[g,e],string:"y = "+g+"x^"+e}},polynomial:function polynomial(F,m){m=m||graphica.Utils.regression.DEFAULT_OPTIONS;var p=[];var e=[];var E=0;var D=0;var B=F.length;var s=m.order+1;if(B<=1){return null}for(var A=0;A<s;A++){for(var q=0;q<B;q++){if(F[q][1]!==null){E+=Math.pow(F[q][0],A)*F[q][1]}}p.push(E);E=0;var C=[];for(var t=0;t<s;t++){for(var g=0;g<B;g++){if(F[g][1]!==null){D+=Math.pow(F[g][0],A+t)}}C.push(D);D=0}e.push(C)}e.push(p);var o=graphica.Utils.regression.gaussianElimination(e,s).map(function(a){return graphica.Utils.regression.round(a,m.precision)});var n=function n(a){return[graphica.Utils.regression.round(a,m.precision),graphica.Utils.regression.round(o.reduce(function(k,b,c){return k+b*Math.pow(a,c)},0),m.precision)]};var w=F.map(function(a){return n(a[0])});var f="y = ";for(var h=o.length-1;h>=0;h--){if(h>1){f+=o[h]+"x^"+h+" + "}else{if(h===1){f+=o[h]+"x + "}else{f+=o[h]}}}return{string:f,points:w,predict:n,equation:[].concat(graphica.Utils.regression._toConsumableArray(o)).reverse()}}};window.graphica=window.graphica||{};graphica.View=function(g,c,b,f,i,d,h){if(typeof i!=="undefined"&&i!==null){this._viewgroup=f;this._viewidgroup=i}else{this._viewidgroup=-1}if(typeof b==="string"){b=JSON.parse(b)}this._settings=b||{};this._settings.general=this._settings.general||{};this._settings.grammar=this._settings.grammar||[];this._settings.annotations=this._settings.annotations||[];this._settings.custom_properties=this._settings.custom_properties||[];this._settings.graph_positions=this._settings.graph_positions||null;this._dataset=c;this.unitElements=new GrapeGroup();if(typeof g==="string"){g=by("id:"+g)}if(g.tagName()!="svg"&&g.tagName()!="canvas"){g.clear();var e=new Grape("svg").style("display","block").addTo(g);g=e}else{if(g.tagName()=="svg"){g.style("display","block")}}this._target=g;var a=this.getDimensions();this._width=a.width;this._height=a.height;this._isforscreenshot=h;this._numElements=[];this._filter_alpha=0.1;this._highlight_alpha=0;this._rangeSliders=[];this.highlight_on_hover=false;this.highlight_same_color_elements_on_hover=false;this.static_view=false;this.background_elements=false;this.background_elements_color="#DCDCDC";this.background_elements_opacity=0.8;this._transparent_background=false;this._indexes={};if(typeof d!=="boolean"||d==true){this.init();this.checkLabelingOverlap()}};graphica.View.fn=graphica.View.prototype;graphica.View.fn.init=function(O){var c=this;this._rangeSliders=[];if(this._target.pixi&&this._target.pixi.ticker){this._target.pixi.ticker.stop()}if(this._target.tagName()=="canvas"){this._target.clear().width(this._width*window.devicePixelRatio).height(this._height*devicePixelRatio)}else{this._target.clear().viewbox(0,0,this._width,this._height).width(this._width).height(this._height)}if(O){if(O.length==0){return}this.vp=new graphica.Properties(O,this);if(O.edges){this.vpedges=new graphica.Properties(O.edges,this);this.vp.vpedges=this.vpedges}}else{this.vp=new graphica.Properties(this._dataset,this);if(this._dataset.edges){this.vpedges=new graphica.Properties(this._dataset.edges,this);this.vp.vpedges=this.vpedges}}this.vp.applyGrammar();this.vp.init();if(this._settings.graph_positions){this.vp._graph_positions=this._settings.graph_positions;if(this._settings.graphObj){this._settings.graphObj.eachNode(function(){if(typeof c._settings.graph_positions[this.id]!=="undefined"&&c._settings.graph_positions[this.id]!==null){this._layoutPosX=c._settings.graph_positions[this.id].x;this._layoutPosY=c._settings.graph_positions[this.id].y}})}}if(this._viewidgroup!=-1){this._viewgroup.eachFilterVar(this._viewidgroup,function(t){if(!c.vp._dataset.isQuantitative(t.variable)){c._numElements[t.variable]=c.vp._ds.unique(t.variable).length}})}if(this._variables_hues){this.vp._variables_hues=this._variables_hues}this.frame=new graphica.Frame(this.vp,this._width,this._height,null,this._isforscreenshot);this.applySettings();var d=new Grape();if(this._transparent_background==false){if(typeof this._background_color!=="undefined"){d.beginFill(this._background_color,1)}else{d.beginFill("white",1)}}else{d.beginFill("white",0)}d.rect(0,0,this._width,this._height).addTo(this._target);if(this._dataset.length==0){var E=raceme.label("no data",this._width/2,this._height/2,"rgb(100,100,100)",15,"center");this._target.addChild(E);return}d.clic(function(){if(c._viewidgroup!=-1){c._viewgroup.removeFilters(c._viewidgroup);c._viewgroup.showhideReset(c._viewidgroup);return false}return true},"background_box",false);this.frame.init();var s=this.frame._height;var p=this.frame._width;if(this._target.tagName()=="canvas"){s=Math.min(s,4500);p=Math.min(p,4500)}if(s>this._height){this._height=s;if(this._target.tagName()=="canvas"){this._target.height(this._height*devicePixelRatio).style("height",this._height+"px")}else{this._target.viewbox(0,0,this._width,this._height).width(this._width).height(this._height)}d.height(this._height);this._height_forced_to=this._height}if(p>this._width){this._width=p;if(this._target.tagName()=="canvas"){this._target.width(this._width*window.devicePixelRatio).height(this._height*devicePixelRatio).style("width",this._width+"px")}else{this._target.viewbox(0,0,this._width,this._height).width(this._width).height(this._height)}d.width(this._width);this._width_forced_to=this._width}var h=this.frame.getGrape();this._target.addChild(h);var f=null;if(this.background_elements&&this.frame._frame_type=="multiple"&&this.frame._sub_frames.length&&(this.vp.default_form==graphica.DISK||this.vp.default_form==graphica.FILLED_DISK||this.vp.default_form==graphica.LINE||this.vp.default_form==graphica.NONE)){f=new Grape();if(this.vpedges){this.frame._sub_frames[0]._properties.vpedges=this.vpedges}this.frame._sub_frames[0]._subdataset=this.frame._dataset;var i=null;var H=null;if(this.frame._sub_frames[0].graphObj){i=this.frame._sub_frames[0].graphObj;H=new graphica.GraphModel();H.init(this.frame._dataset,this.frame._dataset.edges);this.frame._sub_frames[0].graphObj=H}var K=[];if(this.frame._subframe_type=="2x1C"||this.frame._subframe_type=="Nx1C"||this.frame._subframe_type=="Nx2C"||this.frame._subframe_type=="1Cx2"||this.frame._subframe_type=="1CxN"||this.frame._subframe_type=="2CxN"){for(var F=0;F<this.frame._sub_frames[0].all_n_variables.length;F++){var m=new graphica.Elements(this.frame._sub_frames[0],this.frame._sub_frames[0].all_n_variables[F],{active:true,color:this.background_elements_color,opacity:this.background_elements_opacity});m.init();K.push(m.getGrape())}}else{var m=new graphica.Elements(this.frame._sub_frames[0],null,{active:true,color:this.background_elements_color,opacity:this.background_elements_opacity});m.init();K.push(m.getGrape())}var M=this.frame._sub_frames[0]._dataspace;var q;for(var J=0;J<K.length;J++){var x=K[J];if(this._target.pixi){for(q=0;q<this.frame._sub_frames.length;q++){var a=x.clone();a.x(this.frame._sub_frames[q]._dataspace.x-M.x).y(this.frame._sub_frames[q]._dataspace.y-M.y);a.addTo(f)}}else{var A=new Grape("def");var I="background_elements_use_id"+raceme._generateId();x.id(I);A.addChild(x);A.addTo(f);for(q=0;q<this.frame._sub_frames.length;q++){var a=new Grape("use");a.seed.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+I);a.x(this.frame._sub_frames[q]._dataspace.x-M.x).y(this.frame._sub_frames[q]._dataspace.y-M.y);a.addTo(f)}}}this.frame._sub_frames[0]._tmp_grgroup_to_do_bubble_layout=null;this.frame._sub_frames[0]._categorical_matrix.latest_x=0;this.frame._sub_frames[0]._categorical_matrix.latest_y=0;if(i){this.frame._sub_frames[0].graphObj=i;for(q=0;q<this.frame._sub_frames.length;q++){this.frame._sub_frames[q].graphObj.eachNode(function(){var t=this.id;var w=null;if(t){w=H.getNode(t)}if(w){this._layoutPosX=w._layoutPosX;this._layoutPosY=w._layoutPosY}})}this.frame._properties._layout="noLayout"}}var g=new Grape();if(this.frame._frame_type=="2x1C"||this.frame._frame_type=="Nx1C"||this.frame._frame_type=="Nx2C"||this.frame._frame_type=="1Cx2"||this.frame._frame_type=="1CxN"||this.frame._frame_type=="2CxN"||(this.frame._frame_type=="multiple"&&(this.frame._subframe_type=="2x1C"||this.frame._subframe_type=="Nx1C"||this.frame._subframe_type=="Nx2C"||this.frame._subframe_type=="1Cx2"||this.frame._subframe_type=="1CxN"||this.frame._subframe_type=="2CxN"))){this.elements=[];for(var F=0;F<this.frame.all_n_variables.length;F++){var e=new graphica.Elements(this.frame,this.frame.all_n_variables[F],{includeMap:(f===null)},this._isforscreenshot);e.init();this.elements.push(e);g.addChild(e.getGrape())}}else{this.elements=[new graphica.Elements(this.frame,null,{includeMap:(f===null)},this._isforscreenshot)];this.elements[0].init();g=this.elements[0].getGrape()}if((this.frame._map||this.vp._is_graph_layout)&&this.elements.length==1){var j=new Grape();var B=raceme._generateId();var L=new Grape("defs").addChild(new Grape("clipPath").id(B).addChild(new Grape("rect").attr("x",this.frame._dataspace.x).attr("y",this.frame._dataspace.y).attr("width",this.frame._dataspace.width).attr("height",this.frame._dataspace.height)));j.addChild(L);j.style("clip-path","url(#"+B+")");j.addChild(g);if(this.frame.zoomable&&this.static_view==false){var v=new Grape();v.beginFill("white").lineStyle(1,"rgb(230,230,230)").rect(0,0,30,60);v.lineStyle(1,"rgb(230,230,230)").moveTo(3,30).lineTo(27,30);var b=new Grape();b.beginFill("#FFFFFF").rect(1,1,28,28).lineStyle(2,"rgb(150,150,150)").line(15,10,15,20).line(10,15,20,15);var D=new Grape().y(30);D.beginFill("#FFFFFF").rect(1,1,28,28).lineStyle(2,"rgb(150,150,150)").line(10,15,20,15);v.addChild(b).addChild(D);v.x(this.frame._dataspace.x+10).y(this.frame._dataspace.y+10);b.clic(function(){g.zoomIn()});D.clic(function(){g.zoomOut()});j.addChild(v)}this._target.addChild(j);if(g.pixi){var u=new PIXI.Graphics();u.beginFill(16724736);u.drawRect(this.frame._dataspace.x,this.frame._dataspace.y,this.frame._dataspace.width,this.frame._dataspace.height);u.endFill();g.pixi.mask=u}}else{if(f){this._target.addChild(f)}this._target.addChild(g)}if(this.frame.legends_grape&&this.frame._floating_legend){this.frame.legends_grape.addTo(this._target)}this.applyTooltip();this.applyResizeResponse();if(typeof this._variables_hues=="undefined"&&this.vp._variables_hues){this._variables_hues=this.vp._variables_hues}if(this._reset_button&&this._viewidgroup!=-1){this.reset_button_grape=new Grape().x(5).y(this._height-26);var n=raceme.label(this._reset_button,8,12,"rgb(60,60,60)",12,"left","top");var z=n.getBBox();this.reset_button_grape.beginFill("rgb(200,200,200)",0.5).rect(0,0,z.width+16,21,2);this.reset_button_grape.opacity(0).addChild(n);this._target.addChild(this.reset_button_grape);this.reset_button_grape.clic(function(){d.clic()});this._viewgroup.showhideReset(this._viewidgroup)}if(this.frame._map&&this.frame.zoom_auto_focus){if(this.frame.zoom_auto_focus_box&&(this.frame.zoom_auto_focus_box.x!=this.frame.zoom_auto_focus_box.x2||this.frame.zoom_auto_focus_box.y!=this.frame.zoom_auto_focus_box.y2)){if(this.frame._properties.Mark()==graphica.GEO_SHAPE&&!isPIXI()){var k=this.frame._map.root.scale();var G=this.frame._map.root.x()+this.frame._dataspace.x;var r=this.frame._map.root.y()+this.frame._dataspace.y;this.frame.zoom_auto_focus_box.x=this.frame.zoom_auto_focus_box.x*k+G;this.frame.zoom_auto_focus_box.y=this.frame.zoom_auto_focus_box.y*k+r;this.frame.zoom_auto_focus_box.x2=this.frame.zoom_auto_focus_box.x2*k+G;this.frame.zoom_auto_focus_box.y2=this.frame.zoom_auto_focus_box.y2*k+r}g.focusZoom(this.frame.zoom_auto_focus_box,false)}else{this.frame._map._elms_to_make_zoom=g}}for(var N=0;N<this._rangeSliders.length;N++){this._target.addChild(this._rangeSliders[N])}if(this._target.pixi&&this._target.pixi.ticker){this._target.pixi.render();this._target.pixi.ticker.start()}if(this._highlight_on_hover){this._target.mouseleave(function(){if(window._highlightOFF_timeout){clearTimeout(window._highlightOFF_timeout);window._highlightOFF_timeout=null}for(var t=0;t<c.elements.length;t++){c.highlightOFF(c.elements[t].grgroup);c.highlightOFF(c.elements[t].linksgroup);c.highlightOFF(c.elements[t].labelsgroup)}})}if(typeof this._indexes_to_call_when_reinit!=="undefined"){var y=Object.keys(this._indexes_to_call_when_reinit);for(var C=0;C<y.length;C++){var o=y[C];for(var l=0;l<this._indexes[o].length;l++){this._indexes_to_call_when_reinit[o].call(this._indexes[o][l])}}}};graphica.View.fn.applyTooltip=function(){var b=this;if(this.vp.tooltip_config!=""||this.vp.reference_lines!="none"){this.tlp=new raceme.Tooltip(this._target,this._settings.general);this.frame.tlp=this.tlp;if(this.frame.zoomable){for(var a=0;a<this.elements.length;a++){this.elements[a].gr._callwhenchange=function(){b.tlp.update()}}}}};graphica.View.fn.applyResizeResponse=function(){var a=this;if(typeof process!=="undefined"&&typeof process.versions!=="undefined"&&typeof(process.versions.electron)==="string"){return}if(this._target.seed.parentNode){new ResizeObserver(function(){a.resize()}).observe(this._target.seed.parentNode)}};graphica.View.fn.matchCriteria=function(b,a){for(let prop in b){if(typeof a[prop]==="undefined"||b[prop]!=a[prop]){return false}}return true};graphica.View.fn.getAnnotationConfig=function(b,c){for(var a=0;a<this._settings.annotations.length;a++){if(typeof c==="undefined"||c===null||typeof this._settings.annotations[a].anchor_variable==="undefined"||this._settings.annotations[a].anchor_variable==c){if(this.matchCriteria(this._settings.annotations[a].criteria,b)){return this._settings.annotations[a]}}}return null};graphica.View.fn.getCustomColor=function(b,c){if(this._settings.custom_properties.length==0){return""}for(var a=0;a<this._settings.custom_properties.length;a++){if(typeof c==="undefined"||c===null||typeof this._settings.custom_properties[a].anchor_variable==="undefined"||this._settings.custom_properties[a].anchor_variable==c){if(this.matchCriteria(this._settings.custom_properties[a].criteria,b)&&typeof this._settings.custom_properties[a].color!=="undefined"){return this._settings.custom_properties[a].color}}}return""};graphica.View.fn.applySettings=function(){var a=this._settings.general;if(typeof a.static_view=="boolean"){this.static_view=a.static_view}if(typeof a.font_family==="string"){window.GlobalFontFamily=a.font_family;this._target.style("font-family",a.font_family)}else{if(this.static_view){this._target.style("font-family","Inter")}}if(typeof a.title==="string"){this.frame._title=a.title}if(typeof a.title_font==="string"){this.frame._title_font=a.title_font}if(typeof a.title_size==="number"&&a.title_size){this.frame._title_size=a.title_size}if(typeof a.labels_colored_as_marks==="boolean"){this.vp.labels_colored_as_marks=a.labels_colored_as_marks}if(typeof a.labels_opacity_as_marks==="boolean"){this.vp.labels_opacity_as_marks=a.labels_opacity_as_marks}if(typeof a.labels_size_as_marks==="boolean"){this.vp.labels_size_as_marks=a.labels_size_as_marks}if(typeof a.label_allow_overlapping==="boolean"){this.vp.label_allow_overlapping=a.label_allow_overlapping}if(typeof a.label_auto_contrast==="boolean"){this.vp.label_auto_contrast=a.label_auto_contrast}if(typeof a.label_font==="string"){this.vp.label_font=a.label_font}if(typeof a.background_image==="string"){this.frame._background_image=a.background_image}if(typeof a.padding==="number"){this.frame._left_padding=a.padding;this.frame._top_padding=a.padding;this.frame._bottom_padding=a.padding;this.frame._right_padding=a.padding}if(typeof a.left_padding==="number"){this.frame._left_padding=a.left_padding}if(typeof a.right_padding==="number"){this.frame._right_padding=a.right_padding}if(typeof a.top_padding==="number"){this.frame._top_padding=a.top_padding}if(typeof a.bottom_padding==="number"){this.frame._bottom_padding=a.bottom_padding}if(raceme._getRGB(a.title_color)!==false){this.frame._title_color=a.title_color}if(typeof a.default_edge_width=="number"&&this.vpedges){this.vpedges.max_width=a.default_edge_width}if(typeof a.edge_width=="string"&&this.vpedges&&this.vpedges._ds.hasColumn(a.edge_width)){this.vpedges.width_variable=this.vpedges._ds.header.getId(a.edge_width)}if(typeof a.edge_opacity=="string"&&this.vpedges&&this.vpedges._ds.hasColumn(a.edge_opacity)){this.vpedges.opacity_variable=this.vpedges._ds.header.getId(a.edge_opacity)}if(typeof a.edge_form=="string"&&this.vpedges&&typeof graphica.EDGE_FORMS[a.edge_form]!=="undefined"){this.vpedges.edge_form=graphica.EDGE_FORMS[a.edge_form]}if(typeof a.edge_curvature=="number"&&this.vpedges){this.vpedges.edge_curvature=a.edge_curvature}if(typeof a.edge_bundling_on=="string"&&a.edge_bundling_on=="weight"&&this.vpedges&&this.vpedges.edge_form==graphica.EDGE_BUNDLING){this.vpedges.edge_bundling_on="weight"}if(typeof a.default_alpha=="number"&&a.default_alpha>=0&&a.default_alpha<=1){this.vp.default_intensity=a.default_alpha}if(typeof a.default_link_alpha=="number"&&this.vpedges&&a.default_link_alpha>=0&&a.default_link_alpha<=1){this.vpedges.default_intensity=a.default_link_alpha}if(typeof a.default_size=="number"&&a.default_size>0){this.vp.default_area=Math.round(a.default_size*a.default_size*Math.PI);this.vp.max_area=this.vp.default_area*1000/113}if(typeof a.default_area=="number"&&a.default_area>0){this.vp.default_area=a.default_area;this.vp.max_area=this.vp.default_area*1000/113}if(typeof a.default_border_width=="number"){this.vp.default_border_width=a.default_border_width}if(typeof a.default_width=="number"){this.vp.default_width=a.default_width}if(typeof a.responsive_size=="boolean"){this.vp.responsive_size=a.responsive_size}if(typeof a.default_border_color=="string"){this.vp.default_border_color=a.default_border_color}if(typeof a.distribution_plot=="string"){if(a.distribution_plot=="density map"){this.vp.density_map=true}else{if(a.distribution_plot=="box plot"){this.vp.box_plot=true}else{if(a.distribution_plot=="convex hull"){this.vp.convex_hull=true}}}}if(typeof a.reference_lines=="string"){this.vp.reference_lines=a.reference_lines}if(typeof a.reference_lines_type=="string"){this.vp.reference_lines_type=a.reference_lines_type}if(typeof a.reference_lines_constant=="number"){this.vp.reference_lines_constant=a.reference_lines_constant}if(typeof a.reference_lines_degree=="number"&&Math.round(a.reference_lines_degree)>=2){this.vp.reference_lines_degree=Math.round(a.reference_lines_degree)}if(typeof a.reference_lines_width=="number"){this.vp.reference_lines_width=a.reference_lines_width}if(typeof a.prev_moving_average_data_points=="number"&&Number.isInteger(a.prev_moving_average_data_points)&&a.prev_moving_average_data_points>=0){this.vp.prev_moving_average_data_points=a.prev_moving_average_data_points}if(typeof a.next_moving_average_data_points=="number"&&Number.isInteger(a.next_moving_average_data_points)&&a.next_moving_average_data_points>=0){this.vp.next_moving_average_data_points=a.next_moving_average_data_points}if(raceme._getRGB(a.reference_lines_color)!=false){this.vp.reference_lines_color=a.reference_lines_color}if(typeof a.reference_lines_independent=="boolean"){this.vp.reference_lines_independent=a.reference_lines_independent}if(typeof a.reference_lines_opacity=="number"&&a.reference_lines_opacity>=0&&a.reference_lines_opacity<=1){this.vp.reference_lines_opacity=a.reference_lines_opacity}if(typeof a.highlight_on_hover==="boolean"){this.highlight_on_hover=a.highlight_on_hover}if(typeof a.highlight_same_color_elements_on_hover==="boolean"){this.highlight_same_color_elements_on_hover=a.highlight_same_color_elements_on_hover}if(typeof a.background_elements==="boolean"){this.background_elements=a.background_elements}if(raceme._getRGB(a.background_elements_color)!=false){this.background_elements_color=a.background_elements_color}if(typeof a.background_elements_opacity==="number"){this.background_elements_opacity=a.background_elements_opacity}if(typeof a.box_plot_style=="string"){this.vp.box_plot_style=a.box_plot_style}if(typeof a.box_plot_colored_as_marks==="boolean"){this.vp.box_plot_colored_as_marks=a.box_plot_colored_as_marks}if(typeof a.distribution_plot_in_front==="boolean"){this.vp.distribution_plot_in_front=a.distribution_plot_in_front}if(typeof a.distribution_plot_opacity==="number"){this.vp.distribution_plot_opacity=a.distribution_plot_opacity}if(typeof a.distribution_plot_fill_opacity==="number"){this.vp.distribution_plot_fill_opacity=a.distribution_plot_fill_opacity}if(typeof a.distribution_plot_border_width==="number"){this.vp.distribution_plot_border_width=a.distribution_plot_border_width}if(typeof a.box_plot_max_width==="number"){this.vp.box_plot_max_width=a.box_plot_max_width}if(raceme._getRGB(a.box_plot_default_color)!==false){this.vp.box_plot_default_color=a.box_plot_default_color}if(raceme._getRGB(a.default_inner_color)!==false){this.vp.default_inner_color=a.default_inner_color}if(typeof a.default_inner_alpha=="number"&&a.default_inner_alpha>=0&&a.default_inner_alpha<=1){this.vp.default_inner_alpha=a.default_inner_alpha}if(typeof a.default_border_alpha=="number"&&a.default_border_alpha>=0&&a.default_border_alpha<=1){this.vp.default_border_intensity=a.default_border_alpha}if(typeof a.donut_inner_radius=="number"&&a.donut_inner_radius>=0&&a.donut_inner_radius<=1){this.vp.donut_inner_radius=a.donut_inner_radius}if(raceme._getRGB(a.default_color)!=false){this.vp.default_hue=a.default_color}if(raceme._getRGB(a.default_link_color)!=false&&this.vpedges){this.vpedges.default_hue=a.default_link_color}if(typeof a.max_edges_displayed=="number"&&a.max_edges_displayed>=0&&a.max_edges_displayed<=10000){this.vpedges.max_edges_displayed=a.max_edges_displayed}if(typeof a.edges_colored_as_marks==="boolean"&&this.vpedges){this.vpedges.edges_colored_as_marks=a.edges_colored_as_marks}if(typeof a.edges_colored_as_marks_only_between_same_color_marks==="boolean"&&this.vpedges){this.vpedges.edges_colored_as_marks_only_between_same_color_marks=a.edges_colored_as_marks_only_between_same_color_marks}if(raceme._getRGB(a.default_label_color)!=false){this.vp.default_label_color=a.default_label_color;if(this.vpedges){this.vpedges.default_label_color=a.default_label_color}}if(typeof a.default_label_opacity=="number"&&a.default_label_opacity>=0&&a.default_label_opacity<=1){this.vp.default_label_opacity=a.default_label_opacity;if(this.vpedges){this.vpedges.default_label_opacity=a.default_label_opacity}}if(typeof a.colors=="object"){this.vp.user_selected_colors=a.colors}if(raceme._getRGB(a.map_color)!==false){this.frame._default_map_color=a.map_color}if(typeof a.map_border==="number"){this.frame._default_map_border=a.map_border}if(raceme._getRGB(a.map_border_color)!==false){this.frame._default_map_border_color=a.map_border_color}if(typeof a.map_opacity=="number"&&a.map_opacity>=0&&a.map_opacity<=1){this.frame._default_map_opacity=a.map_opacity}if(typeof a.map_border_only_in_regions_with_data=="boolean"){this.frame._map_border_only_in_regions_with_data=a.map_border_only_in_regions_with_data}if(typeof a.map_border_only_in_selected_country=="string"&&graphica.Geo.existsCountry(a.map_border_only_in_selected_country)){this.frame._map_border_only_in_selected_country=a.map_border_only_in_selected_country}if(typeof a.map_projection=="string"){this.frame._map_projection=a.map_projection}if(typeof a.map_division=="string"){this.frame._map_division=a.map_division}if(typeof a.filter_alpha=="number"&&a.filter_alpha>=0&&a.filter_alpha<=1){this._filter_alpha=a.filter_alpha}if(typeof a.highlight_alpha=="number"&&a.highlight_alpha>=0&&a.highlight_alpha<=1){this._highlight_alpha=a.highlight_alpha}if(typeof a.legend_width=="number"&&a.legend_width>0){this.frame._legend_width=a.legend_width}if(typeof a.bar_width=="number"&&a.bar_width>=0&&a.bar_width<=1){this.vp.bar_width=a.bar_width}if(typeof a.base_url=="string"){this.vp.base_url=a.base_url}if(typeof a.linkurl_variable=="string"&&this._dataset.hasColumn(a.linkurl_variable)){this.vp.linkurl_variable=this._dataset.header.getId(a.linkurl_variable)}if(typeof a.default_link_target=="string"){this.vp.default_link_target=a.default_link_target}if(typeof a.reset_button=="string"){this._reset_button=a.reset_button}if(typeof a.zoom=="boolean"){this.frame.zoomable=a.zoom}if(typeof a.zoom_auto_focus=="boolean"){this.frame.zoom_auto_focus=a.zoom_auto_focus}if(typeof a.floating_legend=="boolean"){this.frame._floating_legend=a.floating_legend}if(typeof a.legend_position=="string"){this.frame._legend_position=a.legend_position}if(typeof a.category_padding=="number"){this.frame._category_padding=a.category_padding}if(typeof a.show_edges=="boolean"){this.frame._show_edges=a.show_edges}if(typeof a.show_map=="boolean"){this.frame._show_map=a.show_map}if(raceme._getRGB(a.background_color)!==false){this._background_color=a.background_color}if(typeof a.transparent_background=="boolean"){this._transparent_background=a.transparent_background}};graphica.View.fn.resize=function(b){var c=this;if(this.resizeTimeout){clearTimeout(this.resizeTimeout)}var a=function(){var d=c.getDimensions();if((isNaN(d.width)==false&&isNaN(d.height)==false)&&((d.width!=c._width&&(typeof c._width_forced_to=="undefined"||c._width_forced_to<d.width))||(d.height!=c._height&&(typeof c._height_forced_to=="undefined"||c._height_forced_to<d.height)))){c._width=d.width;c._height=d.height;if(c.vp._graph_positions){c._settings.graph_positions=c.vp._graph_positions}c.init(c.vp._dataset);c.reFade()}};if(b){a();return}this.resizeTimeout=setTimeout(function(){a()},250)};graphica.View.fn.getDimensions=function(){var a=new Grape(this._target.seed.parentNode);if(a.style("width")&&a.style("height")){return{width:parseInt(a.style("width").replace("px","")),height:parseInt(a.style("height").replace("px",""))}}else{return{width:getComputedStyle(a.seed).width,height:getComputedStyle(a.seed).height}}return{width:100,height:100}};graphica.View.fn.checkLabelingOverlap=function(){if(typeof this.elements==="undefined"){return false}for(var a=0;a<this.elements.length;a++){this.elements[a].labelsgroup.check_overlapping(true)}};graphica.View.fn.reFade=function(){if(this.unitElements.length==0){this.checkLabelingOverlap();return}if(this._viewidgroup!=-1){var o=this;var l=this._viewgroup.viewsFilters[this._viewidgroup];var b=[];var a=[];var u=new GrapeGroup();for(var g=0;g<this.unitElements.length;g++){var w=true;var d=this.unitElements.item(g);for(var t=0;t<l.length;t++){if(w==false){break}var f=l[t].aggregation;var v=l[t].variable;if(l[t].filtrosAplicados.length>0){for(var q=0;q<d._viz_filter_classes.length;q++){if(w==false){break}if(d._viz_filter_classes[q].variable==v){if(typeof l[t].filtrosAplicados[0].min!=="undefined"){if(!d._is_legend_element){if(o._dataset.isDateType(v)){var m;if(d._viz_filter_classes[q].value!==null&&d._viz_filter_classes[q].value.rule){for(var n=0;n<d._viz_filter_classes[q].value.rows.length;n++){m=d._viz_filter_classes[q].value.rows[n];if(graphica.Utils.compareDates(m,l[t].filtrosAplicados[0].min,f)==-1||graphica.Utils.compareDates(m,l[t].filtrosAplicados[0].max,f)==1){w=false;break}}}else{m=d._viz_filter_classes[q].value;if(graphica.Utils.compareDates(m,l[t].filtrosAplicados[0].min,f)==-1||graphica.Utils.compareDates(m,l[t].filtrosAplicados[0].max,f)==1){w=false;break}}}else{if(d._viz_filter_classes[q].value!==null&&d._viz_filter_classes[q].value.rule){for(var c=0;c<d._viz_filter_classes[q].value.rows.length;c++){if(d._viz_filter_classes[q].value.rows[c]<l[t].filtrosAplicados[0].min||d._viz_filter_classes[q].value.rows[c]>l[t].filtrosAplicados[0].max){w=false;break}}}else{if(d._viz_filter_classes[q].value<l[t].filtrosAplicados[0].min||d._viz_filter_classes[q].value>l[t].filtrosAplicados[0].max){w=false;break}}}}}else{if(typeof d._viz_filter_classes[q].value=="string"){if(l[t].filtrosAplicados.indexOf(d._viz_filter_classes[q].value)==-1){w=false;break}}else{if(typeof d._viz_filter_classes[q].value.strformat!=="undefined"){for(da=0;da<l[t].filtrosAplicados.length;da++){if(d._viz_filter_classes[q].value.faststrformat(l[t].aggregation)==l[t].filtrosAplicados[da].faststrformat(l[t].aggregation)){w=false;break}}if(w==false){break}}else{if(d._viz_filter_classes[q].value!==null&&d._viz_filter_classes[q].value.rule){if(d._viz_filter_classes[q].value.rule=="or"){w=false}for(var p=0;p<d._viz_filter_classes[q].value.rows.length;p++){if(d._viz_filter_classes[q].value.rule=="or"&&l[t].filtrosAplicados.indexOf(d._viz_filter_classes[q].value.rows[p])!=-1){w=true;break}else{if(d._viz_filter_classes[q].value.rule=="and"&&l[t].filtrosAplicados.indexOf(d._viz_filter_classes[q].value.rows[p])==-1){w=false;break}}}}}}}}}}}if(w){d._is_hidden_by_filter=false;d.getChildren().each(function(){this._is_hidden_by_filter=false});if(!d._is_label){d.enableEvents(true)}if(typeof d._original_opacity!="undefined"){b[g]=d._original_opacity}else{b[g]=1}}else{if(typeof d._form_data=="undefined"||(d._form_data.form()!=graphica.AREALINE&&d._form_data.form()!=graphica.BAR)){u.push(d)}d._is_hidden_by_filter=true;d.getChildren().each(function(){this._is_hidden_by_filter=true});if(d._is_legend_element){b[g]=0.3;a[g]=false}else{if(d._is_graph_link||d._is_label){a[g]=true;b[g]=0}else{d.enableEvents(false);a[g]=true;b[g]=this._filter_alpha}}}if(typeof d._prev_highlight_opacity!=="undefined"){delete d._prev_highlight_opacity}}for(var h=0;h<this.elements.length;h++){this.elements[h].labelsgroup.check_overlapping(false)}for(var e=0;e<this.unitElements.length;e++){if(this.unitElements.item(e)._is_label&&this.unitElements.item(e)._is_hidden_by_overlap){b[e]=0;this.unitElements.item(e).opacity(0);a[e]=true}}if(u.length){u.toBack()}this.unitElements.show();this.unitElements.stop().animate(100).opacity(b).done(function(){if(o._filter_alpha==0){for(var i=0;i<o.unitElements.length;i++){if(b[i]==0){o.unitElements.item(i).hide()}}}});if(this._viewidgroup!=-1&&this.reset_button_grape){this._viewgroup.showhideReset(this._viewidgroup)}}};graphica.View.fn.reInit=function(a){var b=this;setTimeout(function(){b.init(a);b.reFade()},120)};graphica.View.fn.classify=function(b,a){this._indexes[a]=this._indexes[a]||[];this._indexes[a].push(b)};graphica.View.fn.eachByClass=function(c,a){if(typeof this._indexes[c]!=="undefined"){this._indexes_to_call_when_reinit=this._indexes_to_call_when_reinit||{};if(typeof this._indexes_to_call_when_reinit[c]=="undefined"){this._indexes_to_call_when_reinit[c]=a}for(var b=0;b<this._indexes[c].length;b++){a.call(this._indexes[c][b])}}};graphica.View.fn.filterWrapper=function(g,a,d,c){if(!g){return}if(typeof c==="undefined"){c=null}var e=this;this.eachFilterVar(function(i){var f;if(d._indices){f={rule:"or",rows:d.unique(i.variable)};if(f.rows.length==1){f=f.rows[0]}}else{if(typeof d!=="string"&&d.length){if(typeof d[0]!=="string"&&d[0]!==null&&d[0].length){f={rule:"and",rows:[]};for(var j=0;j<d.length;j++){f.rows.push(d[j][i.variable])}}else{f=d[i.variable]}}else{if(typeof d==="string"){f=d}}}g._viz_filter_classes=g._viz_filter_classes||[];g._viz_otrasCondiciones=g._viz_otrasCondiciones||[];if(a!==null&&i.variable==a){g._viz_filter_classes.push({variable:i.variable,value:f,aggregation:c});g._viz_filter_interactions={variable:i.variable,value:f,aggregation:c};g.enableEvents(true);if(e._numElements[a]&&e._numElements[a]>1){g.fixedclic(function(h){if(h.which!=3){e.clicFilter(this._viz_filter_interactions,this._viz_otrasCondiciones)}})}}else{if(f!=d){g._viz_filter_classes.push({variable:i.variable,value:f,aggregation:c})}}});if(g._viz_filter_classes&&g._viz_filter_classes.length>0){this.unitElements.push(g);if(g._viz_filter_interactions){for(var b=0;b<g._viz_filter_classes.length;b++){if(g._viz_filter_classes[b].variable!=g._viz_filter_interactions.variable){g._viz_otrasCondiciones.push(g._viz_filter_classes[b])}}}}if(typeof g._highlight_id!=="undefined"&&this.highlight_on_hover&&!g._is_legend_element&&!g._is_hidden_by_filter){g.mouseenter(function(){if(this._is_hidden_by_filter){return}if(window._highlightOFF_timeout){clearTimeout(window._highlightOFF_timeout);window._highlightOFF_timeout=null}for(var f=0;f<e.elements.length;f++){e.highlightON(this,e.elements[f].grgroup);e.highlightON(this,e.elements[f].linksgroup);e.highlightON(this,e.elements[f].labelsgroup);e.highlightON(this,e.elements[f].annotationgroup);if(e.elements[f].labelsgroup){for(var h=0;h<e.elements[f].labelsgroup.length;h++){if(this.highlight_same_color_elements_on_hover==false&&e.elements[f].labelsgroup.item(h)._label_highlight_id==this._highlight_id){e.elements[f].labelsgroup.item(h)._tmp_highlight_allow_overlap=true}else{e.elements[f].labelsgroup.item(h)._tmp_highlight_allow_overlap=false}}e.elements[f].labelsgroup.check_overlapping(true)}}});g.mouseleave(function(f){if(this._is_hidden_by_filter){return}if(window._highlightOFF_timeout){clearTimeout(window._highlightOFF_timeout);window._highlightOFF_timeout=null}window._highlightOFF_timeout=setTimeout(function(){for(var h=0;h<e.elements.length;h++){e.highlightOFF(e.elements[h].grgroup);e.highlightOFF(e.elements[h].linksgroup);e.highlightOFF(e.elements[h].labelsgroup);e.highlightOFF(e.elements[h].annotationgroup)}},200)})}};graphica.View.fn.highlightON=function(d,a){var c=this;var b=[];a.each(function(){if(typeof this._prev_highlight_opacity==="undefined"){this._prev_highlight_opacity=this.opacity();if(this._prev_highlight_opacity===""){this._prev_highlight_opacity=1}}if(this._is_hidden_by_filter){this._hide_by_highlight=false;b.push(this._prev_highlight_opacity)}else{if(typeof this._highlight_ids==="undefined"||this._highlight_ids.includes(d._highlight_id)==false){this._hide_by_highlight=true;b.push(c._highlight_alpha)}else{this._hide_by_highlight=false;this.opacity(this._prev_highlight_opacity);b.push(this._prev_highlight_opacity)}}});a.stop().opacity(b)};graphica.View.fn.highlightOFF=function(a){var b=[];a.each(function(){this._hide_by_highlight=false;if(this._is_hidden_by_filter||typeof this._prev_highlight_opacity!=="undefined"){b.push(this._prev_highlight_opacity)}else{b.push(1)}});a.stop().animate(200).opacity(b)};graphica.View.fn.filterWrapperAxis=function(a){var b=a._variable;if(this._dataset.isQuantitative(b)||this._dataset.isDateType(b)){var c=this;this.eachFilterVar(function(l){if(l.variable==b&&l.seleccion=="range"){var e=a._max_posicion-a._min_posicion;var d=a._orientation;var k=a._reversed;var g=a._scale;var h;if(c._dataset.isDateType(b)){h=a._dataset.getDateTicks(b,a._stat).ticks}else{h={min:a._min,max:a._max}}var f;var i;var j=l.filtrosAplicados;if(j.length){f=j[0].min;i=j[0].max}c._rangeSliders.push(new graphica.RangeSlider(e,d,k,h,function(n,m){c.clicFilter({variable:l.variable,min:n,max:m,aggregation:a._stat})},g,f,i,c._dataset.isQuantitative(b)).getGrape().x(a.innerX()).y(a.innerY()))}})}};graphica.View.fn.eachFilterVar=function(a){if(this._viewidgroup!=-1){this._viewgroup.eachFilterVar(this._viewidgroup,a)}};graphica.View.fn.clicFilter=function(a,b){if(this._viewidgroup!=-1){this._viewgroup.clicFilter(this._viewidgroup,a,b)}};graphica.View.fn.getSVGFileContents=function(c,d){if(typeof c==="undefined"){c=this._width}if(typeof d==="undefined"){d=this._height}var a=new Grape("div").style("width",c+"px").style("height",d+"px");this._settings.general.static_view=true;var b=new graphica.View(a,this._dataset,this._settings,null,null,true);raceme._applyAttributesandStyle(a.seed);this._settings.general.static_view=false;return a.innerHTML()};graphica.View.fn.getPNGFileContents=function(g,h,c,f){if(typeof g!=="boolean"){g=false}if(typeof h==="undefined"){h=this._width}if(typeof c==="undefined"){c=this._height}var i=1;if(g){i=2}var a=new Grape("div","html",true,i).style("width",h+"px").style("height",c+"px");var e=new Grape("canvas","html",true,i);e.addTo(a);raceme._applyAttributesandStyle(a.seed);this._settings.general.static_view=true;var b=new graphica.View(e,this._dataset,this._settings,null,null,true,f);if(b._target.pixi.ticker){b._target.pixi.ticker.stop()}b._target.pixi.render();var d;if(g){d=e.seed.toDataURL("image/png").replace(/^data:image\/png;base64,/,"")}else{d=e.pixi.renderer.plugins.extract.canvas(e.pixi.stage).toDataURL("image/png").replace(/^data:image\/png;base64,/,"")}this._settings.general.static_view=false;return d};graphica.ViewGroup=function(a){this._dataset=a;this.views=[];this.viewsFilters=[];this.viewidcounter=0};graphica.ViewGroup.fn=graphica.ViewGroup.prototype;graphica.ViewGroup.fn.add=function(g,d){var e=new graphica.View(g,this._dataset,d,this,this.viewidcounter,false);this.views.push(e);var a=[];if(d&&typeof d.grammar!="undefined"){for(var b=0;b<d.grammar.length;b++){if(typeof d.grammar[b].interaction=="string"&&d.grammar[b].interaction!="none"){var f=this._dataset.header.getId(d.grammar[b].variable);a.push({variable:f,seleccion:d.grammar[b].interaction,filtrosAplicados:[],aggregation:null})}}}this.viewsFilters.push(a);this.viewidcounter++;if(window&&window.process&&window.process.type&&g.containsClass("chart")){e._is_view_op_app=true}e.init();e.checkLabelingOverlap();if(typeof this.isBasicChart!=="undefined"){var c=new Grape("div","html");c.attr("style","position:absolute;left:"+(Math.max(4,e.frame._left_padding))+"px;bottom:2px;font-size:11px;opacity:0.8;color:#666;font-family:Roboto,Inter,Arial,sans-serif;");c.innerHTML('Created with <a href="https://www.graphica.app" target="_blank" style="text-decoration:underline;color:#1e87f0">SCImago Graphica</a>');if(typeof g==="string"){g=by("id:"+g)}c.addTo(g);if(getComputedStyle(g.seed).position=="static"){g.style("position","relative")}}return this};graphica.ViewGroup.fn.eachFilterVar=function(a,c){for(var b=0;b<this.viewsFilters[a].length;b++){c.call(this,this.viewsFilters[a][b])}};graphica.ViewGroup.fn.removeFilters=function(a){var d=false;var c=this.viewsFilters[a];for(var b=0;b<c.length;b++){if(c[b].filtrosAplicados.length>0){c[b].filtrosAplicados=[];d=true}}if(d){this.reGen(a)}if(this.views[a]._rangeSliders){for(b=0;b<this.views[a]._rangeSliders.length;b++){this.views[a]._rangeSliders[b]._reset_slider()}}};graphica.ViewGroup.fn.showhideReset=function(b){if(this.views[b].reset_button_grape){var a=true;var d=this.viewsFilters[b];for(var c=0;c<d.length;c++){if(d[c].filtrosAplicados.length>0){a=false;break}}if(a){if(this.views[b].reset_button_grape.opacity()>0){this.views[b].reset_button_grape.stop().animate(100).opacity(0).done(function(){this.hide()})}}else{if(this.views[b].reset_button_grape.opacity()==0){this.views[b].reset_button_grape.opacity(0).show().stop().animate(100).opacity(1)}}}};graphica.ViewGroup.fn.clicFilter=function(a,l,k){var h=this;var n=false;k=k||[];var p=this.viewsFilters[a];var m=false;var b=false;var c;var g=0;for(var f=0;f<p.length;f++){if(p[f].variable==l.variable&&((typeof l.min!=="undefined"&&p[f].seleccion=="range")||p[f].seleccion!="range")){p[f].aggregation=l.aggregation;g=f;if(typeof l.min!=="undefined"){p[f].filtrosAplicados=[{min:l.min,max:l.max}];n=true;break}else{if(p[f].filtrosAplicados.length==0||(p[f].seleccion=="simple"&&p[f].filtrosAplicados.length>1)){p[f].filtrosAplicados=[l.value];m=true}else{var e=p[f].filtrosAplicados.indexOf(l.value);if(e!=-1){p[f].filtrosAplicados.splice(e,1)}else{if(p[f].seleccion=="simple"){p[f].filtrosAplicados=[l.value];m=true}else{p[f].filtrosAplicados.push(l.value);if(p[f].filtrosAplicados.length==this.views[a]._numElements[l.variable]){b=true;filtro_primario_limpiar=f}m=true}}}break}}}if(k.length){for(f=0;f<p.length;f++){if(f!=g){for(var d=0;d<k.length;d++){if(p[f].variable==k[d].variable){if(m==true){if(p[f].seleccion=="simple"||p[f].filtrosAplicados.length==0){if(typeof k[d].value=="string"){p[f].filtrosAplicados=[k[d].value]}else{if(typeof k[d].value.rows!="undefined"){p[f].filtrosAplicados=k[d].value.rows.slice(0)}}}else{if(typeof k[d].value=="string"){if(p[f].filtrosAplicados.indexOf(k[d].value)==-1){p[f].filtrosAplicados.push(k[d].value)}}else{if(typeof k[d].value.rows!="undefined"){for(var q=0;q<k[d].value.rows.length;q++){if(p[f].filtrosAplicados.indexOf(k[d].value.rows[q])==-1){p[f].filtrosAplicados.push(k[d].value.rows[q])}}}}}if(b&&p[f].filtrosAplicados.length==this.views[a]._numElements[k[d].variable]){p[f].filtrosAplicados=[];p[filtro_primario_limpiar].filtrosAplicados=[]}}else{if(p[f].seleccion=="simple"){p[f].filtrosAplicados=[]}else{if(k[d].value.rule){for(var q=0;q<k[d].value.rows.length;q++){var o=p[f].filtrosAplicados.indexOf(k[d].value.rows[q]);if(o!=-1){p[f].filtrosAplicados.splice(o,1)}}}}}}}}}}this.reGen(a,n)};graphica.ViewGroup.fn.reGen=function(c,b){var h=this;var g=[];for(var d=0;d<this.viewsFilters.length;d++){for(var f=0;f<this.viewsFilters[d].length;f++){if(this.viewsFilters[d][f].filtrosAplicados.length>0){g.push({variable:this.viewsFilters[d][f].variable,filtrosAplicados:this.viewsFilters[d][f].filtrosAplicados,id_view:d})}}}this.views[c].reFade();var a;var e;if(b){if(this.rangeTimer){clearTimeout(this.rangeTimer);this.rangeTimer=null}var h=this;this.rangeTimer=setTimeout(function(){for(e=0;e<h.views.length;e++){if(e!=c){a=h.remakeDataSet(e,g);h.views[e].reInit(a)}}},300)}else{for(e=0;e<h.views.length;e++){if(e!=c){a=this.remakeDataSet(e,g);h.views[e].reInit(a)}}}};graphica.ViewGroup.fn.remakeDataSet=function(b,d){var a;var c=this;var a;if(d.length>0){a=this._dataset.where(function(i){for(var h=0;h<d.length;h++){if(d[h].id_view!=b){var f=d[h].variable;if(typeof d[h].filtrosAplicados[0]!=="undefined"&&typeof d[h].filtrosAplicados[0].min!=="undefined"){if(c._dataset.isDateType(f)){var e=i[f];if(e<d[h].filtrosAplicados[0].min||e>d[h].filtrosAplicados[0].max){return false}}else{if(i[f]<d[h].filtrosAplicados[0].min||i[f]>d[h].filtrosAplicados[0].max){return false}}}else{var g=d[h].filtrosAplicados;if(g.indexOf(i[f])==-1){return false}}}}return true});if(this._dataset.edges){a.edges=this._dataset.edges.clone();a.edges.initAsNetwork(a)}}else{a=this._dataset}return a};graphica.ViewGroup.fn.eachByClass=function(c,a){for(var b=0;b<this.views.length;b++){this.views[b].eachByClass(c,a)}return this};graphica.Chart=function(b,a){graphica.ViewGroup.call(this,b);if(typeof a==="undefined"||typeof a.license_domain!=="string"||a.license_domain.trim()==""){this.isBasicChart=true}};graphica.Chart.prototype=new graphica.ViewGroup();


/*
SCImago Graphica  All rights reserved, 2021.
https://www.graphica.app
No warranty, explicit or implicit, provided.
This software may be freely copied and distributed, but not modified, sublicensed or sold.

----------------------------------------------------------------------------------------------
Algorithms used in this software
----------------------------------------------------------------------------------------------

Wallinger, M.; Archambault, D.; Auber, D.; Nllenburg, M.; Peltonen. J. (2021). Edge-Path Bundling: A Less Ambiguous Edge Bundling Approach. https://arxiv.org/abs/2108.05467
Clauset, A.; Newman, M.E.J.; Moore, C. (2004). Finding community structure in very large networks. Phys. Rev. E 70, 066111 (2004)
Fruchterman, T.M.J.; Reingold, E.M. (1991). Graph Drawing by Force-Directed Placement. Software  Practice & Experience, Wiley, 21 (11): 11291164
Kamada, T.; Kawai, S. (1989)- An algorithm for drawing general undirected graphs. Information Processing Letters, Elsevier, 31 (1): 715
Noack, A. (2007). Energy Models for Graph Clustering. Journal of Graph Algorithms and Applications. vol. 11, no. 2, pp. 453480 (2007)
Dijkstra, E. W. (1959). A note on two problems in connexion with graphs. Numerische Mathematik. 1: 269271. 
Dougenik, J. A. et al. (1985).  An Algotithm to construct continuous area cartograms. The Professional Geographer 37 (1985): 75-81.


----------------------------------------------------------------------------------------------
Third party software licenses, which may be contained in part in SCImago Graphica core 
----------------------------------------------------------------------------------------------

https://github.com/springmeyer/arc.js/
Copyright (c) Dane Springmeyer

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

* Redistributions of source code must retain the above copyright
  notice, this list of conditions and the following disclaimer.
* Redistributions in binary form must reproduce the above copyright
  notice, this list of conditions and the following disclaimer in
  the documentation and/or other materials provided with the
  distribution.
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.




https://github.com/mwallinger-tu/edge-path-bundling
Copyright (c) 2021 Markus Wallinger

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.



https://github.com/AndriiHeonia/hull
Copyright (c) 2014-2020, Andrii Heonia
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

* Redistributions of source code must retain the above copyright notice, this
  list of conditions and the following disclaimer.

* Redistributions in binary form must reproduce the above copyright notice,
  this list of conditions and the following disclaimer in the documentation
  and/or other materials provided with the distribution.

* Neither the name of the author nor the names of its
  contributors may be used to endorse or promote products derived from
  this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.


https://github.com/dagrejs/dagre
Copyright (c) 2012-2014 Chris Pettitt

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

--

Graph JavaScript framework, version 0.0.1
(c) 2006 Aslak Hellesoy <aslak.hellesoy@gmail.com>
(c) 2006 Dave Hoover <dave.hoover@gmail.com>
 
Ported from Graph::Layouter::Spring in
http://search.cpan.org/~pasky/Graph-Layderer-0.02/
The algorithm is based on a spring-style layouter of a Java-based social
network tracker PieSpy written by Paul Mutton E<lt>paul@jibble.orgE<gt>.
 
Graph is freely distributable under the terms of an MIT-style license.
For details, see the Graph web site: http://dev.buildpatternd.com/trac

--

LinLogLayout
Copyright (C) 2008 Andreas Noack

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA 

--

https://github.com/mholt/PapaParse
The MIT License (MIT)
Copyright (c) 2015 Matthew Holt

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

--

pixi.js-legacy - v6.1.3
Compiled Mon, 13 Sep 2021 15:18:01 UTC
pixi.js-legacy is licensed under the MIT License.
http://www.opensource.org/licenses/mit-license

--

pixi-filters - v3.0.3
Compiled Wed, 29 May 2019 03:04:05 UTC
pixi-filters is licensed under the MIT License.
http://www.opensource.org/licenses/mit-license

--

pixi-tagged-text
https://github.com/mimshwright/pixi-tagged-text/blob/main/LICENSE.md
The MIT License (MIT)

Copyright (c) 2014 Tommy Leunen

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

--

d-path-parser - v1.0.0
by Massimo Artizzu (MaxArt2501)
https://github.com/MaxArt2501/d-path-parser
Licensed under the MIT License
See LICENSE for details

--

RacemeJS 1.0
By Yusef Hassan Montero
Licensed under the MIT License

--

Easing Functions (Equations)
Open source under the MIT License and the 3-Clause BSD License.
MIT License
Copyright  2001 Robert Penner

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

BSD License
Copyright  2001 Robert Penner

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
Neither the name of the author nor the names of contributors may be used to endorse or promote products derived from this software without specific prior written permission.
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

--

https://github.com/nicopolyptic/treemap
MIT License

Copyright (c) 2015 Nicholas Nguyen

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

--

https://github.com/mourner/simpleheat
Copyright (c) 2015, Vladimir Agafonkin
All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are
permitted provided that the following conditions are met:

   1. Redistributions of source code must retain the above copyright notice, this list of
      conditions and the following disclaimer.

   2. Redistributions in binary form must reproduce the above copyright notice, this list
      of conditions and the following disclaimer in the documentation and/or other materials
      provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

--

Javascript Quadtree 
@version 1.1.1
@licence MIT
@author Timo Hausmann
https://github.com/timohausmann/quadtree-js/

Copyright  2012 Timo Hausmann
Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:
The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENthis. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

--

https://github.com/Tom-Alexander/regression-js
The MIT License (MIT)
Copyright (c) Tom Alexander <me@tomalexander.co.nz>

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

--

Copyright (C) 2012 Shawn Allen

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

*/
 



